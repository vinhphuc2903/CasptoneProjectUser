!function (e, t) { if ("function" == typeof define && define.amd) define(["jquery", "jquery-ui"], t); else if ("undefined" != typeof exports) { var n, i; try { n = require("jquery"), i = require("jquery-ui") } catch (e) { } module.exports = t(n, i) } else t(e.jQuery, e.jQuery.ui, !0) }(this, function (e, t, n) { var i, a, o, r, s, l, c, d, p, u, h = function (t, n, i) { var a, o, r, s, l, c, d, p, u, f, m, g, v, b, y, w, x, k, C, z, T, A, j, O, S = this, I = [], M = ["button", "tooltip"], E = e(t), F = e.extend(!0, {}, e._data(E.get(0), "events")), D = e("<div></div>").append(E.contents()).attr("class", E.attr("class") || "").attr("style", E.attr("style") || ""), U = E.attr("id") || E.attr("id", "elfauto" + e(".elfinder").length).attr("id"), P = "elfinder-" + U, q = "mousedown." + P, R = "keydown." + P, H = "keypress." + P, _ = "keyup." + P, N = !1, L = !1, W = "", B = { path: "", url: "", tmbUrl: "", disabled: [], separator: "/", archives: [], extract: [], copyOverwrite: !0, uploadOverwrite: !0, uploadMaxSize: 0, jpgQuality: 100, tmbCrop: !1, tmbReqCustomData: !1, tmb: !1 }, $ = {}, V = {}, K = {}, X = {}, J = [], G = {}, Y = {}, Q = [], Z = {}, ee = [], te = [], ne = new S.command(S), ie = "auto", ae = 400, oe = null, re = "sounds/", se = "", le = !1, ce = e(document.createElement("audio")).hide().appendTo("body")[0], de = 0, pe = "", ue = null, he = function (t) { var n, i, a, o, r, s, l, c = {}, d = {}; S.api >= 2.1 ? (S.commandMap = t.options.uiCmdMap && Object.keys(t.options.uiCmdMap).length ? t.options.uiCmdMap : {}, pe !== JSON.stringify(S.commandMap) && (pe = JSON.stringify(S.commandMap))) : S.options.sync = 0, t.init ? (V = {}, X = {}) : (r = W, n = "elfinder-subtree-loaded " + S.res("class", "navexpand"), S.res("class", "navcollapse"), i = Object.keys(V), a = function (e) { if (!V[e]) return !0; var t = "directory" === V[e].mime, i = V[e].phash; !(!t || c[i] || !d[i] && S.navHash2Elm(V[e].hash).is(":hidden") && S.navHash2Elm(i).next(".elfinder-navbar-subtree").children().length > 100) || !t && i === W || Z[e] ? t && (d[i] = !0) : (t && !c[i] && (c[i] = !0, S.navHash2Elm(i).removeClass(n).next(".elfinder-navbar-subtree").empty()), ge(V[e])) }, o = function () { i.length && (ue && ue._abort(), ue = S.asyncJob(a, i, { interval: 20, numPerOnce: 100 }).done(function () { var t = S.storage("hide") || { items: {} }; Object.keys(K).length && e.each(K, function (e) { t.items[e] || delete K[e] }) })) }, S.trigger("filesgc").one("filesgc", function () { i = [] }), S.one("opendone", function () { r !== W && (E.data("lazycnt") ? S.one("lazydone", o) : o()) })), S.sorters = {}, W = t.cwd.hash, fe(t.files), V[W] ? (l = S.diff([t.cwd], !0)).changed.length && (fe(l.changed, "change"), S.change({ changed: l.changed })) : fe([t.cwd]), t.changed && t.changed.length && fe(t.changed, "change"), s = JSON.stringify(S.sorters), se !== s && (S.trigger("sorterupdate"), se = s), S.lastDir(W), S.autoSync() }, fe = function (t, n) { n = n || "files"; var i, a, o, r, s, l = ["sizeInfo", "encoding"], c = { name: !0, perm: !0, date: !0, size: !0, kind: !0 }, d = !S.sorters._checked && "files" === n, p = t.length, u = function (t) { var n = t || {}, i = []; e.each(S.sortRules, function (e) { (c[e] || void 0 !== n[e] || "mode" === e && void 0 !== n.perm) && i.push(e) }), S.sorters = S.arrayFlip(i, !0), S.sorters._checked = !0 }, h = {}, f = S.storage("hide") || {}, m = f.items || {}; for (a = 0; a < p; a++)if (i = Object.assign({}, t[a]), s = !(f.show || !m[i.hash]), i.name && i.hash && i.mime) { if (s || (d && i.phash === W && (u(i), d = !1), !i.phash || "add" !== n && ("change" !== n || V[i.hash] && i.size === V[i.hash]) || (r = S.parents(i.phash)) && e.each(r, function () { h[this] = !0 })), V[i.hash]) { for (o = 0; o < l.length; o++)V[i.hash][l[o]] && !i[l[o]] && (i[l[o]] = V[i.hash][l[o]]); i.sizeInfo && !i.size && (i.size = i.sizeInfo.size), ge(V[i.hash], !0) } m[i.hash] && (K[i.hash] = i), s ? (p--, t.splice(a--, 1)) : (V[i.hash] = i, "directory" !== i.mime || X[i.hash] || (X[i.hash] = {}), i.phash && (X[i.phash] || (X[i.phash] = {}), X[i.phash][i.hash] = !0)) } e.each(Object.keys(h), function () { var e = V[this]; e && e.sizeInfo && delete e.sizeInfo }), d && u() }, me = function (t) { var n, i = t.length, a = {}, o = function (t) { var i = V[t]; i && ("directory" === i.mime && (a[t] && delete S.roots[a[t]], e.each(S.leafRoots, function (n, i) { var a, o; -1 !== (a = e.inArray(t, i)) && (1 === i.length ? ((o = Object.assign({}, V[n])) && o._realStats && (e.each(o._realStats, function (e, t) { o[e] = t }), me(V[n]._realStats), S.change({ changed: [o] })), delete S.leafRoots[n]) : S.leafRoots[n].splice(a, 1)) }), S.searchStatus.state < 2 && e.each(V, function (e, n) { n.phash == t && o(e) })), i.phash && (n = S.parents(i.phash)) && e.each(n, function () { r[this] = !0 }), ge(V[t])) }, r = {}; for (e.each(S.roots, function (e, t) { a[t] = e }); i--;)o(t[i]); e.each(Object.keys(r), function () { var e = V[this]; e && e.sizeInfo && delete e.sizeInfo }) }, ge = function (e, t) { var n = e.hash, i = e.phash; i && X[i] && delete X[i][n], t || (X[n] && delete X[n], S.optionsByHashes[n] && delete S.optionsByHashes[n]), delete V[n] }, ve = 0, be = [], ye = null, we = function (t) { var n, i = t.keyCode, a = !(!t.ctrlKey && !t.metaKey), o = "mousedown" === t.type; !o && (S.keyState.keyCode = i), S.keyState.ctrlKey = a, S.keyState.shiftKey = t.shiftKey, S.keyState.metaKey = t.metaKey, S.keyState.altKey = t.altKey, o || ("keyup" !== t.type ? N && (e.each(Y, function (e, n) { n.type == t.type && n.keyCode == i && n.shiftKey == t.shiftKey && n.ctrlKey == a && n.altKey == t.altKey && (t.preventDefault(), t.stopPropagation(), n.callback(t, S), S.debug("shortcut-exec", e + " : " + n.description)) }), i != e.ui.keyCode.TAB || e(t.target).is(":input") || t.preventDefault(), "keydown" === t.type && i == e.ui.keyCode.ESCAPE && (E.find(".ui-widget:visible").length || S.clipboard().length && S.clipboard([]), e.ui.ddmanager && (n = e.ui.ddmanager.current) && n.helper && n.cancel(), S.toHide(E.find(".ui-widget.elfinder-button-menu.elfinder-frontmost:visible")), S.trigger("keydownEsc", t))) : S.keyState.keyCode = null) }, xe = new Date, ke = window.parent !== window, Ce = function () { var t, n; if (ke) try { (n = e("iframe", window.parent.document)).length && e.each(n, function (n, i) { if (i.contentWindow === window) return t = e(i), !1 }) } catch (e) { } return t }(); n || (n = {}), S.UA.Mobile && e(window).on("orientationchange." + P, function () { var e = (screen && screen.orientation && screen.orientation.angle || window.orientation || 0) + 0; -90 === e && (e = 270), S.UA.Angle = e, S.UA.Rotated = e % 180 != 0 }).trigger("orientationchange." + P), n.bootCallback && "function" == typeof n.bootCallback && (p = i, u = n.bootCallback, i = function (e, t) { p && "function" == typeof p && p.call(this, e, t), u.call(this, e, t) }), delete n.bootCallback, this.api = null, this.newAPI = !1, this.oldAPI = !1, this.netDrivers = [], this.baseUrl = "", this.i18nBaseUrl = "", this.cssloaded = !1, this.theme = null, this.mimesCanMakeEmpty = {}, this.bootCallback, this.reloadCallback, this.id = U, this.storage = function () { try { return "localStorage" in window && null !== window.localStorage ? (S.UA.Safari && (window.localStorage.setItem("elfstoragecheck", 1), window.localStorage.removeItem("elfstoragecheck")), S.localStorage) : S.cookie } catch (e) { return S.cookie } }(), this.pauseUnloadCheck = function (e, t) { if (void 0 === e) return le; le = !!e, e && !t && requestAnimationFrame(function () { le = !1 }) }, this.options = Object.assign({}, this._options), n.uiOptions && n.uiOptions.toolbar && Array.isArray(n.uiOptions.toolbar) && e.isPlainObject(n.uiOptions.toolbar[n.uiOptions.toolbar.length - 1]) && (S.options.uiOptions.toolbarExtra = Object.assign(S.options.uiOptions.toolbarExtra || {}, n.uiOptions.toolbar.pop())), (f = function (t, n) { e.isPlainObject(t) && e.each(t, function (t, i) { e.isPlainObject(i) ? (n[t] || (n[t] = {}), f(i, n[t])) : n[t] = i }) })(n, S.options), this.options.uiOptions.toolbar.push(this.options.uiOptions.toolbarExtra), delete this.options.uiOptions.toolbarExtra, this.toUnbindEvents = {}, this.bind = function (e, t, n) { var i, a; if (t && ("function" == typeof t || "function" == typeof t.done)) for (a = (e = ("" + e).toLowerCase().replace(/^\s+|\s+$/g, "").split(/\s+/)).length, i = 0; i < a; i++)void 0 === G[e[i]] && (G[e[i]] = []), G[e[i]][n ? "unshift" : "push"](t); return this }, this.unbind = function (t, n) { var i, a, o, r; for (a = (t = ("" + t).toLowerCase().split(/\s+/)).length, i = 0; i < a; i++)(o = G[t[i]]) && (r = e.inArray(n, o)) > -1 && o.splice(r, 1); return n = null, this }, this.trigger = function (t, n, i) { var a, o, r, s, l = t.toLowerCase(), c = "object" == typeof n, d = G[l] || [], p = []; if (this.debug("event-" + l, n), c && void 0 !== i || (i = !0), o = d.length) { for (s = e.Event(l), n && (n._getEvent = function () { return s }), i && (s.data = n), a = 0; a < o; a++)if (d[a]) if (d[a].done) p.push(d[a].done); else { if (d[a].length && !i) { if (void 0 === r) try { r = JSON.stringify(n) } catch (e) { r = !1 } s.data = r ? JSON.parse(r) : n } try { if (!1 === d[a].call(s, s, this) || s.isDefaultPrevented()) { this.debug("event-stoped", s.type); break } } catch (e) { window.console && window.console.log && window.console.log(e) } } if (o = p.length) for (a = 0; a < o; a++)try { if (!1 === p[a].call(s, s, this) || s.isDefaultPrevented()) { this.debug("event-stoped", s.type + "(done)"); break } } catch (e) { window.console && window.console.log && window.console.log(e) } this.toUnbindEvents[l] && this.toUnbindEvents[l].length && (e.each(this.toUnbindEvents[l], function (e, t) { S.unbind(t.type, t.callback) }), delete this.toUnbindEvents[l]) } return this }, this.getListeners = function (e) { return e ? G[e.toLowerCase()] : G }, this.baseUrl = function () { var t, n, i; return S.options.baseUrl ? S.options.baseUrl : (i = "", t = null, e("head > script").each(function () { if (this.src && this.src.match(/js\/elfinder(?:-[a-z0-9_-]+)?\.(?:min|full)\.js$/i)) return t = e(this), !1 }), t && ((i = t.attr("src").replace(/js\/[^\/]+$/, "")).match(/^(https?\/\/|\/)/) || (n = e("head > base[href]").attr("href")) && (i = n.replace(/\/$/, "") + "/" + i)), "" !== i ? S.options.baseUrl = i : (S.options.baseUrl || (S.options.baseUrl = "./"), i = S.options.baseUrl), i) }(), this.i18nBaseUrl = (this.options.i18nBaseUrl || this.baseUrl + "js/i18n").replace(/\/$/, "") + "/", this.options.maxErrorDialogs = Math.max(1, parseInt(this.options.maxErrorDialogs || 5)), B.dispInlineRegex = this.options.dispInlineRegex, this.options.cssAutoLoad && (m = S.baseUrl, g = e('head > link[href$="css/elfinder.min.css"],link[href$="css/elfinder.full.css"]:first').length, v = function () { E.data("cssautoloadHide") && (E.data("cssautoloadHide").remove(), E.removeData("cssautoloadHide")) }, b = function () { S.cssloaded || (v(), S.cssloaded = !0, S.trigger("cssloaded")) }, g || (S.cssloaded = null), Array.isArray(S.options.cssAutoLoad) && (S.options.themes.default ? !0 === S.cssloaded ? S.loadCss(S.options.cssAutoLoad) : S.bind("cssloaded", function () { S.loadCss(S.options.cssAutoLoad) }) : (S.options.themes = Object.assign({ default: { name: "default", cssurls: S.options.cssAutoLoad } }, S.options.themes), S.options.theme || (S.options.theme = "default"))), null === S.cssloaded && (E.addClass("elfinder").data("cssautoloadHide", e("<style>.elfinder{visibility:hidden;overflow:hidden}</style>")), e("head").append(E.data("cssautoloadHide")), S.options.themes.default || (S.options.themes = Object.assign({ default: { name: "default", cssurls: "css/theme.css", author: "elFinder Project", license: "3-clauses BSD" } }, S.options.themes), S.options.theme || (S.options.theme = "default")), requestAnimationFrame(function () { "hidden" === E.css("visibility") ? S.loadCss([m + "css/elfinder.min.css"], { dfd: e.Deferred().done(function () { b() }).fail(function () { v(), S.cssloaded || (S.cssloaded = !1, S.bind("init", function () { S.cssloaded || S.error(["errRead", "CSS (elfinder.min)"]) })) }) }) : b() }))), w = S.options.themes, (x = Object.keys(w || {})).length && (w[y = S.storage("theme") || S.options.theme] || (y = x[0]), S.cssloaded ? S.changeTheme(y) : S.bind("cssloaded", function () { S.changeTheme(y) })), this.optionProperties = { icon: void 0, csscls: void 0, tmbUrl: void 0, uiCmdMap: {}, netkey: void 0, disabled: [] }, ke || this.options.enableAlways || 2 !== e("body").children().length || (this.options.enableAlways = !0), !0 === this.options.debug ? this.options.debug = "all" : Array.isArray(this.options.debug) ? (k = {}, e.each(S.options.debug, function () { k[this] = !0 }), S.options.debug = k) : this.options.debug = !1, this.noConflicts = {}, this.noConflict = function () { e.each(M, function (t, n) { e.fn[n] && "function" == typeof e.fn[n].noConflict && (S.noConflicts[n] = e.fn[n].noConflict()) }) }, this.noConflict(), this.isCORS = !1, function () { if (void 0 !== S.options.cors && null !== S.options.cors) S.isCORS = !!S.options.cors; else { var t, i = document.createElement("a"), a = window.location.protocol, o = function (e) { return "https:" === (e = e && ":" !== e ? e : a) ? /\:443$/ : /\:80$/ }, r = window.location.host.replace(o(a), ""); i.href = n.url, n.urlUpload && n.urlUpload !== n.url && ((t = document.createElement("a")).href = n.urlUpload), (r !== i.host.replace(o(i.protocol), "") || ":" !== i.protocol && "" !== i.protocol && a !== i.protocol || t && (r !== t.host.replace(o(t.protocol), "") || ":" !== t.protocol && "" !== t.protocol && a !== t.protocol)) && (S.isCORS = !0) } S.isCORS && (e.isPlainObject(S.options.customHeaders) || (S.options.customHeaders = {}), e.isPlainObject(S.options.xhrFields) || (S.options.xhrFields = {}), S.options.requestType = "post", S.options.customHeaders["X-Requested-With"] = "XMLHttpRequest", S.options.xhrFields.withCredentials = !0) }(), this.requestType = /^(get|post)$/i.test(this.options.requestType) ? this.options.requestType.toLowerCase() : "get", r = Math.max(parseInt(this.options.requestMaxConn), 1), this.optsCustomData = e.isPlainObject(this.options.customData) ? this.options.customData : {}, this.customData = Object.assign({}, this.optsCustomData), this.prevCustomData = null, this.customHeaders = e.isPlainObject(this.options.customHeaders) ? this.options.customHeaders : {}, this.xhrFields = e.isPlainObject(this.options.xhrFields) ? this.options.xhrFields : {}, this.replaceXhrSend = function () { d || (d = XMLHttpRequest.prototype.send), XMLHttpRequest.prototype.send = function () { var t = this; return S.customHeaders && e.each(S.customHeaders, function (e) { t.setRequestHeader(e, this) }), S.xhrFields && e.each(S.xhrFields, function (e) { e in t && (t[e] = this) }), d.apply(this, arguments) } }, this.restoreXhrSend = function () { d && (XMLHttpRequest.prototype.send = d) }, this.abortCmdsOnOpen = this.options.abortCmdsOnOpen || ["tmb", "parents"], this.navPrefix = "nav" + (h.prototype.uniqueid ? h.prototype.uniqueid : "") + "-", this.cwdPrefix = h.prototype.uniqueid ? "cwd" + h.prototype.uniqueid + "-" : "", ++h.prototype.uniqueid, this.uploadURL = n.urlUpload || n.url, this.namespace = P, this.today = new Date(xe.getFullYear(), xe.getMonth(), xe.getDate()).getTime() / 1e3, this.yesterday = this.today - 86400, s = this.options.UTCDate ? "UTC" : "", this.getHours = "get" + s + "Hours", this.getMinutes = "get" + s + "Minutes", this.getSeconds = "get" + s + "Seconds", this.getDate = "get" + s + "Date", this.getDay = "get" + s + "Day", this.getMonth = "get" + s + "Month", this.getFullYear = "get" + s + "FullYear", this.zIndex, this.searchStatus = { state: 0, query: "", target: "", mime: "", mixed: !1, ininc: !1 }, this.lang = this.storage("lang") || this.options.lang, "jp" === this.lang && (this.lang = this.options.lang = "ja"), this.viewType = this.storage("view") || this.options.defaultView || "icons", this.sortType = this.storage("sortType") || this.options.sortType || "name", this.sortOrder = this.storage("sortOrder") || this.options.sortOrder || "asc", this.sortStickFolders = this.storage("sortStickFolders"), null === this.sortStickFolders ? this.sortStickFolders = !!this.options.sortStickFolders : this.sortStickFolders = !!this.sortStickFolders, this.sortAlsoTreeview = this.storage("sortAlsoTreeview"), null === this.sortAlsoTreeview || null === this.options.sortAlsoTreeview ? this.sortAlsoTreeview = !!this.options.sortAlsoTreeview : this.sortAlsoTreeview = !!this.sortAlsoTreeview, this.sortRules = e.extend(!0, {}, this._sortRules, this.options.sortRules), e.each(this.sortRules, function (e, t) { "function" != typeof t && delete S.sortRules[e] }), this.compare = e.proxy(this.compare, this), this.notifyDelay = this.options.notifyDelay > 0 ? parseInt(this.options.notifyDelay) : 500, this.draggingUiHelper = null, this.droppable = { greedy: !0, tolerance: "pointer", accept: ".elfinder-cwd-file-wrapper,.elfinder-navbar-dir,.elfinder-cwd-file,.elfinder-cwd-filename", hoverClass: this.res("class", "adroppable"), classes: { "ui-droppable-hover": this.res("class", "adroppable") }, autoDisable: !0, drop: function (t, n) { var i, a, o, r = e(this), s = e.grep(n.helper.data("files") || [], function (e) { return !!e }), l = [], c = [], d = [], p = n.helper.hasClass("elfinder-drag-helper-plus"), u = "class"; if (void 0 === t.button || n.helper.data("namespace") !== P || !S.insideWorkzone(t.pageX, t.pageY)) return !1; for (a = r.hasClass(S.res(u, "cwdfile")) ? S.cwdId2Hash(r.attr("id")) : r.hasClass(S.res(u, "navdir")) ? S.navId2Hash(r.attr("id")) : W, i = s.length; i--;)(o = s[i]) != a && V[o].phash != a ? l.push(o) : (p && o !== a && V[a].write ? c : d).push(o); if (d.length) return !1; n.helper.data("droped", !0), c.length && (n.helper.hide(), S.exec("duplicate", c, { _userAction: !0 })), l.length && (n.helper.hide(), S.clipboard(l, !p), S.exec("paste", a, { _userAction: !0 }, a).always(function () { S.clipboard([]), S.trigger("unlockfiles", { files: s }) }), S.trigger("drop", { files: s })) } }, this.enabled = function () { return N && this.visible() }, this.visible = function () { return E[0].elfinder && E.is(":visible") }, this.isRoot = function (e) { return !(!e.isroot && e.phash) }, this.root = function (t, n) { var i, a; if (t = t || W, !n && (e.each(S.roots, function (e, n) { if (0 === t.indexOf(e)) return i = n, !1 }), i)) return i; for (i = V[t]; i && i.phash && (n || !i.isroot);)i = V[i.phash]; if (i) return i.hash; for (; a in V && V.hasOwnProperty(a);)if ("directory" === (i = V[a]).mime && !i.phash && i.read) return i.hash; return "" }, this.cwd = function () { return V[W] || {} }, this.option = function (t, n) { var i, a; return n = n || W, S.optionsByHashes[n] && void 0 !== S.optionsByHashes[n][t] ? S.optionsByHashes[n][t] : !S.hasVolOptions || W === n || (a = S.file(n)) && a.phash === W ? $[t] || "" : (i = "", e.each(S.volOptions, function (e, a) { if (0 === n.indexOf(e)) return i = a[t] || "", !1 }), i) }, this.getDisabledCmds = function (t, n) { var i = { hidden: !0 }; return Array.isArray(t) || (t = [t]), e.each(t, function (e, t) { var n = S.option("disabledFlip", t); n && Object.assign(i, n) }), n ? i : Object.keys(i) }, this.file = function (e, t) { return e ? V[e] || (t ? K[e] : void 0) : void 0 }, this.files = function (t) { var n = {}; return t ? X[t] ? (e.each(X[t], function (e) { V[e] ? n[e] = V[e] : delete X[t][e] }), Object.assign({}, n)) : {} : Object.assign({}, V) }, this.parents = function (e) { for (var t, n = []; e && (t = this.file(e));)n.unshift(t.hash), e = t.phash; return n }, this.path2array = function (e, t) { for (var n, i = []; e;) { if (!(n = V[e]) || !n.hash) { i = []; break } i.unshift(t && n.i18 ? n.i18 : n.name), e = n.isroot ? null : n.phash } return i }, this.path = function (t, n, i) { var a = V[t] && V[t].path ? V[t].path : this.path2array(t, n).join($.separator); if (i && V[t]) { i = Object.assign({ notify: { type: "parents", cnt: 1, hideCnt: !0 } }, i); var o, r = e.Deferred(), s = i.notify, l = !1, c = function () { S.request({ data: { cmd: "parents", target: V[t].phash }, notify: s, preventFail: !0 }).done(d).fail(function () { r.reject() }) }, d = function () { S.one("parentsdone", function () { "" === (a = S.path(t, n)) && l ? (l = !1, c()) : (s && (clearTimeout(o), s.cnt = -parseInt(s.cnt || 0), S.notify(s)), r.resolve(a)) }) }; return a ? r.resolve(a) : (S.ui.tree ? (s && (o = setTimeout(function () { S.notify(s) }, S.notifyDelay)), l = !0, d(!0)) : c(), r) } return a }, this.url = function (t, n) { var i, a = V[t], o = n || {}, r = o.async || !1, s = o.temporary || !1, l = o.onetime && S.option("onetimeUrl", t) || !1, c = o.absurl || !1, d = r || l ? e.Deferred() : null, p = function (e) { return e && c && (e = S.convAbsUrl(e)), e }, u = function (n) { if (n) return p(n); if (a.url) return p(a.url); if (void 0 === i && (i = h()), i) return p(i + e.map(S.path2array(t), function (e) { return encodeURIComponent(e) }).slice(1).join("/")); var o = Object.assign({}, S.customData, { cmd: "file", target: a.hash }); return S.oldAPI && (o.cmd = "open", o.current = a.phash), p(S.options.url + (-1 === S.options.url.indexOf("?") ? "?" : "&") + e.param(o, !0)) }, h = function () { return S.option("url", !S.isRoot(a) && a.phash || a.hash) }; if (!a || !a.read) return r ? d.resolve("") : ""; if (!l || a.url && "1" != a.url || (i = h())) if ("1" == a.url || s && !a.url && !(i = h())) this.request({ data: { cmd: "url", target: t, options: { temporary: s ? 1 : 0 } }, preventDefault: !0, options: { async: r }, notify: r ? { type: s ? "file" : "url", cnt: 1, hideCnt: !0 } : {}, progressBar: o.progressBar }).done(function (e) { a.url = e.url || "" }).fail(function () { a.url = "" }).always(function () { var e; if (a.url && s && (e = a.url, a.url = "1"), !r) return u(e); d.resolve(u(e)) }); else { if (!r) return u(); d.resolve(u()) } else r = !0, this.request({ data: { cmd: "url", target: t, options: { onetime: 1 } }, preventDefault: !0, options: { async: r }, notify: { type: "file", cnt: 1, hideCnt: !0 }, progressBar: o.progressBar }).done(function (e) { d.resolve(p(e.url || "")) }).fail(function () { d.resolve("") }); return r ? d : void 0 }, this.forExternalUrl = function (e, t) { var n = { async: !0, absurl: !0 }; return n[S.option("onetimeUrl", e) ? "onetime" : "temporary"] = !0, S.url(e, Object.assign({}, t, n)) }, this.openUrl = function (t, n, i, a) { var o = V[t], r = "", s = (a || {}).onetimeSize || 5242880; return o && o.read ? n && "sameorigin" !== n || (o.url ? 1 != o.url && (r = o.url) : $.url && 0 === o.hash.indexOf(S.cwd().volumeid) && (r = $.url + e.map(this.path2array(t), function (e) { return encodeURIComponent(e) }).slice(1).join("/")), n && !this.isSameOrigin(r) || !r) ? i && this.hasParrotHeaders() ? (a ? delete a.onetimeSize : a = {}, !a.onetime && !a.temporary && o.size > s && (o.mime.match(/^video|audio/) ? a.temporary = !0 : a.onetime = !0), a.onetime || a.temporary ? this.url(o.hash, Object.assign({ async: !0 }, a)).done(function (e) { i(e) }).fail(function () { i("") }) : this.getContents(t, "blob", a).done(function (e) { r = (window.URL || window.webkitURL).createObjectURL(e), i(r) }).fail(function () { i("") })) : (r = (r = this.options.url) + (-1 === r.indexOf("?") ? "?" : "&") + (this.oldAPI ? "cmd=open&current=" + o.phash : "cmd=file") + "&target=" + o.hash + "&_t=" + (o.ts || parseInt(+new Date / 1e3)), !0 === n && (r += "&download=1"), e.each(this.customData, function (e, t) { r += "&" + encodeURIComponent(e) + "=" + encodeURIComponent(t) }), i ? void i(r) : r) : (r += (r.match(/\?/) ? "&" : "?") + "_".repeat((r.match(/[\?&](_+)t=/g) || ["&t="]).sort().shift().match(/[\?&](_*)t=/)[1].length + 1) + "t=" + (o.ts || parseInt(+new Date / 1e3)), i ? void i(r) : r) : "" }, this.tmb = function (t) { var n, i, a = "elfinder-cwd-bgurl", o = "", r = {}, s = 0; return !(!e.isPlainObject(t) || (S.searchStatus.state && 0 !== t.hash.indexOf(S.cwd().volumeid) ? (n = S.option("tmbUrl", t.hash), i = S.option("tmbCrop", t.hash)) : (n = $.tmbUrl, i = $.tmbCrop), i && (a += " elfinder-cwd-bgurl-crop"), "self" === n && 0 === t.mime.indexOf("image/") ? (o = S.openUrl(t.hash), a += " elfinder-cwd-bgself") : (S.oldAPI || n) && t && t.tmb && 1 != t.tmb ? o = n + t.tmb : S.newAPI && t && t.tmb && 1 != t.tmb && (o = t.tmb), !o)) && ("self" !== n && (t.ts && (r._t = t.ts), $.tmbReqCustomData && Object.keys(this.customData).length && (r = Object.assign(r, this.customData)), Object.keys(r).length && (o += o.match(/\?/) ? "&" : "?", e.each(r, function (e, t) { o += (0 == s++ ? "" : "&") + encodeURIComponent(e) + "=" + encodeURIComponent(t) }))), { url: o, className: a }) }, this.selected = function () { return J.slice(0) }, this.selectedFiles = function () { return e.map(J, function (e) { return V[e] ? Object.assign({}, V[e]) : null }) }, this.fileByName = function (e, t) { var n; for (n in V) if (V.hasOwnProperty(n) && V[n].phash == t && V[n].name == e) return V[n] }, this.validResponse = function (e, t) { return t.error || this.rules[this.rules[e] ? e : "defaults"](t) }, this.returnBytes = function (e) { var t; return isNaN(e) ? (e || (e = ""), t = (e = e.replace(/b$/i, "")).charAt(e.length - 1).toLowerCase(), e = e.replace(/[tgmk]$/i, ""), "t" == t ? e = 1024 * e * 1024 * 1024 * 1024 : "g" == t ? e = 1024 * e * 1024 * 1024 : "m" == t ? e = 1024 * e * 1024 : "k" == t && (e *= 1024), e = isNaN(e) ? 0 : parseInt(e)) : (e = parseInt(e)) < 1 && (e = 0), e }, this.request = function (t) { var n, i, a, o, s = this, l = this.options, c = e.Deferred(), d = (+new Date).toString(16) + Math.floor(1e3 * Math.random()).toString(16), p = Object.assign({}, s.customData, { mimes: l.onlyMimes }, t.data || t), u = p.cmd, h = "binary" === (t.options || {}).dataType, f = !t.asNotOpen && "open" === u, m = !(h || t.preventDefault || t.preventFail), g = !(h || t.preventDefault || t.preventDone), v = t.progressVal || 20, b = null, y = !1, w = t.progressBar ? {} : t.notify ? Object.assign({ progress: v * t.notify.cnt }, t.notify) : {}, x = !!t.cancel, k = h || !!t.raw, C = t.syncOnFail, z = !!t.lazy, T = t.prepare, A = t.navigate, j = (t.options || {}).cache, O = Object.assign({ url: l.url, async: !0, type: this.requestType, dataType: "json", cache: s.api >= 2.1029, data: p, headers: this.customHeaders, xhrFields: this.xhrFields, progress: function (e) { var n = e.loaded / e.total * 100; if (b && clearTimeout(b), t.progressBar) try { t.progressBar.width(n + "%") } catch (e) { } else y && w.type && (n *= w.cnt, v < n && (s.notify({ type: w.type, progress: n - v, cnt: 0, hideCnt: w.hideCnt }), v = n)); if (t.progress) try { t.progress(e) } catch (e) { } } }, t.options || {}), S = function (t) { t.warning && s.error(t.warning), f ? he(t) : s.updateCache(t), s.lazy(function () { t.removed && t.removed.length && s.remove(t), t.added && t.added.length && s.add(t), t.changed && t.changed.length && s.change(t) }).then(function () { return s.lazy(function () { s.trigger(u, t, !1) }) }).then(function () { return s.lazy(function () { s.trigger(u + "done") }) }).then(function () { t.toasts && Array.isArray(t.toasts) && e.each(t.toasts, function () { this.msg && s.toast(this) }), t.sync && s.sync() }) }, I = function (e, t) { var n, i, a = s.options.debug; switch (t) { case "abort": n = e.quiet ? "" : ["errConnect", "errAbort"]; break; case "timeout": n = ["errConnect", "errTimeout"]; break; case "parsererror": n = ["errResponse", "errDataNotJSON"], e.responseText && (!W || a && ("all" === a || a["backend-error"])) && n.push(e.responseText); break; default: if (e.responseText) try { (i = JSON.parse(e.responseText)) && i.error && (n = i.error) } catch (e) { } if (!n) if (403 == e.status) n = ["errConnect", "errAccess", "HTTP error " + e.status]; else if (404 == e.status) n = ["errConnect", "errNotFound", "HTTP error " + e.status]; else if (e.status >= 500) n = ["errResponse", "errServerError", "HTTP error " + e.status]; else { if (414 == e.status && "get" === O.type) return O.type = "post", s.abortXHR(e), void (c.xhr = e = s.transport.send(O).fail(n).done(M)); n = e.quiet ? "" : ["errConnect", "HTTP error " + e.status] } }s.trigger(u + "done"), c.reject({ error: n }, e, t) }, M = function (t) { if (s.currentReqCmd = u, t.debug && s.responseDebug(t), s.setCustomHeaderByXhr(i), k) return s.abortXHR(i), t && t.debug && s.debug("backend-debug", t), c.resolve(t); if (!t) return c.reject({ error: ["errResponse", "errDataEmpty"] }, i, t); if (!e.isPlainObject(t)) return c.reject({ error: ["errResponse", "errDataNotJSON"] }, i, t); if (t.error) return f && e.each(s.leafRoots, function (t, n) { s.leafRoots[t] = e.grep(n, function (e) { return e !== p.target }) }), c.reject({ error: t.error }, i, t); var n = function () { var n, a = function (n) { s.leafRoots[p.target] && t[n] && e.each(s.leafRoots[p.target], function (e, i) { var a; (a = s.file(i)) && t[n].push(a) }) }, o = function () { s.textMimes = {}, e.each(s.res("mimes", "text"), function () { s.textMimes[this.toLowerCase()] = !0 }) }; if (f ? a("files") : "tree" === u && a("tree"), t = s.normalize(t), !s.validResponse(u, t)) return c.reject({ error: t.norError || "errResponse" }, i, t); f && (s.api || (s.api = t.api || 1, "2.0" == s.api && void 0 !== t.options.uploadMaxSize && (s.api = "2.1"), s.newAPI = s.api >= 2, s.oldAPI = !s.newAPI), t.textMimes && Array.isArray(t.textMimes) && (s.resources.mimes.text = t.textMimes, o()), !s.textMimes && o(), t.options && ($ = Object.assign({}, B, t.options)), t.netDrivers && (s.netDrivers = t.netDrivers), t.maxTargets && (s.maxTargets = t.maxTargets), p.init && (s.uplMaxSize = s.returnBytes(t.uplMaxSize), s.uplMaxFile = t.uplMaxFile ? Math.min(parseInt(t.uplMaxFile), 50) : 20)), "function" == typeof T && T(t), A && (n = A.target || "added", t[n] && t[n].length && s.one(u + "done", function () { var i = t[n], a = s.findCwdNodes(i), o = function () { var t = s.cwd().hash; return e.map(i, function (e) { return e.phash && t === e.phash ? e.hash : null }) }, r = o(), l = function (t) { var n, i, a, l = void 0, c = t.action ? t.action.data : void 0; return (c || r.length) && t.action && (i = t.action.msg) && (n = t.action.cmd) && (!t.action.cwdNot || t.action.cwdNot !== s.cwd().hash) && (a = t.action.done, c = t.action.data, l = e("<div></div>").append(e('<button type="button" class="ui-button ui-widget ui-state-default ui-corner-all elfinder-tabstop"><span class="ui-button-text">' + s.i18n(i) + "</span></button>").on("mouseenter mouseleave", function (t) { e(this).toggleClass("ui-state-hover", "mouseenter" == t.type) }).on("click", function () { s.exec(n, c || r, { _userAction: !0, _currentType: "toast", _currentNode: e(this) }), a && s.one(n + "done", function () { "function" == typeof a ? a() : "select" === a && s.trigger("selectfiles", { files: o() }) }) }))), delete t.action, t.extNode = l, t }; A.toast || (A.toast = {}), !A.noselect && s.trigger("selectfiles", { files: s.searchStatus.state > 1 ? e.map(i, function (e) { return e.hash }) : r }), a.length ? (A.noscroll || (a.first().trigger("scrolltoview", { blink: !1 }), s.resources.blink(a, "lookme")), e.isPlainObject(A.toast.incwd) && s.toast(l(A.toast.incwd))) : e.isPlainObject(A.toast.inbuffer) && s.toast(l(A.toast.inbuffer)) })), c.resolve(t), t.debug && s.debug("backend-debug", t) }; s.abortXHR(i), z ? s.lazy(n) : n() }, E = function (e) { i && "pending" === i.state() && (s.abortXHR(i, { quiet: !0, abort: !0 }), (!e || "unload" !== e.type && "destroy" !== e.type) && s.autoSync()) }, F = function (e) { if (s.trigger(u + "done"), "autosync" == e.type) { if ("stop" != e.data.action) return } else if (!("unload" == e.type || "destroy" == e.type || "openxhrabort" == e.type || e.data.added && e.data.added.length)) return; E(e) }, D = function (t) { var n = function () { C = !1, c.reject() }; if (t && "cmd" === t) return u; if (f) { if (ye && "pending" === ye.state()) { if (ye._target === p.target) return c.reject("openabort"); ye.xhr ? ye.xhr.queueAbort() : ye.reject("openabort") } (ye = c)._target = p.target } if (c.always(function () { delete O.headers["X-elFinderReqid"], f && (ye = null) }).fail(function (t, n, i) { var a, r; f && "openabort" === t && (t = "", C = !1), a = { cmd: u, err: t, xhr: n, rc: i }, 0 === t && be.length && (be = e.grep(be, function (e) { return e("cmd") !== u })), s.trigger("requestError", a), a._getEvent && a._getEvent().isDefaultPrevented() && (m = !1, C = !1, t && (t.error = "")), E(), f && (o = s.file(p.target)) && o.volumeid && s.isRoot(o) && delete s.volumeExpires[o.volumeid], s.trigger(u + "fail", i), (r = "object" == typeof t ? t.error : t) && (m ? s.error(r) : s.debug("error", s.i18n(r))), C && s.sync() }), !u) return C = !1, c.reject({ error: "errCmdReq" }); if (s.maxTargets && p.targets && p.targets.length > s.maxTargets) return C = !1, c.reject({ error: ["errMaxTargets", s.maxTargets] }); if (g && c.done(S), f) { for (; a = ee.pop();)a.queueAbort(); if (W !== p.target) for (; a = te.pop();)a.queueAbort() } return -1 !== e.inArray(u, (s.cmdsToAdd + " autosync").split(" ")) && ("autosync" !== u && (s.autoSync("stop"), c.always(function () { s.autoSync() })), s.trigger("openxhrabort")), delete O.preventFail, s.api >= 2.1029 && (j ? O.headers["X-elFinderReqid"] = d : Object.assign(O.data, { reqid: d })), c.syncOnFail = function (e) { C = !!e }, ve++, c.xhr = i = s.transport.send(O).always(function () { O._xhr && void 0 !== O._xhr.responseURL && (i.responseURL = O._xhr.responseURL || ""), --ve, be.length && be.shift()() }).fail(I).done(M), s.api >= 2.1029 && (i._requestId = d), f || p.compare && "info" === u ? (i.queueAbort = n, ee.unshift(i), p.compare && s.bind(s.cmdsToAdd + " autosync openxhrabort", F), c.always(function () { var t = e.inArray(i, ee); p.compare && s.unbind(s.cmdsToAdd + " autosync openxhrabort", F), -1 !== t && ee.splice(t, 1) })) : -1 !== e.inArray(u, s.abortCmdsOnOpen) && (i.queueAbort = n, te.unshift(i), c.always(function () { var t = e.inArray(i, te); -1 !== t && te.splice(t, 1) })), s.bind("unload destroy", F), c.always(function () { s.unbind("unload destroy", F) }), c }, U = function () { return w.type && w.cnt && (x && (w.cancel = c, t.eachCancel && (w.id = +new Date)), n = setTimeout(function () { b = setTimeout(P, 1e3), s.notify(w), y = !0, c.always(function () { w.cnt = -(parseInt(w.cnt) || 0), s.notify(w), y = !1 }) }, s.notifyDelay), c.always(function () { clearTimeout(n) })), ve < r ? D() : (f ? be.unshift(D) : be.push(D), c) }, P = function () { var e; y && b && (e = 1 * w.cnt, b = null, s.notify({ type: w.type, progress: e, cnt: 0, hideCnt: w.hideCnt }), (v += e) / w.cnt < 80 && (b = setTimeout(P, 500))) }, q = { opts: t, result: !0 }; return s.api || p.init ? (s.trigger("request." + u, q, !0), q.result ? "object" == typeof q.result && q.result.promise ? (q.result.done(U).fail(function () { s.trigger(u + "done"), c.reject() }), c) : U() : (s.trigger(u + "done"), c.reject())) : (C = !1, c.reject()) }, this.cache = function (e, t) { Array.isArray(e) || (e = [e]), fe(e, t) }, this.updateCache = function (t) { e.isPlainObject(t) && (t.files && t.files.length && fe(t.files, "files"), t.tree && t.tree.length && fe(t.tree, "tree"), t.removed && t.removed.length && me(t.removed), t.added && t.added.length && fe(t.added, "add"), t.changed && t.changed.length && fe(t.changed, "change")) }, this.diff = function (t, n, i) { var a = {}, o = [], r = [], s = [], l = null; return e.each(t, function (e, t) { a[t.hash] = t }), i && i.length && (l = {}, e.each(i, function () { l[this] = !0 })), e.each(V, function (e, t) { a[e] || n && t.phash !== n || r.push(e) }), e.each(a, function (t, n) { var i, a = V[t], r = {}; a ? (e.each(Object.keys(a), function () { r[this] = !0 }), e.each(n, function (e) { if (delete r[e], !(l && l[e] || n[e] === a[e])) return s.push(n), r = {}, !1 }), 0 !== (i = Object.keys(r).length) && (l && e.each(r, function (e) { l[e] && --i }), 0 !== i && s.push(n))) : o.push(n) }), e.each(r, function (t, n) { var i = V[n], o = i.phash; o && "directory" == i.mime && -1 === e.inArray(o, r) && a[o] && !function (e) { for (var t = s.length; t--;)if (s[t].hash == e) return !0 }(o) && s.push(a[o]) }), { added: o, removed: r, changed: s } }, this.sync = function (t, n) { this.autoSync("stop"); var i, a, o, r, s = this, l = (a = "", o = 0, r = 0, t && n && e.each(V, function (e, n) { n.phash && n.phash === t && (++o, r = Math.max(r, n.ts)), a = o + ":" + r }), a), c = e.Deferred().always(function () { !i && s.trigger("sync") }), d = [this.request({ data: { cmd: "open", reload: 1, target: W, tree: !t && this.ui.tree ? 1 : 0, compare: l }, preventDefault: !0 })]; return !t && s.api >= 2 && (W !== this.root() && d.push(this.request({ data: { cmd: "parents", target: W }, preventDefault: !0 })), e.each(function () { for (var e, t = [], n = s.file(s.root(W)), i = n ? n.volumeid : null, a = s.cwd().phash; a;)(e = s.file(a)) ? (0 !== a.indexOf(i) && (t.push({ target: a, cmd: "tree" }), s.isRoot(e) || t.push({ target: a, cmd: "parents" }), i = (n = s.file(s.root(a))) ? n.volumeid : null), a = e.phash) : a = null; return t }(), function (e, t) { d.push(s.request({ data: { cmd: t.cmd, target: t.target }, preventDefault: !0 })) })), e.when.apply(e, d).fail(function (t, a) { i = a && 200 != a.status, n && -1 === e.inArray("errOpen", t) ? c.reject(t && 0 != a.status ? t : void 0) : (c.reject(t), s.parseError(t) && s.request({ data: { cmd: "open", target: s.lastDir("") || s.root(), tree: 1, init: 1 }, notify: { type: "open", cnt: 1, hideCnt: !0 } })) }).done(function (e) { var n, i, a; if (e.cwd.compare && l === e.cwd.compare) return c.reject(); if (n = { tree: [] }, (i = arguments.length) > 1) for (a = 1; a < i; a++)arguments[a].tree && arguments[a].tree.length && n.tree.push.apply(n.tree, arguments[a].tree); if (s.api < 2.1 && (n.tree || (n.tree = []), n.tree.push(e.cwd)), e = s.normalize(e), !s.validResponse("open", e)) return c.reject(e.norError || "errResponse"); if (n = s.normalize(n), !s.validResponse("tree", n)) return c.reject(n.norError || "errResponse"); var o = s.diff(e.files.concat(n && n.tree ? n.tree : []), t); return o.added.push(e.cwd), s.updateCache(o), o.removed.length && s.remove(o), o.added.length && s.add(o), o.changed.length && s.change(o), c.resolve(o) }).always(function () { s.autoSync() }), c }, this.upload = function (e) { return this.transport.upload(e, this) }, this.shortcut = function (t) { var n, i, a, o, r; if (this.options.allowShortcuts && t.pattern && e.isFunction(t.callback)) for (n = t.pattern.toUpperCase().split(/\s+/), o = 0; o < n.length; o++)(a = 1 == (a = (r = (i = n[o]).split("+")).pop()).length ? a > 0 ? a : a.charCodeAt(0) : a > 0 ? a : e.ui.keyCode[a]) && !Y[i] && (Y[i] = { keyCode: a, altKey: -1 != e.inArray("ALT", r), ctrlKey: -1 != e.inArray("CTRL", r), shiftKey: -1 != e.inArray("SHIFT", r), type: t.type || "keydown", callback: t.callback, description: t.description, pattern: i }); return this }, this.shortcuts = function () { var t = []; return e.each(Y, function (e, n) { t.push([n.pattern, S.i18n(n.description)]) }), t }, this.clipboard = function (t, n) { var i = function () { return e.map(Q, function (e) { return e.hash }) }; return void 0 !== t && (Q.length && this.trigger("unlockfiles", { files: i() }), Z = {}, Q = e.map(t || [], function (e) { var t = V[e]; return t ? (Z[e] = !0, { hash: e, phash: t.phash, name: t.name, mime: t.mime, read: t.read, locked: t.locked, cut: !!n }) : null }), this.trigger("changeclipboard", { clipboard: Q.slice(0, Q.length) }), n && this.trigger("lockfiles", { files: i() })), Q.slice(0, Q.length) }, this.isCommandEnabled = function (e, t) { var n, i, a = S.cwd().volumeid || ""; return !t && S.searchStatus.state > 1 && S.selected().length && (t = S.selected()[0]), n = !t || a && 0 === t.indexOf(a) ? $.disabledFlip : S.option("disabledFlip", t), !!(i = this._commands[e]) && (i.alwaysEnabled || !n[e]) }, this.exec = function (t, n, i, a) { var o, r; return !a && this.commandMap[t] && "hidden" !== this.commandMap[t] && (t = this.commandMap[t]), "open" === t && ((this.searchStatus.state || this.searchStatus.ininc) && this.trigger("searchend", { noupdate: !0 }), this.autoSync("stop")), !a && n && (e.isArray(n) ? n.length && (a = n[0]) : a = n), "object" === (r = typeof (o = this._commands[t] && this.isCommandEnabled(t, a) ? this._commands[t].exec(n, i) : e.Deferred().reject("errUnknownCmd"))) && o.promise || (S.debug("warning", '"cmd.exec()" should be returned "$.Deferred" but cmd "' + t + '" returned "' + r + '"'), o = e.Deferred().resolve()), this.trigger("exec", { dfrd: o, cmd: t, files: n, opts: i, dstHash: a }), o }, this.dialog = function (t, n) { var i = e("<div></div>").append(t).appendTo(E).elfinderdialog(n, S), a = i.closest(".ui-dialog"), o = function () { !i.data("draged") && i.is(":visible") && i.elfinderdialog("posInit") }; return a.length && (S.bind("resize", o), a.on("remove", function () { S.unbind("resize", o) })), i }, this.toast = function (t) { return e('<div class="ui-front"></div>').appendTo(this.ui.toast).elfindertoast(t || {}, this) }, this.getUI = function (t) { return t ? this.ui[t] || e() : E }, this.getCommand = function (e) { return void 0 === e ? this._commands : this._commands[e] }, this.resize = function (t, n) { var i, a = !E.hasClass("ui-resizable"), o = E.data("resizeSize") || { w: 0, h: 0 }, r = {}; oe && oe.data("resizeTm") && clearTimeout(oe.data("resizeTm")), "string" == typeof n && (i = n.match(/^([0-9.]+)%$/)) && (oe && oe.length || (oe = e(window)), oe.data("marginToMyNode") || oe.data("marginToMyNode", function () { for (var e = E.outerHeight(!0) - E.innerHeight(), t = E; t.get(0) !== oe.get(0) && (e += (t = t.parent()).outerHeight(!0) - t.innerHeight(), t.parent().length);); return e }()), oe.data("fitToBaseFunc") || oe.data("fitToBaseFunc", function (e) { var t = oe.data("resizeTm"); e.preventDefault(), e.stopPropagation(), t && cancelAnimationFrame(t), E.hasClass("elfinder-fullscreen") || S.UA.Mobile && oe.data("rotated") === S.UA.Rotated || (oe.data("rotated", S.UA.Rotated), oe.data("resizeTm", requestAnimationFrame(function () { S.restoreSize() }))) }), void 0 === oe.data("rotated") && oe.data("rotated", S.UA.Rotated), n = oe.height() * (i[1] / 100) - oe.data("marginToMyNode"), oe.off("resize." + S.namespace, oe.data("fitToBaseFunc")), a && oe.on("resize." + S.namespace, oe.data("fitToBaseFunc"))), E.css({ width: t, height: parseInt(n) }), r.w = Math.round(E.width()), r.h = Math.round(E.height()), E.data("resizeSize", r), r.w === o.w && r.h === o.h || (E.trigger("resize"), this.trigger("resize", { width: r.w, height: r.h })) }, this.restoreSize = function () { this.resize(ie, ae) }, this.show = function () { E.show(), this.enable().trigger("show") }, this.hide = function () { this.options.enableAlways && (L = N, N = !1), this.disable(), this.trigger("hide"), E.hide() }, this.lazy = function (t, n, i) { var a = function (e) { var t, n = E.data("lazycnt"); e ? (t = !E.data("lazyrepaint") && i.repaint, n ? E.data("lazycnt", ++n) : E.data("lazycnt", 1).addClass("elfinder-processing"), t && E.data("lazyrepaint", !0).css("display")) : n && n > 1 ? E.data("lazycnt", --n) : (t = E.data("lazyrepaint"), E.data("lazycnt", 0).removeData("lazyrepaint").removeClass("elfinder-processing"), t && E.css("display"), S.trigger("lazydone")) }, o = e.Deferred(), r = function () { o.resolve(t.call(o)), a(!1) }; return n = n || 0, i = i || {}, a(!0), n ? setTimeout(r, n) : requestAnimationFrame(r), o }, this.destroy = function () { E && E[0].elfinder && (E.hasClass("elfinder-fullscreen") && S.toggleFullscreen(E), this.options.syncStart = !1, this.autoSync("forcestop"), this.trigger("destroy").disable(), Q = [], J = [], G = {}, Y = {}, e(window).off("." + P), e(document).off("." + P), S.trigger = function () { }, e(ce).remove(), E.off().removeData().empty().append(D.contents()).attr("class", D.attr("class")).attr("style", D.attr("style")), delete E[0].elfinder, e.each(F, function (t, n) { e.each(n, function (e, t) { E.on(t.type + (t.namespace ? "." + t.namespace : ""), t.selector, t.handler) }) })) }, this.autoSync = function (t) { var n; if (S.options.sync >= 1e3) { if (o && (clearTimeout(o), o = null, S.trigger("autosync", { action: "stop" })), "stop" === t ? ++de : de = Math.max(0, --de), de || "forcestop" === t || !S.options.syncStart) return; (n = function (t) { var i; $.syncMinMs && (t || o) && (t && S.trigger("autosync", { action: "start" }), i = Math.max(S.options.sync, $.syncMinMs), o && clearTimeout(o), o = setTimeout(function () { var t, a = !0, r = W; $.syncChkAsTs && V[r] && (t = V[r].ts) ? S.request({ data: { cmd: "info", targets: [r], compare: t, reload: 1 }, preventDefault: !0 }).done(function (e) { var i; a = !0, e.compare && (i = e.compare) == t && (a = !1), a ? S.sync(r).always(function () { i && (V[r].ts = i), n() }) : n() }).fail(function (t, a) { var r = S.parseError(t); r && 0 != a.status ? (S.error(r), Array.isArray(r) && -1 !== e.inArray("errOpen", r) && S.request({ data: { cmd: "open", target: S.lastDir("") || S.root(), tree: 1, init: 1 }, notify: { type: "open", cnt: 1, hideCnt: !0 } })) : o = setTimeout(function () { n() }, i) }) : S.sync(W, !0).always(function () { n() }) }, i)) })(!0) } }, this.insideWorkzone = function (e, t, n) { var i = this.getUI("workzone").data("rectangle"); return n = n || 1, !(e < i.left + n || e > i.left + i.width + n || t < i.top + n || t > i.top + i.height + n) }, this.toFront = function (t) { var n = E.children(".ui-front").removeClass("elfinder-frontmost"), i = n.last(); n.css("z-index", ""), e(t).addClass("ui-front elfinder-frontmost").css("z-index", i.css("z-index") + 1) }, this.toHide = function (t, n) { var i, a = e(t); !n && a.hide(), a.hasClass("elfinder-frontmost") && (a.removeClass("elfinder-frontmost"), (i = E.children(".ui-front:visible:not(.elfinder-frontmost)").last()).length && requestAnimationFrame(function () { E.children(".elfinder-frontmost:visible").length || (S.toFront(i), i.trigger("frontmost")) })) }, this.getMaximizeCss = function () { return { width: "100%", height: "100%", margin: 0, top: 0, left: 0, display: "block", position: "fixed", zIndex: Math.max(S.zIndex ? S.zIndex + 1 : 0, 1e3), maxWidth: "", maxHeight: "" } }, function () { ke && S.UA.Fullscreen && (S.UA.Fullscreen = !1, Ce && void 0 !== Ce.attr("allowfullscreen") && (S.UA.Fullscreen = !0)); var t, n, i, a, o = "elfinder-fullscreen", r = "elfinder-fullscreen-native", s = function () { var t = 0, n = 0; e.each(E.children(".ui-dialog,.ui-draggable"), function (i, a) { var o = e(a), r = o.position(); r.top < 0 && (o.css("top", t), t += 20), r.left < 0 && (o.css("left", n), n += 20) }) }, l = function () { var i = S.storage("useFullscreen"); a = S.UA.Fullscreen && (i ? i > 0 : "screen" === S.options.commandsOptions.fullscreen.mode) ? { fullElm: function () { return document.fullscreenElement || document.webkitFullscreenElement || document.mozFullScreenElement || document.msFullscreenElement || null }, exitFull: function () { return document.exitFullscreen ? document.exitFullscreen() : document.webkitExitFullscreen ? document.webkitExitFullscreen() : document.mozCancelFullScreen ? document.mozCancelFullScreen() : document.msExitFullscreen ? document.msExitFullscreen() : void 0 }, toFull: function (e) { return e.requestFullscreen ? e.requestFullscreen() : e.webkitRequestFullscreen ? e.webkitRequestFullscreen() : e.mozRequestFullScreen ? e.mozRequestFullScreen() : !!e.msRequestFullscreen && e.msRequestFullscreen() } } : { fullElm: function () { var e; return E.hasClass(o) ? E.get(0) : (e = E.find("." + o)).length ? e.get(0) : null }, exitFull: function () { var i; e(window).off("resize." + P, d), void 0 !== n && e("body").css("overflow", n), n = void 0, t && (i = t.elm, c(i), e(i).trigger("resize", { fullscreen: "off" })), e(window).trigger("resize") }, toFull: function (t) { return n = e("body").css("overflow") || "", e("body").css("overflow", "hidden"), e(t).css(S.getMaximizeCss()).addClass(o).trigger("resize", { fullscreen: "on" }), s(), e(window).on("resize." + P, d).trigger("resize"), !0 } } }, c = function (n) { t && t.elm == n && (e(n).removeClass(o + " " + r).attr("style", t.style), t = null) }, d = function (t) { var n; t.target === window && (i && cancelAnimationFrame(i), i = requestAnimationFrame(function () { (n = a.fullElm()) && e(n).trigger("resize", { fullscreen: "on" }) })) }; l(), e(document).on("fullscreenchange." + P + " webkitfullscreenchange." + P + " mozfullscreenchange." + P + " MSFullscreenChange." + P, function (n) { if (S.UA.Fullscreen) { var l = a.fullElm(), p = e(window); i && cancelAnimationFrame(i), null === l ? (p.off("resize." + P, d), t && (l = t.elm, c(l), e(l).trigger("resize", { fullscreen: "off" }))) : (e(l).addClass(o + " " + r).attr("style", "width:100%; height:100%; margin:0; padding:0;").trigger("resize", { fullscreen: "on" }), p.on("resize." + P, d), s()), p.trigger("resize") } }), S.toggleFullscreen = function (n, i) { var o, r = e(n).get(0); if (o = a.fullElm()) { if (o == r) { if (!0 === i) return o } else if (!1 === i) return o; return a.exitFull(), null } return !1 === i ? null : (l(), t = { elm: r, style: e(r).attr("style") }, !1 !== a.toFull(r) ? r : (t = null, null)) } }(), z = "elfinder-maximized", T = function (e) { if (e.target === window && e.data && e.data.elm) { var t = e.data.elm; C && cancelAnimationFrame(C), C = requestAnimationFrame(function () { t.trigger("resize", { maximize: "on" }) }) } }, S.toggleMaximize = function (t, n) { var i = e(t); if (i.hasClass(z)) { if (!0 === n) return; !function (t) { e(window).off("resize." + P, T), e("body").css("overflow", t.data("bodyOvf")), t.removeClass(z).attr("style", t.data("orgStyle")).removeData("bodyOvf").removeData("orgStyle"), t.trigger("resize", { maximize: "off" }) }(i) } else { if (!1 === n) return; !function (t) { t.data("bodyOvf", e("body").css("overflow") || "").data("orgStyle", t.attr("style")).addClass(z).css(S.getMaximizeCss()), e("body").css("overflow", "hidden"), e(window).on("resize." + P, { elm: t }, T), t.trigger("resize", { maximize: "on" }) }(i) } }, Object.assign(e.ui.keyCode, { F1: 112, F2: 113, F3: 114, F4: 115, F5: 116, F6: 117, F7: 118, F8: 119, F9: 120, F10: 121, F11: 122, F12: 123, DIG0: 48, DIG1: 49, DIG2: 50, DIG3: 51, DIG4: 52, DIG5: 53, DIG6: 54, DIG7: 55, DIG8: 56, DIG9: 57, NUM0: 96, NUM1: 97, NUM2: 98, NUM3: 99, NUM4: 100, NUM5: 101, NUM6: 102, NUM7: 103, NUM8: 104, NUM9: 105, CONTEXTMENU: 93, DOT: 190 }), this.dragUpload = !1, this.xhrUpload = ("undefined" != typeof XMLHttpRequestUpload || "undefined" != typeof XMLHttpRequestEventTarget) && "undefined" != typeof File && "undefined" != typeof FormData, this.transport = {}, "object" == typeof this.options.transport && (this.transport = this.options.transport, "function" == typeof this.transport.init && this.transport.init(this)), "function" != typeof this.transport.send && (this.transport.send = function (t) { return S.UA.IE || (t._xhr = new XMLHttpRequest, t.xhr = function () { return t.progress && t._xhr.addEventListener("progress", t.progress), t._xhr }), e.ajax(t) }), "iframe" == this.transport.upload ? this.transport.upload = e.proxy(this.uploads.iframe, this) : "function" == typeof this.transport.upload ? this.dragUpload = !!this.options.dragUploadAllow : this.xhrUpload && this.options.dragUploadAllow ? (this.transport.upload = e.proxy(this.uploads.xhr, this), this.dragUpload = !0) : this.transport.upload = e.proxy(this.uploads.iframe, this), this.decodeRawString = function (e) { return function (e) { var t, n, i, a, o = String.fromCharCode; for (t = 0, n = e.length, a = ""; i = e[t], t < n; t++)a += i <= 127 ? o(i) : i <= 223 && i >= 194 ? o((31 & i) << 6 | 63 & e[++t]) : i <= 239 && i >= 224 ? o((15 & i) << 12 | (63 & e[++t]) << 6 | 63 & e[++t]) : i <= 247 && i >= 240 ? o(55296 | ((7 & i) << 8 | (63 & e[++t]) << 2 | e[++t] >>> 4 & 3) - 64, 56320 | (15 & e[t++]) << 6 | 63 & e[t]) : o(65533); return a }(function (e) { var t, n, i, a = []; for ("string" == typeof e && (e = function (e) { var t, n, i; for (t = 0, n = e.length, i = []; t < n; t++)i.push(e.charCodeAt(t)); return i }(e)), t = 0, n = e.length; i = e[t], t < n; t++)i >= 55296 && i <= 56319 ? a.push(64 + (1023 & i) << 10 | 1023 & e[++t]) : a.push(i); return a }(e)) }, this.getContents = function (t, n, i) { var a, o, r = e.Deferred(), s = n || "arraybuffer"; return r.fail(function () { o && "pending" === o.state() && o.reject() }), a = this.openUrl(t), this.isSameOrigin(a) || (a = this.openUrl(t, !0)), o = this.request(Object.assign({ data: { cmd: "get" }, options: { url: a, type: "get", cache: !0, dataType: "binary", responseType: s, processData: !1 }, notify: { type: "file", cnt: 1, hideCnt: !0 }, cancel: !0 }, i || {})).fail(function () { r.reject() }).done(function (e) { r.resolve(e) }), r }, this.getBinaryByUrl = function (t, n, i) { var a, o = e.Deferred(); return o.fail(function () { a && "pending" === a.state() && a.reject() }), a = this.request(Object.assign({ data: { cmd: "get" }, options: Object.assign({ type: "get", cache: !0, dataType: "binary", responseType: "blob", processData: !1 }, t) }, i || {})).fail(function () { o.reject() }).done(function (e) { n && n(e), o.resolve(e) }), o }, this.getMimetype = function (e, t) { var n, i, o = t; return (i = (e + "").match(/\.([^.]+)$/)) && (n = i[1]) && (a || (a = S.arrayFlip(S.mimeTypes)), (o = a[n.toLowerCase()]) || (o = t)), o }, S.hashCheckers = [], function (t) { var n = {}; window.Worker && window.ArrayBuffer && (t.options.cdns.sparkmd5 && (n.SparkMD5 = !0, t.hashCheckers.push("md5")), t.options.cdns.jssha && (n.jsSHA = !0, t.hashCheckers = t.hashCheckers.concat(["sha1", "sha224", "sha256", "sha384", "sha512", "sha3-224", "sha3-256", "sha3-384", "sha3-512", "shake128", "shake256"]))), t.getContentsHashes = function (i, a, o, r) { var s, l = e.Deferred(), c = t.arrayFlip(a || ["md5"], !0), d = [], p = {}, u = o || { shake128len: 256, shake256len: 512 }; return l.fail(function () { s && s.reject() }), Object.keys(n).length ? s = t.getContents(i, "arraybuffer", r).done(function (a) { c.md5 && n.SparkMD5 && d.push(function () { var o = e.Deferred(); try { var r = t.getWorker(); o.fail(function () { r && r.terminate() }), r.onmessage = function (e) { var n; (r && r.terminate(), e.data.hash) ? (p.md5 = e.data.hash, (n = t.file(i)) && (n.md5 = p.md5)) : e.data.error && (p.md5 = e.data.error); l.notify(p), o.resolve() }, r.onerror = function (e) { o.reject() }, r.postMessage({ scripts: [t.options.cdns.sparkmd5, t.getWorkerUrl("calcfilehash.js")], data: { type: "md5", bin: a } }), l.fail(function () { o.reject() }) } catch (e) { o.reject(), delete n.SparkMD5 } return o }()), n.jsSHA && e.each(["1", "224", "256", "384", "512", "3-224", "3-256", "3-384", "3-512", "ke128", "ke256"], function (o, r) { c["sha" + r] && d.push(function () { var o = e.Deferred(); try { var s = t.getWorker(); o.fail(function () { s && s.terminate() }), s.onmessage = function (e) { var n; (s && s.terminate(), e.data.hash) ? (p["sha" + r] = e.data.hash, (n = t.file(i)) && (n["sha" + r] = p["sha" + r])) : e.data.error && (p["sha" + r] = e.data.error); l.notify(p), o.resolve() }, s.onerror = function (e) { o.reject() }, s.postMessage({ scripts: [t.options.cdns.jssha, t.getWorkerUrl("calcfilehash.js")], data: { type: r, bin: a, hashOpts: u } }), l.fail(function () { o.reject() }) } catch (e) { o.reject(), delete n.jsSHA } return o }()) }), d.length ? e.when.apply(null, d).always(function () { l.resolve(p) }) : l.reject() }).fail(function () { l.reject() }) : l.reject(), l } }(this), this.parseError = function (t) { var n = t; return e.isPlainObject(n) && (n = n.error), n }, this.error = function () { var e, t = arguments[0], n = arguments[1] || null; return 1 == arguments.length && "function" == typeof t ? S.bind("error", t) : !0 !== (e = this.parseError(t)) && e ? S.trigger("error", { error: e, opts: n }) : this }, e.each(["enable", "disable", "load", "open", "reload", "select", "add", "remove", "change", "dblclick", "getfile", "lockfiles", "unlockfiles", "selectfiles", "unselectfiles", "dragstart", "dragstop", "search", "searchend", "viewchange"], function (t, n) { S[n] = function () { var t = arguments[0]; return 1 == arguments.length && "function" == typeof t ? S.bind(n, t) : S.trigger(n, e.isPlainObject(t) ? t : {}) } }), this.enable(function () { !N && S.api && S.visible() && S.ui.overlay.is(":hidden") && !E.children(".elfinder-dialog." + S.res("class", "editing") + ":visible").length && (N = !0, document.activeElement && document.activeElement.blur(), E.removeClass("elfinder-disabled")) }).disable(function () { L = N, N = !1, E.addClass("elfinder-disabled") }).open(function () { J = [] }).select(function (t) { var n = 0, i = []; J = e.grep(t.data.selected || t.data.value || [], function (e) { return i.length || S.maxTargets && ++n > S.maxTargets ? (i.push(e), !1) : !!V[e] }), i.length && (S.trigger("unselectfiles", { files: i, inselect: !0 }), S.toast({ mode: "warning", msg: S.i18n(["errMaxTargets", S.maxTargets]) })) }).error(function (t) { var n, i, a = { cssClass: "elfinder-dialog-error", title: S.i18n("error"), resizable: !1, destroyOnClose: !0, buttons: {} }, o = S.getUI(); o.children(".elfinder-dialog-error").length < S.options.maxErrorDialogs ? (a.buttons[S.i18n(S.i18n("btnClose"))] = function () { e(this).elfinderdialog("close") }, t.data.opts && e.isPlainObject(t.data.opts) && Object.assign(a, t.data.opts), S.dialog('<span class="elfinder-dialog-icon elfinder-dialog-icon-error"></span>' + S.i18n(t.data.error), a)) : (i = (n = o.children(".elfinder-dialog-error:last").children(".ui-dialog-content:first")).children(".elfinder-error-counter")).length ? i.data("cnt", parseInt(i.data("cnt")) + 1).html(S.i18n(["moreErrors", i.data("cnt")])) : (i = e('<span class="elfinder-error-counter">' + S.i18n(["moreErrors", 1]) + "</span>").data("cnt", 1), n.append("<br/>", i)) }).bind("tmb", function (t) { e.each(t.data.images || [], function (e, t) { V[e] && (V[e].tmb = t) }) }).bind("searchstart", function (e) { Object.assign(S.searchStatus, e.data), S.searchStatus.state = 1 }).bind("search", function (e) { S.searchStatus.state = 2 }).bind("searchend", function () { S.searchStatus.state = 0, S.searchStatus.ininc = !1, S.searchStatus.mixed = !1 }).bind("canMakeEmptyFile", function (t) { var n = t.data, i = {}; n && Array.isArray(n.mimes) && (n.unshift || (i = S.mimesCanMakeEmpty), e.each(n.mimes, function () { i[this] || (i[this] = S.mimeTypes[this]) }), n.unshift && (S.mimesCanMakeEmpty = Object.assign(i, S.mimesCanMakeEmpty))) }).bind("themechange", function () { requestAnimationFrame(function () { S.trigger("uiresize") }) }), !0 === this.options.sound && this.bind("playsound", function (t) { var n = ce.canPlayType && ce.canPlayType('audio/wav; codecs="1"'), i = t.data && t.data.soundFile; n && i && "" != n && "no" != n && e(ce).html('<source src="' + re + i + '" type="audio/wav">')[0].play() }), e.each(this.options.handlers, function (e, t) { S.bind(e, t) }), this.history = new this.history(this), this.roots = {}, this.leafRoots = {}, this.volumeExpires = {}, this._commands = {}, Array.isArray(this.options.commands) || (this.options.commands = []), -1 !== e.inArray("*", this.options.commands) && (this.options.commands = Object.keys(this.commands)), this.commandMap = {}, this.volOptions = {}, this.hasVolOptions = !1, this.trashes = {}, this.optionsByHashes = {}, this.uiAutoHide = [], this.one("open", function () { S.uiAutoHide.length && setTimeout(function () { S.trigger("uiautohide") }, 500) }), this.bind("uiautohide", function () { S.uiAutoHide.length && S.uiAutoHide.shift()() }), this.options.width && (ie = this.options.width), this.options.height && (ae = this.options.height), this.options.heightBase && (oe = e(this.options.heightBase)), re = this.options.soundPath ? this.options.soundPath.replace(/\/+$/, "") + "/" : this.baseUrl + re, this.options.parrotHeaders && Array.isArray(this.options.parrotHeaders) && this.options.parrotHeaders.length ? (this.parrotHeaders = this.options.parrotHeaders, e.each(this.parrotHeaders, function (e, t) { var n = S.sessionStorage("core-ph:" + t); n && (S.customHeaders[t] = n) })) : this.parrotHeaders = [], S.one("opendone", function () { var t; e(document).on("click." + P, function (t) { N && !S.options.enableAlways && !e(t.target).closest(E).length && S.disable() }).on(R + " " + H + " " + _ + " " + q, we), S.options.useBrowserHistory && e(window).on("popstate." + P, function (t) { var n, i, a = t.originalEvent.state || {}, o = !!a.thash, r = E.find(".elfinder-frontmost:visible"), s = E.find(".elfinder-navbar-dir,.elfinder-cwd-filename").find("input,textarea"); o || (a = { thash: S.cwd().hash }, e("html,body").animate({ scrollTop: E.offset().top })), r.length || s.length ? (history.pushState(a, null, location.pathname + location.search + "#elf_" + a.thash), r.length ? r.hasClass(S.res("class", "preventback")) || (r.hasClass("elfinder-contextmenu") ? e(document).trigger(e.Event("keydown", { keyCode: e.ui.keyCode.ESCAPE, ctrlKey: !1, shiftKey: !1, altKey: !1, metaKey: !1 })) : r.hasClass("elfinder-dialog") ? r.elfinderdialog("close") : r.trigger("close")) : s.trigger(e.Event("keydown", { keyCode: e.ui.keyCode.ESCAPE, ctrlKey: !1, shiftKey: !1, altKey: !1, metaKey: !1 }))) : o ? !e.isEmptyObject(S.files()) && S.request({ data: { cmd: "open", target: a.thash, onhistory: 1 }, notify: { type: "open", cnt: 1, hideCnt: !0 }, syncOnFail: !0 }) : (n = function () { i.trigger("click") }, S.one("open", n, !0), i = S.toast({ msg: S.i18n("pressAgainToExit"), onHidden: function () { S.unbind("open", n), history.pushState(a, null, location.pathname + location.search + "#elf_" + a.thash) } })) }), e(window).on("resize." + P, function (e) { e.target === this && (t && cancelAnimationFrame(t), t = requestAnimationFrame(function () { var e = E.data("resizeSize") || { w: 0, h: 0 }, t = { w: Math.round(E.width()), h: Math.round(E.height()) }; E.data("resizeSize", t), t.w === e.w && t.h === e.h || (E.trigger("resize"), S.trigger("resize", { width: t.w, height: t.h })) })) }).on("beforeunload." + P, function (t) { var n, i; if (!S.pauseUnloadCheck()) { if (E.is(":visible") && (S.ui.notify.children().length && -1 !== e.inArray("hasNotifyDialog", S.options.windowCloseConfirm) ? n = S.i18n("ntfsmth") : E.find("." + S.res("class", "editing")).length && -1 !== e.inArray("editingFile", S.options.windowCloseConfirm) ? n = S.i18n("editingFile") : (i = Object.keys(S.selected()).length) && -1 !== e.inArray("hasSelectedItem", S.options.windowCloseConfirm) ? n = S.i18n("hasSelected", "" + i) : (i = Object.keys(S.clipboard()).length) && -1 !== e.inArray("hasClipboardData", S.options.windowCloseConfirm) && (n = S.i18n("hasClipboard", "" + i)), n)) return t.returnValue = n, n; S.trigger("unload") } }), e(window).on("message." + P, function (e) { var t, n, i = e.originalEvent || null; if (i && (0 === S.convAbsUrl(S.options.url).indexOf(i.origin) || 0 === S.convAbsUrl(S.uploadURL).indexOf(i.origin))) try { (n = (t = JSON.parse(i.data)).data || null) && (n.error ? (t.bind && S.trigger(t.bind + "fail", n), S.error(n.error)) : (n.warning && S.error(n.warning), S.updateCache(n), n.removed && n.removed.length && S.remove(n), n.added && n.added.length && S.add(n), n.changed && n.changed.length && S.change(n), t.bind && (S.trigger(t.bind, n), S.trigger(t.bind + "done")), n.sync && S.sync())) } catch (e) { S.sync() } }), S.options.enableAlways ? (e(window).on("focus." + P, function (e) { e.target === this && S.enable() }), ke && e(window.top).on("focus." + P, function () { !S.enable() || Ce && !Ce.is(":visible") || requestAnimationFrame(function () { e(window).trigger("focus") }) })) : ke && e(window).on("blur." + P, function (e) { N && e.target === this && S.disable() }), ke && E.on("click", function (t) { e(window).trigger("focus") }), S.options.enableByMouseOver && E.on("mouseenter touchstart", function (t) { ke && e(window).trigger("focus"), !S.enabled() && S.enable() }), e(window).on("visibilitychange." + P, function (e) { var t = document.hidden || document.webkitHidden || document.msHidden; S.options.syncStart && S.autoSync(t ? "stop" : void 0) }) }), E[0].elfinder = this, I.push((A = S.lang, j = S.i18nBaseUrl + "elfinder." + A + ".js", O = e.Deferred().done(function () { S.i18[A] && (S.lang = A), S.trigger("i18load"), l = "en" === S.lang ? S.i18.en : e.extend(!0, {}, S.i18.en, S.i18[S.lang]) }), S.i18[A] ? O.resolve() : (S.lang = "en", S.hasRequire ? require([j], function () { O.resolve() }, function () { O.resolve() }) : S.loadScript([j], function () { O.resolve() }, { loadType: "tag", error: function () { O.resolve() } })), O)), c = function () { var t, n, i, a, o, r, s, c, d; return S.messages = l.messages, e.fn.selectable && e.fn.draggable && e.fn.droppable && e.fn.resizable && e.fn.button && e.fn.slider ? E.length ? S.options.url ? (t = Object.assign({ name: S.i18n("name"), perm: S.i18n("perms"), date: S.i18n("modify"), size: S.i18n("size"), kind: S.i18n("kind"), modestr: S.i18n("mode"), modeoct: S.i18n("mode"), modeboth: S.i18n("mode") }, S.options.uiOptions.cwd.listView.columnsCustomName), S.getColumnName = function (e) { return t[e] || S.i18n(e) }, S.direction = l.direction, S.dateFormat = S.options.dateFormat || l.dateFormat, S.fancyFormat = S.options.fancyDateFormat || l.fancyDateFormat, S.nonameDateFormat = (S.options.nonameDateFormat || l.nonameDateFormat).replace(/[\/\\]/g, "_"), S.cssClass = "ui-helper-reset ui-helper-clearfix ui-widget ui-widget-content ui-corner-all elfinder elfinder-" + ("rtl" == S.direction ? "rtl" : "ltr") + (S.UA.Touch ? " elfinder-touch" + (S.options.resizable ? " touch-punch" : "") : "") + (S.UA.Mobile ? " elfinder-mobile" : "") + (S.UA.iOS ? " elfinder-ios" : "") + " " + S.options.cssClass, E.addClass(S.cssClass).on(q, function () { !N && S.enable() }), s = R + "draggable keyup." + P + "draggable", S.draggable = { appendTo: E, addClasses: !1, distance: 4, revert: !0, refreshPositions: !1, cursor: "crosshair", cursorAt: { left: 50, top: 47 }, scroll: !1, start: function (t, s) { var l, c, d = s.helper, p = e.grep(d.data("files") || [], function (e) { return !!e && (Z[e] = !0, !0) }), u = !1; for (r = E.attr("style"), E.width(E.width()).height(E.height()), n = "ltr" === S.direction, i = S.getUI("workzone").data("rectangle"), a = i.top + i.height, o = a - S.getUI("navdock").outerHeight(!0), S.draggingUiHelper = d, l = p.length; l--;)if (c = p[l], V[c].locked) { u = !0, d.data("locked", !0); break } !u && S.trigger("lockfiles", { files: p }), d.data("autoScrTm", setInterval(function () { d.data("autoScr") && S.autoScroll[d.data("autoScr")](d.data("autoScrVal")) }, 50)) }, drag: function (t, r) { var s, l, c, d = r.helper; ((l = i.top > t.pageY) || o < t.pageY) && (s = i.cwdEdge > t.pageX ? (n ? "navbar" : "cwd") + (l ? "Up" : "Down") : (n ? "cwd" : "navbar") + (l ? "Up" : "Down"), l || ("cwd" === s.substr(0, 3) ? a < t.pageY ? c = a : s = null : c = o), s && (d.data("autoScr", s), d.data("autoScrVal", Math.pow(l ? i.top - t.pageY : t.pageY - c, 1.3)))), s || d.data("autoScr") && d.data("refreshPositions", 1).data("autoScr", null), d.data("refreshPositions") && e(this).elfUiWidgetInstance("draggable") && (d.data("refreshPositions") > 0 ? (e(this).draggable("option", { refreshPositions: !0, elfRefresh: !0 }), d.data("refreshPositions", -1)) : (e(this).draggable("option", { refreshPositions: !1, elfRefresh: !1 }), d.data("refreshPositions", null))) }, stop: function (t, n) { var i, a = n.helper; e(document).off(s), e(this).elfUiWidgetInstance("draggable") && e(this).draggable("option", { refreshPositions: !1 }), S.draggingUiHelper = null, S.trigger("focus").trigger("dragstop"), a.data("droped") || (i = e.grep(a.data("files") || [], function (e) { return !!e }), S.trigger("unlockfiles", { files: i }), S.trigger("selectfiles", { files: S.selected() })), S.enable(), E.attr("style", r), a.data("autoScrTm") && clearInterval(a.data("autoScrTm")) }, helper: function (t, n) { var i, a, o, r = this.id ? e(this) : e(this).parents("[id]:first"), l = e('<div class="elfinder-drag-helper"><span class="elfinder-drag-helper-icon-status"></span></div>'), c = function (t) { var n, i = t.mime, a = S.tmb(t); return n = '<div class="elfinder-cwd-icon elfinder-cwd-icon-drag ' + S.mime2class(i) + ' ui-corner-all"></div>', a ? n = e(n).addClass(a.className).css("background-image", "url('" + a.url + "')").get(0).outerHTML : t.icon && (n = e(n).css(S.getIconStyle(t, !0)).get(0).outerHTML), t.csscls && (n = '<div class="' + t.csscls + '">' + n + "</div>"), n }; return S.draggingUiHelper && S.draggingUiHelper.stop(!0, !0), S.trigger("dragstart", { target: r[0], originalEvent: t }, !0), i = r.hasClass(S.res("class", "cwdfile")) ? S.selected() : [S.navId2Hash(r.attr("id"))], l.append(c(V[i[0]])).data("files", i).data("locked", !1).data("droped", !1).data("namespace", P).data("dropover", 0), (a = i.length) > 1 && l.append(c(V[i[a - 1]]) + '<span class="elfinder-drag-num">' + a + "</span>"), e(document).on(s, function (e) { var t = e.shiftKey || e.ctrlKey || e.metaKey; o !== t && (o = t, l.is(":visible") && l.data("dropover") && !l.data("droped") && (l.toggleClass("elfinder-drag-helper-plus", !!l.data("locked") || o), S.trigger(o ? "unlockfiles" : "lockfiles", { files: i, helper: l }))) }), l } }, S.commands.getfile && ("function" == typeof S.options.getFileCallback ? (S.bind("dblclick", function (e) { e.preventDefault(), S.exec("getfile").fail(function () { S.exec("open", e.data && e.data.file ? [e.data.file] : void 0) }) }), S.shortcut({ pattern: "enter", description: S.i18n("cmdgetfile"), callback: function () { S.exec("getfile").fail(function () { S.exec("mac" == S.OS ? "rename" : "open") }) } }).shortcut({ pattern: "ctrl+enter", description: S.i18n("mac" == S.OS ? "cmdrename" : "cmdopen"), callback: function () { S.exec("mac" == S.OS ? "rename" : "open") } })) : S.options.getFileCallback = null), e.each(S.commands, function (t, n) { var i, a, o = Object.assign({}, n.prototype); if (e.isFunction(n) && !S._commands[t] && (n.prototype.forceLoad || -1 !== e.inArray(t, S.options.commands))) { if (i = n.prototype.extendsCmd || "") { if (!e.isFunction(S.commands[i])) return !0; n.prototype = Object.assign({}, ne, new S.commands[i], n.prototype) } else n.prototype = Object.assign({}, ne, n.prototype); S._commands[t] = new n, n.prototype = o, a = S.options.commandsOptions[t] || {}, i && S.options.commandsOptions[i] && (a = e.extend(!0, {}, S.options.commandsOptions[i], a)), S._commands[t].setup(t, a), S._commands[t].linkedCmds.length && e.each(S._commands[t].linkedCmds, function (t, n) { var i = S.commands[n]; e.isFunction(i) && !S._commands[n] && (i.prototype = ne, S._commands[n] = new i, S._commands[n].setup(n, S.options.commandsOptions[n] || {})) }) } }), S.ui = { workzone: e("<div></div>").appendTo(E).elfinderworkzone(S), navbar: e("<div></div>").appendTo(E).elfindernavbar(S, S.options.uiOptions.navbar || {}), navdock: e("<div></div>").appendTo(E).elfindernavdock(S, S.options.uiOptions.navdock || {}), contextmenu: e("<div></div>").appendTo(E).elfindercontextmenu(S), overlay: e("<div></div>").appendTo(E).elfinderoverlay({ show: function () { S.disable() }, hide: function () { L && S.enable() } }), cwd: e("<div></div>").appendTo(E).elfindercwd(S, S.options.uiOptions.cwd || {}), notify: S.dialog("", { cssClass: "elfinder-dialog-notify" + (S.options.notifyDialog.canClose ? "" : " elfinder-titlebar-button-hide"), position: S.options.notifyDialog.position, absolute: !0, resizable: !1, autoOpen: !1, allowMinimize: !0, closeOnEscape: !!S.options.notifyDialog.canClose, title: "&nbsp;", width: S.options.notifyDialog.width ? parseInt(S.options.notifyDialog.width) : null, minHeight: null, minimize: function () { S.ui.notify.trigger("minimize") } }), statusbar: e('<div class="ui-widget-header ui-helper-clearfix ui-corner-bottom elfinder-statusbar"></div>').hide().appendTo(E), toast: e('<div class="elfinder-toast"></div>').appendTo(E), bottomtray: e('<div class="elfinder-bottomtray">').appendTo(E), progressbar: e('<div class="elfinder-ui-progressbar">').appendTo(E) }, S.trigger("uiready"), e.each(S.options.ui || [], function (t, n) { var i = "elfinder" + n, a = S.options.uiOptions[n] || {}; !S.ui[n] && e.fn[i] && (S.ui[n] = e("<" + (a.tag || "div") + "/>").appendTo(E), S.ui[n][i](S, a)) }), S.ui.progressbar.appendTo(S.ui.workzone), S.ui.notify.prev(".ui-dialog-titlebar").append('<div class="elfinder-ui-progressbar"></div>'), S.resize(ie, ae), S.options.resizable && (E.resizable({ resize: function (e, t) { S.resize(t.size.width, t.size.height) }, handles: "se", minWidth: 300, minHeight: 200 }), S.UA.Touch && E.addClass("touch-punch")), c = S.getUI("navbar"), d = S.getUI("cwd").parent(), S.autoScroll = { navbarUp: function (e) { c.scrollTop(Math.max(0, c.scrollTop() - e)) }, navbarDown: function (e) { c.scrollTop(c.scrollTop() + e) }, cwdUp: function (e) { d.scrollTop(Math.max(0, d.scrollTop() - e)) }, cwdDown: function (e) { d.scrollTop(d.scrollTop() + e) } }, S.UA.Touch && function () { var e, t, n, i, a, o, r, s, l = S.getUI("navbar"), c = S.getUI("toolbar"), d = "touchmove.stopscroll", p = function (e) { var n = (e.originalEvent.touches || [{}])[0].pageY || null; (!t || n < t) && (e.preventDefault(), r && clearTimeout(r)) }, u = function (e) { e.preventDefault(), r && clearTimeout(r) }; l = l.children().length ? l : null, c = c.length ? c : null, E.on("touchstart touchmove touchend", function (h) { if ("touchend" === h.type) return e = !1, t = !1, void (r = setTimeout(function () { E.off(d) }, 100)); var f, m, g, v, b = h.originalEvent.touches || [{}], y = b[0].pageX || null, w = b[0].pageY || null, x = "ltr" === S.direction; null === y || null === w || "touchstart" === h.type && b.length > 1 || ("touchstart" === h.type ? (n = E.offset(), i = E.width(), l && (e = !1, l.is(":hidden") ? (s || (s = Math.max(50, i / 10)), (x ? y - n.left : i + n.left - y) < s && (e = y)) : h.originalEvent._preventSwipeX || (a = l.width(), (x ? y < n.left + a : y > n.left + i - a) ? (s = Math.max(50, i / 10), e = y) : e = !1)), c && (t = !1, h.originalEvent._preventSwipeY || (o = c.height(), w - n.top < (c.is(":hidden") ? 50 : o + 30) && (t = w, E.on(d, c.is(":hidden") ? u : p))))) : (l && !1 !== e && (f = (x ? e > y : e < y) ? "navhide" : "navshow", m = Math.abs(e - y), ("navhide" === f && m > .6 * a || m > ("navhide" === f ? a / 3 : 45) && ("navshow" === f || (x ? y < n.left + 20 : y > n.left + i - 20))) && (S.getUI("navbar").trigger(f, { handleW: s }), e = !1)), c && !1 !== t && (g = c.offset().top, Math.abs(t - w) > Math.min(45, o / 3) && ("slideDown" === (v = t > w ? "slideUp" : "slideDown") || g + 20 > w) && (c.is("slideDown" === v ? ":hidden" : ":visible") && c.stop(!0, !0).trigger("toggle", { duration: 100, handleH: 50 }), t = !1)))) }) }(), S.dragUpload && function () { var t, n, i = function (t) { return "TEXTAREA" !== t.target.nodeName && "INPUT" !== t.target.nodeName && 0 === e(t.target).closest("div.ui-dialog-content").length }, a = "native-drag-enter", o = "native-drag-disable", r = "class", s = S.res(r, "navdir"), l = (S.res(r, "droppable"), S.res(r, "adroppable"), S.res(r, "navarrow"), S.res(r, "adroppable")), c = S.getUI("workzone"), d = "ltr" === S.direction, p = function () { n && cancelAnimationFrame(n), n = null }; E.on("dragenter", function (e) { p(), i(e) && (e.preventDefault(), e.stopPropagation(), t = c.data("rectangle")) }).on("dragleave", function (e) { p(), i(e) && (e.preventDefault(), e.stopPropagation()) }).on("dragover", function (e) { var a; i(e) ? (e.preventDefault(), e.stopPropagation(), e.originalEvent.dataTransfer.dropEffect = "none", n || (n = requestAnimationFrame(function () { var i, o = t.top + t.height, r = o - S.getUI("navdock").outerHeight(!0); ((a = e.pageY < t.top) || e.pageY > r) && (i = t.cwdEdge > e.pageX ? (d ? "navbar" : "cwd") + (a ? "Up" : "Down") : (d ? "cwd" : "navbar") + (a ? "Up" : "Down"), a || "cwd" === i.substr(0, 3) && (o < e.pageY ? r = o : i = ""), i && S.autoScroll[i](Math.pow(a ? t.top - e.pageY : e.pageY - r, 1.3))), n = null }))) : p() }).on("drop", function (e) { p(), i(e) && (e.stopPropagation(), e.preventDefault()) }), E.on("dragenter", ".native-droppable", function (t) { if (t.originalEvent.dataTransfer) { var n, i = e(t.currentTarget), r = null; if (!(t.currentTarget.id || null)) { r = S.cwd(), i.data(o, !1); try { e.each(t.originalEvent.dataTransfer.types, function (e, t) { "elfinderfrom:" === t.substr(0, 13) && (n = t.substr(13).toLowerCase()) }) } catch (t) { } } r && (!r.write || n && n === (window.location.href + r.hash).toLowerCase()) ? i.data(o, !0) : (t.preventDefault(), t.stopPropagation(), i.data(a, !0), i.addClass(l)) } }).on("dragleave", ".native-droppable", function (t) { if (t.originalEvent.dataTransfer) { var n = e(t.currentTarget); t.preventDefault(), t.stopPropagation(), n.data(a) ? n.data(a, !1) : n.removeClass(l) } }).on("dragover", ".native-droppable", function (t) { if (t.originalEvent.dataTransfer) { var n = e(t.currentTarget); t.preventDefault(), t.stopPropagation(), t.originalEvent.dataTransfer.dropEffect = n.data(o) ? "none" : "copy", n.data(a, !1) } }).on("drop", ".native-droppable", function (t) { if (t.originalEvent && t.originalEvent.dataTransfer) { var n, i = e(t.currentTarget); t.preventDefault(), t.stopPropagation(), i.removeClass(l), n = t.currentTarget.id ? i.hasClass(s) ? S.navId2Hash(t.currentTarget.id) : S.cwdId2Hash(t.currentTarget.id) : S.cwd().hash, t.originalEvent._target = n, S.exec("upload", { dropEvt: t.originalEvent, target: n }, void 0, n) } }) }(), !1 === S.cssloaded && (S.cssloaded = !0, S.trigger("cssloaded")), S.zIndexCalc(), void S.trigger("init").request({ data: { cmd: "open", target: S.startDir(), init: 1, tree: 1 }, preventDone: !0, notify: { type: "open", cnt: 1, hideCnt: !0 }, freeze: !0 }).fail(function () { S.trigger("fail").disable().lastDir(""), G = {}, Y = {}, e(document).add(E).off("." + P), S.trigger = function () { } }).done(function (t) { var n = function (e) { var t = S.file(S.trashes[e]); S.options.debug; t && t.volumeid && delete S.volOptions[t.volumeid].trashHash, S.trashes[e] = !1, S.debug("backend-error", 'Trash hash "' + e + '" was not found or not writable.') }, i = {}; S.options.rawStringDecoder && S.registRawStringDecoder(S.options.rawStringDecoder), S.zIndexCalc(), S.load().debug("api", S.api), E.trigger("resize"), he(t), S.trigger("open", t, !1), S.trigger("opendone"), ke && S.options.enableAlways && e(window).trigger("focus"), e.each(S.trashes, function (e) { var t = S.file(e); t ? "directory" === t.mime && t.write || n(e) : i[e] = !0 }), Object.keys(i).length && S.request({ data: { cmd: "info", targets: Object.keys(i) }, preventDefault: !0 }).done(function (t) { t && t.files && e.each(t.files, function (e, t) { "directory" === t.mime && t.write && delete i[t.hash] }) }).always(function () { e.each(i, n) }), S[S.options.enableAlways ? "enable" : "disable"]() })) : alert(S.i18n("errURL")) : alert(S.i18n("errNode")) : alert(S.i18n("errJqui")) }, i && "function" == typeof i && (S.bootCallback = i, i.call(E.get(0), S, { dfrdsBeforeBootup: I })), e.when.apply(null, I).done(function () { c() }).fail(function (e) { S.error(e) }) }; return (void 0 === (n = n || !1) || n) && (window.elFinder = h), h.prototype = { uniqueid: 0, res: function (e, t) { return this.resources[e] && this.resources[e][t] }, OS: -1 !== navigator.userAgent.indexOf("Mac") ? "mac" : -1 !== navigator.userAgent.indexOf("Win") ? "win" : "other", UA: (s = !document.unqueID && !window.opera && !window.sidebar && "localStorage" in window && "WebkitAppearance" in document.documentElement.style, l = s && window.chrome, { ltIE6: void 0 === window.addEventListener && void 0 === document.documentElement.style.maxHeight, ltIE7: void 0 === window.addEventListener && void 0 === document.querySelectorAll, ltIE8: void 0 === window.addEventListener && void 0 === document.getElementsByClassName, ltIE9: document.uniqueID && document.documentMode <= 9, ltIE10: document.uniqueID && document.documentMode <= 10, gtIE11: document.uniqueID && document.documentMode >= 11, IE: document.uniqueID, Firefox: window.sidebar, Opera: window.opera, Webkit: s, Chrome: l, Edge: !(!l || !window.msCredentials), Safari: s && !window.chrome, Mobile: void 0 !== window.orientation, Touch: void 0 !== window.ontouchstart, iOS: navigator.platform.match(/^iP(?:[ao]d|hone)/), Mac: navigator.platform.match(/^Mac/), Fullscreen: void 0 !== (document.exitFullscreen || document.webkitExitFullscreen || document.mozCancelFullScreen || document.msExitFullscreen), Angle: 0, Rotated: !1, CSS: (o = document.createElement("a").style, r = document.createElement("p").style, o.cssText = "position:sticky;position:-webkit-sticky;width:-webkit-max-content;width:-moz-max-content;width:-ms-max-content;width:max-content;", { positionSticky: -1 !== o.position.indexOf("sticky"), widthMaxContent: -1 !== o.width.indexOf("max-content"), flex: void 0 !== r.flex }) }), cookieEnabled: (a = "elftest=", document.cookie = a + "1", i = 2 === document.cookie.split(a).length, document.cookie = a + ";max-age=0", i), hasRequire: "function" == typeof define && define.amd, currentReqCmd: "", keyState: {}, i18: { en: { translator: "", language: "English", direction: "ltr", dateFormat: "d.m.Y H:i", fancyDateFormat: "$1 H:i", nonameDateFormat: "ymd-His", messages: {} }, months: ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"], monthsShort: ["msJan", "msFeb", "msMar", "msApr", "msMay", "msJun", "msJul", "msAug", "msSep", "msOct", "msNov", "msDec"], days: ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"], daysShort: ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"] }, kinds: { unknown: "Unknown", directory: "Folder", group: "Selects", symlink: "Alias", "symlink-broken": "AliasBroken", "application/x-empty": "TextPlain", "application/postscript": "Postscript", "application/vnd.ms-office": "MsOffice", "application/msword": "MsWord", "application/vnd.ms-word": "MsWord", "application/vnd.openxmlformats-officedocument.wordprocessingml.document": "MsWord", "application/vnd.ms-word.document.macroEnabled.12": "MsWord", "application/vnd.openxmlformats-officedocument.wordprocessingml.template": "MsWord", "application/vnd.ms-word.template.macroEnabled.12": "MsWord", "application/vnd.ms-excel": "MsExcel", "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet": "MsExcel", "application/vnd.ms-excel.sheet.macroEnabled.12": "MsExcel", "application/vnd.openxmlformats-officedocument.spreadsheetml.template": "MsExcel", "application/vnd.ms-excel.template.macroEnabled.12": "MsExcel", "application/vnd.ms-excel.sheet.binary.macroEnabled.12": "MsExcel", "application/vnd.ms-excel.addin.macroEnabled.12": "MsExcel", "application/vnd.ms-powerpoint": "MsPP", "application/vnd.openxmlformats-officedocument.presentationml.presentation": "MsPP", "application/vnd.ms-powerpoint.presentation.macroEnabled.12": "MsPP", "application/vnd.openxmlformats-officedocument.presentationml.slideshow": "MsPP", "application/vnd.ms-powerpoint.slideshow.macroEnabled.12": "MsPP", "application/vnd.openxmlformats-officedocument.presentationml.template": "MsPP", "application/vnd.ms-powerpoint.template.macroEnabled.12": "MsPP", "application/vnd.ms-powerpoint.addin.macroEnabled.12": "MsPP", "application/vnd.openxmlformats-officedocument.presentationml.slide": "MsPP", "application/vnd.ms-powerpoint.slide.macroEnabled.12": "MsPP", "application/pdf": "PDF", "application/xml": "XML", "application/vnd.oasis.opendocument.text": "OO", "application/vnd.oasis.opendocument.text-template": "OO", "application/vnd.oasis.opendocument.text-web": "OO", "application/vnd.oasis.opendocument.text-master": "OO", "application/vnd.oasis.opendocument.graphics": "OO", "application/vnd.oasis.opendocument.graphics-template": "OO", "application/vnd.oasis.opendocument.presentation": "OO", "application/vnd.oasis.opendocument.presentation-template": "OO", "application/vnd.oasis.opendocument.spreadsheet": "OO", "application/vnd.oasis.opendocument.spreadsheet-template": "OO", "application/vnd.oasis.opendocument.chart": "OO", "application/vnd.oasis.opendocument.formula": "OO", "application/vnd.oasis.opendocument.database": "OO", "application/vnd.oasis.opendocument.image": "OO", "application/vnd.openofficeorg.extension": "OO", "application/x-shockwave-flash": "AppFlash", "application/flash-video": "Flash video", "application/x-bittorrent": "Torrent", "application/javascript": "JS", "application/rtf": "RTF", "application/rtfd": "RTF", "application/x-font-ttf": "TTF", "application/x-font-otf": "OTF", "application/x-rpm": "RPM", "application/x-web-config": "TextPlain", "application/xhtml+xml": "HTML", "application/docbook+xml": "DOCBOOK", "application/x-awk": "AWK", "application/x-gzip": "GZIP", "application/x-bzip2": "BZIP", "application/x-xz": "XZ", "application/zip": "ZIP", "application/x-zip": "ZIP", "application/x-rar": "RAR", "application/x-tar": "TAR", "application/x-7z-compressed": "7z", "application/x-jar": "JAR", "text/plain": "TextPlain", "text/x-php": "PHP", "text/html": "HTML", "text/javascript": "JS", "text/css": "CSS", "text/rtf": "RTF", "text/rtfd": "RTF", "text/x-c": "C", "text/x-csrc": "C", "text/x-chdr": "CHeader", "text/x-c++": "CPP", "text/x-c++src": "CPP", "text/x-c++hdr": "CPPHeader", "text/x-shellscript": "Shell", "application/x-csh": "Shell", "text/x-python": "Python", "text/x-java": "Java", "text/x-java-source": "Java", "text/x-ruby": "Ruby", "text/x-perl": "Perl", "text/x-sql": "SQL", "text/xml": "XML", "text/x-comma-separated-values": "CSV", "text/x-markdown": "Markdown", "image/x-ms-bmp": "BMP", "image/jpeg": "JPEG", "image/gif": "GIF", "image/png": "PNG", "image/tiff": "TIFF", "image/x-targa": "TGA", "image/vnd.adobe.photoshop": "PSD", "image/xbm": "XBITMAP", "image/pxm": "PXM", "audio/mpeg": "AudioMPEG", "audio/midi": "AudioMIDI", "audio/ogg": "AudioOGG", "audio/mp4": "AudioMPEG4", "audio/x-m4a": "AudioMPEG4", "audio/wav": "AudioWAV", "audio/x-mp3-playlist": "AudioPlaylist", "video/x-dv": "VideoDV", "video/mp4": "VideoMPEG4", "video/mpeg": "VideoMPEG", "video/x-msvideo": "VideoAVI", "video/quicktime": "VideoMOV", "video/x-ms-wmv": "VideoWM", "video/x-flv": "VideoFlash", "video/x-matroska": "VideoMKV", "video/ogg": "VideoOGG" }, mimeTypes: {}, rules: { defaults: function (e) { return !(!e || e.added && !Array.isArray(e.added) || e.removed && !Array.isArray(e.removed) || e.changed && !Array.isArray(e.changed)) }, open: function (t) { return t && t.cwd && t.files && e.isPlainObject(t.cwd) && Array.isArray(t.files) }, tree: function (e) { return e && e.tree && Array.isArray(e.tree) }, parents: function (e) { return e && e.tree && Array.isArray(e.tree) }, tmb: function (t) { return t && t.images && (e.isPlainObject(t.images) || Array.isArray(t.images)) }, upload: function (t) { return t && (e.isPlainObject(t.added) || Array.isArray(t.added)) }, search: function (e) { return e && e.files && Array.isArray(e.files) } }, commands: {}, cmdsToAdd: "archive duplicate extract mkdir mkfile paste rm upload", parseUploadData: function (t) { var n, i = this; if (!e.trim(t)) return { error: ["errResponse", "errDataEmpty"] }; try { n = JSON.parse(t) } catch (e) { return { error: ["errResponse", "errDataNotJSON"] } } return n = i.normalize(n), i.validResponse("upload", n) ? (n.removed = e.merge(n.removed || [], e.map(n.added || [], function (e) { return i.file(e.hash) ? e.hash : null })), n) : { error: n.norError || ["errResponse"] } }, iframeCnt: 0, uploads: { xhrUploading: !1, failSyncTm: null, chunkfailReq: {}, checkExists: function (t, n, i, a) { var o, r, s, l, c, d = e.Deferred(), p = [], u = {}, h = function () { for (var e = t.length; --e > -1;)t[e]._remove = !0 }, f = function () { d.resolve(p, u) }; return i.api >= 2.1 && "object" == typeof t[0] ? (r = [], s = [], l = n !== i.cwd().hash ? i.path(n, !0) + i.option("separator", n) : "", c = function (e) { var n = e == s.length - 1, o = { cssClass: "elfinder-confirm-upload", title: i.i18n("cmdupload"), text: ["errExists", l + s[e].name, "confirmRepl"], all: !n, accept: { label: "btnYes", callback: function (t) { n || t ? f() : c(++e) } }, reject: { label: "btnNo", callback: function (i) { var a; if (i) for (a = s.length; e < a--;)t[s[a].i]._remove = !0; else t[s[e].i]._remove = !0; n || i ? f() : c(++e) } }, cancel: { label: "btnCancel", callback: function () { h(), f() } }, buttons: [{ label: "btnBackup", cssClass: "elfinder-confirm-btn-backup", callback: function (t) { var i; if (t) for (i = s.length; e < i--;)p.push(s[i].name); else p.push(s[e].name); n || t ? f() : c(++e) } }] }; a || o.buttons.push({ label: "btnRename" + (n ? "" : "All"), cssClass: "elfinder-confirm-btn-rename", callback: function () { p = null, f() } }), i.iframeCnt > 0 && delete o.reject, i.confirm(o) }, i.file(n).read ? (o = e.map(t, function (e, t) { return !e.name || i.UA.iOS && "image.jpg" === e.name ? null : { i: t, name: e.name } }), i.request({ data: { cmd: "ls", target: n, intersect: e.map(o, function (e) { return e.name }) }, notify: { type: "preupload", cnt: 1, hideCnt: !0 }, preventDefault: !0 }).done(function (t) { var a, l; t && (t.error ? h() : i.options.overwriteUploadConfirm && i.option("uploadOverwrite", n) && t.list && (Array.isArray(t.list) ? r = t.list || [] : (a = [], r = e.map(t.list, function (e) { return "string" == typeof e ? e : (a = a.concat(e), !1) }), a.length && (r = r.concat(a)), u = t.list), (s = e.grep(o, function (t) { return -1 !== e.inArray(t.name, r) })).length && r.length && n == i.cwd().hash && (l = e.map(i.files(n), function (e) { return e.name }), e.grep(r, function (t) { return -1 === e.inArray(t, l) }).length && i.sync()))), s.length > 0 ? c(0) : f() }).fail(function (e) { h(), f(), e && i.error(e) })) : f()) : f(), d }, checkFile: function (t, n, i) { if (t.checked || "files" == t.type) return t.files; if ("data" == t.type) { var a, o, r = e.Deferred(), s = e.Deferred(), l = [], c = [], d = 0, p = [], u = !1, h = function (e) { var t, i = n.options.folderUploadExclude[n.OS] || null, a = e.length, o = function () { --d < 1 && "pending" === s.state() && s.resolve() }, r = function (e) { i && e.name.match(i) || (c.push(t.fullPath || ""), l.push(e)), o() }, f = function (e) { var t = [], n = function () { e.readEntries(function (e) { if (u || !e.length) { for (var i = 0; i < t.length; i++) { if (u) { s.reject(); break } h([t[i]]) } o() } else t = t.concat((a = e, Array.prototype.slice.call(a || [], 0))), n(); var a }, o) }; n() }; d++; for (var m = 0; m < a; m++) { if (u) { s.reject(); break } (t = e[m]) && (t.isFile ? (d++, t.file(r, o)) : t.isDirectory && n.api >= 2.1 && (d++, p.push(t.fullPath), f(t.createReader()))) } return o(), s }; return a = e.map(t.files.items, function (e) { return e.getAsEntry ? e.getAsEntry() : e.webkitGetAsEntry() }), e.each(a, function (e, t) { if (t.isDirectory) return o = !0, !1 }), a.length > 0 ? (n.uploads.checkExists(a, i, n, o).done(function (o, s) { var d = []; n.options.overwriteUploadConfirm && n.option("uploadOverwrite", i) && (null === o && (t.overwrite = 0, o = []), a = e.grep(a, function (t) { var a, r, l, c; return t.isDirectory && o.length && -1 !== (a = e.inArray(t.name, o)) && (o.splice(a, 1), r = n.uniqueName(t.name + n.options.backupSuffix, null, ""), e.each(s, function (e, n) { if (t.name == n) return l = e, !1 }), l || (l = n.fileByName(t.name, i).hash), n.lockfiles({ files: [l] }), c = n.request({ data: { cmd: "rename", target: l, name: r }, notify: { type: "rename", cnt: 1 } }).fail(function () { t._remove = !0, n.sync() }).always(function () { n.unlockfiles({ files: [l] }) }), d.push(c)), !t._remove })), e.when.apply(e, d).done(function () { var e, t, i = +new Date; a.length > 0 ? (t = n.escape(a[0].name), a.length > 1 && (t += " ... " + a.length + n.i18n("items")), e = setTimeout(function () { n.notify({ type: "readdir", id: i, cnt: 1, hideCnt: !0, msg: n.i18n("ntfreaddir") + " (" + t + ")", cancel: function () { u = !0 } }) }, n.options.notifyDelay), h(a).done(function () { e && clearTimeout(e), n.notify({ type: "readdir", id: i, cnt: -1 }), u ? r.reject() : r.resolve([l, c, o, s, p]) }).fail(function () { r.reject() })) : r.reject() }) }), r.promise()) : r.reject() } var f = [], m = [], g = t.files[0]; if ("html" == t.type) { var v, b = e("<html></html>").append(e.parseHTML(g.replace(/ src=/gi, " _elfsrc="))); e("img[_elfsrc]", b).each(function () { var n, i, a = e(this), o = a.closest("a"); o && o.attr("href") && o.attr("href").match(/\.(?:jpe?g|gif|bmp|png)/i) && (i = o.attr("href")), (n = a.attr("_elfsrc")) && (i ? (-1 == e.inArray(i, f) && f.push(i), -1 == e.inArray(n, m) && m.push(n)) : -1 == e.inArray(n, f) && f.push(n)), 1 === f.length && f[0].match(/^data:image\/png/) && (t.clipdata = !0) }), (v = e("a[href]", b)).each(function () { var t, n, i, a; (t = e(this).text()) && (i = e(this).attr("href"), (a = document.createElement("a")).href = i, (n = a).href && n.href.match(/^(?:ht|f)tp/i) && (1 === v.length || !n.pathname.match(/(?:\.html?|\/[^\/.]*)$/i) || e.trim(t).match(/\.[a-z0-9-]{1,10}$/i)) && -1 == e.inArray(n.href, f) && -1 == e.inArray(n.href, m) && f.push(n.href)) }) } else { var y, w, x; for (y = /((?:ht|f)tps?:\/\/[-_.!~*\'()a-z0-9;/?:\@&=+\$,%#\*\[\]]+)/gi; w = y.exec(g);)x = w[1].replace(/&amp;/g, "&"), -1 == e.inArray(x, f) && f.push(x) } return f }, xhr: function (t, n) { var i = n || this, a = i.getUI(), o = new XMLHttpRequest, r = null, s = null, l = null, c = t.checked, d = t.isDataType || "data" == t.type, p = t.target || i.cwd().hash, u = t.dropEvt || null, h = t.extraData || null, f = -1 != i.option("uploadMaxConn", p), m = Math.min(5, Math.max(1, i.option("uploadMaxConn", p))), g = 0, v = function (t) { var n = e.Deferred(); return t.promise ? t.always(function (e) { n.resolve(Array.isArray(e) && e.length ? d ? e[0][0] : e[0] : {}) }) : n.resolve(t.length ? d ? t[0][0] : t[0] : {}), n }, b = e.Deferred().fail(function (e) { var t, a = i.parseError(e); "userabort" === a && (t = !0, a = void 0), w && (i.uploads.xhrUploading || t) ? v(w).done(function (e) { t || P(a, e), e._cid ? i.uploads.chunkfailReq[e._cid] || (i.uploads.chunkfailReq[e._cid] = !0, setTimeout(function () { n.request({ data: { cmd: "upload", target: p, chunk: e._chunk, cid: e._cid, upload: ["chunkfail"], mimes: "chunkfail" }, options: { type: "post", url: i.uploadURL }, preventDefault: !0 }).always(function () { delete i.uploads.chunkfailReq[e._chunk] }) }, 1e3)) : (i.uploads.failSyncTm && clearTimeout(i.uploads.failSyncTm), i.uploads.failSyncTm = setTimeout(function () { i.sync(p) }, 1e3)) }) : P(a), !t && i.sync(), i.uploads.xhrUploading = !1, w = null }).done(function (t) { i.uploads.xhrUploading = !1, w = null, t && (i.currentReqCmd = "upload", t.warning && P(t.warning), i.updateCache(t), t.removed && t.removed.length && i.remove(t), t.added && t.added.length && i.add(t), t.changed && t.changed.length && i.change(t), i.trigger("upload", t, !1), i.trigger("uploaddone"), t.toasts && Array.isArray(t.toasts) && e.each(t.toasts, function () { this.msg && i.toast(this) }), t.sync && i.sync(), t.debug && (i.responseDebug(t), n.debug("backend-debug", t))) }).always(function () { i.abortXHR(o), a.off("uploadabort", E), e(window).off("unload", E), r && clearTimeout(r), s && clearTimeout(s), l && clearTimeout(l), c && !t.multiupload && M() && i.notify({ type: "upload", cnt: -x, progress: 0, size: 0 }), s && S && i.notify({ type: "chunkmerge", cnt: -x }), N && j.children(".elfinder-notify-chunkmerge").length && i.notify({ type: "chunkmerge", cnt: -1 }) }), y = new FormData, w = t.input ? t.input.files : i.uploads.checkFile(t, i, p), x = t.checked && d ? w[0].length : w.length, k = !1, C = 0, z = 0, T = 0, A = !1, j = i.ui.notify, O = !0, S = !1, I = !1, M = function () { return !A && (L = j.children(".elfinder-notify-upload")).length && (A = !0), A }, E = function (e, t) { I = !0, i.abortXHR(o, { quiet: !0, abort: !0 }), b.reject(t), M() && i.notify({ type: "upload", cnt: -1 * L.data("cnt"), progress: 0, size: 0 }) }, F = function (e, t) { L.children(".elfinder-notify-cancel")[e ? "show" : "hide"](), O = e }, D = function (e) { return e || (e = T), setTimeout(function () { A = !0, i.notify({ type: "upload", cnt: x, progress: C - z, size: e, cancel: function () { a.trigger("uploadabort", "userabort") } }), L = j.children(".elfinder-notify-upload"), z = C, t.multiupload ? O && F(!0) : F(O && C < e) }, i.options.notifyDelay) }, U = function () { A && b.notifyWith(L, [{ cnt: L.data("cnt"), progress: L.data("progress"), total: L.data("total") }]) }, P = function (e, t, n) { e && i.trigger("xhruploadfail", { error: e, file: t }), n ? e && (R < i.options.maxErrorDialogs && (Array.isArray(e) ? q = q.concat(e) : q.push(e)), R++) : e ? i.error(e) : (q.length && (R >= i.options.maxErrorDialogs && (q = q.concat("moreErrors", R - i.options.maxErrorDialogs)), i.error(q)), q = [], R = 0) }, q = [], R = 0, H = t.renames || null, _ = t.hashes || null, N = !1, L = e(); if (a.one("uploadabort", E), e(window).one("unload." + n.namespace, E), !N && (z = C), !d && !x) return b.reject(["errUploadNoFiles"]); o.addEventListener("error", function () { 0 == o.status ? I ? b.reject() : !d && t.files && e.grep(t.files, function (e) { return !e.type && e.size === (i.UA.Safari ? 1802 : 0) }).length ? b.reject(["errAbort", "errFolderUpload"]) : t.input && e.grep(t.input.files, function (e) { return !e.type && e.size === (i.UA.Safari ? 1802 : 0) }).length ? b.reject(["errUploadNoFiles"]) : g++ <= 30 ? (M() && z && i.notify({ type: "upload", cnt: 0, progress: 0, size: z }), i.abortXHR(o, { quiet: !0 }), z = C = 0, setTimeout(function () { var e; I || (o.open("POST", i.uploadURL, !0), i.api >= 2.1029 && (e = (+new Date).toString(16) + Math.floor(1e3 * Math.random()).toString(16), "function" == typeof y.delete && y.delete("reqid"), y.append("reqid", e), o._requestId = e), o.send(y)) }, 1e4)) : a.trigger("uploadabort", ["errAbort", "errTimeout"]) : a.trigger("uploadabort", "errConnect") }, !1), o.addEventListener("load", function (e) { var n, s, c = o.status, p = 0, u = ""; if (i.setCustomHeaderByXhr(o), c >= 400 ? u = c > 500 ? "errResponse" : ["errResponse", "errServerError"] : o.responseText || (u = ["errResponse", "errDataEmpty"]), u && (a.trigger("uploadabort"), v(w || {}).done(function (e) { return b.reject(e._cid ? null : u) })), C = T, M() && (p = C - z) && (i.notify({ type: "upload", cnt: 0, progress: p, size: 0 }), U()), (n = i.parseUploadData(o.responseText))._chunkmerged) { y = new FormData; var h = [{ _chunkmerged: n._chunkmerged, _name: n._name, _mtime: n._mtime }]; return N = !0, a.off("uploadabort", E), l = setTimeout(function () { i.notify({ type: "chunkmerge", cnt: 1 }) }, i.options.notifyDelay), void (d ? $(h, w[1]) : $(h)) } n._multiupload = !!t.multiupload, n.error ? (s = { cmd: "upload", err: n, xhr: o, rc: o.status }, i.trigger("uploadfail", n), i.trigger("requestError", s), s._getEvent && s._getEvent().isDefaultPrevented() && (n.error = ""), n._chunkfailure || n._multiupload ? (I = !0, i.uploads.xhrUploading = !1, r && clearTimeout(r), L.length ? (i.notify({ type: "upload", cnt: -x, progress: 0, size: 0 }), b.reject(n)) : b.reject()) : b.reject(n)) : b.resolve(n) }, !1), o.upload.addEventListener("loadstart", function (e) { !N && e.lengthComputable && (C = e.loaded, g && (C = 0), T = e.total, C || (C = parseInt(.05 * T)), M() && (i.notify({ type: "upload", cnt: 0, progress: C - z, size: t.multiupload ? 0 : T }), z = C, U())) }, !1), o.upload.addEventListener("progress", function (e) { var n; e.lengthComputable && !N && o.readyState < 2 && (C = e.loaded, !t.checked && C > 0 && !r && (r = D(o._totalSize - C)), T || (T = e.total, C || (C = parseInt(.05 * T))), n = C - z, M() && n / e.total >= .05 && (i.notify({ type: "upload", cnt: 0, progress: n, size: 0 }), z = C, U()), !S && C >= T && !k && (S = !0, s = setTimeout(function () { i.notify({ type: "chunkmerge", cnt: x }) }, i.options.notifyDelay)), O && !t.multiupload && C >= T && M() && F(!1)) }, !1); var W, B, $ = function (a, s) { var l, g, v, w, C, z, T, A, j, S, E, U, R, N, L, W = 0, B = 1, $ = [], V = 0, K = x, X = 0, J = [], G = (new Date).getTime().toString().substr(-9), Y = Math.min((n.uplMaxSize ? n.uplMaxSize : 2097152) - 8190, n.options.uploadMaxChunkSize), Q = !f && "", Z = function (a, o) { var s, l, c, h = [], f = 0; if (!I) { for (; a.length && h.length < o;)h.push(a.shift()); if (f = h.length) { l = f; for (var m = 0; m < f && !I; m++)s = d ? h[m][0][0]._cid || null : h[m][0]._cid || null, c = !(!c && !s), N[s] ? R-- : n.exec("upload", { type: t.type, isDataType: d, files: h[m], checked: !0, target: p, dropEvt: u, renames: H, hashes: _, multiupload: !0, overwrite: 0 === t.overwrite ? 0 : void 0, clipdata: t.clipdata }, void 0, p).fail(function (e) { e && "No such command" === e && (I = !0, n.error(["errUpload", "errPerm"])), s && (N[s] = !0) }).always(function (t) { t && t.added && (E = e.merge(E, t.added)), R <= ++U && (n.trigger("multiupload", { added: E }), r && clearTimeout(r), M() && i.notify({ type: "upload", cnt: -x, progress: 0, size: 0 })), a.length ? Z(a, 1) : (--l <= 1 && O && F(!1), b.resolve()) }) } } (h.length < 1 || I) && (I ? (r && clearTimeout(r), s && (N[s] = !0), b.reject()) : (b.resolve(), i.uploads.xhrUploading = !1)) }, ee = function () { i.uploads.xhrUploading ? setTimeout(ee, 100) : (i.uploads.xhrUploading = !0, Z($, m)) }; if (!c && (d || "files" == t.type)) { for ((l = n.option("uploadMaxSize", p)) || (l = 0), C = 0; C < a.length; C++) { try { g = (j = a[C]).size, !1 === Q && (Q = "", i.api >= 2.1 && ("slice" in j ? Q = "slice" : "mozSlice" in j ? Q = "mozSlice" : "webkitSlice" in j && (Q = "webkitSlice"))) } catch (e) { x--, K--; continue } if (l && g > l || !Q && n.uplMaxSize && g > n.uplMaxSize) P(["errUploadFile", j.name, "errUploadFileSize"], j, !0), x--, K--; else if (!j.type || i.uploadMimeCheck(j.type, p)) if (Q && g > Y) { for (z = 0, T = Y, A = -1, K = Math.floor((g - 1) / Y), v = j.lastModified ? Math.round(j.lastModified / 1e3) : 0, w = t.clipdata ? n.date(n.nonameDateFormat) + ".png" : j.name, X += g, J[G] = 0; z < g;)(S = j[Q](z, T))._chunk = w + "." + ++A + "_" + K + ".part", S._cid = G, S._range = z + "," + S.size + "," + g, S._mtime = v, J[G]++, W && V++, void 0 === $[V] && ($[V] = [], d && ($[V][0] = [], $[V][1] = [])), W = Y, B = 1, d ? ($[V][0].push(S), $[V][1].push(s[C])) : $[V].push(S), T = (z = T) + Y; null == S ? (P(["errUploadFile", j.name, "errUploadFileSize"], j, !0), x--, K--) : (K += A, W = 0, B = 1, V++) } else (n.uplMaxSize && W + g > n.uplMaxSize || B > n.uplMaxFile) && (W = 0, B = 1, V++), void 0 === $[V] && ($[V] = [], d && ($[V][0] = [], $[V][1] = [])), d ? ($[V][0].push(j), $[V][1].push(s[C])) : $[V].push(j), W += g, X += g, B++; else P(["errUploadFile", j.name, "errUploadMime", "(" + j.type + ")"], j, !0), x--, K-- } if (q.length && P(), 0 == $.length) return t.checked = !0, !1; if ($.length > 1) return r = D(X), E = [], U = 0, R = $.length, N = [], ee(), !0; d ? (a = $[0][0], s = $[0][1]) : a = $[0] } return c || (n.UA.Safari && t.files ? o._totalSize = X : r = D(X)), c = !0, a.length || b.reject(["errUploadNoFiles"]), o.open("POST", i.uploadURL, !0), n.customHeaders && e.each(n.customHeaders, function (e) { o.setRequestHeader(e, this) }), n.xhrFields && e.each(n.xhrFields, function (e) { e in o && (o[e] = this) }), i.api >= 2.1029 && (L = (+new Date).toString(16) + Math.floor(1e3 * Math.random()).toString(16), y.append("reqid", L), o._requestId = L), y.append("cmd", "upload"), y.append(i.newAPI ? "target" : "current", p), H && H.length && (e.each(H, function (e, t) { y.append("renames[]", t) }), y.append("suffix", n.options.backupSuffix)), _ && e.each(_, function (e, t) { y.append("hashes[" + e + "]", t) }), e.each(i.customData, function (e, t) { y.append(e, t) }), e.each(i.options.onlyMimes, function (e, t) { y.append("mimes[]", t) }), e.each(a, function (e, i) { var a; i._chunkmerged ? (y.append("chunk", i._chunkmerged), y.append("upload[]", i._name), y.append("mtime[]", i._mtime), t.clipdata && y.append("overwrite", 0), k = !0) : (i._chunkfail ? (y.append("upload[]", "chunkfail"), y.append("mimes", "chunkfail")) : (t.clipdata ? i._chunk || (t.overwrite = 0, a = n.date(n.nonameDateFormat) + ".png") : i.name && (a = i.name, n.UA.iOS && (a.match(/^image\.jpe?g$/i) ? (t.overwrite = 0, a = n.date(n.nonameDateFormat) + ".jpg") : a.match(/^capturedvideo\.mov$/i) && (t.overwrite = 0, a = n.date(n.nonameDateFormat) + ".mov")), a = (i.webkitRelativePath || i.relativePath || i._relativePath || "").replace(/[^\/]+$/, "") + a), a ? y.append("upload[]", i, a) : y.append("upload[]", i)), i._chunk ? (y.append("chunk", i._chunk), y.append("cid", i._cid), y.append("range", i._range), y.append("mtime[]", i._mtime), k = !0) : y.append("mtime[]", i.lastModified ? Math.round(i.lastModified / 1e3) : 0)) }), d && e.each(s, function (e, t) { y.append("upload_path[]", t) }), 0 === t.overwrite && y.append("overwrite", 0), u && y.append("dropWith", parseInt((u.altKey ? "1" : "0") + (u.ctrlKey ? "1" : "0") + (u.metaKey ? "1" : "0") + (u.shiftKey ? "1" : "0"), 2)), h && e.each(h, function (e, t) { y.append(e, t) }), o.send(y), !0 }; if (d) c ? $(w[0], w[1]) : w.done(function (t) { if (H = [], x = t[0].length) { if (t[4] && t[4].length) return void n.request({ data: { cmd: "mkdir", target: p, dirs: t[4] }, notify: { type: "mkdir", cnt: t[4].length }, preventFail: !0 }).fail(function (e) { "errCmdParams" === (e = e || ["errUnknown"])[0] ? m = 1 : (m = 0, b.reject(e)) }).done(function (n) { var i = !1; n.hashes || (n.hashes = {}), t[1] = e.map(t[1], function (e, a) { return t[0][a]._relativePath = e.replace(/^\//, ""), "" === (e = e.replace(/\/[^\/]*$/, "")) ? p : n.hashes[e] ? n.hashes[e] : (i = !0, t[0][a]._remove = !0, null) }), i && (t[0] = e.grep(t[0], function (e) { return !e._remove })) }).always(function (e) { m && (H = t[2], _ = t[3], $(t[0], t[1])) }); t[1] = e.map(t[1], function () { return p }), H = t[2], _ = t[3], $(t[0], t[1]) } else b.reject(["errUploadNoFiles"]) }).fail(function () { b.reject() }); else if (w.length > 0) if (t.clipdata || null != H) $(w) || b.reject(); else { var V = [], K = [], X = n.options.folderUploadExclude[n.OS] || null; e.each(w, function (t, n) { var i, a, o = n.webkitRelativePath || n.relativePath || ""; if (!o) return !1; X && n.name.match(X) ? (n._remove = !0, o = void 0) : (o = "/" + o.replace(/\/[^\/]*$/, "").replace(/^\//, "")) && -1 === e.inArray(o, V) && (V.push(o), -1 !== (i = o.substr(1).indexOf("/")) && (a = o.substr(0, i + 1)) && -1 === e.inArray(a, V) && V.unshift(a)), K.push(o) }), H = [], _ = {}, V.length ? (W = e.map(V, function (e) { return -1 === e.substr(1).indexOf("/") ? { name: e.substr(1) } : null }), B = [], n.uploads.checkExists(W, p, n, !0).done(function (t, i) { var a, o, r = []; n.options.overwriteUploadConfirm && n.option("uploadOverwrite", p) && (B = e.map(W, function (e) { return e._remove ? e.name : null }), W = e.grep(W, function (e) { return !e._remove })), B.length && e.each(K.concat(), function (t, n) { 0 === e.inArray(n, B) && (w[t]._remove = !0, K[t] = void 0) }), w = e.grep(w, function (e) { return !e._remove }), K = e.grep(K, function (e) { return void 0 !== e }), W.length ? (e.Deferred(), t.length ? e.each(t, function (s, l) { a = n.uniqueName(l + n.options.backupSuffix, null, ""), e.each(i, function (e, n) { if (t[0] == n) return o = e, !1 }), o || (o = n.fileByName(t[0], p).hash), n.lockfiles({ files: [o] }), r.push(n.request({ data: { cmd: "rename", target: o, name: a }, notify: { type: "rename", cnt: 1 } }).fail(function (e) { b.reject(e), n.sync() }).always(function () { n.unlockfiles({ files: [o] }) })) }) : r.push(null), e.when.apply(e, r).done(function () { n.request({ data: { cmd: "mkdir", target: p, dirs: V }, notify: { type: "mkdir", cnt: V.length }, preventFail: !0 }).fail(function (e) { "errCmdParams" === (e = e || ["errUnknown"])[0] ? m = 1 : (m = 0, b.reject(e)) }).done(function (t) { var n = !1; t.hashes || (t.hashes = {}), K = e.map(K.concat(), function (e, i) { return "/" === e ? p : t.hashes[e] ? t.hashes[e] : (n = !0, w[i]._remove = !0, null) }), n && (w = e.grep(w, function (e) { return !e._remove })) }).always(function (e) { m && (d = !0, $(w, K) || b.reject()) }) })) : b.reject() })) : n.uploads.checkExists(w, p, n).done(function (i, a) { n.options.overwriteUploadConfirm && n.option("uploadOverwrite", p) && (_ = a, null === i ? t.overwrite = 0 : H = i, w = e.grep(w, function (e) { return !e._remove })), (x = w.length) > 0 && $(w) || b.reject() }) } else b.reject(); return b }, iframe: function (t, n) { var i, a, o, r, s = n || this, l = !!t.input && t.input, c = !l && s.uploads.checkFile(t, s), d = e.Deferred().fail(function (e) { e && s.error(e) }), p = "iframe-" + n.namespace + ++s.iframeCnt, u = e('<form action="' + s.uploadURL + '" method="post" enctype="multipart/form-data" encoding="multipart/form-data" target="' + p + '" style="display:none"><input type="hidden" name="cmd" value="upload" /></form>'), h = this.UA.IE, f = function () { r && clearTimeout(r), o && clearTimeout(o), a && s.notify({ type: "upload", cnt: -i }), setTimeout(function () { h && e('<iframe src="javascript:false;"></iframe>').appendTo(u), u.remove(), m.remove() }, 100) }, m = e('<iframe src="' + (h ? "javascript:false;" : "about:blank") + '" name="' + p + '" style="position:absolute;left:-1000px;top:-1000px" ></iframe>').on("load", function () { m.off("load").on("load", function () { f(), d.resolve() }), o = setTimeout(function () { a = !0, s.notify({ type: "upload", cnt: i }) }, s.options.notifyDelay), s.options.iframeTimeout > 0 && (r = setTimeout(function () { f(), d.reject(["errConnect", "errTimeout"]) }, s.options.iframeTimeout)), u.submit() }), g = t.target || s.cwd().hash, v = [], b = [], y = [], w = {}; if (c && c.length) e.each(c, function (e, t) { u.append('<input type="hidden" name="upload[]" value="' + t + '"/>') }), i = 1; else { if (!(l && e(l).is(":file") && e(l).val())) return d.reject(); n.options.overwriteUploadConfirm && n.option("uploadOverwrite", g) && (v = l.files ? l.files : [{ name: e(l).val().replace(/^(?:.+[\\\/])?([^\\\/]+)$/, "$1") }], b.push(s.uploads.checkExists(v, g, s).done(function (n, a) { w = a, null === n ? t.overwrite = 0 : (y = n, (i = e.grep(v, function (e) { return !e._remove }).length) != v.length && (i = 0)) }))), i = l.files ? l.files.length : 1, u.append(l) } return e.when.apply(e, b).done(function () { if (i < 1) return d.reject(); u.append('<input type="hidden" name="' + (s.newAPI ? "target" : "current") + '" value="' + g + '"/>').append('<input type="hidden" name="html" value="1"/>').append('<input type="hidden" name="node" value="' + s.id + '"/>').append(e(l).attr("name", "upload[]")), y.length > 0 && (e.each(y, function (e, t) { u.append('<input type="hidden" name="renames[]" value="' + s.escape(t) + '"/>') }), u.append('<input type="hidden" name="suffix" value="' + n.options.backupSuffix + '"/>')), w && e.each(y, function (e, t) { u.append('<input type="hidden" name="[' + e + ']" value="' + s.escape(t) + '"/>') }), 0 === t.overwrite && u.append('<input type="hidden" name="overwrite" value="0"/>'), e.each(s.options.onlyMimes || [], function (e, t) { u.append('<input type="hidden" name="mimes[]" value="' + s.escape(t) + '"/>') }), e.each(s.customData, function (e, t) { u.append('<input type="hidden" name="' + e + '" value="' + s.escape(t) + '"/>') }), u.appendTo("body"), m.appendTo("body") }), d } }, one: function (e, t, n) { var i = this, a = e.toLowerCase(), o = function (e, n) { return i.toUnbindEvents[a] || (i.toUnbindEvents[a] = []), i.toUnbindEvents[a].push({ type: a, callback: o }), (t.done ? t.done : t).apply(this, arguments) }; return t.done && (o = { done: o }), this.bind(a, o, n) }, localStorage: function (t, n) { var i, a, o, r, s, l = window.localStorage, c = "elfinder-" + (t || "") + this.id, d = window.location.pathname + "-elfinder-", p = this.id, u = []; if (void 0 === t) return r = d.length, s = -1 * p.length, e.each(l, function (e) { e.substr(0, r) === d && e.substr(s) === p && u.push(e) }), e.each(u, function (e, t) { l.removeItem(t) }), !0; if (t = d + t + p, null === n) return l.removeItem(t); if (void 0 === n && !(i = l.getItem(t)) && (a = l.getItem(c)) && (n = a, l.removeItem(c)), void 0 !== n) { "string" !== (o = typeof n) && "number" !== o && (n = JSON.stringify(n)); try { l.setItem(t, n) } catch (e) { try { l.clear(), l.setItem(t, n) } catch (e) { this.debug("error", e.toString()) } } i = l.getItem(t) } if (i && ("{" === i.substr(0, 1) || "[" === i.substr(0, 1))) try { return JSON.parse(i) } catch (e) { } return i }, sessionStorage: function (e, t) { var n, i, a; try { n = window.sessionStorage } catch (e) { } if (n) { if (null === t) return n.removeItem(e); if (void 0 !== t) { "string" !== (a = typeof t) && "number" !== a && (t = JSON.stringify(t)); try { n.setItem(e, t) } catch (i) { try { n.clear(), n.setItem(e, t) } catch (e) { this.debug("error", e.toString()) } } } if ((i = n.getItem(e)) && ("{" === i.substr(0, 1) || "[" === i.substr(0, 1))) try { return JSON.parse(i) } catch (e) { } return i } }, cookie: function (t, n) { var i, a, o, r, s, l; if (t = "elfinder-" + t + this.id, void 0 === n) { if (this.cookieEnabled && document.cookie && "" != document.cookie) for (o = document.cookie.split(";"), t += "=", r = 0; r < o.length; r++)if (o[r] = e.trim(o[r]), o[r].substring(0, t.length) == t) { if ("{" === (s = decodeURIComponent(o[r].substring(t.length))).substr(0, 1) || "[" === s.substr(0, 1)) try { return JSON.parse(s) } catch (e) { } return s } return null } if (!this.cookieEnabled) return ""; if (a = Object.assign({}, this.options.cookie), null === n ? (n = "", a.expires = -1) : "string" !== (l = typeof n) && "number" !== l && (n = JSON.stringify(n)), "number" == typeof a.expires && ((i = new Date).setTime(i.getTime() + 864e5 * a.expires), a.expires = i), document.cookie = t + "=" + encodeURIComponent(n) + "; expires=" + a.expires.toUTCString() + (a.path ? "; path=" + a.path : "") + (a.domain ? "; domain=" + a.domain : "") + (a.secure ? "; secure" : ""), n && ("{" === n.substr(0, 1) || "[" === n.substr(0, 1))) try { return JSON.parse(n) } catch (e) { } return n }, startDir: function () { var e = window.location.hash; return e && e.match(/^#elf_/) ? e.replace(/^#elf_/, "") : this.options.startPathHash ? this.options.startPathHash : this.lastDir() }, lastDir: function (e) { return this.options.rememberLastDir ? this.storage("lastdir", e) : "" }, _node: e("<span></c.length;>"), escape: function (e) { return this._node.text(e).html().replace(/"/g, "&quot;").replace(/'/g, "&#039;") }, normalize: function (t) { var n, i, a, o, r, s, l, c = this, d = function () { var e, t; return (t = c.options.fileFilter) && ("function" == typeof t ? e = function (e) { return t.call(c, e) } : t instanceof RegExp && (e = function (e) { return t.test(e.name) })), e || null }(), p = function (t) { var n = function (e) { var t = typeof e; return "object" === t && Array.isArray(e) && (t = "array"), t }; return e.each(c.optionProperties, function (e, i) { void 0 !== i && t[e] && n(t[e]) !== n(i) && (t[e] = i) }), t.disabled ? (t.disabledFlip = c.arrayFlip(t.disabled, !0), e.each(c.options.disabledCmdsRels, function (n, i) { var a, o; t.disabledFlip[n] ? o = !0 : (a = n.match(/^([^&]+)&([^=]+)=(.*)$/)) && t.disabledFlip[a[1]] && t[a[2]] == a[3] && (o = !0), o && e.each(i, function (e, n) { t.disabledFlip[n] || (t.disabledFlip[n] = !0, t.disabled.push(n)) }) })) : t.disabledFlip = {}, t }, u = function (t, r, s) { var l, u, h, m, g, v, b = !r || t, y = !!r && null; if (t && t.hash && t.name && t.mime) { if ("application/x-empty" === t.mime && (t.mime = "text/plain"), (h = c.isRoot(t)) && !t.volumeid && c.debug("warning", "The volume root statuses requires `volumeid` property."), h || "directory" === t.mime) { if (t.phash) { if (t.phash === t.hash) return f = f.concat(['Parent folder of "$1" is itself.', t.name]), y; if (h && t.volumeid && 0 === t.phash.indexOf(t.volumeid)) return f = f.concat(['Parent folder of "$1" is inner itself.', t.name]), y } t.volumeid && (l = t.volumeid, h && (t.phash && (c.leafRoots[t.phash] ? -1 === e.inArray(t.hash, c.leafRoots[t.phash]) && c.leafRoots[t.phash].push(t.hash) : c.leafRoots[t.phash] = [t.hash]), c.hasVolOptions = !0, c.volOptions[l] || (c.volOptions[l] = { dispInlineRegex: c.options.dispInlineRegex }), u = c.volOptions[l], t.options && Object.assign(u, t.options), t.disabled && (u.disabled = t.disabled, u.disabledFlip = c.arrayFlip(t.disabled, !0)), t.tmbUrl && (u.tmbUrl = t.tmbUrl), u.url && "/" !== u.url.substr(-1) && (u.url += "/"), (g = u).uiCmdMap && (e.isPlainObject(g.uiCmdMap) && Object.keys(g.uiCmdMap).length ? (g.disabledFlip || (g.disabledFlip = {}), v = g.disabledFlip, e.each(g.uiCmdMap, function (e, t) { "hidden" !== t || v[e] || (g.disabled.push(e), g.disabledFlip[e] = !0) })) : delete g.uiCmdMap), u.trashHash && (!1 === c.trashes[u.trashHash] ? delete u.trashHash : c.trashes[u.trashHash] = t.hash), e.each(c.optionProperties, function (e) { u[e] && (t[e] = u[e]) }), "cwd" !== s && (c.roots[l] = t.hash), t.expires && (c.volumeExpires[l] = t.expires)), o !== l && (o = l, a = c.option("i18nFolderName", l))), h && !t.i18 && (n = "volume_" + t.name, i = c.i18n(!1, n), n !== i && (t.i18 = i)), a && !t.i18 && (n = "folder_" + t.name, i = c.i18n(!1, n), n !== i && (t.i18 = i)), h && (m = c.storage("rootNames")) && (m[t.hash] && (t._name = t.name, t._i18 = t.i18, t.name = m[t.hash] = m[t.hash], delete t.i18), c.storage("rootNames", m)), c.trashes[t.hash] && (t.locked = !0) } else { if (d) try { if (!d(t)) return y } catch (e) { c.debug(e) } 0 == t.size && (t.mime = c.getMimetype(t.name, t.mime)) } return t.options && (c.optionsByHashes[t.hash] = p(t.options)), delete t.options, b } return y }, h = function (n, i) { e.each(n, function (n, a) { var o, r; c.leafRoots[a.hash] && c.applyLeafRootStats(a), "change" !== i && a.phash && c.isRoot(a) && (o = c.file(a.phash)) && (c.applyLeafRootStats(o), t.changed ? (e.each(t.changed, function (e, n) { if (n.hash === o.hash) return t.changed[e] = o, r = !0, !1 }), r || t.changed.push(o)) : t.changed = [o]) }) }, f = []; if (t.customData && (!c.prevCustomData || JSON.stringify(t.customData) !== JSON.stringify(c.prevCustomData))) { c.prevCustomData = t.customData; try { r = JSON.parse(t.customData), e.isPlainObject(r) && (c.prevCustomData = r, e.each(Object.keys(r), function (e, t) { null === r[t] && (delete r[t], delete c.optsCustomData[t]) }), c.customData = Object.assign({}, c.optsCustomData, r)) } catch (e) { } } return t.options && p(t.options), t.cwd && (t.cwd.volumeid && t.options && Object.keys(t.options).length && c.isRoot(t.cwd) && (c.hasVolOptions = !0, c.volOptions[t.cwd.volumeid] = t.options), t.cwd = u(t.cwd, !0, "cwd")), t.files && (t.files = e.grep(t.files, u)), t.tree && (t.tree = e.grep(t.tree, u)), t.added && (t.added = e.grep(t.added, u)), t.changed && (t.changed = e.grep(t.changed, u)), t.removed && t.removed.length && 2 === c.searchStatus.state && (t.removed = t.removed.concat((s = t.removed, l = [], e.each(c.files(), function (t, n) { e.each(c.parents(t), function (n, i) { if (-1 !== e.inArray(i, s) && -1 === e.inArray(t, s)) return l.push(t), !1 }) }), l))), t.api && (t.init = !0), Object.keys(c.leafRoots).length && (t.files && h(t.files), t.tree && h(t.tree), t.added && h(t.added), t.changed && h(t.changed, "change")), t.cwd && t.cwd.options && t.options && Object.assign(t.options, p(t.cwd.options)), t.options && t.options.url && "/" !== t.options.url.substr(-1) && (t.options.url += "/"), f.length && (t.norError = ["errResponse"].concat(f)), t }, setSort: function (e, t, n, i) { this.storage("sortType", this.sortType = this.sortRules[e] ? e : "name"), this.storage("sortOrder", this.sortOrder = /asc|desc/.test(t) ? t : "asc"), this.storage("sortStickFolders", (this.sortStickFolders = !!n) ? 1 : ""), this.storage("sortAlsoTreeview", (this.sortAlsoTreeview = !!i) ? 1 : ""), this.trigger("sortchange") }, _sortRules: { name: function (e, t) { return h.prototype.naturalCompare(e.i18 || e.name, t.i18 || t.name) }, size: function (e, t) { var n = parseInt(e.size) || 0, i = parseInt(t.size) || 0; return n === i ? 0 : n > i ? 1 : -1 }, kind: function (e, t) { return h.prototype.naturalCompare(e.mime, t.mime) }, date: function (e, t) { var n = e.ts || e.date || 0, i = t.ts || t.date || 0; return n === i ? 0 : n > i ? 1 : -1 }, perm: function (e, t) { var n = function (e) { return (e.write ? 2 : 0) + (e.read ? 1 : 0) }, i = n(e), a = n(t); return i === a ? 0 : i > a ? 1 : -1 }, mode: function (e, t) { var n = e.mode || e.perm || "", i = t.mode || t.perm || ""; return h.prototype.naturalCompare(n, i) }, owner: function (e, t) { var n = e.owner || "", i = t.owner || ""; return h.prototype.naturalCompare(n, i) }, group: function (e, t) { var n = e.group || "", i = t.group || ""; return h.prototype.naturalCompare(n, i) } }, sorters: {}, naturalCompare: function (e, t) { var n = h.prototype.naturalCompare; return void 0 === n.loc && (n.loc = navigator.userLanguage || navigator.browserLanguage || navigator.language || "en-US"), void 0 === n.sort && ("11".localeCompare("2", n.loc, { numeric: !0 }) > 0 ? window.Intl && window.Intl.Collator ? n.sort = new Intl.Collator(n.loc, { numeric: !0 }).compare : n.sort = function (e, t) { return e.localeCompare(t, n.loc, { numeric: !0 }) } : (n.sort = function (e, t) { var i, a, o = /(^-?[0-9]+(\.?[0-9]*)[df]?e?[0-9]?$|^0x[0-9a-f]+$|[0-9]+)/gi, r = /(^[ ]*|[ ]*$)/g, s = /(^([\w ]+,?[\w ]+)?[\w ]+,?[\w ]+\d+:\d+(:\d+)?[\w ]?|^\d{1,4}[\/\-]\d{1,4}[\/\-]\d{1,4}|^\w+, \w+ \d+, \d{4})/, l = /^0x[0-9a-f]+$/i, c = /^0/, d = /^[\x01\x21-\x2f\x3a-\x40\x5b-\x60\x7b-\x7e]/, p = function (e) { return n.sort.insensitive && ("" + e).toLowerCase() || "" + e }, u = p(e).replace(r, "").replace(/^_/, "") || "", h = p(t).replace(r, "").replace(/^_/, "") || "", f = u.replace(o, "\0$1\0").replace(/\0$/, "").replace(/^\0/, "").split("\0"), m = h.replace(o, "\0$1\0").replace(/\0$/, "").replace(/^\0/, "").split("\0"), g = parseInt(u.match(l)) || 1 != f.length && u.match(s) && Date.parse(u), v = parseInt(h.match(l)) || g && h.match(s) && Date.parse(h) || null, b = 0; if (v) { if (g < v) return -1; if (g > v) return 1 } for (var y = 0, w = Math.max(f.length, m.length); y < w; y++) { if (i = !(f[y] || "").match(c) && parseFloat(f[y]) || f[y] || 0, a = !(m[y] || "").match(c) && parseFloat(m[y]) || m[y] || 0, isNaN(i) !== isNaN(a)) { if (isNaN(i) && ("string" != typeof i || !i.match(d))) return 1; if ("string" != typeof a || !a.match(d)) return -1 } if (0 === parseInt(i, 10) && (i = 0), 0 === parseInt(a, 10) && (a = 0), typeof i != typeof a && (i += "", a += ""), n.sort.insensitive && "string" == typeof i && "string" == typeof a && 0 !== (b = i.localeCompare(a, n.loc))) return b; if (i < a) return -1; if (i > a) return 1 } return 0 }, n.sort.insensitive = !0)), n.sort(e, t) }, compare: function (e, t) { var n, i = this.sortType, a = "asc" == this.sortOrder, o = this.sortStickFolders, r = this.sortRules, s = r[i], l = "directory" == e.mime, c = "directory" == t.mime; if (o) { if (l && !c) return -1; if (!l && c) return 1 } return n = a ? s(e, t) : s(t, e), "name" !== i && 0 === n ? n = a ? r.name(e, t) : r.name(t, e) : n }, sortFiles: function (e) { return e.sort(this.compare) }, notify: function (t) { var n, i, a, o = this, r = t.type, s = t.id ? "elfinder-notify-" + t.id : "", l = this.i18n(void 0 !== t.msg ? t.msg : this.messages["ntf" + r] ? "ntf" + r : "ntfsmth"), c = this.arrayFlip(this.options.notifyDialog.hiddens || []), d = this.ui.notify, p = d.closest(".ui-dialog"), u = d.children(".elfinder-notify-" + r + (s ? "." + s : "")), h = u.children("div.elfinder-notify-cancel").children("button"), f = '<div class="elfinder-notify elfinder-notify-{type}' + (s ? " " + s : "") + '"><span class="elfinder-dialog-icon elfinder-dialog-icon-{type}"></span><span class="elfinder-notify-msg">{msg}</span> <span class="elfinder-notify-cnt"></span><div class="elfinder-notify-progressbar"><div class="elfinder-notify-progress"></div></div><div class="elfinder-notify-cancel"></div></div>', m = t.cnt + 0, g = void 0 !== t.size ? parseInt(t.size) : null, v = void 0 !== t.progress && t.progress >= 0 ? t.progress : null, b = t.fakeinterval || 200, y = t.cancel, w = function () { var t = u.find(".elfinder-notify-progress"), n = function () { u.remove(), d.children(p.data("minimized") ? void 0 : ":visible").length || (p.data("minimized") ? p.data("minimized").hide() : d.elfinderdialog("close")), k() }; u._esc && e(document).off("keydown", u._esc), u.data("cur") < 100 ? t.animate({ width: "100%" }, 50, function () { requestAnimationFrame(function () { n() }) }) : n() }, x = function (e) { var t; u.length && (t = u.data("cur") + 1) <= 98 && (u.find(".elfinder-notify-progress").width(t + "%"), u.data("cur", t), k(), setTimeout(function () { x(e *= 1.05) }, e)) }, k = function () { var t, n = 0, i = 0, a = d.children(".elfinder-notify"); a.length ? (a.each(function () { n++, i += Math.min(e(this).data("cur"), 100) }), t = n ? Math.floor(i / (100 * n) * 100) + "%" : 0, o.ui.progressbar.width(t), p.data("minimized") && (p.data("minimized").title(t), p.data("minimized").dialog().children(".ui-dialog-titlebar").children(".elfinder-ui-progressbar").width(t))) : (o.ui.progressbar.width(0), p.data("minimized") && p.data("minimized").hide()) }; return r ? (u.length ? void 0 !== t.msg && u.children("span.elfinder-notify-msg").html(l) : (u = e(f.replace(/\{type\}/g, r).replace(/\{msg\}/g, l)), c[r] ? u.hide() : d.on("minimize", function (e) { p.data("minimized") && k() }), u.appendTo(d).data("cnt", 0), null != v ? u.data({ progress: 0, total: 0, cur: 0 }) : (u.data({ cur: 0 }), x(b)), y && (h = e('<span class="elfinder-notify-button ui-icon ui-icon-close" title="' + this.i18n("btnCancel") + '"></span>').on("mouseenter mouseleave", function (t) { e(this).toggleClass("ui-state-hover", "mouseenter" === t.type) }), u.children("div.elfinder-notify-cancel").append(h)), d.trigger("resize")), (n = m + parseInt(u.data("cnt"))) > 0 ? (y && h.length && (e.isFunction(y) || "object" == typeof y && y.promise) && (u._esc = function (t) { "keydown" == t.type && t.keyCode != e.ui.keyCode.ESCAPE || (t.preventDefault(), t.stopPropagation(), w(), y.promise ? y.reject(0) : y(t)) }, h.on("click", function (e) { u._esc(e) }), e(document).on("keydown." + this.namespace, u._esc)), !t.hideCnt && u.children(".elfinder-notify-cnt").text("(" + n + ")"), m > 0 && d.is(":hidden") && !c[r] && (p.data("minimized") ? p.data("minimized").show() : d.elfinderdialog("open", this).height("auto")), u.data("cnt", n), null != v && (i = u.data("total")) >= 0 && (a = u.data("progress")) >= 0 && (i += null != g ? g : m, a += v, null == g && m < 0 && (a += 100 * m), u.data({ progress: a, total: i }), null != g && (a *= 100, i = Math.max(1, i)), v = Math.min(parseInt(a / i), 100), u.find(".elfinder-notify-progress").animate({ width: (v < 100 ? v : 100) + "%" }, 20, function () { u.data("cur", v), k() }))) : w(), this) : this }, confirm: function (t) { var n, i, a = this, o = !1, r = { cssClass: "elfinder-dialog-confirm", modal: !0, resizable: !1, title: this.i18n(t.title || "confirmReq"), buttons: {}, close: function () { !o && t.cancel.callback(), e(this).elfinderdialog("destroy") } }, s = this.i18n("apllyAll"); return t.cssClass && (r.cssClass += " " + t.cssClass), r.buttons[this.i18n(t.accept.label)] = function () { t.accept.callback(!(!n || !n.prop("checked"))), o = !0, e(this).elfinderdialog("close") }, r.buttons[this.i18n(t.accept.label)]._cssClass = "elfinder-confirm-accept", t.reject && (r.buttons[this.i18n(t.reject.label)] = function () { t.reject.callback(!(!n || !n.prop("checked"))), o = !0, e(this).elfinderdialog("close") }, r.buttons[this.i18n(t.reject.label)]._cssClass = "elfinder-confirm-reject"), t.buttons && t.buttons.length > 0 && (i = 1, e.each(t.buttons, function (t, s) { r.buttons[a.i18n(s.label)] = function () { s.callback(!(!n || !n.prop("checked"))), o = !0, e(this).elfinderdialog("close") }, r.buttons[a.i18n(s.label)]._cssClass = "elfinder-confirm-extbtn" + i++, s.cssClass && (r.buttons[a.i18n(s.label)]._cssClass += " " + s.cssClass) })), r.buttons[this.i18n(t.cancel.label)] = function () { e(this).elfinderdialog("close") }, r.buttons[this.i18n(t.cancel.label)]._cssClass = "elfinder-confirm-cancel", t.all && (r.create = function () { var t = e('<div class="elfinder-dialog-confirm-applyall"></div>'); n = e('<input type="checkbox" />'), e(this).next().find(".ui-dialog-buttonset").prepend(t.append(e("<label>" + s + "</label>").prepend(n))) }), t.optionsCallback && e.isFunction(t.optionsCallback) && t.optionsCallback(r), this.dialog('<span class="elfinder-dialog-icon elfinder-dialog-icon-confirm"></span>' + this.i18n(t.text), r) }, uniqueName: function (e, t, n) { var i, a, o = 0, r = ""; if (e = this.i18n(!1, e), t = t || this.cwd().hash, n = void 0 === n ? " " : n, (i = e.match(/^(.+)(\.[^.]+)$/)) && (r = i[2], e = i[1]), a = e + r, !this.fileByName(a, t)) return a; for (; o < 1e4;)if (a = e + n + ++o + r, !this.fileByName(a, t)) return a; return e + Math.random() + r }, i18n: function () { var t, n, i, a, o, r = this, s = this.messages, l = [], c = [], d = function (e) { var t; return 0 === e.indexOf("#") && (t = r.file(e.substr(1))) ? t.name : e }, p = 0; for (arguments.length && !1 === arguments[0] && (a = function (e) { return e }, p = 1), t = p; t < arguments.length; t++)if (i = arguments[t], Array.isArray(i)) for (n = 0; n < i.length; n++)i[n] instanceof jQuery ? l.push(i[n]) : void 0 !== i[n] && l.push(d("" + i[n])); else i instanceof jQuery ? l.push(i[n]) : void 0 !== i && l.push(d("" + i)); for (t = 0; t < l.length; t++)-1 === e.inArray(t, c) && ("string" == typeof (i = l[t]) ? (o = !(!s[i] || !i.match(/^err/)), i = (i = s[i] || (a ? a(i) : r.escape(i))).replace(/\$(\d+)/g, function (e, n) { var i; return (n = t + parseInt(n)) > 0 && l[n] && c.push(n), i = a ? a(l[n]) : r.escape(l[n]), o && (i = '<span class="elfinder-err-var elfinder-err-var' + n + '">' + i + "</span>"), i })) : i = i.get(0).outerHTML, l[t] = i); return e.grep(l, function (t, n) { return -1 === e.inArray(n, c) }).join("<br>") }, getIconStyle: function (t, n) { var i = this, a = "", o = {}, r = 0; return t.icon && (a = 'style="', e.each({ background: "url('{url}') 0 0 no-repeat", "background-size": "contain" }, function (e, s) { 0 == r++ && (s = s.replace("{url}", i.escape(t.icon))), n ? o[e] = s : a += e + ":" + s + ";" }), a += '"'), n ? o : a }, mime2class: function (e) { var t = "elfinder-cwd-icon-", n = e.toLowerCase(), i = this.textMimes[n]; return n = n.split("/"), i ? n[0] += " " + t + "text" : n[1] && n[1].match(/\+xml$/) && (n[0] += " " + t + "xml"), t + n[0] + (n[1] ? " " + t + n[1].replace(/(\.|\+)/g, "-") : "") }, mime2kind: function (e) { var t, n = "object" == typeof e, i = n ? e.mime : e; return n && e.alias && "symlink-broken" != i ? t = "Alias" : this.kinds[i] && (t = !n || "directory" !== i || e.phash && !e.isroot ? this.kinds[i] : "Root"), t || (t = 0 === i.indexOf("text") ? "Text" : 0 === i.indexOf("image") ? "Image" : 0 === i.indexOf("audio") ? "Audio" : 0 === i.indexOf("video") ? "Video" : 0 === i.indexOf("application") ? "App" : i), this.messages["kind" + t] ? this.i18n("kind" + t) : i }, mimeIsText: function (e) { return !!(this.textMimes[e.toLowerCase()] || 0 === e.indexOf("text/") && "rtf" !== e.substr(5, 3) || e.match(/^application\/.+\+xml$/)) }, date: function (e, t) { var n, i, a, o, r, s, l, c, d = this; return t || (t = new Date), r = t[d.getHours](), s = r > 12 ? r - 12 : r, l = t[d.getMinutes](), c = t[d.getSeconds](), n = t[d.getDate](), i = t[d.getDay](), a = t[d.getMonth]() + 1, o = t[d.getFullYear](), e.replace(/[a-z]/gi, function (e) { switch (e) { case "d": return n > 9 ? n : "0" + n; case "j": return n; case "D": return d.i18n(d.i18.daysShort[i]); case "l": return d.i18n(d.i18.days[i]); case "m": return a > 9 ? a : "0" + a; case "n": return a; case "M": return d.i18n(d.i18.monthsShort[a - 1]); case "F": return d.i18n(d.i18.months[a - 1]); case "Y": return o; case "y": return ("" + o).substr(2); case "H": return r > 9 ? r : "0" + r; case "G": return r; case "g": return s; case "h": return s > 9 ? s : "0" + s; case "a": return r >= 12 ? "pm" : "am"; case "A": return r >= 12 ? "PM" : "AM"; case "i": return l > 9 ? l : "0" + l; case "s": return c > 9 ? c : "0" + c }return e }) }, formatDate: function (e, t) { var n, i, a, o = this, r = t || e.ts; o.i18; return o.options.clientFormatDate && r > 0 ? (n = new Date(1e3 * r), i = r >= this.yesterday ? this.fancyFormat : this.dateFormat, a = o.date(i, n), r >= this.yesterday ? a.replace("$1", this.i18n(r >= this.today ? "Today" : "Yesterday")) : a) : e.date ? e.date.replace(/([a-z]+)\s/i, function (e, t) { return o.i18n(t) + " " }) : o.i18n("dateUnknown") }, toLocaleString: function (e) { var t = new Number(e); return t ? t.toLocaleString ? t.toLocaleString() : String(e).replace(/(\d)(?=(\d\d\d)+(?!\d))/g, "$1,") : e }, perms2class: function (e) { var t = ""; return e.read || e.write ? e.read ? e.write || (t = "elfinder-ro") : t = "elfinder-wo" : t = "elfinder-na", e.type && (t += " elfinder-" + this.escape(e.type)), t }, formatPermissions: function (e) { var t = []; return e.read && t.push(this.i18n("read")), e.write && t.push(this.i18n("write")), t.length ? t.join(" " + this.i18n("and") + " ") : this.i18n("noaccess") }, formatSize: function (e) { var t = 1, n = "b"; return "unknown" == e ? this.i18n("unknown") : (e > 1073741824 ? (t = 1073741824, n = "GB") : e > 1048576 ? (t = 1048576, n = "MB") : e > 1024 && (t = 1024, n = "KB"), ((e /= t) > 0 ? t >= 1048576 ? e.toFixed(2) : Math.round(e) : 0) + " " + n) }, formatFileMode: function (t, n) { var i, a, o, r, s, l, c, d; if (n || (n = this.options.fileModeStyle.toLowerCase()), (t = e.trim(t)).match(/[rwxs-]{9}$/i)) { if (c = t = t.substr(-9), "string" == n) return c; for (d = "", o = 0, i = 0; i < 7; i += 3)r = 0, (a = t.substr(i, 3)).match(/[r]/i) && (r += 4), a.match(/[w]/i) && (r += 2), a.match(/[xs]/i) && (a.match(/[xs]/) && (r += 1), a.match(/[s]/i) && (0 == i ? o += 4 : 3 == i && (o += 2))), d += r.toString(8); o && (d = o.toString(8) + d) } else { if (d = (t = parseInt(t, 8)) ? t.toString(8) : "", !t || "octal" == n) return d; for (o = 0, (a = t.toString(8)).length > 3 && (a = a.substr(-4), o = parseInt(a.substr(0, 1), 8), a = a.substr(1)), 1 == (1 & o), l = 2 == (2 & o), s = 4 == (4 & o), c = "", i = 0; i < 3; i++)4 == (4 & parseInt(a.substr(i, 1), 8)) ? c += "r" : c += "-", 2 == (2 & parseInt(a.substr(i, 1), 8)) ? c += "w" : c += "-", 1 == (1 & parseInt(a.substr(i, 1), 8)) ? c += 0 == i && s || 1 == i && l ? "s" : "x" : c += "-" } return "both" == n ? c + " (" + d + ")" : "string" == n ? c : d }, registRawStringDecoder: function (t) { e.isFunction(t) && (this.decodeRawString = this.options.rawStringDecoder = t) }, uploadMimeCheck: function (t, n) { n = n || this.cwd().hash; var i, a, o = !0, r = this.option("uploadMime", n), s = function (n) { var i = !1; return "string" == typeof n && "all" === n.toLowerCase() ? i = !0 : Array.isArray(n) && n.length && e.each(n, function (e, n) { if ("all" === (n = n.toLowerCase()) || 0 === t.indexOf(n)) return i = !0, !1 }), i }; return t && e.isPlainObject(r) && (t = t.toLowerCase(), i = s(r.allow), a = s(r.deny), "allow" === r.firstOrder ? (o = !1, a || !0 !== i || (o = !0)) : (o = !0, !0 !== a || i || (o = !1))), o }, sequence: function (e) { var t = e.length, n = function (t, i) { return e[++i] ? n(t.then(e[i]), i) : t }; return t > 1 ? n(e[0](), 0) : e[0]() }, reloadContents: function (t) { var n, i = e.Deferred(); try { n = e('<iframe width="1" height="1" scrolling="no" frameborder="no" style="position:absolute; top:-1px; left:-1px" crossorigin="use-credentials">').attr("src", t).one("load", function () { var n = e(this); try { this.contentDocument.location.reload(!0), n.one("load", function () { n.remove(), i.resolve() }) } catch (e) { n.attr("src", "").attr("src", t).one("load", function () { n.remove(), i.resolve() }) } }).appendTo("body") } catch (e) { n && n.remove(), i.reject() } return i }, makeNetmountOptionOauth: function (t, n, i, a) { var o, r = "boolean" == typeof a ? a : null, s = Object.assign({ noOffline: !1, root: "root", pathI18n: "folderId", folders: !0 }, null === r ? a || {} : { noOffline: r }), l = function (n, a, r) { var d, p = this, u = Object.keys(e.isPlainObject(r) ? r : {}).length; a.next().remove(), u && (d = e('<select class="ui-corner-all elfinder-tabstop" style="max-width:200px;">').append(e(e.map(r, function (e, t) { return '<option value="' + n.escape((t + "").trim()) + '">' + n.escape(e) + "</option>" }).join(""))).on("change click", function (a) { var r, d = e(this), u = d.val(); p.inputs.path.val(u), !s.folders || "change" !== a.type && d.data("current") === u || (d.next().remove(), d.data("current", u), u != s.root && (r = c(), o && "pending" === o.state() && n.abortXHR(o, { quiet: !0, abort: !0 }), d.after(r), o = n.request({ data: { cmd: "netmount", protocol: t, host: i, user: "init", path: u, pass: "folders" }, preventDefault: !0 }).done(function (e) { l.call(p, n, d, e.folders) }).always(function () { n.abortXHR(o, { quiet: !0 }), r.remove() }).xhr)) }), a.after(e("<div></div>").append(d)).closest(".ui-dialog").trigger("tabstopsInit"), d.trigger("focus")) }, c = function () { return e('<div class="elfinder-netmount-spinner"></div>').append('<span class="elfinder-spinner"></span>') }; return { vars: {}, name: n, inputs: { offline: e('<input type="checkbox"/>').on("change", function () { e(this).parents("table.elfinder-netmount-tb").find("select:first").trigger("change", "reset") }), host: e('<span><span class="elfinder-spinner"></span></span><input type="hidden"/>'), path: e('<input type="text" value="' + s.root + '"/>'), user: e('<input type="hidden"/>'), pass: e('<input type="hidden"/>'), mnt2res: e('<input type="hidden"/>') }, select: function (n, a, o) { var r = this.inputs, l = r.offline, c = e(r.host[0]), d = o || null; this.vars.mbtn = r.host.closest(".ui-dialog").children(".ui-dialog-buttonpane:first").find("button.elfinder-btncnt-0"), c.data("inrequest") || !c.find("span.elfinder-spinner").length && "reset" !== d && ("winfocus" !== d || c.siblings("span.elfinder-button-icon-reload").length) ? (l.closest("tr")[s.noOffline || r.user.val() ? "hide" : "show"](), c.data("funcexpup") && c.data("funcexpup")()) : (1 === l.parent().children().length && (r.path.parent().prev().html(n.i18n(s.pathI18n)), l.attr("title", n.i18n("offlineAccess")), l.uniqueId().after(e("<label></label>").attr("for", l.attr("id")).html(" " + n.i18n("offlineAccess")))), c.data("inrequest", !0).empty().addClass("elfinder-spinner").parent().find("span.elfinder-button-icon").remove(), n.request({ data: { cmd: "netmount", protocol: t, host: i, user: "init", options: { id: n.id, offline: l.prop("checked") ? 1 : 0, pass: r.host[1].value } }, preventDefault: !0 }).done(function (e) { c.removeClass("elfinder-spinner").html(e.body.replace(/\{msg:([^}]+)\}/g, function (e, t) { return n.i18n(t, i) })) }), s.noOffline && l.closest("tr").hide()), this.vars.mbtn[e(r.host[1]).val() ? "show" : "hide"]() }, done: function (n, a) { var o, r = this.inputs, c = this.protocol, d = e(r.host[0]), p = e(r.host[1]), u = "&nbsp;", h = this.vars, f = function () { h.oauthW && !document.hasFocus() && --h.chkCnt && (c.trigger("change", "winfocus"), h.tm = setTimeout(f, 3e3)) }; if (s.noOffline && r.offline.closest("tr").hide(), "makebtn" == a.mode) d.removeClass("elfinder-spinner").removeData("expires").removeData("funcexpup"), o = r.host.find("input").on("mouseenter mouseleave", function () { e(this).toggleClass("ui-state-hover") }), a.url && o.on("click", function () { h.tm && clearTimeout(h.tm), h.oauthW = window.open(a.url), (n.UA.iOS || n.UA.Mac) && n.isCORS && !h.chkdone && (h.chkCnt = 60, h.tm = setTimeout(f, 5e3)) }), p.val(""), r.path.val(s.root).next().remove(), r.user.val(""), r.pass.val(""), !s.noOffline && r.offline.closest("tr").show(), h.mbtn.hide(); else if ("folders" == a.mode) a.folders && l.call(this, n, r.path.nextAll(":last"), a.folders); else { if (h.oauthW && (h.tm && clearTimeout(h.tm), h.oauthW.close(), delete h.oauthW, h.chkdone = !0), a.expires && (u = "()", d.data("expires", a.expires)), d.html(i + u).removeClass("elfinder-spinner"), a.expires && (d.data("funcexpup", function () { var e = Math.floor((d.data("expires") - +new Date / 1e3) / 60); e < 3 ? d.parent().children(".elfinder-button-icon-reload").click() : (d.text(d.text().replace(/\(.*\)/, "(" + n.i18n(["minsLeft", e]) + ")")), setTimeout(function () { d.is(":visible") && d.data("funcexpup")() }, 6e4)) }), d.data("funcexpup")()), a.reset) return void c.trigger("change", "reset"); d.parent().append(e('<span class="elfinder-button-icon elfinder-button-icon-reload" title="' + n.i18n("reAuth") + '">').on("click", function () { p.val("reauth"), c.trigger("change", "reset") })), p.val(t), h.mbtn.show(), a.folders && l.call(this, n, r.path, a.folders), a.mnt2res && r.mnt2res.val("1"), r.user.val("done"), r.pass.val("done"), r.offline.closest("tr").hide() } d.removeData("inrequest") }, fail: function (t, n) { e(this.inputs.host[0]).removeData("inrequest"), this.protocol.trigger("change", "reset") }, integrateInfo: s.integrate } }, findCwdNodes: function (t, n) { var i = this, a = (this.getUI("cwd"), this.cwd().hash), o = e(); return n = n || {}, e.each(t, function (e, t) { if ((t.phash === a || i.searchStatus.state > 1) && (o = o.add(i.cwdHash2Elm(t.hash)), n.firstOnly)) return !1 }), o }, convAbsUrl: function (e) { if (e.match(/^http/i)) return e; if ("//" === e.substr(0, 2)) return window.location.protocol + e; var t, n = window.location.protocol + "//" + window.location.host, i = /[^\/]+\/\.\.\//; for (t = (t = "/" === e.substr(0, 1) ? n + e : n + window.location.pathname.replace(/\/[^\/]+$/, "/") + e).replace("/./", "/"); i.test(t);)t = t.replace(i, ""); return t }, isSameOrigin: function (e) { var t; if (e = this.convAbsUrl(e), location.origin && window.URL) try { return t = new URL(e), location.origin === t.origin } catch (e) { } return (t = document.createElement("a")).href = e, location.protocol === t.protocol && location.host === t.host && location.port && t.port }, navHash2Id: function (e) { return this.navPrefix + e }, navId2Hash: function (e) { return "string" == typeof e && e.substr(this.navPrefix.length) }, cwdHash2Id: function (e) { return this.cwdPrefix + e }, cwdId2Hash: function (e) { return "string" == typeof e && e.substr(this.cwdPrefix.length) }, navHash2Elm: function (t) { return e(document.getElementById(this.navHash2Id(t))) }, cwdHash2Elm: function (t) { return e(document.getElementById(this.cwdHash2Id(t))) }, isInWindow: function (e, t) { var n, i; return !!(n = e.get(0)) && (!(!t && null === n.offsetParent) && (i = n.getBoundingClientRect(), !!document.elementFromPoint(i.left, i.top))) }, zIndexCalc: function () { var t = this, n = this.getUI(), i = n.css("z-index"); i && "auto" !== i && "inherit" !== i ? t.zIndex = i : n.parents().each(function (n, i) { var a = e(i).css("z-index"); if ("auto" !== a && "inherit" !== a && (a = parseInt(a))) return t.zIndex = a, !1 }) }, loadScript: function (t, n, i, a) { var o, r, s = { dataType: "script", cache: !0 }, l = {}, c = {}; return (i = i || {}).tryRequire && this.hasRequire ? require(t, n, i.error) : (o = function () { var t, o, r; e.each(c, function (e, t) { if ("success" !== t && "notmodified" !== t) return r = !0, !1 }), r ? i.error && e.isFunction(i.error) && i.error({ loadResults: c }) : e.isFunction(n) && (a && void 0 === a.obj[a.name] ? (t = a.timeout ? a.timeout / 10 : 1, o = setInterval(function () { (--t < 0 || void 0 !== a.obj[a.name]) && (clearInterval(o), n()) }, 10)) : n()) }, "tag" === i.loadType ? (e("head > script").each(function () { l[this.src] = this }), r = t.length, e.each(t, function (t, n) { var a, s = !1; l[n] ? (c[t] = l[n]._error || "success", --r < 1 && o()) : ((a = document.createElement("script")).charset = i.charset || "UTF-8", e("head").append(a), a.onload = a.onreadystatechange = function () { s || this.readyState && "loaded" !== this.readyState && "complete" !== this.readyState || (s = !0, c[t] = "success", --r < 1 && o()) }, a.onerror = function (e) { c[t] = a._error = e && e.type ? e.type : "error", --r < 1 && o() }, a.src = n) })) : (i = e.isPlainObject(i) ? Object.assign(s, i) : s, r = 0, function n(a, s) { void 0 !== a && (c[r++] = s), t.length ? e.ajax(Object.assign({}, i, { url: t.shift(), success: n, error: n })) : o() }())), this }, loadCss: function (t, n) { var i, a, o = this; return "string" == typeof t && (t = [t]), n && (n.className && (i = n.className), n.dfd && n.dfd.promise && (a = [])), e.each(t, function (t, n) { var r; n = o.convAbsUrl(n).replace(/^https?:/i, ""), a && (a[t] = e.Deferred()), e('head > link[href="' + o.escape(n) + '"]').length ? a && a[t].resolve() : ((r = document.createElement("link")).type = "text/css", r.rel = "stylesheet", r.href = n, i && (r.className = i), a && (r.onload = function () { a[t].resolve() }, r.onerror = function () { a[t].reject() }), e("head").append(r)) }), a && e.when.apply(null, a).done(function () { n.dfd.resolve() }).fail(function () { n.dfd.reject() }), this }, asyncJob: function (t, n, i) { var a, o, r = e.Deferred(), s = !1, l = Object.assign({ interval: 0, numPerOnce: 1 }, i || {}), c = [], d = [], p = []; return r._abort = function (e) { o && clearTimeout(o), d = [], s = !0, "pending" === r.state() && r[e ? "resolve" : "reject"](c) }, r.fail(function () { r._abort() }).always(function () { r._abort = function () { } }), "function" == typeof t && Array.isArray(n) ? (d = n.concat(), a = function () { var e, n, i; if (!s) { for (n = (p = d.splice(0, l.numPerOnce)).length, e = 0; e < n && !s; e++)null !== (i = t(p[e])) && c.push(i); s || (d.length ? o = setTimeout(a, l.interval) : r.resolve(c)) } }, d.length ? o = setTimeout(a, 0) : r.resolve(c)) : r.reject(), r }, getSize: function (t) { var n, i, a = this, o = [], r = t.length, s = e.Deferred().fail(function () { e.each(o, function (e, t) { t && (t.syncOnFail && t.syncOnFail(!1), t.reject()) }) }); return a.autoSync("stop"), (n = e.Deferred(), i = Object.keys(a.leafRoots).length, i > 0 ? e.each(a.leafRoots, function (t) { (function (t) { var n = e.Deferred(), i = a.file(t), o = i ? i.phash : t; return o && !a.file(o) ? a.request({ data: { cmd: "parents", target: o }, preventFail: !0 }).done(function () { a.one("parentsdone", function () { n.resolve() }) }).fail(function () { n.resolve() }) : n.resolve(), n })(t).done(function () { --i < 1 && n.resolve() }) }) : n.resolve(), n).done(function () { var n = [], i = {}, l = [], c = [], d = {}; e.each(t, function () { var t, i; n.push.apply(n, (t = a.file(this), i = [], "directory" === t.mime && e.each(a.leafRoots, function (e, n) { var o; if (e === t.hash) i.push.apply(i, n); else for (o = (a.file(e) || {}).phash; o;)o === t.hash && i.push.apply(i, n), o = (a.file(o) || {}).phash }), i)) }), t.push.apply(t, n), e.each(t, function () { var t = a.root(this), n = a.file(this); n && (n.sizeInfo || "directory" !== n.mime) ? c.push(e.Deferred().resolve(n.sizeInfo ? n.sizeInfo : { size: n.size, dirCnt: 0, fileCnt: 1 })) : i[t] ? i[t].push(this.toString()) : i[t] = [this.toString()] }), e.each(i, function () { var e = l.length; 1 === this.length && (d[e] = this[0]), l.push(a.request({ data: { cmd: "size", targets: this }, preventDefault: !0 })) }), o.push.apply(o, l), l.push.apply(l, c), e.when.apply(e, l).fail(function () { s.reject() }).done(function () { var t, n, i = function (t, n) { var i; (i = a.file(t)) && (i.sizeInfo = { isCache: !0 }, e.each(["size", "dirCnt", "fileCnt"], function () { i.sizeInfo[this] = n[this] || 0 }), i.size = parseInt(i.sizeInfo.size), f.push(i)) }, o = 0, l = 0, c = 0, p = arguments.length, u = [], h = "", f = []; for (t = 0; t < p; t++)null, (n = arguments[t]).isCache || (d[t] && a.file(d[t]) ? i(d[t], n) : n.sizes && e.isPlainObject(n.sizes) && e.each(n.sizes, function (e, t) { i(e, t) })), o += parseInt(n.size), !1 !== l && (void 0 === n.fileCnt ? l = !1 : l += parseInt(n.fileCnt || 0)), !1 !== c && (void 0 === n.dirCnt ? c = !1 : c += parseInt(n.dirCnt || 0)); f.length && a.change({ changed: f }), !1 !== c && u.push(a.i18n("folders") + ": " + (c - (r > 1 ? 0 : 1))), !1 !== l && u.push(a.i18n("files") + ": " + l), u.length && (h = "<br>" + u.join(", ")), s.resolve({ size: o, fileCnt: l, dirCnt: c, formated: (o >= 0 ? a.formatSize(o) : a.i18n("unknown")) + h }) }), a.autoSync() }), s }, wkObjUrl: null, getWorker: function (e) { var t; try { this.wkObjUrl || (this.wkObjUrl = (window.URL || window.webkitURL).createObjectURL(new Blob([function () { self.onmessage = function (e) { var t = e.data; try { if (self.data = t.data, t.scripts) for (var n = 0; n < t.scripts.length; n++)importScripts(t.scripts[n]); self.postMessage(self.res) } catch (e) { self.postMessage({ error: e.toString() }) } } }.toString().replace(/\s+/g, " ").replace(/ *([^\w]) */g, "$1").replace(/^function\b.+?\{|\}$/g, "")], { type: "text/javascript" }))), t = new Worker(this.wkObjUrl, e) } catch (e) { this.debug("error", e.toString()) } return t }, getWorkerUrl: function (e) { return this.convAbsUrl(this.baseUrl + "js/worker/" + e) }, getTheme: function (t) { var n, i, a = this, o = e.Deferred(), r = function (t, n) { return n || (n = a.convAbsUrl(a.baseUrl)), Array.isArray(t) ? e.map(t, function (e) { return r(e, n) }) : t.match(/^(?:http|\/\/)/i) ? t : n + t.replace(/^(?:\.\/|\/)/, "") }; return t && (n = a.options.themes[t]) ? "string" == typeof n ? (url = r(n), (i = url.match(/^(.+\/)[^/]+\.json$/i)) ? e.getJSON(url).done(function (e) { (n = e).id = t, n.cssurls && (n.cssurls = r(n.cssurls, i[1])), o.resolve(n) }).fail(function () { o.reject() }) : o.resolve({ id: t, name: t, cssurls: [url] })) : e.isPlainObject(n) && n.cssurls ? (n.id = t, n.cssurls = r(n.cssurls), Array.isArray(n.cssurls) || (n.cssurls = [n.cssurls]), n.name || (n.name = t), o.resolve(n)) : o.reject() : o.reject(), o }, changeTheme: function (t) { var n = this; return t && (!n.options.themes[t] || n.theme && n.theme.id === t ? "default" === t && n.theme && "default" !== n.theme.id && (e("head>link.elfinder-theme-ext").remove(), n.theme = null, n.trigger && n.trigger("themechange")) : n.getTheme(t).done(function (t) { t.cssurls && (e("head>link.elfinder-theme-ext").remove(), n.loadCss(t.cssurls, { className: "elfinder-theme-ext", dfd: e.Deferred().done(function () { n.theme = t, n.trigger && n.trigger("themechange") }) })) })), this }, applyLeafRootStats: function (t, n) { var i = this, a = n ? t : i.file(t.hash) || t, o = a.ts, r = !1; return !n && t._realStats || (t._realStats = { locked: t.locked || 0, dirs: t.dirs || 0, ts: t.ts }), t.locked = 1, a.locked || (r = !0), t.dirs = 1, a.dirs || (r = !0), e.each(i.leafRoots[t.hash], function () { var e = i.file(this); e && e.ts && (t.ts || 0) < e.ts && (t.ts = e.ts) }), o !== t.ts && (r = !0), r }, abortXHR: function (e, t) { var n = t || {}; e && (n.quiet && (e.quiet = !0), n.abort && e._requestId && this.request({ data: { cmd: "abort", id: e._requestId }, preventDefault: !0 }), e.abort(), e = void 0) }, setCustomHeaderByXhr: function (t) { var n = this; t.getResponseHeader && n.parrotHeaders && n.parrotHeaders.length && e.each(n.parrotHeaders, function (e, i) { var a = t.getResponseHeader(i); a ? (n.customHeaders[i] = a, n.sessionStorage("core-ph:" + i, a)) : "string" == typeof a && (delete n.customHeaders[i], n.sessionStorage("core-ph:" + i, null)) }) }, hasParrotHeaders: function () { var e = !1, t = this.parrotHeaders; if (Object.keys(this.customHeaders).length) for (var n = 0; n < t.length; n++)if (this.customHeaders[t[n]]) { e = !0; break } return e }, getRequestId: function () { return (+new Date).toString(16) + Math.floor(1e3 * Math.random()).toString(16) }, arrayFlip: function (t, n) { var i, a = {}, o = e.isArray(t); for (i in t) (o || t.hasOwnProperty(i)) && (a[t[i]] = n || i); return a }, splitFileExtention: function (e) { var t; return (t = e.match(/^(.+?)?\.((?:tar\.(?:gz|bz|bz2|z|lzo))|cpio\.gz|ps\.gz|xcf\.(?:gz|bz2)|[a-z0-9]{1,10})$/i)) ? (void 0 === t[1] && (t[1] = ""), [t[1], t[2]]) : [e, ""] }, sliceArrayBuffer: function (e, t) { for (var n = [], i = 0; i * t < e.byteLength;)n.push(e.slice(i * t, (i + 1) * t)), i++; return n }, arrayBufferToBase64: function (e) { if (!window.btoa) return ""; var t = new Uint8Array(e), n = Array.prototype.slice.call(t).map(function (e) { return String.fromCharCode(e) }); return window.btoa(n.join("")) }, log: function (e) { return window.console && window.console.log && window.console.log(e), this }, debug: function (t, n) { var i, a, o = this, r = this.options.debug, s = this.options.toastBackendWarn; return "backend-error" === t ? (!this.cwd().hash || r && ("all" === r || r["backend-error"])) && (n = Array.isArray(n) ? n : [n], this.error(n)) : "backend-warning" === t ? (a = !0, s && (i = e.isPlainObject(s) ? s : {}, e.each(Array.isArray(n) ? n : [n], function (e, t) { o.toast(Object.assign({ mode: "warning", msg: t }, i)) }))) : "backend-debug" === t && this.trigger("backenddebug", n), (a || r && ("all" === r || r[t])) && window.console && window.console.log && window.console.log("elfinder debug: [" + t + "] [" + this.id + "]", n), this }, responseDebug: function (e) { var t, n = e.debug; n && ((t = this.options.debug) && "all" === t || (t || (t = this.options.debug = {}), t["backend-error"] = !0, t.warning = !0), n.mountErrors && ("string" == typeof n.mountErrors || Array.isArray(n.mountErrors) && n.mountErrors.length) && this.debug("backend-error", n.mountErrors), n.backendErrors && ("string" == typeof n.backendErrors || Array.isArray(n.backendErrors) && n.backendErrors.length) && this.debug("backend-warning", n.backendErrors)) }, time: function (e) { window.console && window.console.time && window.console.time(e) }, timeEnd: function (e) { window.console && window.console.timeEnd && window.console.timeEnd(e) } }, Object.keys || (Object.keys = (c = Object.prototype.hasOwnProperty, d = !{ toString: null }.propertyIsEnumerable("toString"), u = (p = ["toString", "toLocaleString", "valueOf", "hasOwnProperty", "isPrototypeOf", "propertyIsEnumerable", "constructor"]).length, function (e) { if ("object" != typeof e && "function" != typeof e || null === e) throw new TypeError("Object.keys called on non-object"); var t = []; for (var n in e) c.call(e, n) && t.push(n); if (d) for (var i = 0; i < u; i++)c.call(e, p[i]) && t.push(p[i]); return t })), Array.isArray || (Array.isArray = function (e) { return jQuery.isArray(e) }), Object.assign || (Object.assign = function () { return jQuery.extend.apply(null, arguments) }), String.prototype.repeat || (String.prototype.repeat = function (e) { "use strict"; if (null == this) throw new TypeError("can't convert " + this + " to object"); var t = "" + this; if ((e = +e) != e && (e = 0), e < 0) throw new RangeError("repeat count must be non-negative"); if (e == 1 / 0) throw new RangeError("repeat count must be less than infinity"); if (e = Math.floor(e), 0 == t.length || 0 == e) return ""; if (t.length * e >= 1 << 28) throw new RangeError("repeat count must not overflow maximum string size"); for (var n = "", i = 0; i < e; i++)n += t; return n }), String.prototype.trim || (String.prototype.trim = function () { return this.replace(/^\s+|\s+$/g, "") }), function () { try { return void Array.apply(null, {}) } catch (e) { } var e = Object.prototype.toString, t = Function.prototype.apply, n = Array.prototype.slice; Function.prototype.apply = function (i, a) { return t.call(this, i, "[object Array]" === e.call(a) ? a : n.call(a)) } }(), Array.from || (Array.from = function (e) { return 1 === e.length ? [e[0]] : Array.apply(null, e) }), window.cancelAnimationFrame || function () { for (var e = 0, t = ["ms", "moz", "webkit", "o"], n = 0; n < t.length && !window.requestAnimationFrame; ++n)window.requestAnimationFrame = window[t[n] + "RequestAnimationFrame"], window.cancelAnimationFrame = window[t[n] + "CancelAnimationFrame"] || window[t[n] + "CancelRequestAnimationFrame"]; window.requestAnimationFrame || (window.requestAnimationFrame = function (t, n) { var i = (new Date).getTime(), a = Math.max(0, 16 - (i - e)), o = window.setTimeout(function () { t(i + a) }, a); return e = i + a, o }), window.cancelAnimationFrame || (window.cancelAnimationFrame = function (e) { clearTimeout(e) }) }(), h.prototype.version = "2.1.57", function () { if (e.ui && e.ui.ddmanager) { var t = e.ui.ddmanager.prepareOffsets; e.ui.ddmanager.prepareOffsets = function (n, i) { var a = function (e) { if (e.is(":hidden")) return !0; var t = e[0].getBoundingClientRect(); return !document.elementFromPoint(t.left, t.top) && !document.elementFromPoint(t.left + t.width, t.top + t.height) }; if ("mousedown" === i.type || n.options.elfRefresh) { var o, r, s = e.ui.ddmanager.droppables[n.options.scope] || [], l = s.length; for (o = 0; o < l; o++)(r = s[o]).options.autoDisable && (!r.options.disabled || r.options.autoDisable > 1) && (r.options.disabled = a(r.element), r.options.autoDisable = r.options.disabled ? 2 : 1) } return t(n, i) } } }(), window.jQuery.ajaxTransport("+binary", function (e, t, n) { var i; if (window.FormData && (e.dataType && "binary" == e.dataType || e.data && (window.ArrayBuffer && e.data instanceof ArrayBuffer || window.Blob && e.data instanceof Blob))) return { send: function (t, n) { var a, o = e.responseType || "blob", r = e.xhr(); if (r.open(e.type, e.url, e.async, e.username, e.password), e.xhrFields) for (a in e.xhrFields) r[a] = e.xhrFields[a]; for (a in e.mimeType && r.overrideMimeType && r.overrideMimeType(e.mimeType), e.crossDomain || t["X-Requested-With"] || (t["X-Requested-With"] = "XMLHttpRequest"), t) r.setRequestHeader(a, t[a]); i = function (t) { return function () { if (i) if (i = r.onload = r.onerror = r.onabort = r.ontimeout = null, "abort" === t) r.abort(); else if ("error" === t) n(r.status, r.statusText); else { var a = {}; a[e.dataType] = r.response, n(r.status, r.statusText, a, r.getAllResponseHeaders()) } } }, r.onload = i(), r.onabort = r.onerror = r.ontimeout = i("error"), i = i("abort"); try { r.responseType = o, r.send(e.data || null) } catch (e) { if (i) throw e } }, abort: function () { i && i() } } }), function (e) { if (e.support.touch = "ontouchend" in document, e.support.touch) { var t, n, i, a = e.ui.mouse.prototype, o = a._mouseInit, r = a._mouseDestroy; a._touchStart = function (e) { !t && this._mouseCapture(e.originalEvent.changedTouches[0]) && (n = e.originalEvent.changedTouches[0].screenX.toFixed(0), i = e.originalEvent.changedTouches[0].screenY.toFixed(0), t = !0, this._touchMoved = !1, s(e, "mouseover"), s(e, "mousemove"), s(e, "mousedown")) }, a._touchMove = function (e) { if (t) { var a = e.originalEvent.changedTouches[0].screenX.toFixed(0), o = e.originalEvent.changedTouches[0].screenY.toFixed(0); Math.abs(n - a) <= 4 && Math.abs(i - o) <= 4 || (this._touchMoved = !0, s(e, "mousemove")) } }, a._touchEnd = function (e) { t && (s(e, "mouseup"), s(e, "mouseout"), this._touchMoved || s(e, "click"), t = !1, this._touchMoved = !1) }, a._mouseInit = function () { this.element.hasClass("touch-punch") && this.element.on({ touchstart: e.proxy(this, "_touchStart"), touchmove: e.proxy(this, "_touchMove"), touchend: e.proxy(this, "_touchEnd") }), o.call(this) }, a._mouseDestroy = function () { this.element.hasClass("touch-punch") && this.element.off({ touchstart: e.proxy(this, "_touchStart"), touchmove: e.proxy(this, "_touchMove"), touchend: e.proxy(this, "_touchEnd") }), r.call(this) } } function s(t, n) { if (!(t.originalEvent.touches.length > 1)) { e(t.currentTarget).hasClass("touch-punch-keep-default") || t.preventDefault(); var i = t.originalEvent.changedTouches[0], a = document.createEvent("MouseEvents"); a.initMouseEvent(n, !0, !0, window, 1, i.screenX, i.screenY, i.clientX, i.clientY, !1, !1, !1, !1, 0, null), t.target.dispatchEvent(a) } } }(jQuery), e.fn.elfinder = function (t, n) { return "instance" === t ? this.getElFinder() : this.each(function () { var i, a = "string" == typeof t ? t : "", o = "function" == typeof n ? n : void 0, r = this.elfinder; if (r) switch (a) { case "close": case "hide": r.hide(); break; case "open": case "show": r.show(); break; case "destroy": r.destroy(); break; case "reload": case "restart": r && (i = e.extend(!0, r.options, e.isPlainObject(n) ? n : {}), o = r.bootCallback, r.reloadCallback && e.isFunction(r.reloadCallback) ? r.reloadCallback(i, o) : (r.destroy(), new h(this, i, o))) } else e.isPlainObject(t) && new h(this, t, o) }) }, e.fn.getElFinder = function () { var e; return this.each(function () { if (this.elfinder) return e = this.elfinder, !1 }), e }, e.fn.elfUiWidgetInstance = function (e) { try { return this[e]("instance") } catch (n) { var t = this.data("ui-" + e); return t && "object" == typeof t && t.widgetFullName === "ui-" + e ? t : null } }, e.fn.scrollRight || e.fn.extend({ scrollRight: function (e) { var t = this.get(0); return void 0 === e ? Math.max(0, t.scrollWidth - (t.scrollLeft + t.clientWidth)) : this.scrollLeft(t.scrollWidth - t.clientWidth - e) } }), e.fn.scrollBottom || e.fn.extend({ scrollBottom: function (e) { var t = this.get(0); return void 0 === e ? Math.max(0, t.scrollHeight - (t.scrollTop + t.clientHeight)) : this.scrollTop(t.scrollHeight - t.clientHeight - e) } }), h.prototype.mimeTypes = { "application/x-executable": "exe", "application/x-jar": "jar", "application/x-gzip": "gz", "application/x-bzip2": "tbz", "application/x-rar": "rar", "text/x-php": "php", "text/javascript": "js", "application/rtfd": "rtfd", "text/x-python": "py", "text/x-ruby": "rb", "text/x-shellscript": "sh", "text/x-perl": "pl", "text/xml": "xml", "text/x-csrc": "c", "text/x-chdr": "h", "text/x-c++src": "cpp", "text/x-c++hdr": "hh", "text/x-markdown": "md", "text/x-yaml": "yml", "image/x-ms-bmp": "bmp", "image/x-targa": "tga", "image/xbm": "xbm", "image/pxm": "pxm", "audio/wav": "wav", "video/x-dv": "dv", "video/x-ms-wmv": "wm", "video/ogg": "ogm", "video/MP2T": "m2ts", "application/x-mpegURL": "m3u8", "application/dash+xml": "mpd", "application/andrew-inset": "ez", "application/applixware": "aw", "application/atom+xml": "atom", "application/atomcat+xml": "atomcat", "application/atomsvc+xml": "atomsvc", "application/ccxml+xml": "ccxml", "application/cdmi-capability": "cdmia", "application/cdmi-container": "cdmic", "application/cdmi-domain": "cdmid", "application/cdmi-object": "cdmio", "application/cdmi-queue": "cdmiq", "application/cu-seeme": "cu", "application/davmount+xml": "davmount", "application/docbook+xml": "dbk", "application/dssc+der": "dssc", "application/dssc+xml": "xdssc", "application/ecmascript": "ecma", "application/emma+xml": "emma", "application/epub+zip": "epub", "application/exi": "exi", "application/font-tdpfr": "pfr", "application/gml+xml": "gml", "application/gpx+xml": "gpx", "application/gxf": "gxf", "application/hyperstudio": "stk", "application/inkml+xml": "ink", "application/ipfix": "ipfix", "application/java-serialized-object": "ser", "application/java-vm": "class", "application/json": "json", "application/jsonml+json": "jsonml", "application/lost+xml": "lostxml", "application/mac-binhex40": "hqx", "application/mac-compactpro": "cpt", "application/mads+xml": "mads", "application/marc": "mrc", "application/marcxml+xml": "mrcx", "application/mathematica": "ma", "application/mathml+xml": "mathml", "application/mbox": "mbox", "application/mediaservercontrol+xml": "mscml", "application/metalink+xml": "metalink", "application/metalink4+xml": "meta4", "application/mets+xml": "mets", "application/mods+xml": "mods", "application/mp21": "m21", "application/mp4": "mp4s", "application/msword": "doc", "application/mxf": "mxf", "application/octet-stream": "bin", "application/oda": "oda", "application/oebps-package+xml": "opf", "application/ogg": "ogx", "application/omdoc+xml": "omdoc", "application/onenote": "onetoc", "application/oxps": "oxps", "application/patch-ops-error+xml": "xer", "application/pdf": "pdf", "application/pgp-encrypted": "pgp", "application/pgp-signature": "asc", "application/pics-rules": "prf", "application/pkcs10": "p10", "application/pkcs7-mime": "p7m", "application/pkcs7-signature": "p7s", "application/pkcs8": "p8", "application/pkix-attr-cert": "ac", "application/pkix-cert": "cer", "application/pkix-crl": "crl", "application/pkix-pkipath": "pkipath", "application/pkixcmp": "pki", "application/pls+xml": "pls", "application/postscript": "ai", "application/prs.cww": "cww", "application/pskc+xml": "pskcxml", "application/rdf+xml": "rdf", "application/reginfo+xml": "rif", "application/relax-ng-compact-syntax": "rnc", "application/resource-lists+xml": "rl", "application/resource-lists-diff+xml": "rld", "application/rls-services+xml": "rs", "application/rpki-ghostbusters": "gbr", "application/rpki-manifest": "mft", "application/rpki-roa": "roa", "application/rsd+xml": "rsd", "application/rss+xml": "rss", "application/rtf": "rtf", "application/sbml+xml": "sbml", "application/scvp-cv-request": "scq", "application/scvp-cv-response": "scs", "application/scvp-vp-request": "spq", "application/scvp-vp-response": "spp", "application/sdp": "sdp", "application/set-payment-initiation": "setpay", "application/set-registration-initiation": "setreg", "application/shf+xml": "shf", "application/smil+xml": "smi", "application/sparql-query": "rq", "application/sparql-results+xml": "srx", "application/srgs": "gram", "application/srgs+xml": "grxml", "application/sru+xml": "sru", "application/ssdl+xml": "ssdl", "application/ssml+xml": "ssml", "application/tei+xml": "tei", "application/thraud+xml": "tfi", "application/timestamped-data": "tsd", "application/vnd.3gpp.pic-bw-large": "plb", "application/vnd.3gpp.pic-bw-small": "psb", "application/vnd.3gpp.pic-bw-var": "pvb", "application/vnd.3gpp2.tcap": "tcap", "application/vnd.3m.post-it-notes": "pwn", "application/vnd.accpac.simply.aso": "aso", "application/vnd.accpac.simply.imp": "imp", "application/vnd.acucobol": "acu", "application/vnd.acucorp": "atc", "application/vnd.adobe.air-application-installer-package+zip": "air", "application/vnd.adobe.formscentral.fcdt": "fcdt", "application/vnd.adobe.fxp": "fxp", "application/vnd.adobe.xdp+xml": "xdp", "application/vnd.adobe.xfdf": "xfdf", "application/vnd.ahead.space": "ahead", "application/vnd.airzip.filesecure.azf": "azf", "application/vnd.airzip.filesecure.azs": "azs", "application/vnd.amazon.ebook": "azw", "application/vnd.americandynamics.acc": "acc", "application/vnd.amiga.ami": "ami", "application/vnd.android.package-archive": "apk", "application/vnd.anser-web-certificate-issue-initiation": "cii", "application/vnd.anser-web-funds-transfer-initiation": "fti", "application/vnd.antix.game-component": "atx", "application/vnd.apple.installer+xml": "mpkg", "application/vnd.aristanetworks.swi": "swi", "application/vnd.astraea-software.iota": "iota", "application/vnd.audiograph": "aep", "application/vnd.blueice.multipass": "mpm", "application/vnd.bmi": "bmi", "application/vnd.businessobjects": "rep", "application/vnd.chemdraw+xml": "cdxml", "application/vnd.chipnuts.karaoke-mmd": "mmd", "application/vnd.cinderella": "cdy", "application/vnd.claymore": "cla", "application/vnd.cloanto.rp9": "rp9", "application/vnd.clonk.c4group": "c4g", "application/vnd.cluetrust.cartomobile-config": "c11amc", "application/vnd.cluetrust.cartomobile-config-pkg": "c11amz", "application/vnd.commonspace": "csp", "application/vnd.contact.cmsg": "cdbcmsg", "application/vnd.cosmocaller": "cmc", "application/vnd.crick.clicker": "clkx", "application/vnd.crick.clicker.keyboard": "clkk", "application/vnd.crick.clicker.palette": "clkp", "application/vnd.crick.clicker.template": "clkt", "application/vnd.crick.clicker.wordbank": "clkw", "application/vnd.criticaltools.wbs+xml": "wbs", "application/vnd.ctc-posml": "pml", "application/vnd.cups-ppd": "ppd", "application/vnd.curl.car": "car", "application/vnd.curl.pcurl": "pcurl", "application/vnd.dart": "dart", "application/vnd.data-vision.rdz": "rdz", "application/vnd.dece.data": "uvf", "application/vnd.dece.ttml+xml": "uvt", "application/vnd.dece.unspecified": "uvx", "application/vnd.dece.zip": "uvz", "application/vnd.denovo.fcselayout-link": "fe_launch", "application/vnd.dna": "dna", "application/vnd.dolby.mlp": "mlp", "application/vnd.dpgraph": "dpg", "application/vnd.dreamfactory": "dfac", "application/vnd.ds-keypoint": "kpxx", "application/vnd.dvb.ait": "ait", "application/vnd.dvb.service": "svc", "application/vnd.dynageo": "geo", "application/vnd.ecowin.chart": "mag", "application/vnd.enliven": "nml", "application/vnd.epson.esf": "esf", "application/vnd.epson.msf": "msf", "application/vnd.epson.quickanime": "qam", "application/vnd.epson.salt": "slt", "application/vnd.epson.ssf": "ssf", "application/vnd.eszigno3+xml": "es3", "application/vnd.ezpix-album": "ez2", "application/vnd.ezpix-package": "ez3", "application/vnd.fdf": "fdf", "application/vnd.fdsn.mseed": "mseed", "application/vnd.fdsn.seed": "seed", "application/vnd.flographit": "gph", "application/vnd.fluxtime.clip": "ftc", "application/vnd.framemaker": "fm", "application/vnd.frogans.fnc": "fnc", "application/vnd.frogans.ltf": "ltf", "application/vnd.fsc.weblaunch": "fsc", "application/vnd.fujitsu.oasys": "oas", "application/vnd.fujitsu.oasys2": "oa2", "application/vnd.fujitsu.oasys3": "oa3", "application/vnd.fujitsu.oasysgp": "fg5", "application/vnd.fujitsu.oasysprs": "bh2", "application/vnd.fujixerox.ddd": "ddd", "application/vnd.fujixerox.docuworks": "xdw", "application/vnd.fujixerox.docuworks.binder": "xbd", "application/vnd.fuzzysheet": "fzs", "application/vnd.genomatix.tuxedo": "txd", "application/vnd.geogebra.file": "ggb", "application/vnd.geogebra.tool": "ggt", "application/vnd.geometry-explorer": "gex", "application/vnd.geonext": "gxt", "application/vnd.geoplan": "g2w", "application/vnd.geospace": "g3w", "application/vnd.gmx": "gmx", "application/vnd.google-earth.kml+xml": "kml", "application/vnd.google-earth.kmz": "kmz", "application/vnd.grafeq": "gqf", "application/vnd.groove-account": "gac", "application/vnd.groove-help": "ghf", "application/vnd.groove-identity-message": "gim", "application/vnd.groove-injector": "grv", "application/vnd.groove-tool-message": "gtm", "application/vnd.groove-tool-template": "tpl", "application/vnd.groove-vcard": "vcg", "application/vnd.hal+xml": "hal", "application/vnd.handheld-entertainment+xml": "zmm", "application/vnd.hbci": "hbci", "application/vnd.hhe.lesson-player": "les", "application/vnd.hp-hpgl": "hpgl", "application/vnd.hp-hpid": "hpid", "application/vnd.hp-hps": "hps", "application/vnd.hp-jlyt": "jlt", "application/vnd.hp-pcl": "pcl", "application/vnd.hp-pclxl": "pclxl", "application/vnd.hydrostatix.sof-data": "sfd-hdstx", "application/vnd.ibm.minipay": "mpy", "application/vnd.ibm.modcap": "afp", "application/vnd.ibm.rights-management": "irm", "application/vnd.ibm.secure-container": "sc", "application/vnd.iccprofile": "icc", "application/vnd.igloader": "igl", "application/vnd.immervision-ivp": "ivp", "application/vnd.immervision-ivu": "ivu", "application/vnd.insors.igm": "igm", "application/vnd.intercon.formnet": "xpw", "application/vnd.intergeo": "i2g", "application/vnd.intu.qbo": "qbo", "application/vnd.intu.qfx": "qfx", "application/vnd.ipunplugged.rcprofile": "rcprofile", "application/vnd.irepository.package+xml": "irp", "application/vnd.is-xpr": "xpr", "application/vnd.isac.fcs": "fcs", "application/vnd.jam": "jam", "application/vnd.jcp.javame.midlet-rms": "rms", "application/vnd.jisp": "jisp", "application/vnd.joost.joda-archive": "joda", "application/vnd.kahootz": "ktz", "application/vnd.kde.karbon": "karbon", "application/vnd.kde.kchart": "chrt", "application/vnd.kde.kformula": "kfo", "application/vnd.kde.kivio": "flw", "application/vnd.kde.kontour": "kon", "application/vnd.kde.kpresenter": "kpr", "application/vnd.kde.kspread": "ksp", "application/vnd.kde.kword": "kwd", "application/vnd.kenameaapp": "htke", "application/vnd.kidspiration": "kia", "application/vnd.kinar": "kne", "application/vnd.koan": "skp", "application/vnd.kodak-descriptor": "sse", "application/vnd.las.las+xml": "lasxml", "application/vnd.llamagraphics.life-balance.desktop": "lbd", "application/vnd.llamagraphics.life-balance.exchange+xml": "lbe", "application/vnd.lotus-1-2-3": 123, "application/vnd.lotus-approach": "apr", "application/vnd.lotus-freelance": "pre", "application/vnd.lotus-notes": "nsf", "application/vnd.lotus-organizer": "org", "application/vnd.lotus-screencam": "scm", "application/vnd.lotus-wordpro": "lwp", "application/vnd.macports.portpkg": "portpkg", "application/vnd.mcd": "mcd", "application/vnd.medcalcdata": "mc1", "application/vnd.mediastation.cdkey": "cdkey", "application/vnd.mfer": "mwf", "application/vnd.mfmp": "mfm", "application/vnd.micrografx.flo": "flo", "application/vnd.micrografx.igx": "igx", "application/vnd.mif": "mif", "application/vnd.mobius.daf": "daf", "application/vnd.mobius.dis": "dis", "application/vnd.mobius.mbk": "mbk", "application/vnd.mobius.mqy": "mqy", "application/vnd.mobius.msl": "msl", "application/vnd.mobius.plc": "plc", "application/vnd.mobius.txf": "txf", "application/vnd.mophun.application": "mpn", "application/vnd.mophun.certificate": "mpc", "application/vnd.mozilla.xul+xml": "xul", "application/vnd.ms-artgalry": "cil", "application/vnd.ms-cab-compressed": "cab", "application/vnd.ms-excel": "xls", "application/vnd.ms-excel.addin.macroenabled.12": "xlam", "application/vnd.ms-excel.sheet.binary.macroenabled.12": "xlsb", "application/vnd.ms-excel.sheet.macroenabled.12": "xlsm", "application/vnd.ms-excel.template.macroenabled.12": "xltm", "application/vnd.ms-fontobject": "eot", "application/vnd.ms-htmlhelp": "chm", "application/vnd.ms-ims": "ims", "application/vnd.ms-lrm": "lrm", "application/vnd.ms-officetheme": "thmx", "application/vnd.ms-pki.seccat": "cat", "application/vnd.ms-pki.stl": "stl", "application/vnd.ms-powerpoint": "ppt", "application/vnd.ms-powerpoint.addin.macroenabled.12": "ppam", "application/vnd.ms-powerpoint.presentation.macroenabled.12": "pptm", "application/vnd.ms-powerpoint.slide.macroenabled.12": "sldm", "application/vnd.ms-powerpoint.slideshow.macroenabled.12": "ppsm", "application/vnd.ms-powerpoint.template.macroenabled.12": "potm", "application/vnd.ms-project": "mpp", "application/vnd.ms-word.document.macroenabled.12": "docm", "application/vnd.ms-word.template.macroenabled.12": "dotm", "application/vnd.ms-works": "wps", "application/vnd.ms-wpl": "wpl", "application/vnd.ms-xpsdocument": "xps", "application/vnd.mseq": "mseq", "application/vnd.musician": "mus", "application/vnd.muvee.style": "msty", "application/vnd.mynfc": "taglet", "application/vnd.neurolanguage.nlu": "nlu", "application/vnd.nitf": "ntf", "application/vnd.noblenet-directory": "nnd", "application/vnd.noblenet-sealer": "nns", "application/vnd.noblenet-web": "nnw", "application/vnd.nokia.n-gage.data": "ngdat", "application/vnd.nokia.n-gage.symbian.install": "n-gage", "application/vnd.nokia.radio-preset": "rpst", "application/vnd.nokia.radio-presets": "rpss", "application/vnd.novadigm.edm": "edm", "application/vnd.novadigm.edx": "edx", "application/vnd.novadigm.ext": "ext", "application/vnd.oasis.opendocument.chart": "odc", "application/vnd.oasis.opendocument.chart-template": "otc", "application/vnd.oasis.opendocument.database": "odb", "application/vnd.oasis.opendocument.formula": "odf", "application/vnd.oasis.opendocument.formula-template": "odft", "application/vnd.oasis.opendocument.graphics": "odg", "application/vnd.oasis.opendocument.graphics-template": "otg", "application/vnd.oasis.opendocument.image": "odi", "application/vnd.oasis.opendocument.image-template": "oti", "application/vnd.oasis.opendocument.presentation": "odp", "application/vnd.oasis.opendocument.presentation-template": "otp", "application/vnd.oasis.opendocument.spreadsheet": "ods", "application/vnd.oasis.opendocument.spreadsheet-template": "ots", "application/vnd.oasis.opendocument.text": "odt", "application/vnd.oasis.opendocument.text-master": "odm", "application/vnd.oasis.opendocument.text-template": "ott", "application/vnd.oasis.opendocument.text-web": "oth", "application/vnd.olpc-sugar": "xo", "application/vnd.oma.dd2+xml": "dd2", "application/vnd.openofficeorg.extension": "oxt", "application/vnd.openxmlformats-officedocument.presentationml.presentation": "pptx", "application/vnd.openxmlformats-officedocument.presentationml.slide": "sldx", "application/vnd.openxmlformats-officedocument.presentationml.slideshow": "ppsx", "application/vnd.openxmlformats-officedocument.presentationml.template": "potx", "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet": "xlsx", "application/vnd.openxmlformats-officedocument.spreadsheetml.template": "xltx", "application/vnd.openxmlformats-officedocument.wordprocessingml.document": "docx", "application/vnd.openxmlformats-officedocument.wordprocessingml.template": "dotx", "application/vnd.osgeo.mapguide.package": "mgp", "application/vnd.osgi.dp": "dp", "application/vnd.osgi.subsystem": "esa", "application/vnd.palm": "pdb", "application/vnd.pawaafile": "paw", "application/vnd.pg.format": "str", "application/vnd.pg.osasli": "ei6", "application/vnd.picsel": "efif", "application/vnd.pmi.widget": "wg", "application/vnd.pocketlearn": "plf", "application/vnd.powerbuilder6": "pbd", "application/vnd.previewsystems.box": "box", "application/vnd.proteus.magazine": "mgz", "application/vnd.publishare-delta-tree": "qps", "application/vnd.pvi.ptid1": "ptid", "application/vnd.quark.quarkxpress": "qxd", "application/vnd.realvnc.bed": "bed", "application/vnd.recordare.musicxml": "mxl", "application/vnd.recordare.musicxml+xml": "musicxml", "application/vnd.rig.cryptonote": "cryptonote", "application/vnd.rim.cod": "cod", "application/vnd.rn-realmedia": "rm", "application/vnd.rn-realmedia-vbr": "rmvb", "application/vnd.route66.link66+xml": "link66", "application/vnd.sailingtracker.track": "st", "application/vnd.seemail": "see", "application/vnd.sema": "sema", "application/vnd.semd": "semd", "application/vnd.semf": "semf", "application/vnd.shana.informed.formdata": "ifm", "application/vnd.shana.informed.formtemplate": "itp", "application/vnd.shana.informed.interchange": "iif", "application/vnd.shana.informed.package": "ipk", "application/vnd.simtech-mindmapper": "twd", "application/vnd.smaf": "mmf", "application/vnd.smart.teacher": "teacher", "application/vnd.solent.sdkm+xml": "sdkm", "application/vnd.spotfire.dxp": "dxp", "application/vnd.spotfire.sfs": "sfs", "application/vnd.stardivision.calc": "sdc", "application/vnd.stardivision.draw": "sda", "application/vnd.stardivision.impress": "sdd", "application/vnd.stardivision.math": "smf", "application/vnd.stardivision.writer": "sdw", "application/vnd.stardivision.writer-global": "sgl", "application/vnd.stepmania.package": "smzip", "application/vnd.stepmania.stepchart": "sm", "application/vnd.sun.xml.calc": "sxc", "application/vnd.sun.xml.calc.template": "stc", "application/vnd.sun.xml.draw": "sxd", "application/vnd.sun.xml.draw.template": "std", "application/vnd.sun.xml.impress": "sxi", "application/vnd.sun.xml.impress.template": "sti", "application/vnd.sun.xml.math": "sxm", "application/vnd.sun.xml.writer": "sxw", "application/vnd.sun.xml.writer.global": "sxg", "application/vnd.sun.xml.writer.template": "stw", "application/vnd.sus-calendar": "sus", "application/vnd.svd": "svd", "application/vnd.symbian.install": "sis", "application/vnd.syncml+xml": "xsm", "application/vnd.syncml.dm+wbxml": "bdm", "application/vnd.syncml.dm+xml": "xdm", "application/vnd.tao.intent-module-archive": "tao", "application/vnd.tcpdump.pcap": "pcap", "application/vnd.tmobile-livetv": "tmo", "application/vnd.trid.tpt": "tpt", "application/vnd.triscape.mxs": "mxs", "application/vnd.trueapp": "tra", "application/vnd.ufdl": "ufd", "application/vnd.uiq.theme": "utz", "application/vnd.umajin": "umj", "application/vnd.unity": "unityweb", "application/vnd.uoml+xml": "uoml", "application/vnd.vcx": "vcx", "application/vnd.visio": "vsd", "application/vnd.visionary": "vis", "application/vnd.vsf": "vsf", "application/vnd.wap.wbxml": "wbxml", "application/vnd.wap.wmlc": "wmlc", "application/vnd.wap.wmlscriptc": "wmlsc", "application/vnd.webturbo": "wtb", "application/vnd.wolfram.player": "nbp", "application/vnd.wordperfect": "wpd", "application/vnd.wqd": "wqd", "application/vnd.wt.stf": "stf", "application/vnd.xara": "xar", "application/vnd.xfdl": "xfdl", "application/vnd.yamaha.hv-dic": "hvd", "application/vnd.yamaha.hv-script": "hvs", "application/vnd.yamaha.hv-voice": "hvp", "application/vnd.yamaha.openscoreformat": "osf", "application/vnd.yamaha.openscoreformat.osfpvg+xml": "osfpvg", "application/vnd.yamaha.smaf-audio": "saf", "application/vnd.yamaha.smaf-phrase": "spf", "application/vnd.yellowriver-custom-menu": "cmp", "application/vnd.zul": "zir", "application/vnd.zzazz.deck+xml": "zaz", "application/voicexml+xml": "vxml", "application/widget": "wgt", "application/winhlp": "hlp", "application/wsdl+xml": "wsdl", "application/wspolicy+xml": "wspolicy", "application/x-7z-compressed": "7z", "application/x-abiword": "abw", "application/x-ace-compressed": "ace", "application/x-apple-diskimage": "dmg", "application/x-authorware-bin": "aab", "application/x-authorware-map": "aam", "application/x-authorware-seg": "aas", "application/x-bcpio": "bcpio", "application/x-bittorrent": "torrent", "application/x-blorb": "blb", "application/x-bzip": "bz", "application/x-cbr": "cbr", "application/x-cdlink": "vcd", "application/x-cfs-compressed": "cfs", "application/x-chat": "chat", "application/x-chess-pgn": "pgn", "application/x-conference": "nsc", "application/x-cpio": "cpio", "application/x-csh": "csh", "application/x-debian-package": "deb", "application/x-dgc-compressed": "dgc", "application/x-director": "dir", "application/x-doom": "wad", "application/x-dtbncx+xml": "ncx", "application/x-dtbook+xml": "dtb", "application/x-dtbresource+xml": "res", "application/x-dvi": "dvi", "application/x-envoy": "evy", "application/x-eva": "eva", "application/x-font-bdf": "bdf", "application/x-font-ghostscript": "gsf", "application/x-font-linux-psf": "psf", "application/x-font-pcf": "pcf", "application/x-font-snf": "snf", "application/x-font-type1": "pfa", "application/x-freearc": "arc", "application/x-futuresplash": "spl", "application/x-gca-compressed": "gca", "application/x-glulx": "ulx", "application/x-gnumeric": "gnumeric", "application/x-gramps-xml": "gramps", "application/x-gtar": "gtar", "application/x-hdf": "hdf", "application/x-install-instructions": "install", "application/x-iso9660-image": "iso", "application/x-java-jnlp-file": "jnlp", "application/x-latex": "latex", "application/x-lzh-compressed": "lzh", "application/x-mie": "mie", "application/x-mobipocket-ebook": "prc", "application/x-ms-application": "application", "application/x-ms-shortcut": "lnk", "application/x-ms-wmd": "wmd", "application/x-ms-wmz": "wmz", "application/x-ms-xbap": "xbap", "application/x-msaccess": "mdb", "application/x-msbinder": "obd", "application/x-mscardfile": "crd", "application/x-msclip": "clp", "application/x-msdownload": "dll", "application/x-msmediaview": "mvb", "application/x-msmetafile": "wmf", "application/x-msmoney": "mny", "application/x-mspublisher": "pub", "application/x-msschedule": "scd", "application/x-msterminal": "trm", "application/x-mswrite": "wri", "application/x-netcdf": "nc", "application/x-nzb": "nzb", "application/x-pkcs12": "p12", "application/x-pkcs7-certificates": "p7b", "application/x-pkcs7-certreqresp": "p7r", "application/x-research-info-systems": "ris", "application/x-shar": "shar", "application/x-shockwave-flash": "swf", "application/x-silverlight-app": "xap", "application/x-sql": "sql", "application/x-stuffit": "sit", "application/x-stuffitx": "sitx", "application/x-subrip": "srt", "application/x-sv4cpio": "sv4cpio", "application/x-sv4crc": "sv4crc", "application/x-t3vm-image": "t3", "application/x-tads": "gam", "application/x-tar": "tar", "application/x-tcl": "tcl", "application/x-tex": "tex", "application/x-tex-tfm": "tfm", "application/x-texinfo": "texinfo", "application/x-tgif": "obj", "application/x-ustar": "ustar", "application/x-wais-source": "src", "application/x-x509-ca-cert": "der", "application/x-xfig": "fig", "application/x-xliff+xml": "xlf", "application/x-xpinstall": "xpi", "application/x-xz": "xz", "application/x-zmachine": "z1", "application/xaml+xml": "xaml", "application/xcap-diff+xml": "xdf", "application/xenc+xml": "xenc", "application/xhtml+xml": "xhtml", "application/xml": "xsl", "application/xml-dtd": "dtd", "application/xop+xml": "xop", "application/xproc+xml": "xpl", "application/xslt+xml": "xslt", "application/xspf+xml": "xspf", "application/xv+xml": "mxml", "application/yang": "yang", "application/yin+xml": "yin", "application/zip": "zip", "audio/adpcm": "adp", "audio/basic": "au", "audio/midi": "mid", "audio/mp4": "m4a", "audio/mpeg": "mpga", "audio/ogg": "oga", "audio/s3m": "s3m", "audio/silk": "sil", "audio/vnd.dece.audio": "uva", "audio/vnd.digital-winds": "eol", "audio/vnd.dra": "dra", "audio/vnd.dts": "dts", "audio/vnd.dts.hd": "dtshd", "audio/vnd.lucent.voice": "lvp", "audio/vnd.ms-playready.media.pya": "pya", "audio/vnd.nuera.ecelp4800": "ecelp4800", "audio/vnd.nuera.ecelp7470": "ecelp7470", "audio/vnd.nuera.ecelp9600": "ecelp9600", "audio/vnd.rip": "rip", "audio/webm": "weba", "audio/x-aac": "aac", "audio/x-aiff": "aif", "audio/x-caf": "caf", "audio/x-flac": "flac", "audio/x-matroska": "mka", "audio/x-mpegurl": "m3u", "audio/x-ms-wax": "wax", "audio/x-ms-wma": "wma", "audio/x-pn-realaudio": "ram", "audio/x-pn-realaudio-plugin": "rmp", "audio/xm": "xm", "chemical/x-cdx": "cdx", "chemical/x-cif": "cif", "chemical/x-cmdf": "cmdf", "chemical/x-cml": "cml", "chemical/x-csml": "csml", "chemical/x-xyz": "xyz", "font/collection": "ttc", "font/otf": "otf", "font/ttf": "ttf", "font/woff": "woff", "font/woff2": "woff2", "image/cgm": "cgm", "image/g3fax": "g3", "image/gif": "gif", "image/ief": "ief", "image/jpeg": "jpeg", "image/ktx": "ktx", "image/png": "png", "image/prs.btif": "btif", "image/sgi": "sgi", "image/svg+xml": "svg", "image/tiff": "tiff", "image/vnd.adobe.photoshop": "psd", "image/vnd.dece.graphic": "uvi", "image/vnd.djvu": "djvu", "image/vnd.dvb.subtitle": "sub", "image/vnd.dwg": "dwg", "image/vnd.dxf": "dxf", "image/vnd.fastbidsheet": "fbs", "image/vnd.fpx": "fpx", "image/vnd.fst": "fst", "image/vnd.fujixerox.edmics-mmr": "mmr", "image/vnd.fujixerox.edmics-rlc": "rlc", "image/vnd.ms-modi": "mdi", "image/vnd.ms-photo": "wdp", "image/vnd.net-fpx": "npx", "image/vnd.wap.wbmp": "wbmp", "image/vnd.xiff": "xif", "image/webp": "webp", "image/x-3ds": "3ds", "image/x-cmu-raster": "ras", "image/x-cmx": "cmx", "image/x-freehand": "fh", "image/x-icon": "ico", "image/x-mrsid-image": "sid", "image/x-pcx": "pcx", "image/x-pict": "pic", "image/x-portable-anymap": "pnm", "image/x-portable-bitmap": "pbm", "image/x-portable-graymap": "pgm", "image/x-portable-pixmap": "ppm", "image/x-rgb": "rgb", "image/x-xpixmap": "xpm", "image/x-xwindowdump": "xwd", "message/rfc822": "eml", "model/iges": "igs", "model/mesh": "msh", "model/vnd.collada+xml": "dae", "model/vnd.dwf": "dwf", "model/vnd.gdl": "gdl", "model/vnd.gtw": "gtw", "model/vnd.vtu": "vtu", "model/vrml": "wrl", "model/x3d+binary": "x3db", "model/x3d+vrml": "x3dv", "model/x3d+xml": "x3d", "text/cache-manifest": "appcache", "text/calendar": "ics", "text/css": "css", "text/csv": "csv", "text/html": "html", "text/n3": "n3", "text/plain": "txt", "text/prs.lines.tag": "dsc", "text/richtext": "rtx", "text/sgml": "sgml", "text/tab-separated-values": "tsv", "text/troff": "t", "text/turtle": "ttl", "text/uri-list": "uri", "text/vcard": "vcard", "text/vnd.curl": "curl", "text/vnd.curl.dcurl": "dcurl", "text/vnd.curl.mcurl": "mcurl", "text/vnd.curl.scurl": "scurl", "text/vnd.fly": "fly", "text/vnd.fmi.flexstor": "flx", "text/vnd.graphviz": "gv", "text/vnd.in3d.3dml": "3dml", "text/vnd.in3d.spot": "spot", "text/vnd.sun.j2me.app-descriptor": "jad", "text/vnd.wap.wml": "wml", "text/vnd.wap.wmlscript": "wmls", "text/x-asm": "s", "text/x-c": "cc", "text/x-fortran": "f", "text/x-java-source": "java", "text/x-nfo": "nfo", "text/x-opml": "opml", "text/x-pascal": "p", "text/x-setext": "etx", "text/x-sfv": "sfv", "text/x-uuencode": "uu", "text/x-vcalendar": "vcs", "text/x-vcard": "vcf", "video/3gpp": "3gp", "video/3gpp2": "3g2", "video/h261": "h261", "video/h263": "h263", "video/h264": "h264", "video/jpeg": "jpgv", "video/jpm": "jpm", "video/mj2": "mj2", "video/mp4": "mp4", "video/mpeg": "mpeg", "video/quicktime": "qt", "video/vnd.dece.hd": "uvh", "video/vnd.dece.mobile": "uvm", "video/vnd.dece.pd": "uvp", "video/vnd.dece.sd": "uvs", "video/vnd.dece.video": "uvv", "video/vnd.dvb.file": "dvb", "video/vnd.fvt": "fvt", "video/vnd.mpegurl": "mxu", "video/vnd.ms-playready.media.pyv": "pyv", "video/vnd.uvvu.mp4": "uvu", "video/vnd.vivo": "viv", "video/webm": "webm", "video/x-f4v": "f4v", "video/x-fli": "fli", "video/x-flv": "flv", "video/x-m4v": "m4v", "video/x-matroska": "mkv", "video/x-mng": "mng", "video/x-ms-asf": "asf", "video/x-ms-vob": "vob", "video/x-ms-wmx": "wmx", "video/x-ms-wvx": "wvx", "video/x-msvideo": "avi", "video/x-sgi-movie": "movie", "video/x-smv": "smv", "x-conference/x-cooltalk": "ice", "text/x-sql": "sql", "image/x-pixlr-data": "pxd", "image/x-adobe-dng": "dng", "image/x-sketch": "sketch", "image/x-xcf": "xcf", "audio/amr": "amr", "image/vnd-ms.dds": "dds", "application/plt": "plt", "application/sat": "sat", "application/step": "step", "text/x-httpd-cgi": "cgi", "text/x-asap": "asp", "text/x-jsp": "jsp" }, h.prototype._options = { cdns: { ace: "https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.8", codemirror: "https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.52.2", ckeditor: "https://cdnjs.cloudflare.com/ajax/libs/ckeditor/4.12.1", ckeditor5: "https://cdn.ckeditor.com/ckeditor5/17.0.0", tinymce: "https://cdnjs.cloudflare.com/ajax/libs/tinymce/5.2.0", simplemde: "https://cdnjs.cloudflare.com/ajax/libs/simplemde/1.11.2", fabric: "https://cdnjs.cloudflare.com/ajax/libs/fabric.js/3.6.2", fabric16: "https://cdnjs.cloudflare.com/ajax/libs/fabric.js/1.6.7", tui: "https://uicdn.toast.com", hls: "https://cdnjs.cloudflare.com/ajax/libs/hls.js/0.13.2/hls.min.js", dash: "https://cdnjs.cloudflare.com/ajax/libs/dashjs/3.0.3/dash.all.min.js", flv: "https://cdnjs.cloudflare.com/ajax/libs/flv.js/1.5.0/flv.min.js", videojs: "https://cdnjs.cloudflare.com/ajax/libs/video.js/7.7.5", prettify: "https://cdn.jsdelivr.net/gh/google/code-prettify@f1c3473acd1e8ea8c8c1a60c56e89f5cdd06f915/loader/run_prettify.js", psd: "https://cdnjs.cloudflare.com/ajax/libs/psd.js/3.2.0/psd.min.js", rar: "https://cdn.jsdelivr.net/gh/nao-pon/rar.js@6cef13ec66dd67992fc7f3ea22f132d770ebaf8b/rar.min.js", zlibUnzip: "https://cdn.jsdelivr.net/gh/imaya/zlib.js@0.3.1/bin/unzip.min.js", zlibGunzip: "https://cdn.jsdelivr.net/gh/imaya/zlib.js@0.3.1/bin/gunzip.min.js", bzip2: "https://cdn.jsdelivr.net/gh/nao-pon/bzip2.js@0.8.0/bzip2.js", marked: "https://cdnjs.cloudflare.com/ajax/libs/marked/0.7.0/marked.min.js", sparkmd5: "https://cdnjs.cloudflare.com/ajax/libs/spark-md5/3.0.0/spark-md5.min.js", jssha: "https://cdnjs.cloudflare.com/ajax/libs/jsSHA/2.3.1/sha.js", amr: "https://cdn.jsdelivr.net/gh/yxl/opencore-amr-js@dcf3d2b5f384a1d9ded2a54e4c137a81747b222b/js/amrnb.js", tiff: "https://cdn.jsdelivr.net/gh/seikichi/tiff.js@545ede3ee46b5a5bc5f06d65954e775aa2a64017/tiff.min.js" }, url: "", requestType: "get", cors: null, parrotHeaders: [], requestMaxConn: 3, transport: {}, urlUpload: "", dragUploadAllow: "auto", overwriteUploadConfirm: !0, uploadMaxChunkSize: 10485760, folderUploadExclude: { win: /^(?:desktop\.ini|thumbs\.db)$/i, mac: /^\.ds_store$/i }, iframeTimeout: 0, customData: {}, handlers: {}, customHeaders: {}, xhrFields: {}, lang: "en", baseUrl: "", i18nBaseUrl: "", cssAutoLoad: !0, themes: {}, theme: null, maxErrorDialogs: 5, cssClass: "", commands: ["*"], commandsOptions: { getfile: { onlyURL: !1, multiple: !1, folders: !1, oncomplete: "", onerror: "", getPath: !0, getImgSize: !1 }, open: { method: "post", into: "window", selectAction: "open" }, opennew: { url: "", useOriginQuery: !0 }, upload: { ui: "button" }, download: { maxRequests: 10, minFilesZipdl: 2 }, quicklook: { autoplay: !0, width: 450, height: 300, mediaControlsList: "", pdfToolbar: !0, textInitialLines: 100, prettifyMaxLines: 300, contain: !1, docked: 0, dockHeight: "auto", dockAutoplay: !1, googleMapsApiKey: "", googleMapsOpts: { maps: {}, kml: { suppressInfoWindows: !1, preserveViewport: !1 } }, viewerjs: { url: "", mimes: ["application/pdf", "application/vnd.oasis.opendocument.text", "application/vnd.oasis.opendocument.spreadsheet", "application/vnd.oasis.opendocument.presentation"], pdfNative: !0 }, sharecadMimes: [], googleDocsMimes: [], officeOnlineMimes: [], getDimThreshold: "200K", unzipMaxSize: "50M", mimeRegexNotEmptyCheck: /^application\/vnd\.google-apps\./ }, edit: { dialogWidth: void 0, dialogHeight: void 0, mimes: [], mkfileHideMimes: [], makeTextMimes: ["text/plain", "text/css", "text/html"], useStoredEditor: !1, editorMaximized: !1, editors: [], encodings: ["Big5", "Big5-HKSCS", "Cp437", "Cp737", "Cp775", "Cp850", "Cp852", "Cp855", "Cp857", "Cp858", "Cp862", "Cp866", "Cp874", "EUC-CN", "EUC-JP", "EUC-KR", "GB18030", "ISO-2022-CN", "ISO-2022-JP", "ISO-2022-KR", "ISO-8859-1", "ISO-8859-2", "ISO-8859-3", "ISO-8859-4", "ISO-8859-5", "ISO-8859-6", "ISO-8859-7", "ISO-8859-8", "ISO-8859-9", "ISO-8859-13", "ISO-8859-15", "KOI8-R", "KOI8-U", "Shift-JIS", "Windows-1250", "Windows-1251", "Windows-1252", "Windows-1253", "Windows-1254", "Windows-1257"], extraOptions: { uploadOpts: {}, tuiImgEditOpts: { iconsPath: void 0, theme: {} }, pixo: { apikey: "" }, managerUrl: null, ckeditor: {}, ckeditor5: { mode: "decoupled-document" }, tinymce: {}, onlineConvert: { maxSize: 100, showLink: !0 } } }, fullscreen: { mode: "screen" }, search: { incsearch: { enable: !0, minlen: 1, wait: 500 }, searchTypes: { SearchMime: { name: "btnMime", title: "searchMime", incsearch: "mime" } } }, info: { nullUrlDirLinkSelf: !0, hideItems: [], showHashMaxsize: 104857600, showHashAlgorisms: ["md5", "sha256"], showHashOpts: { shake128len: 256, shake256len: 512 }, custom: {} }, mkdir: { intoNewFolderToolbtn: !1 }, resize: { grid8px: "disable", presetSize: [[320, 240], [400, 400], [640, 480], [800, 600]], getDimThreshold: 204800, dimSubImgSize: 307200 }, rm: { quickTrash: !0, infoCheckWait: 10, toTrashMaxItems: 1e3 }, paste: { moveConfirm: !1 }, help: { view: ["about", "shortcuts", "help", "integrations", "debug"], helpSource: "" }, preference: { width: 600, height: 400, categories: null, prefs: null, langs: null, selectActions: ["open", "edit/download", "resize/edit/download", "download", "quicklook"] } }, disabledCmdsRels: { get: ["edit"], rm: ["cut", "empty"], "file&url=": ["download", "zipdl"] }, bootCallback: null, getFileCallback: null, defaultView: "icons", startPathHash: "", sound: !0, ui: ["toolbar", "places", "tree", "path", "stat"], uiOptions: { toolbar: [["home", "back", "forward", "up", "reload"], ["netmount"], ["mkdir", "mkfile", "upload"], ["open", "download", "getfile"], ["undo", "redo"], ["copy", "cut", "paste", "rm", "empty", "hide"], ["duplicate", "rename", "edit", "resize", "chmod"], ["selectall", "selectnone", "selectinvert"], ["quicklook", "info"], ["extract", "archive"], ["search"], ["view", "sort"], ["preference", "help"], ["fullscreen"]], toolbarExtra: { displayTextLabel: !1, labelExcludeUA: ["Mobile"], autoHideUA: ["Mobile"], defaultHides: ["home", "reload"], showPreferenceButton: "none", preferenceInContextmenu: !0 }, tree: { attrTitle: !0, openRootOnLoad: !0, openCwdOnOpen: !0, syncTree: !0, subTreeMax: 100, subdirsMaxConn: 2, subdirsAtOnce: 5, durations: { slideUpDown: "fast", autoScroll: "fast" } }, navbar: { minWidth: 150, maxWidth: 500, autoHideUA: [] }, navdock: { disabled: !1, initMaxHeight: "50%", maxHeight: "90%" }, cwd: { oldSchool: !1, showSelectCheckboxUA: ["Touch"], metakeyDragout: !0, listView: { columns: ["perm", "date", "size", "kind"], columnsCustomName: {}, fixedHeader: !0 }, iconsView: { size: 0, sizeMax: 3, sizeNames: { 0: "viewSmall", 1: "viewMedium", 2: "viewLarge", 3: "viewExtraLarge" } } }, path: { toWorkzoneWithoutNavbar: !0 }, dialog: { focusOnMouseOver: !0 }, toast: { animate: { showMethod: "fadeIn", showDuration: 300, showEasing: "swing", timeOut: 3e3, hideMethod: "fadeOut", hideDuration: 1500, hideEasing: "swing" } } }, dispInlineRegex: "^(?:(?:image|video|audio)|application/(?:x-mpegURL|dash+xml)|(?:text/plain|application/pdf)$)", onlyMimes: [], sortRules: {}, sortType: "name", sortOrder: "asc", sortStickFolders: !0, sortAlsoTreeview: !1, clientFormatDate: !0, UTCDate: !1, dateFormat: "", fancyDateFormat: "", fileModeStyle: "both", width: "auto", height: 400, heightBase: null, resizable: !0, notifyDelay: 500, notifyDialog: { position: {}, width: null, canClose: !1, hiddens: ["open"] }, dialogContained: !1, allowShortcuts: !0, rememberLastDir: !0, reloadClearHistory: !1, useBrowserHistory: !0, showFiles: 50, showThreshold: 50, validName: !1, fileFilter: !1, backupSuffix: "~", sync: 0, syncStart: !0, loadTmbs: 5, cookie: { expires: 30, domain: "", path: "/", secure: !1 }, contextmenu: { navbar: ["open", "opennew", "download", "|", "upload", "mkdir", "|", "copy", "cut", "paste", "duplicate", "|", "rm", "empty", "hide", "|", "rename", "|", "archive", "|", "places", "info", "chmod", "netunmount"], cwd: ["undo", "redo", "|", "back", "up", "reload", "|", "upload", "mkdir", "mkfile", "paste", "|", "empty", "hide", "|", "view", "sort", "selectall", "colwidth", "|", "places", "info", "chmod", "netunmount", "|", "fullscreen", "|", "preference"], files: ["getfile", "|", "open", "opennew", "download", "opendir", "quicklook", "|", "upload", "mkdir", "|", "copy", "cut", "paste", "duplicate", "|", "rm", "empty", "hide", "|", "rename", "edit", "resize", "|", "archive", "extract", "|", "selectall", "selectinvert", "|", "places", "info", "chmod", "netunmount"] }, enableAlways: !1, enableByMouseOver: !0, windowCloseConfirm: ["hasNotifyDialog", "editingFile"], rawStringDecoder: "object" == typeof Encoding && e.isFunction(Encoding.convert) ? function (e) { return Encoding.convert(e, { to: "UNICODE", type: "string" }) } : null, debug: ["error", "warning", "event-destroy"], toastBackendWarn: !0 }, h.prototype._options.commandsOptions.netmount = { ftp: { name: "FTP", inputs: { host: e('<input type="text"/>'), port: e('<input type="number" placeholder="21" class="elfinder-input-optional"/>'), path: e('<input type="text" value="/"/>'), user: e('<input type="text"/>'), pass: e('<input type="password" autocomplete="new-password"/>'), FTPS: e('<input type="checkbox" value="1" title="File Transfer Protocol over SSL/TLS"/>'), encoding: e('<input type="text" placeholder="Optional" class="elfinder-input-optional"/>'), locale: e('<input type="text" placeholder="Optional" class="elfinder-input-optional"/>') } }, dropbox2: h.prototype.makeNetmountOptionOauth("dropbox2", "Dropbox", "Dropbox", { noOffline: !0, root: "/", pathI18n: "path", integrate: { title: "Dropbox.com", link: "https://www.dropbox.com" } }), googledrive: h.prototype.makeNetmountOptionOauth("googledrive", "Google Drive", "Google", { integrate: { title: "Google Drive", link: "https://www.google.com/drive/" } }), onedrive: h.prototype.makeNetmountOptionOauth("onedrive", "One Drive", "OneDrive", { integrate: { title: "Microsoft OneDrive", link: "https://onedrive.live.com" } }), box: h.prototype.makeNetmountOptionOauth("box", "Box", "Box", { noOffline: !0, integrate: { title: "Box.com", link: "https://www.box.com" } }) }, h.prototype.history = function (t) { var n, i = this, a = !0, o = [], r = function () { o = [t.cwd().hash], n = 0, a = !0 }, s = t.options.useBrowserHistory && window.history && window.history.pushState ? window.history : null, l = function (s) { return s && i.canForward() || !s && i.canBack() ? (a = !1, t.exec("open", o[s ? ++n : --n]).fail(r)) : e.Deferred().reject() }, c = function (e) { !s || s.state && s.state.thash === e || s.pushState({ thash: e }, null, location.pathname + location.search + (e ? "#elf_" + e : "")) }; this.canBack = function () { return n > 0 }, this.canForward = function () { return n < o.length - 1 }, this.back = l, this.forward = function () { return l(!0) }, t.bind("init", function () { s && !s.state && c(t.startDir()) }).open(function () { var e = o.length, i = t.cwd().hash; a && (n >= 0 && e > n + 1 && o.splice(n + 1), o[o.length - 1] != i && o.push(i), n = o.length - 1), a = !0, c(i) }).reload(t.options.reloadClearHistory && r) }, h.prototype.command = function (t) { this.fm = t, this.name = "", this.dialogClass = "", this.className = "", this.title = "", this.linkedCmds = [], this.state = -1, this.alwaysEnabled = !1, this.noChangeDirOnRemovedCwd = !1, this._disabled = !1, this.disableOnSearch = !1, this.updateOnSelect = !0, this.syncTitleOnChange = !1, this.keepContextmenu = !1, this._handlers = { enable: function () { this.update(void 0, this.value) }, disable: function () { this.update(-1, this.value) }, "open reload load sync": function () { this._disabled = !(this.alwaysEnabled || this.fm.isCommandEnabled(this.name)), this.update(void 0, this.value), this.change() } }, this.handlers = {}, this.shortcuts = [], this.options = { ui: "button" }, this.listeners = [], this.setup = function (t, n) { var i, a, o, r = this, s = this.fm, l = function (t) { var n = t.callback || function (e) { s.exec(r.name, void 0, { _userAction: !0, _currentType: "shortcut" }) }; t.callback = function (t) { var i, a = {}; r.enabled() && (s.searchStatus.state < 2 ? i = s.isCommandEnabled(r.name) : (e.each(s.selected(), function (t, n) { s.optionsByHashes[n] ? a[n] = !0 : e.each(s.volOptions, function (e) { if (!a[e] && 0 === n.indexOf(e)) return a[e] = !0, !1 }) }), e.each(a, function (e) { if (!(i = s.isCommandEnabled(r.name, e))) return !1 })), i && (r.event = t, n.call(r), delete r.event)) } }; for (this.name = t, this.title = s.messages["cmd" + t] ? s.i18n("cmd" + t) : this.extendsCmd && s.messages["cmd" + this.extendsCmd] ? s.i18n("cmd" + this.extendsCmd) : t, this.options = Object.assign({}, this.options, n), this.listeners = [], this.dialogClass = "elfinder-dialog-" + t, n.shortcuts && ("function" == typeof n.shortcuts ? o = n.shortcuts(this.fm, this.shortcuts) : Array.isArray(n.shortcuts) && (o = n.shortcuts), this.shortcuts = o || []), this.updateOnSelect && (this._handlers.select = function () { this.update(void 0, this.value) }), e.each(Object.assign({}, r._handlers, r.handlers), function (t, n) { s.bind(t, e.proxy(n, r)) }), i = 0; i < this.shortcuts.length; i++)l(a = this.shortcuts[i]), !a.description && (a.description = this.title), s.shortcut(a); this.disableOnSearch && s.bind("search searchend", function () { r._disabled = "search" === this.type || !(this.alwaysEnabled || s.isCommandEnabled(t)), r.update(void 0, r.value) }), this.init() }, this.init = function () { }, this.exec = function (t, n) { return e.Deferred().reject() }, this.getUndo = function (e, t) { return !1 }, this.disabled = function () { return this.state < 0 }, this.enabled = function () { return this.state > -1 }, this.active = function () { return this.state > 0 }, this.getstate = function () { return -1 }, this.update = function (e, t) { var n = this.state, i = this.value; this._disabled && 0 === this.fm.searchStatus ? this.state = -1 : this.state = void 0 !== e ? e : this.getstate(), this.value = t, n == this.state && i == this.value || this.change() }, this.change = function (e) { var t, n; if ("function" == typeof e) this.listeners.push(e); else for (n = 0; n < this.listeners.length; n++) { t = this.listeners[n]; try { t(this.state, this.value) } catch (e) { this.fm.debug("error", e) } } return this }, this.hashes = function (n) { return n ? e.grep(Array.isArray(n) ? n : [n], function (e) { return !!t.file(e) }) : t.selected() }, this.files = function (t) { var n = this.fm; return t ? e.map(Array.isArray(t) ? t : [t], function (e) { return n.file(e) || null }) : n.selectedFiles() }, this.fmDialog = function (e, t) { return t.cssClass ? t.cssClass += " " + this.dialogClass : t.cssClass = this.dialogClass, this.fm.dialog(e, t) } }, h.prototype.resources = { class: { hover: "ui-state-hover", active: "ui-state-active", disabled: "ui-state-disabled", draggable: "ui-draggable", droppable: "ui-droppable", adroppable: "elfinder-droppable-active", cwdfile: "elfinder-cwd-file", cwd: "elfinder-cwd", tree: "elfinder-tree", treeroot: "elfinder-navbar-root", navdir: "elfinder-navbar-dir", navdirwrap: "elfinder-navbar-dir-wrapper", navarrow: "elfinder-navbar-arrow", navsubtree: "elfinder-navbar-subtree", navcollapse: "elfinder-navbar-collapsed", navexpand: "elfinder-navbar-expanded", treedir: "elfinder-tree-dir", placedir: "elfinder-place-dir", searchbtn: "elfinder-button-search", editing: "elfinder-to-editing", preventback: "elfinder-prevent-back", tabstab: "ui-state-default ui-tabs-tab ui-corner-top ui-tab", tabsactive: "ui-tabs-active ui-state-active" }, tpl: { perms: '<span class="elfinder-perms"></span>', lock: '<span class="elfinder-lock"></span>', symlink: '<span class="elfinder-symlink"></span>', navicon: '<span class="elfinder-nav-icon"></span>', navspinner: '<span class="elfinder-spinner elfinder-navbar-spinner"></span>', navdir: '<div class="elfinder-navbar-wrapper{root}"><span id="{id}" class="ui-corner-all elfinder-navbar-dir {cssclass}"{title}><span class="elfinder-navbar-arrow"></span><span class="elfinder-navbar-icon" {style}></span>{symlink}{permissions}{name}</span><div class="elfinder-navbar-subtree" style="display:none"></div></div>', placedir: '<div class="elfinder-navbar-wrapper"><span id="{id}" class="ui-corner-all elfinder-navbar-dir {cssclass}"{title}><span class="elfinder-navbar-arrow"></span><span class="elfinder-navbar-icon" {style}></span>{symlink}{permissions}{name}</span><div class="elfinder-navbar-subtree" style="display:none"></div></div>' }, mimes: { text: ["application/dash+xml", "application/docbook+xml", "application/javascript", "application/json", "application/plt", "application/sat", "application/sql", "application/step", "application/vnd.hp-hpgl", "application/x-awk", "application/x-config", "application/x-csh", "application/x-empty", "application/x-mpegurl", "application/x-perl", "application/x-php", "application/x-web-config", "application/xhtml+xml", "application/xml", "audio/x-mp3-playlist", "image/cgm", "image/svg+xml", "image/vnd.dxf", "model/iges"] }, mixin: { make: function () { var t, n, i, a, o, r, s, l, c, d, p = this, u = this.fm, h = this.name, f = this.requestCmd || h, m = u.getUI("workzone"), g = this.origin && "navbar" === this.origin ? "tree" : "cwd", v = "tree" === g, b = v ? "navHash2Elm" : "cwdHash2Elm", y = !v && "list" != u.storage("view"), w = u.selected(), x = this.move || !1, k = m.hasClass("elfinder-cwd-wrapper-empty"), C = function () { requestAnimationFrame(function () { U && U.trigger("blur") }) }, z = function () { E.is(":hidden") || E.elfinderoverlay("hide").off("click close", D), n && (i.removeClass("ui-front").css("position", "").off("unselect." + u.namespace, C), y ? n && n.css("max-height", "") : v || i.css("width", "").parent("td").css("overflow", "")) }, T = e.Deferred().fail(function (e) { r && o.attr("class", r), k && m.addClass("elfinder-cwd-wrapper-empty"), w && (x && u.trigger("unlockfiles", { files: w }), u.clipboard([]), u.trigger("selectfiles", { files: w })), e && u.error(e) }).always(function () { z(), F(), u.enable().unbind("open", R).trigger("resMixinMake") }), A = "tmp_" + parseInt(1e5 * Math.random()), j = this.data && this.data.target ? this.data.target : v ? u.file(w[0]).hash : u.cwd().hash, O = new Date, S = { hash: A, phash: j, name: u.uniqueName(this.prefix, j), mime: this.mime, read: !0, write: !0, date: "Today " + O.getHours() + ":" + O.getMinutes(), move: x }, I = (u.getUI(g).trigger("create." + u.namespace, S), this.data || {}), M = u[b](A), E = u.getUI("overlay"), F = function () { M && M.length && (U.off(), M.hide(), u.unselectfiles({ files: [A] }).unbind("resize", q), requestAnimationFrame(function () { v ? M.closest(".elfinder-navbar-wrapper").remove() : M.remove() })) }, D = function (e) { E.is(":hidden") || i.css("z-index", ""), H || (F(), T.reject(), e && (e.stopPropagation(), e.preventDefault())) }, U = e(y ? "<textarea></textarea>" : '<input type="text"/>').on("keyup text", function () { y ? (this.style.height = "1px", this.style.height = this.scrollHeight + "px") : t && (this.style.width = t + "px", this.scrollWidth > t && (this.style.width = this.scrollWidth + 10 + "px")) }).on("keydown", function (t) { t.stopImmediatePropagation(), t.keyCode == e.ui.keyCode.ESCAPE ? T.reject() : t.keyCode == e.ui.keyCode.ENTER && (t.preventDefault(), U.trigger("blur")) }).on("mousedown click dblclick", function (e) { e.stopPropagation(), "dblclick" === e.type && e.preventDefault() }).on("blur", function () { var t, n = e.trim(U.val()), o = U.parent(), r = !0; if (E.is(":hidden") || i.css("z-index", ""), "" === n) return D(); if (!H && o.length) { if (u.options.validName && u.options.validName.test) try { r = u.options.validName.test(n) } catch (e) { r = !1 } if (!n || "." === n || ".." === n || !r) return H = !0, u.error("directory" === S.mime ? "errInvDirname" : "errInvName", { modal: !0, close: function () { setTimeout(P, 120) } }), !1; if (u.fileByName(n, j)) return H = !0, u.error(["errExists", n], { modal: !0, close: function () { setTimeout(P, 120) } }), !1; t = w && x ? u.exec("cut", w) : null, e.when(t).done(function () { var t = {}, i = {}; z(), U.hide().before(e("<span>").text(n)), u.lockfiles({ files: [A] }), u.request({ data: Object.assign({ cmd: f, name: n, target: j }, I || {}), notify: { type: f, cnt: 1 }, preventFail: !0, syncOnFail: !0, navigate: { toast: t } }).fail(function (t) { u.unlockfiles({ files: [A] }), H = !0, U.show().prev().remove(), u.error(t, { modal: !0, close: function () { Array.isArray(t) && -1 !== e.inArray("errUploadMime", t) ? T.notify("errUploadMime").reject() : setTimeout(P, 120) } }) }).done(function (n) { if (n && n.added && n.added[0]) { var o, r = n.added[0], s = r.hash, l = (u[b](s), { directory: { cmd: "open", msg: "cmdopendir" }, text: { cmd: "edit", msg: "cmdedit" }, default: { cmd: "open", msg: "cmdopen" } }); w && x && u.one(f + "done", function () { u.exec("paste", s) }), x || (u.mimeIsText(r.mime) && !u.mimesCanMakeEmpty[r.mime] && u.mimeTypes[r.mime] && (u.trigger("canMakeEmptyFile", { mimes: [r.mime], unshift: !0 }), (o = {})[r.mime] = u.mimeTypes[r.mime], u.storage("mkfileTextMimes", Object.assign(o, u.storage("mkfileTextMimes") || {}))), Object.assign(i, a || l[r.mime] || l[r.mime.split("/")[0]] || l[u.mimesCanMakeEmpty[r.mime] || -1 !== e.inArray(r.mime, u.resources.mimes.text) ? "text" : "none"] || l.default), Object.assign(t, i.cmd ? { incwd: { msg: u.i18n(["complete", u.i18n("cmd" + h)]), action: i }, inbuffer: { msg: u.i18n(["complete", u.i18n("cmd" + h)]), action: i } } : { inbuffer: { msg: u.i18n(["complete", u.i18n("cmd" + h)]) } })) } T.resolve(n) }) }).fail(function () { T.reject() }) } }).on("dragenter dragleave dragover drop", function (e) { e.stopPropagation() }), P = function () { var e = u.splitFileExtention(U.val())[0]; H || !u.UA.Mobile || u.UA.iOS || (E.on("click close", D).elfinderoverlay("show"), i.css("z-index", E.css("z-index") + 1)), H = !1, !u.enabled() && u.enable(), U.trigger("focus").trigger("select"), U[0].setSelectionRange && U[0].setSelectionRange(0, e.length) }, q = function () { M.trigger("scrolltoview", { blink: !1 }) }, R = function () { T && "pending" === T.state() && T.reject() }, H = !1; return u.isCommandEnabled(f, j) && M.length ? (e.isPlainObject(p.nextAction) && (a = Object.assign({}, p.nextAction)), v ? (o = u[b](j), s = u.res("class", "navcollapse"), l = u.res("class", "navexpand"), c = u.res("class", "navarrow"), d = u.res("class", "navsubtree"), M.closest("." + d).show(), o.hasClass(s) || (r = o.attr("class"), o.addClass(s + " " + l + " elfinder-subtree-loaded")), o.is("." + s + ":not(." + l + ")") && o.children("." + c).trigger("click").data("dfrd").done(function () { U.val() === S.name && U.val(u.uniqueName(p.prefix, j)).trigger("select").trigger("focus") }), n = M.contents().filter(function () { return 3 == this.nodeType && e(this).parent().attr("id") === u.navHash2Id(S.hash) }), i = n.parent(), n.replaceWith(U.val(S.name))) : (k && m.removeClass("elfinder-cwd-wrapper-empty"), n = M.find(".elfinder-cwd-filename"), i = n.parent(), y ? n.css("max-height", "none") : (t = i.width(), i.width(t - 15).parent("td").css("overflow", "visible")), n.empty().append(U.val(S.name))), i.addClass("ui-front").css("position", "relative").on("unselect." + u.namespace, C), u.bind("resize", q).one("open", R), U.trigger("keyup"), P(), T) : T.reject() } }, blink: function (e, t) { var n, i = { slowonce: function () { e.hide().delay(250).fadeIn(750).delay(500).fadeOut(3500) }, lookme: function () { e.show().fadeOut(500).fadeIn(750) } }; n = i[t = t || "slowonce"] || i.lookme, e.stop(!0, !0), n() } }, e.fn.dialogelfinder = function (t, n) { var i, a, o = "elfinderDestroyOnClose"; if (e.isPlainObject(t)) this.not(".elfinder").each(function () { t.handlers = t.handlers || {}; var i, a = e(this), r = (e(document), e('<div class="ui-widget-header dialogelfinder-drag ui-corner-top">' + (t.title || "Files") + "</div>")), s = (e('<a href="#" class="dialogelfinder-drag-close ui-corner-all"><span class="ui-icon ui-icon-closethick"> </span></a>').appendTo(r).on("click", function (e) { e.preventDefault(), a.dialogelfinder("close") }), t.handlers.init); t.handlers.init = function (e, t) { a.prepend(r), s && s(e, t) }, (i = a.addClass("elfinder dialogelfinder touch-punch").css("position", "absolute").hide().appendTo("body").draggable({ handle: ".dialogelfinder-drag", containment: "window", stop: function () { a.trigger("resize"), i.trigger("resize") } }).elfinder(t, n).elfinder("instance")).reloadCallback = function (e, t) { i.destroy(), e.handlers.init = s, a.dialogelfinder(e, t).dialogelfinder("open") }, a.width(parseInt(a.width()) || 840).data(o, !!t.destroyOnClose).find(".elfinder-toolbar").removeClass("ui-corner-top"), t.position && a.data("elfinderPosition", t.position), !1 !== t.autoOpen && e(this).dialogelfinder("open") }); else if ("open" === t) a = (i = e(this)).data("elfinderPosition") || { top: parseInt(e(document).scrollTop() + (e(window).height() < i.height() ? 2 : (e(window).height() - i.height()) / 2)), left: parseInt(e(document).scrollLeft() + (e(window).width() < i.width() ? 2 : (e(window).width() - i.width()) / 2)) }, i.is(":hidden") && (i.addClass("ui-front").css(a).show().trigger("resize"), setTimeout(function () { i.trigger("resize").trigger("mousedown") }, 200)); else if ("close" === t) (i = e(this).removeClass("ui-front")).is(":visible") && (i.data(o) ? i.elfinder("destroy").remove() : i.elfinder("close")); else if ("instance" === t) return e(this).getElFinder(); return this }, "function" == typeof h && h.prototype.i18 && (h.prototype.i18.en = { translator: "Troex Nevelin &lt;troex@fury.scancode.ru&gt;, Naoki Sawada &lt;hypweb+elfinder@gmail.com&gt;", language: "English", direction: "ltr", dateFormat: "M d, Y h:i A", fancyDateFormat: "$1 h:i A", nonameDateFormat: "ymd-His", messages: { error: "Error", errUnknown: "Unknown error.", errUnknownCmd: "Unknown command.", errJqui: "Invalid jQuery UI configuration. Selectable, draggable and droppable components must be included.", errNode: "elFinder requires DOM Element to be created.", errURL: "Invalid elFinder configuration! URL option is not set.", errAccess: "Access denied.", errConnect: "Unable to connect to backend.", errAbort: "Connection aborted.", errTimeout: "Connection timeout.", errNotFound: "Backend not found.", errResponse: "Invalid backend response.", errConf: "Invalid backend configuration.", errJSON: "PHP JSON module not installed.", errNoVolumes: "Readable volumes not available.", errCmdParams: 'Invalid parameters for command "$1".', errDataNotJSON: "Data is not JSON.", errDataEmpty: "Data is empty.", errCmdReq: "Backend request requires command name.", errOpen: 'Unable to open "$1".', errNotFolder: "Object is not a folder.", errNotFile: "Object is not a file.", errRead: 'Unable to read "$1".', errWrite: 'Unable to write into "$1".', errPerm: "Permission denied.", errLocked: '"$1" is locked and can not be renamed, moved or removed.', errExists: 'Item named "$1" already exists.', errInvName: "Invalid file name.", errInvDirname: "Invalid folder name.", errFolderNotFound: "Folder not found.", errFileNotFound: "File not found.", errTrgFolderNotFound: 'Target folder "$1" not found.', errPopup: "Browser prevented opening popup window. To open file enable it in browser options.", errMkdir: 'Unable to create folder "$1".', errMkfile: 'Unable to create file "$1".', errRename: 'Unable to rename "$1".', errCopyFrom: 'Copying files from volume "$1" not allowed.', errCopyTo: 'Copying files to volume "$1" not allowed.', errMkOutLink: "Unable to create a link to outside the volume root.", errUpload: "Upload error.", errUploadFile: 'Unable to upload "$1".', errUploadNoFiles: "No files found for upload.", errUploadTotalSize: "Data exceeds the maximum allowed size.", errUploadFileSize: "File exceeds maximum allowed size.", errUploadMime: "File type not allowed.", errUploadTransfer: '"$1" transfer error.', errUploadTemp: "Unable to make temporary file for upload.", errNotReplace: 'Object "$1" already exists at this location and can not be replaced by object with another type.', errReplace: 'Unable to replace "$1".', errSave: 'Unable to save "$1".', errCopy: 'Unable to copy "$1".', errMove: 'Unable to move "$1".', errCopyInItself: 'Unable to copy "$1" into itself.', errRm: 'Unable to remove "$1".', errTrash: "Unable into trash.", errRmSrc: "Unable remove source file(s).", errExtract: 'Unable to extract files from "$1".', errArchive: "Unable to create archive.", errArcType: "Unsupported archive type.", errNoArchive: "File is not archive or has unsupported archive type.", errCmdNoSupport: "Backend does not support this command.", errReplByChild: 'The folder "$1" can\'t be replaced by an item it contains.', errArcSymlinks: "For security reason denied to unpack archives contains symlinks or files with not allowed names.", errArcMaxSize: "Archive files exceeds maximum allowed size.", errResize: 'Unable to resize "$1".', errResizeDegree: "Invalid rotate degree.", errResizeRotate: "Unable to rotate image.", errResizeSize: "Invalid image size.", errResizeNoChange: "Image size not changed.", errUsupportType: "Unsupported file type.", errNotUTF8Content: 'File "$1" is not in UTF-8 and cannot be edited.', errNetMount: 'Unable to mount "$1".', errNetMountNoDriver: "Unsupported protocol.", errNetMountFailed: "Mount failed.", errNetMountHostReq: "Host required.", errSessionExpires: "Your session has expired due to inactivity.", errCreatingTempDir: 'Unable to create temporary directory: "$1"', errFtpDownloadFile: 'Unable to download file from FTP: "$1"', errFtpUploadFile: 'Unable to upload file to FTP: "$1"', errFtpMkdir: 'Unable to create remote directory on FTP: "$1"', errArchiveExec: 'Error while archiving files: "$1"', errExtractExec: 'Error while extracting files: "$1"', errNetUnMount: "Unable to unmount.", errConvUTF8: "Not convertible to UTF-8", errFolderUpload: "Try the modern browser, If you'd like to upload the folder.", errSearchTimeout: 'Timed out while searching "$1". Search result is partial.', errReauthRequire: "Re-authorization is required.", errMaxTargets: "Max number of selectable items is $1.", errRestore: "Unable to restore from the trash. Can't identify the restore destination.", errEditorNotFound: "Editor not found to this file type.", errServerError: "Error occurred on the server side.", errEmpty: 'Unable to empty folder "$1".', moreErrors: "There are $1 more errors.", cmdarchive: "Create archive", cmdback: "Back", cmdcopy: "Copy", cmdcut: "Cut", cmddownload: "Download", cmdduplicate: "Duplicate", cmdedit: "Edit file", cmdextract: "Extract files from archive", cmdforward: "Forward", cmdgetfile: "Select files", cmdhelp: "About this software", cmdhome: "Root", cmdinfo: "Get info", cmdmkdir: "New folder", cmdmkdirin: "Into New Folder", cmdmkfile: "New file", cmdopen: "Open", cmdpaste: "Paste", cmdquicklook: "Preview", cmdreload: "Reload", cmdrename: "Rename", cmdrm: "Delete", cmdtrash: "Into trash", cmdrestore: "Restore", cmdsearch: "Find files", cmdup: "Go to parent folder", cmdupload: "Upload files", cmdview: "View", cmdresize: "Resize & Rotate", cmdsort: "Sort", cmdnetmount: "Mount network volume", cmdnetunmount: "Unmount", cmdplaces: "To Places", cmdchmod: "Change mode", cmdopendir: "Open a folder", cmdcolwidth: "Reset column width", cmdfullscreen: "Full Screen", cmdmove: "Move", cmdempty: "Empty the folder", cmdundo: "Undo", cmdredo: "Redo", cmdpreference: "Preferences", cmdselectall: "Select all", cmdselectnone: "Select none", cmdselectinvert: "Invert selection", cmdopennew: "Open in new window", cmdhide: "Hide (Preference)", btnClose: "Close", btnSave: "Save", btnRm: "Remove", btnApply: "Apply", btnCancel: "Cancel", btnNo: "No", btnYes: "Yes", btnMount: "Mount", btnApprove: "Goto $1 & approve", btnUnmount: "Unmount", btnConv: "Convert", btnCwd: "Here", btnVolume: "Volume", btnAll: "All", btnMime: "MIME Type", btnFileName: "Filename", btnSaveClose: "Save & Close", btnBackup: "Backup", btnRename: "Rename", btnRenameAll: "Rename(All)", btnPrevious: "Prev ($1/$2)", btnNext: "Next ($1/$2)", btnSaveAs: "Save As", ntfopen: "Open folder", ntffile: "Open file", ntfreload: "Reload folder content", ntfmkdir: "Creating folder", ntfmkfile: "Creating files", ntfrm: "Delete items", ntfcopy: "Copy items", ntfmove: "Move items", ntfprepare: "Checking existing items", ntfrename: "Rename files", ntfupload: "Uploading files", ntfdownload: "Downloading files", ntfsave: "Save files", ntfarchive: "Creating archive", ntfextract: "Extracting files from archive", ntfsearch: "Searching files", ntfresize: "Resizing images", ntfsmth: "Doing something", ntfloadimg: "Loading image", ntfnetmount: "Mounting network volume", ntfnetunmount: "Unmounting network volume", ntfdim: "Acquiring image dimension", ntfreaddir: "Reading folder infomation", ntfurl: "Getting URL of link", ntfchmod: "Changing file mode", ntfpreupload: "Verifying upload file name", ntfzipdl: "Creating a file for download", ntfparents: "Getting path infomation", ntfchunkmerge: "Processing the uploaded file", ntftrash: "Doing throw in the trash", ntfrestore: "Doing restore from the trash", ntfchkdir: "Checking destination folder", ntfundo: "Undoing previous operation", ntfredo: "Redoing previous undone", ntfchkcontent: "Checking contents", volume_Trash: "Trash", dateUnknown: "unknown", Today: "Today", Yesterday: "Yesterday", msJan: "Jan", msFeb: "Feb", msMar: "Mar", msApr: "Apr", msMay: "May", msJun: "Jun", msJul: "Jul", msAug: "Aug", msSep: "Sep", msOct: "Oct", msNov: "Nov", msDec: "Dec", January: "January", February: "February", March: "March", April: "April", May: "May", June: "June", July: "July", August: "August", September: "September", October: "October", November: "November", December: "December", Sunday: "Sunday", Monday: "Monday", Tuesday: "Tuesday", Wednesday: "Wednesday", Thursday: "Thursday", Friday: "Friday", Saturday: "Saturday", Sun: "Sun", Mon: "Mon", Tue: "Tue", Wed: "Wed", Thu: "Thu", Fri: "Fri", Sat: "Sat", sortname: "by name", sortkind: "by kind", sortsize: "by size", sortdate: "by date", sortFoldersFirst: "Folders first", sortperm: "by permission", sortmode: "by mode", sortowner: "by owner", sortgroup: "by group", sortAlsoTreeview: "Also Treeview", "untitled file.txt": "NewFile.txt", "untitled folder": "NewFolder", Archive: "NewArchive", "untitled file": "NewFile.$1", extentionfile: "$1: File", extentiontype: "$1: $2", confirmReq: "Confirmation required", confirmRm: "Are you sure you want to permanently remove items?<br/>This cannot be undone!", confirmRepl: "Replace old file with new one? (If it contains folders, it will be merged. To backup and replace, select Backup.)", confirmRest: "Replace existing item with the item in trash?", confirmConvUTF8: "Not in UTF-8<br/>Convert to UTF-8?<br/>Contents become UTF-8 by saving after conversion.", confirmNonUTF8: "Character encoding of this file couldn't be detected. It need to temporarily convert to UTF-8 for editting.<br/>Please select character encoding of this file.", confirmNotSave: "It has been modified.<br/>Losing work if you do not save changes.", confirmTrash: "Are you sure you want to move items to trash bin?", confirmMove: 'Are you sure you want to move items to "$1"?', apllyAll: "Apply to all", name: "Name", size: "Size", perms: "Permissions", modify: "Modified", kind: "Kind", read: "read", write: "write", noaccess: "no access", and: "and", unknown: "unknown", selectall: "Select all items", selectfiles: "Select item(s)", selectffile: "Select first item", selectlfile: "Select last item", viewlist: "List view", viewicons: "Icons view", viewSmall: "Small icons", viewMedium: "Medium icons", viewLarge: "Large icons", viewExtraLarge: "Extra large icons", places: "Places", calc: "Calculate", path: "Path", aliasfor: "Alias for", locked: "Locked", dim: "Dimensions", files: "Files", folders: "Folders", items: "Items", yes: "yes", no: "no", link: "Link", searcresult: "Search results", selected: "selected items", about: "About", shortcuts: "Shortcuts", help: "Help", webfm: "Web file manager", ver: "Version", protocolver: "protocol version", homepage: "Project home", docs: "Documentation", github: "Fork us on GitHub", twitter: "Follow us on Twitter", facebook: "Join us on Facebook", team: "Team", chiefdev: "chief developer", developer: "developer", contributor: "contributor", maintainer: "maintainer", translator: "translator", icons: "Icons", dontforget: "and don't forget to take your towel", shortcutsof: "Shortcuts disabled", dropFiles: "Drop files here", or: "or", selectForUpload: "Select files", moveFiles: "Move items", copyFiles: "Copy items", restoreFiles: "Restore items", rmFromPlaces: "Remove from places", aspectRatio: "Aspect ratio", scale: "Scale", width: "Width", height: "Height", resize: "Resize", crop: "Crop", rotate: "Rotate", "rotate-cw": "Rotate 90 degrees CW", "rotate-ccw": "Rotate 90 degrees CCW", degree: "°", netMountDialogTitle: "Mount network volume", protocol: "Protocol", host: "Host", port: "Port", user: "User", pass: "Password", confirmUnmount: "Are you sure to unmount $1?", dropFilesBrowser: "Drop or Paste files from browser", dropPasteFiles: "Drop files, Paste URLs or images(clipboard) here", encoding: "Encoding", locale: "Locale", searchTarget: "Target: $1", searchMime: "Search by input MIME Type", owner: "Owner", group: "Group", other: "Other", execute: "Execute", perm: "Permission", mode: "Mode", emptyFolder: "Folder is empty", emptyFolderDrop: "Folder is empty\\A Drop to add items", emptyFolderLTap: "Folder is empty\\A Long tap to add items", quality: "Quality", autoSync: "Auto sync", moveUp: "Move up", getLink: "Get URL link", selectedItems: "Selected items ($1)", folderId: "Folder ID", offlineAccess: "Allow offline access", reAuth: "To re-authenticate", nowLoading: "Now loading...", openMulti: "Open multiple files", openMultiConfirm: "You are trying to open the $1 files. Are you sure you want to open in browser?", emptySearch: "Search results is empty in search target.", editingFile: "It is editing a file.", hasSelected: "You have selected $1 items.", hasClipboard: "You have $1 items in the clipboard.", incSearchOnly: "Incremental search is only from the current view.", reinstate: "Reinstate", complete: "$1 complete", contextmenu: "Context menu", pageTurning: "Page turning", volumeRoots: "Volume roots", reset: "Reset", bgcolor: "Background color", colorPicker: "Color picker", "8pxgrid": "8px Grid", enabled: "Enabled", disabled: "Disabled", emptyIncSearch: "Search results is empty in current view.\\A Press [Enter] to expand search target.", emptyLetSearch: "First letter search results is empty in current view.", textLabel: "Text label", minsLeft: "$1 mins left", openAsEncoding: "Reopen with selected encoding", saveAsEncoding: "Save with the selected encoding", selectFolder: "Select folder", firstLetterSearch: "First letter search", presets: "Presets", tooManyToTrash: "It's too many items so it can't into trash.", TextArea: "TextArea", folderToEmpty: 'Empty the folder "$1".', filderIsEmpty: 'There are no items in a folder "$1".', preference: "Preference", language: "Language", clearBrowserData: "Initialize the settings saved in this browser", toolbarPref: "Toolbar settings", charsLeft: "... $1 chars left.", linesLeft: "... $1 lines left.", sum: "Sum", roughFileSize: "Rough file size", autoFocusDialog: "Focus on the element of dialog with mouseover", select: "Select", selectAction: "Action when select file", useStoredEditor: "Open with the editor used last time", selectinvert: "Invert selection", renameMultiple: "Are you sure you want to rename $1 selected items like $2?<br/>This cannot be undone!", batchRename: "Batch rename", plusNumber: "+ Number", asPrefix: "Add prefix", asSuffix: "Add suffix", changeExtention: "Change extention", columnPref: "Columns settings (List view)", reflectOnImmediate: "All changes will reflect immediately to the archive.", reflectOnUnmount: "Any changes will not reflect until un-mount this volume.", unmountChildren: "The following volume(s) mounted on this volume also unmounted. Are you sure to unmount it?", selectionInfo: "Selection Info", hashChecker: "Algorithms to show the file hash", infoItems: "Info Items (Selection Info Panel)", pressAgainToExit: "Press again to exit.", toolbar: "Toolbar", workspace: "Work Space", dialog: "Dialog", all: "All", iconSize: "Icon Size (Icons view)", editorMaximized: "Open the maximized editor window", editorConvNoApi: "Because conversion by API is not currently available, please convert on the website.", editorConvNeedUpload: "After conversion, you must be upload with the item URL or a downloaded file to save the converted file.", convertOn: "Convert on the site of $1", integrations: "Integrations", integrationWith: "This elFinder has the following external services integrated. Please check the terms of use, privacy policy, etc. before using it.", showHidden: "Show hidden items", hideHidden: "Hide hidden items", toggleHidden: "Show/Hide hidden items", makefileTypes: 'File types to enable with "New file"', typeOfTextfile: "Type of the Text file", add: "Add", theme: "Theme", default: "Default", description: "Description", website: "Website", author: "Author", email: "Email", license: "License", exportToSave: "This item can't be saved. To avoid losing the edits you need to export to your PC.", dblclickToSelect: "Double click on the file to select it.", useFullscreen: "Use fullscreen mode", kindUnknown: "Unknown", kindRoot: "Volume Root", kindFolder: "Folder", kindSelects: "Selections", kindAlias: "Alias", kindAliasBroken: "Broken alias", kindApp: "Application", kindPostscript: "Postscript document", kindMsOffice: "Microsoft Office document", kindMsWord: "Microsoft Word document", kindMsExcel: "Microsoft Excel document", kindMsPP: "Microsoft Powerpoint presentation", kindOO: "Open Office document", kindAppFlash: "Flash application", kindPDF: "Portable Document Format (PDF)", kindTorrent: "Bittorrent file", kind7z: "7z archive", kindTAR: "TAR archive", kindGZIP: "GZIP archive", kindBZIP: "BZIP archive", kindXZ: "XZ archive", kindZIP: "ZIP archive", kindRAR: "RAR archive", kindJAR: "Java JAR file", kindTTF: "True Type font", kindOTF: "Open Type font", kindRPM: "RPM package", kindText: "Text document", kindTextPlain: "Plain text", kindPHP: "PHP source", kindCSS: "Cascading style sheet", kindHTML: "HTML document", kindJS: "Javascript source", kindRTF: "Rich Text Format", kindC: "C source", kindCHeader: "C header source", kindCPP: "C++ source", kindCPPHeader: "C++ header source", kindShell: "Unix shell script", kindPython: "Python source", kindJava: "Java source", kindRuby: "Ruby source", kindPerl: "Perl script", kindSQL: "SQL source", kindXML: "XML document", kindAWK: "AWK source", kindCSV: "Comma separated values", kindDOCBOOK: "Docbook XML document", kindMarkdown: "Markdown text", kindImage: "Image", kindBMP: "BMP image", kindJPEG: "JPEG image", kindGIF: "GIF Image", kindPNG: "PNG Image", kindTIFF: "TIFF image", kindTGA: "TGA image", kindPSD: "Adobe Photoshop image", kindXBITMAP: "X bitmap image", kindPXM: "Pixelmator image", kindAudio: "Audio media", kindAudioMPEG: "MPEG audio", kindAudioMPEG4: "MPEG-4 audio", kindAudioMIDI: "MIDI audio", kindAudioOGG: "Ogg Vorbis audio", kindAudioWAV: "WAV audio", AudioPlaylist: "MP3 playlist", kindVideo: "Video media", kindVideoDV: "DV movie", kindVideoMPEG: "MPEG movie", kindVideoMPEG4: "MPEG-4 movie", kindVideoAVI: "AVI movie", kindVideoMOV: "Quick Time movie", kindVideoWM: "Windows Media movie", kindVideoFlash: "Flash movie", kindVideoMKV: "Matroska movie", kindVideoOGG: "Ogg movie" } }), e.fn.elfinderbutton = function (t) { return this.each(function () { var n, i, a = "class", o = t.fm, r = o.res(a, "disabled"), s = o.res(a, "active"), l = o.res(a, "hover"), c = "elfinder-button-menu-item", d = e('<span class="elfinder-button-text">' + t.title + "</span>"), p = t.className ? t.className : t.name, u = e(this).addClass("ui-state-default elfinder-button").attr("title", t.title).append('<span class="elfinder-button-icon elfinder-button-icon-' + p + '"></span>', d).on("mouseenter mouseleave", function (e) { !u.hasClass(r) && u["mouseleave" == e.type ? "removeClass" : "addClass"](l) }).on("click", function (e) { u.hasClass(r) || (n && t.variants.length >= 1 ? (n.is(":hidden") && o.getUI().click(), e.stopPropagation(), n.css(f()).slideToggle({ duration: 100, done: function (e) { o[n.is(":visible") ? "toFront" : "toHide"](n) } })) : o.exec(t.name, m(), { _userAction: !0, _currentType: "toolbar", _currentNode: u })) }), h = function () { o.toHide(n) }, f = function () { var e = o.getUI(), t = e.offset(), n = u.offset(); return { top: n.top - t.top, left: n.left - t.left, maxHeight: e.height() - 40 } }, m = function () { var e = o.selected(); return e.length || (e = o.cwd() ? [o.cwd().hash] : void 0), e }; d.hide(), t.button = u, Array.isArray(t.variants) && (u.addClass("elfinder-menubutton"), n = e('<div class="ui-front ui-widget ui-widget-content elfinder-button-menu elfinder-button-' + p + '-menu ui-corner-all"></div>').hide().appendTo(o.getUI()).on("mouseenter mouseleave", "." + c, function () { e(this).toggleClass(l) }).on("click", "." + c, function (i) { var a = e(this).data("value"); i.preventDefault(), i.stopPropagation(), u.removeClass(l), o.toHide(n), void 0 === a && (a = {}), "object" == typeof a && (a._userAction = !0), o.exec(t.name, m(), a) }).on("close", h), o.bind("disable select", h).getUI().on("click", h), t.change(function () { n.html(""), e.each(t.variants, function (i, a) { n.append(e('<div class="' + c + '">' + a[1] + "</div>").data("value", a[0]).addClass(a[0] == t.value ? "elfinder-button-menu-item-selected" : "")) }) })), t.change(function () { var e; i && cancelAnimationFrame(i), i = requestAnimationFrame(function () { t.disabled() ? u.removeClass(s + " " + l).addClass(r) : (u.removeClass(r), u[t.active() ? "addClass" : "removeClass"](s)), t.syncTitleOnChange && (e = t.className ? t.className : t.name, p !== e && (u.children(".elfinder-button-icon").removeClass("elfinder-button-icon-" + p).addClass("elfinder-button-icon-" + e), n && n.removeClass("elfinder-button-" + p + "-menu").addClass("elfinder-button-" + e + "-menu"), p = e), d.html(t.title), u.attr("title", t.title)) }) }).change() }) }, e.fn.elfindercontextmenu = function (t) { return this.each(function () { e(this); var n, i, a, o, r, s, l, c = "elfinder-contextmenu-item", d = "elfinder-contextsubmenu-item", p = "elfinder-contextmenu-extra-icon", u = t.res("class", "hover"), h = { distance: 8, start: function () { f.data("drag", !0).data("touching") && f.find("." + u).removeClass(u) }, stop: function () { f.data("draged", !0).removeData("drag") } }, f = e(this).addClass("touch-punch ui-helper-reset ui-front ui-widget ui-state-default ui-corner-all elfinder-contextmenu elfinder-contextmenu-" + t.direction).hide().on("touchstart", function (e) { f.data("touching", !0).children().removeClass(u) }).on("touchend", function (e) { f.removeData("touching") }).on("mouseenter mouseleave", "." + c, function (t) { e(this).toggleClass(u, !("mouseenter" !== t.type && (f.data("draged") || !f.data("submenuKeep")))), f.data("draged") && f.data("submenuKeep") && f.find(".elfinder-contextmenu-sub:visible").parent().addClass(u) }).on("mouseenter mouseleave", "." + p, function (t) { e(this).parent().toggleClass(u, "mouseleave" === t.type) }).on("mouseenter mouseleave", "." + c + ",." + d, function (t) { var n, i = function (t, n) { e.each(n ? r : a, function (e, i) { if (t[0] === i) return (n ? r : a)._cur = e, n ? s = t : o = t, !1 }) }; if (t.originalEvent) { var l = e(this), c = function () { o && !o.children("div.elfinder-contextmenu-sub:visible").length && o.removeClass(u) }; "mouseenter" === t.type ? l.hasClass(d) ? (s && s.removeClass(u), o && (r = o.find("div." + d)), i(l, !0)) : (c(), i(l)) : l.hasClass(d) ? (s = null, r = null) : (c(), n = o, setTimeout(function () { n === o && (o = null) }, 250)) } }).on("contextmenu", function () { return !1 }).on("mouseup", function () { setTimeout(function () { f.removeData("draged") }, 100) }).draggable(h), m = "ltr" === t.direction, g = m ? "left" : "right", v = Object.assign({}, t.options.contextmenu), b = '<div class="' + c + '{className}"><span class="elfinder-button-icon {icon} elfinder-contextmenu-icon"{style}></span><span>{label}</span></div>', y = function (n, i, a, o) { var r, s, l = "", c = "", d = ""; return o && (o.className && (l = " " + o.className), o.iconClass && (d = o.iconClass, i = ""), o.iconImg && (s = (r = o.iconImg.split(/ +/))[1] && r[2] ? t.escape(r[1] + "px " + r[2] + "px") : "", c = " style=\"background:url('" + t.escape(r[0]) + "') " + (s || "0 0") + " no-repeat;" + (s ? "" : "posbackground-size:contain;") + '"')), e(b.replace("{icon}", i ? "elfinder-button-icon-" + i : d || "").replace("{label}", n).replace("{style}", c).replace("{className}", l)).on("click", function (e) { e.stopPropagation(), e.preventDefault(), a() }) }, w = function (n) { var i = n.keyCode, l = e.ui.keyCode.ESCAPE, c = e.ui.keyCode.ENTER, p = e.ui.keyCode.LEFT, h = e.ui.keyCode.RIGHT, f = e.ui.keyCode.UP, m = e.ui.keyCode.DOWN, g = "ltr" === t.direction ? h : p, v = g === h ? p : h; -1 !== e.inArray(i, [l, c, p, h, f, m]) && (n.preventDefault(), n.stopPropagation(), n.stopImmediatePropagation(), i == l || i === v ? o && r && s ? (s.trigger("mouseleave").trigger("submenuclose"), o.addClass(u), r = null, s = null) : i == l && k() : i == f || i == m ? r ? (s && s.trigger("mouseleave"), i == m && (!s || r.length <= ++r._cur) ? r._cur = 0 : i == f && (!s || --r._cur < 0) && (r._cur = r.length - 1), s = r.eq(r._cur).trigger("mouseenter")) : (r = null, o && o.trigger("mouseleave"), i == m && (!o || a.length <= ++a._cur) ? a._cur = 0 : i == f && (!o || --a._cur < 0) && (a._cur = a.length - 1), o = a.eq(a._cur).addClass(u)) : !o || i != c && i !== g || (o.hasClass("elfinder-contextmenu-group") ? s ? i == c && s.click() : (o.trigger("mouseenter"), (r = o.find("div." + d))._cur = 0, s = r.first().addClass(u)) : i == c && o.click())) }, x = function (a, c, d) { var p, u, h = f.outerWidth(), m = f.outerHeight(), v = n.attr("style"), b = n.offset(), y = n.width(), C = n.height(), z = t.UA.Mobile ? 40 : 2, T = t.UA.Mobile ? 20 : 2; a -= b ? b.left : 0, c -= b ? b.top : 0, d = Object.assign(d || {}, { top: Math.max(0, c + T + m < C ? c + T : c - (c + m - C)), left: Math.max(0, a < h + z || a + z + h < y ? a + z : a - z - h), opacity: "1" }); l = !0, t.autoSync("stop"), n.width(y), f.stop().removeAttr("style").css(d), t.toFront(f), f.show(), n.attr("style", v), d[g] = parseInt(f.width()), f.find(".elfinder-contextmenu-sub").css(d), t.UA.iOS && e("div.elfinder div.overflow-scrolling-touch").css("-webkit-overflow-scrolling", "auto"), o = null, r = null, s = null, e(document).on("keydown." + t.namespace, w), (p = e._data(document).events) && p.keydown && p.keydown.unshift(p.keydown.pop()), t.UA.Mobile && (u = "touchstart.contextmenuAutoToggle", f.data("hideTm") && clearTimeout(f.data("hideTm")), f.is(":visible") && f.on("touchstart", function (e) { e.originalEvent.touches.length > 1 || (f.stop(), t.toFront(f), f.data("hideTm") && clearTimeout(f.data("hideTm"))) }).data("hideTm", setTimeout(function () { f.is(":visible") && (i.find(".elfinder-cwd-file").off(u), i.find(".elfinder-cwd-file.ui-selected").one(u, function (t) { if (!(t.originalEvent.touches.length > 1)) { var n = e(t.target); if (f.first().length && !n.is("input:checkbox") && !n.hasClass("elfinder-cwd-select")) return t.stopPropagation(), x(t.originalEvent.touches[0].pageX, t.originalEvent.touches[0].pageY), i.data("longtap", !0), void n.one("touchend", function () { setTimeout(function () { i.removeData("longtap") }, 80) }); i.find(".elfinder-cwd-file").off(u) } }).one("unselect." + t.namespace, function () { i.find(".elfinder-cwd-file").off(u) }), f.fadeOut({ duration: 300, fail: function () { f.css("opacity", "1").show() }, done: function () { t.toHide(f) } })) }, 4500))), requestAnimationFrame(function () { t.getUI().one("click." + t.namespace, k) }) }, k = function () { if (t.getUI().off("click." + t.namespace, k), e(document).off("keydown." + t.namespace, w), C = z = null, f.is(":visible") || f.children().length) { t.toHide(f.removeAttr("style").empty().removeData("submenuKeep")); try { f.draggable("instance") || f.draggable(h) } catch (e) { f.hasClass("ui-draggable") || f.draggable(h) } f.data("prevNode") && (f.data("prevNode").after(f), f.removeData("prevNode")), t.trigger("closecontextmenu"), t.UA.iOS && e("div.elfinder div.overflow-scrolling-touch").css("-webkit-overflow-scrolling", "touch") } l && t.searchStatus.state < 1 && !t.searchStatus.ininc && t.autoSync(), l = !1 }, C = null, z = null; t.one("load", function () { n = t.getUI(), i = t.getUI("cwd"), t.bind("contextmenu", function (o) { var r, s, l, h, g, b, w, T, A, j, O = o.data, S = {}; O.type && "files" !== O.type && i.trigger("unselectall"), k(), O.type && O.targets ? (t.trigger("contextmenucreate", O), l = O.type, h = O.targets, w = !1, T = !1, A = [], j = "cwd" === l, C = l, z = h, (b = t.option("uiCmdMap", j ? void 0 : h[0])) || (b = {}), j || (A = t.getDisabledCmds(h)), (g = t.selected().length) > 1 && f.append('<div class="ui-corner-top ui-widget-header elfinder-contextmenu-header"><span>' + t.i18n("selectedItems", "" + g) + "</span></div>"), a = e(), e.each(v[l] || [], function (i, o) { var r, s, g, v, x, C; if ("|" !== o) { if (b[o] ? (s = b[o], g = !0) : s = o, !(r = t.getCommand(s)) || j || t.searchStatus.state && r.disableOnSearch || (r.__disabled = r._disabled, r._disabled = !(r.alwaysEnabled || t._commands[s] && !(-1 !== e.inArray(o, A) || g && A[s])), e.each(r.linkedCmds, function (e, n) { var i; (i = t.getCommand(n)) && (i.__disabled = i._disabled, i._disabled = !(i.alwaysEnabled || t._commands[n] && !A[n])) })), r && !r._disabled && -1 != r.getstate(h)) { if (r.variants) { if (!r.variants.length) return; v = y(r.title, r.className ? r.className : r.name, function () { }, r.contextmenuOpts), x = e('<div class="ui-front ui-corner-all elfinder-contextmenu-sub"></div>').hide().css("max-height", t.getUI().height() - 30).appendTo(v.append('<span class="elfinder-contextmenu-arrow"></span>')), C = function (e) { if (e) { var i = n.attr("style"); n.width(n.width()), x.css({ top: "-1000px", left: "auto", right: "auto" }); var a, o, r = v.offset(), s = r.left, l = r.top, c = v.outerWidth(), d = x.outerWidth(!0), p = x.outerHeight(!0), u = n.offset(), h = u.left + n.width(), g = u.top + n.height(), b = m, y = c; m ? (o = s + c + d - h) > 10 && (s > d - 5 ? (y -= 5, b = !1) : t.UA.Mobile || (y = c - o)) : (o = d - s) > 0 && (s + c + d - 15 < h ? (y -= 5, b = !0) : t.UA.Mobile || (y = c - o)), a = (o = l + 5 + p - g) > 0 && l < g ? 5 - o : o > 0 ? 30 - p : 5, f.find(".elfinder-contextmenu-sub:visible").hide(), x.css({ top: a, left: b ? y : "auto", right: b ? "auto" : y, overflowY: "auto" }).show(), n.attr("style", i) } else x.hide() }, v.addClass("elfinder-contextmenu-group").on("mouseleave", ".elfinder-contextmenu-sub", function (e) { f.data("draged") || f.removeData("submenuKeep") }).on("submenuclose", ".elfinder-contextmenu-sub", function (e) { C(!1) }).on("click", "." + d, function (n) { var i, a; n.stopPropagation(), f.data("draged") || (a = e(this), r.keepContextmenu ? (a.removeClass(u), v.addClass(u)) : f.hide(), void 0 === (i = a.data("exec")) && (i = {}), "object" == typeof i && (i._userAction = !0, i._currentType = l, i._currentNode = a), !r.keepContextmenu && k(), t.exec(r.name, h, i)) }).on("touchend", function (e) { f.data("drag") || (C(!0), f.data("submenuKeep", !0)) }).on("mouseenter mouseleave", function (t) { f.data("touching") || (v.data("timer") && (clearTimeout(v.data("timer")), v.removeData("timer")), e(t.target).closest(".elfinder-contextmenu-sub", f).length || ("mouseleave" === t.type ? f.data("submenuKeep") || v.data("timer", setTimeout(function () { v.removeData("timer"), C(!1) }, 250)) : v.data("timer", setTimeout(function () { v.removeData("timer"), C(!0) }, a.find("div.elfinder-contextmenu-sub:visible").length ? 250 : 0)))) }), e.each(r.variants, function (t, n) { var i, a, o, r, s = "|" === n ? '<div class="elfinder-contextmenu-separator"></div>' : e('<div class="' + c + " " + d + '"><span>' + n[1] + "</span></div>").data("exec", n[0]); void 0 !== n[2] && (i = e("<span></span>").addClass("elfinder-button-icon elfinder-contextmenu-icon"), /\//.test(n[2]) ? i.css((a = n[2], o = a.split(/ +/), r = o[1] && o[2] ? o[1] + "px " + o[2] + "px" : "", { backgroundImage: 'url("' + o[0] + '")', backgroundRepeat: "no-repeat", backgroundPosition: r || "", backgroundSize: r ? "" : "contain" })) : i.addClass("elfinder-button-icon-" + n[2]), s.prepend(i).addClass(d + "-icon")), x.append(s) }) } else v = y(r.title, r.className ? r.className : r.name, function () { f.data("draged") || (!r.keepContextmenu && k(), t.exec(r.name, h, { _userAction: !0, _currentType: l, _currentNode: v })) }, r.contextmenuOpts), r.extra && r.extra.node ? (e('<span class="elfinder-button-icon elfinder-button-icon-' + (r.extra.icon || "") + " " + p + '"></span>').append(r.extra.node).appendTo(v), e(r.extra.node).trigger("ready", { targets: h })) : v.remove("." + p); r.extendsCmd && v.children("span.elfinder-button-icon").addClass("elfinder-button-icon-" + r.extendsCmd), T && f.append('<div class="elfinder-contextmenu-separator"></div>'), f.append(v), w = !0, T = !1 } r && void 0 !== r.__disabled && (r._disabled = r.__disabled, delete r.__disabled, e.each(r.linkedCmds, function (e, n) { var i; (i = t.getCommand(n)) && (i._disabled = i.__disabled, delete i.__disabled) })) } else w && (T = !0) }), a = f.children("div." + c), t.trigger("contextmenucreatedone", O)) : O.raw && (s = O.raw, C = "raw", e.each(s, function (e, t) { var n; "|" === t ? f.append('<div class="elfinder-contextmenu-separator"></div>') : t.label && "function" == typeof t.callback && (n = y(t.label, t.icon, function () { f.data("draged") || (!t.remain && k(), t.callback()) }, t.options || null), f.append(n)) }), a = f.children("div." + c)), f.children().length && ((r = O.prevNode || null) && (f.data("prevNode", f.prev()), r.after(f)), O.fitHeight && (S = { maxHeight: Math.min(t.getUI().height(), e(window).height()), overflowY: "auto" }, f.draggable("destroy").removeClass("ui-draggable")), x(O.x, O.y, S), O.opened && "function" == typeof O.opened && O.opened.call(f)) }).one("destroy", function () { f.remove() }).bind("disable", k).bind("select", function (e) { "files" === C && (!e.data || e.data.selected.toString() !== z.toString()) && k() }) }).shortcut({ pattern: "mac" === t.OS ? "ctrl+m" : "contextmenu shift+f10", description: "contextmenu", callback: function (n) { n.stopPropagation(), n.preventDefault(), e(document).one("contextmenu." + t.namespace, function (e) { e.preventDefault(), e.stopPropagation() }); var i, a, o, r, s = t.selected(); s.length ? (i = "files", a = s, r = t.cwdHash2Elm(s[0])) : (i = "cwd", a = [t.cwd().hash], o = t.getUI("workzone").offset()), r && r.length || (r = t.getUI("workzone")), (o = r.offset()).top += r.height() / 2, o.left += r.width() / 2, t.trigger("contextmenu", { type: i, targets: a, x: o.left, y: o.top }) } }) }) }, e.fn.elfindercwd = function (t, n) { return this.not(".elfinder-cwd").each(function () { var i, a, o, r, s, l, c, d = t.UA.Mobile, p = "list" == t.viewType, u = "select." + t.namespace, h = "unselect." + t.namespace, f = "disable." + t.namespace, m = "enable." + t.namespace, g = "class", v = t.res(g, "cwdfile"), b = "." + v, y = "ui-selected", w = t.res(g, "disabled"), x = t.res(g, "draggable"), k = t.res(g, "droppable"), C = t.res(g, "hover"), z = t.res(g, "active"), T = t.res(g, "adroppable"), A = v + "-tmp", j = "elfinder-cwd-selectchk", O = t.options.loadTmbs > 0 ? t.options.loadTmbs : 5, S = "", I = {}, M = [], E = [], F = void 0, D = [], U = "", P = function () { return '<tr id="{id}" class="' + v + ' {permsclass} {dirclass}" title="{tooltip}"{css}><td class="elfinder-col-name"><div class="elfinder-cwd-file-wrapper"><span class="elfinder-cwd-icon {mime}"{style}></span>{marker}<span class="elfinder-cwd-filename">{name}</span></div>' + q + "</td>" + function () { for (var e = "", t = 0; t < D.length; t++)e += '<td class="elfinder-col-' + D[t] + '">{' + D[t] + "}</td>"; return e }() + "</tr>" }, q = e.map(n.showSelectCheckboxUA, function (e) { return !(!t.UA[e] && !e.match(/^all$/i)) || null }).length ? '<div class="elfinder-cwd-select"><input type="checkbox" class="' + j + '"></div>' : "", R = !1, H = null, _ = { icon: '<div id="{id}" class="' + v + ' {permsclass} {dirclass} ui-corner-all" title="{tooltip}"><div class="elfinder-cwd-file-wrapper ui-corner-all"><div class="elfinder-cwd-icon {mime} ui-corner-all" unselectable="on"{style}></div>{marker}</div><div class="elfinder-cwd-filename" title="{nametitle}">{name}</div>' + q + "</div>", row: "" }, N = t.res("tpl", "perms"), L = t.res("tpl", "lock"), W = t.res("tpl", "symlink"), B = { id: function (e) { return t.cwdHash2Id(e.hash) }, name: function (e) { var n = t.escape(e.i18 || e.name); return !p && (n = n.replace(/([_.])/g, "&#8203;$1")), n }, nametitle: function (e) { return t.escape(e.i18 || e.name) }, permsclass: function (e) { return t.perms2class(e) }, perm: function (e) { return t.formatPermissions(e) }, dirclass: function (e) { var i = "directory" == e.mime ? "directory" : ""; return e.isroot && (i += " isroot"), e.csscls && (i += " " + t.escape(e.csscls)), n.getClass && (i += " " + n.getClass(e)), i }, style: function (e) { return e.icon ? t.getIconStyle(e) : "" }, mime: function (e) { var n = t.mime2class(e.mime); return e.icon && (n += " elfinder-cwd-bgurl"), n }, size: function (e) { return "directory" !== e.mime || e.size ? t.formatSize(e.size) : "-" }, date: function (e) { return t.formatDate(e) }, kind: function (e) { return t.mime2kind(e) }, mode: function (e) { return e.perm ? t.formatFileMode(e.perm) : "" }, modestr: function (e) { return e.perm ? t.formatFileMode(e.perm, "string") : "" }, modeoct: function (e) { return e.perm ? t.formatFileMode(e.perm, "octal") : "" }, modeboth: function (e) { return e.perm ? t.formatFileMode(e.perm, "both") : "" }, marker: function (e) { return (e.alias || "symlink-broken" == e.mime ? W : "") + (e.read && e.write ? "" : N) + (e.locked ? L : "") }, tooltip: function (e) { var n = t.formatDate(e) + (e.size > 0 ? " (" + t.formatSize(e.size) + ")" : ""), i = ""; return i = S && e.path ? t.escape(e.path.replace(/\/[^\/]*$/, "")) : e.tooltip ? t.escape(e.tooltip).replace(/\r/g, "&#13;") : "", p && (i += (i ? "&#13;" : "") + t.escape(e.i18 || e.name)), i ? i + "&#13;" + n : n } }, $ = {}, V = function (n) { return n.mime && "directory" !== n.mime && !$[n.mime] && function (n, i) { var o, r, s; if (n && !$[n] && (void 0 === a && (e("#elfinderAddBadgeStyle" + t.namespace).length && e("#elfinderAddBadgeStyle" + t.namespace).remove(), a = e('<style id="addBadgeStyle' + t.namespace + '"></style>').insertBefore(e("head").children(":first")).get(0).sheet || null), a)) { if (s = (n = n.toLowerCase()).split("/"), r = t.escape(t.mimeTypes[n] || (i.replace(/.bac?k$/i, "").match(/\.([^.]+)$/) || ["", ""])[1])) { o = ".elfinder-cwd-icon-" + s[0].replace(/(\.|\+)/g, "-"), void 0 !== s[1] && (o += ".elfinder-cwd-icon-" + s[1].replace(/(\.|\+)/g, "-")); try { a.insertRule(o + ':before{content:"' + r.toLowerCase() + '"}', 0) } catch (e) { } } $[n] = !0 } }(n.mime, n.name), _[p ? "row" : "icon"].replace(/\{([a-z0-9_]+)\}/g, function (e, i) { return B[i] ? B[i](n, t) : n[i] ? n[i] : "" }) }, K = e(), X = !1, J = {}, G = function (e) { t.cwdHash2Elm(e).trigger(u) }, Y = !1, Q = function () { t.cwd().hash; q && Ee.find("input").prop("checked", !0), t.lazy(function () { var n; t.maxTargets && (F || E).length > t.maxTargets ? (Z({ notrigger: !0 }), n = (n = e.map(F || E, function (e) { return t.file(e) || null })).slice(0, t.maxTargets), J = {}, e.each(n, function (e, n) { J[n.hash] = !0, t.cwdHash2Elm(n.hash).trigger(u) }), t.toast({ mode: "warning", msg: t.i18n(["errMaxTargets", t.maxTargets]) })) : (Se.find("[id]:not(.ui-selected):not(.elfinder-cwd-parent)").trigger(u), J = t.arrayFlip(F || E, !0)), te(), q && Ee.data("pending", !1) }, 0, { repaint: !0 }) }, Z = function (e) { var t = e || {}; q && Ee.find("input").prop("checked", !1), Object.keys(J).length && (X = !1, J = {}, Se.find("[id].ui-selected").trigger(h), q && Se.find("input:checkbox." + j).prop("checked", !1)), !t.notrigger && te(), q && Ee.data("pending", !1), Se.removeClass("elfinder-cwd-allselected") }, ee = void 0, te = function () { var e = Object.keys(J), n = { selected: e, origin: "cwd" }; de && (e.length > 1 || e[0] !== t.cwdId2Hash(de.attr("id"))) && de.hasClass(y) && de.trigger(h), Y = e.length && e.length === (F || E).length && (!t.maxTargets || e.length <= t.maxTargets), q && (Ee.find("input").prop("checked", Y), Se[Y ? "addClass" : "removeClass"]("elfinder-cwd-allselected")), Y ? n.selectall = !0 : e.length || (n.unselectall = !0), t.trigger("select", n) }, ne = function (e, n) { if (e.length) { var i = e.position().top, a = e.outerHeight(!0), o = Ie.scrollTop(), r = Ie.get(0).clientHeight, s = he ? he.outerHeight(!0) : 0; i + s + a > o + r ? Ie.scrollTop(parseInt(i + s + a - r)) : i < o && Ie.scrollTop(i), p && Ie.scrollLeft(0), n && t.resources.blink(e, "lookme") } }, ie = [], ae = {}, oe = function (e) { for (var t = ie.length; t--;)if (ie[t].hash == e) return t; return -1 }, re = !1, se = { disabled: !0, filter: "[id]:first", stop: te, delay: 250, appendTo: "body", autoRefresh: !1, selected: function (t, n) { e(n.selected).trigger(u) }, unselected: function (t, n) { e(n.unselected).trigger(h) } }, le = {}, ce = function (a, o) { if (ae.renderd) { var r = (p ? Se.find("tbody:first") : Se).children("[id]" + (n.oldSchool ? ":not(.elfinder-cwd-parent)" : "") + ":first"); if (r.length) { var s, l, c, d, u, h, f, m, g = Se.data("selectable"), y = (c = Ie.offset(), d = Ie.width(), u = e(window), h = r.width() / 2, f = Math.min(c.left - u.scrollLeft() + ("ltr" === t.direction ? h : d - h), c.left + d - 10), m = c.top - u.scrollTop() + 10 + (p ? i : 0), { left: Math.max(0, Math.round(f)), top: Math.max(0, Math.round(m)) }), w = a ? r : e(document.elementFromPoint(y.left, y.top)), x = {}, k = {}, C = Math.ceil((ae.hpi ? Math.ceil(Ue.data("rectangle").height / ae.hpi * 1.5) : pe) / 5), z = function () { var e, n, i; for (i = 0; i < 5 && ((e = w.attr("id")) && (ae.getTmbs = [], n = t.cwdId2Hash(e), le[n] = e, ae.attachTmbs[n] && (k[n] = ae.attachTmbs[n]), g && (x[e] = !0)), (w = w.next()).length); i++); }, T = function () { var e; Se.data("selectable") && (Object.assign(x, J), (e = Object.keys(x)).length && (se.filter = "#" + e.join(", #"), Se.selectable("enable").selectable("option", { filter: se.filter }).selectable("refresh"))), Object.keys(k).length && (ae.getTmbs = [], ye(k)) }, A = function () { w.hasClass(v) || (w = w.closest(b)) }; if (le = {}, g && Se.selectable("option", "disabled"), w.length && (w.hasClass(v) || w.closest(b).length || ((l = t.getUI().find(".ui-dialog:visible,.ui-widget:visible")).length ? (l.hide(), w = e(document.elementFromPoint(y.left, y.top)), l.show()) : l = null), A(), w.length || (l && l.hide(), w = e(document.elementFromPoint(y.left, y.top + 5)), l && l.show(), A())), w.length) { if (w.attr("id")) if (a) { for (var j = 0; j < C && (z(), w.length); j++); T() } else ae.repaintJob && "pending" === ae.repaintJob.state() && ae.repaintJob.reject(), s = new Array(C), ae.repaintJob = t.asyncJob(function () { z(), w.length || (T(), ae.repaintJob && "pending" === ae.repaintJob.state() && ae.repaintJob.reject()) }, s).done(T) } else a && ae.renderd && (o = o || 0) < 10 && requestAnimationFrame(function () { ce(a, ++o) }) } } }, de = null, pe = t.options.showFiles, ue = function () { if (!(ae.rendering || ae.renderd && !ie.length)) { var i, a, o = p ? Se.children("table").children("tbody") : Se, r = !!e.htmlPrefilter, s = e(r ? document.createDocumentFragment() : "<div></div>"), l = function (n) { var i, a, l, c = n || null, h = [], f = !1, m = {}, g = "self" === t.option("tmbUrl"), v = !ae.renderd; i = ie.splice(0, pe + (c || 0) / (ae.hpi || 1)), ae.renderd += i.length, ie.length || (Me.hide(), Ie.off("elfscrstop", ue)), a = [], h = e.map(i, function (e) { return e.hash && e.name ? ("directory" == e.mime && (f = !0), (e.tmb && (1 != e.tmb || e.size > 0) || g && 0 === e.mime.indexOf("image/")) && (m[e.hash] = e.tmb || "self"), I[e.hash] && a.push(e.hash), V(e)) : null }), s.empty().append(h.join("")), f && !d && be(s), l = [], Object.keys(J).length && s.find("[id]:not(.ui-selected):not(.elfinder-cwd-parent)").each(function () { J[t.cwdId2Hash(this.id)] && l.push(e(this)) }), o.append(r ? s : s.children()), l.length && (e.each(l, function (e, t) { t.trigger(u) }), te()), a.length && t.trigger("lockfiles", { files: a }), !ae.hpi && Ce(o, i.length), p && (Se.find("thead").show(), me({ fitWidth: !H })), Object.keys(m).length && Object.assign(ae.attachTmbs, m), v && (d || Se.data("selectable") || Se.selectable(se).data("selectable", !0)), !re && Ie.trigger("elfscrstop") }; ae.renderd || (ae.rendering = !0, Ie.scrollTop(0), i = t.cwd().phash, l(), n.oldSchool && (i && !S ? function (n) { var i = t.cwd().phash, a = t.file(i) || null, o = function (n) { n && (de = e(V(e.extend(!0, {}, n, { name: "..", i18: "..", mime: "directory" }))).addClass("elfinder-cwd-parent").on("dblclick", function () { t.trigger("select", { selected: [i] }).exec("open", i) }), (p ? de.children("td:first") : de).children(".elfinder-cwd-select").remove(), t.cwdHash2Elm(i).length ? t.cwdHash2Elm(i).replaceWith(de) : (p ? Se.find("tbody") : Se).prepend(de), t.draggingUiHelper && t.draggingUiHelper.data("refreshPositions", 1)) }; a ? o(a) : (o({ hash: i, read: !0, write: !0 }), t.getUI("tree").length ? t.one("parents", function () { o(t.file(i) || null), Ie.trigger("elfscrstop") }) : t.request({ data: { cmd: "parents", target: t.cwd().hash }, preventFail: !0 }).done(function (e) { o(t.file(i) || null), Ie.trigger("elfscrstop") })) }() : de = e()), p && (H && ge(), me({ fitWidth: !0 })), ae.itemH = (p ? o.find("tr:first") : o.find("[id]:first")).outerHeight(!0), t.trigger("cwdrender"), ae.rendering = !1, ce(!0)), !ae.rendering && ie.length ? (a = Ie.height() + Ie.scrollTop() + t.options.showThreshold + ae.row - ae.renderd * ae.hpi) > 0 ? (ae.rendering = !0, t.lazy(function () { l(a), ae.rendering = !1 })) : !t.enabled() && De() : De() } }, he = null, fe = t.UA.CSS.positionSticky && t.UA.CSS.widthMaxContent, me = function (a) { if (i = 0, n.listView.fixedHeader) { var o, r, s, l, c, d, p, u, h, f, m, g, v, b = function () { var e, n; n = "ltr" === t.direction ? "left" : "right", e = -1 * ("ltr" === t.direction ? Ie.scrollLeft() : s.outerWidth(!0) - Ie.width() - Ie.scrollLeft()), r.css(n) !== e && r.css(n, e) }, y = a || {}; if ((u = (c = Se.find("tbody")).children("tr:first")).length && u.is(":visible")) { if (s = c.parent(), he ? p = (l = e("#" + t.namespace + "-cwd-thead")).children("tr:first") : (v = !0, c.addClass("elfinder-cwd-fixheader"), d = (p = (l = Se.find("thead").attr("id", t.namespace + "-cwd-thead")).children("tr:first")).outerHeight(!0), Se.css("margin-top", d - parseInt(s.css("padding-top"))), fe ? (he = e('<div class="elfinder-table-header-sticky"></div>').addClass(Se.attr("class")).append(e("<table></table>").append(l)), Se.after(he), Ie.on("resize.fixheader", function (e) { e.stopPropagation(), me({ fitWidth: !0 }) })) : (r = e("<div></div>").addClass(Se.attr("class")).append(e("<table></table>").append(l)), he = e("<div></div>").addClass(Ie.attr("class") + " elfinder-cwd-fixheader").removeClass("ui-droppable native-droppable").css(Ie.position()).css({ height: d, width: Se.outerWidth() }).append(r), "rtl" === t.direction && he.css("left", Ie.data("width") - Ie.width() + "px"), b(), Ie.after(he).on("scroll.fixheader resize.fixheader", function (e) { b(), "resize" === e.type && (e.stopPropagation(), he.css(Ie.position()), Ie.data("width", Ie.css("overflow", "hidden").width()), Ie.css("overflow", "auto"), me()) }))), v || y.fitWidth || Math.abs(u.outerWidth() - p.outerWidth()) > 2) { o = D.length + 1; for (var w = 0; w < o && (h = p.children("td:eq(" + w + ")"), f = u.children("td:eq(" + w + ")"), m = h.width(), g = f.width(), void 0 === h.data("delta") && h.data("delta", h.outerWidth() - m - (f.outerWidth() - g)), g -= h.data("delta"), v || y.fitWidth || m !== g); w++)h.css("width", g + "px") } fe || (he.data("widthTimer") && cancelAnimationFrame(he.data("widthTimer")), he.data("widthTimer", requestAnimationFrame(function () { he && (he.css("width", Pe.width() + "px"), "rtl" === t.direction && he.css("left", Ie.data("width") - Ie.width() + "px")) }))), i = l.height() } } }, ge = function () { if (p && H) { var t = "elfinder-cwd-colwidth", n = Se.find("tr[id]:first"); n.hasClass(t) || (Se.find("tr." + t).removeClass(t).find("td").css("width", ""), n.addClass(t), Se.find("table:first").css("table-layout", "fixed"), e.each(e.merge(["name"], D), function (e, t) { var i = H[t] || n.find("td.elfinder-col-" + t).width(); n.find("td.elfinder-col-" + t).width(i) })) } }, ve = Object.assign({}, t.droppable, { over: function (n, i) { var a, o, r, s = e(this), l = i.helper, c = n.shiftKey || n.ctrlKey || n.metaKey; n.stopPropagation(), l.data("dropover", l.data("dropover") + 1), s.data("dropover", !0), l.removeClass("elfinder-drag-helper-move elfinder-drag-helper-plus"), l.data("namespace") === t.namespace && t.insideWorkzone(n.pageX, n.pageY) ? (s.hasClass(t.res(g, "cwdfile")) ? (a = t.cwdId2Hash(s.attr("id")), s.data("dropover", a)) : (a = t.cwd().hash, t.cwd().write && s.data("dropover", a)), r = t.file(l.data("files")[0]).phash === a, s.data("dropover") === a ? e.each(l.data("files"), function (e, t) { if (t === a || r && !c && !l.hasClass("elfinder-drag-helper-plus")) return s.removeClass(T), !1 }) : s.removeClass(T), l.data("locked") || r ? o = "elfinder-drag-helper-plus" : (o = "elfinder-drag-helper-move", c && (o += " elfinder-drag-helper-plus")), s.hasClass(T) && l.addClass(o), requestAnimationFrame(function () { s.hasClass(T) && l.addClass(o) })) : s.removeClass(T) }, out: function (t, n) { var i = n.helper; t.stopPropagation(), i.removeClass("elfinder-drag-helper-move elfinder-drag-helper-plus").data("dropover", Math.max(i.data("dropover") - 1, 0)), e(this).removeData("dropover").removeClass(T) }, deactivate: function () { e(this).removeData("dropover").removeClass(T) }, drop: function (e, n) { Z({ notrigger: !0 }), t.droppable.drop.call(this, e, n) } }), be = function (n) { var i = (n = n || (p ? Se.find("tbody") : Se)).children(".directory:not(." + k + ",.elfinder-na,.elfinder-ro)"); t.isCommandEnabled("paste") && i.droppable(ve), t.isCommandEnabled("upload") && i.addClass("native-droppable"), n.children(".isroot").each(function (n, i) { var a = e(i), o = t.cwdId2Hash(i.id); t.isCommandEnabled("paste", o) ? a.hasClass(k + ",elfinder-na,elfinder-ro") || a.droppable(ve) : a.hasClass(k) && a.droppable("destroy"), t.isCommandEnabled("upload", o) ? a.hasClass("native-droppable,elfinder-na,elfinder-ro") || a.addClass("native-droppable") : a.hasClass("native-droppable") && a.removeClass("native-droppable") }) }, ye = function (n, i) { e.isPlainObject(n) && Object.keys(n).length && (Object.assign(ae.attachTmbs, n), e.each(n, function (n, a) { var o, r, s = t.cwdHash2Elm(n); s.length && ("1" != a ? ((o = t.file(n)).tmb !== a && (o.tmb = a), r = t.tmb(o), i ? s.find(".elfinder-cwd-icon").addClass(r.className).css("background-image", "url('" + r.url + "')") : function (t, n) { n.url = commonUrl.media.url + n.url, e("<img/>").on("load", function () { t.find(".elfinder-cwd-icon").addClass(n.className).css("background-image", "url('" + n.url + "')") }).attr("src", n.url) }(s, r), delete ae.attachTmbs[n]) : i ? we([n]) : ae.tmbLoading[n] || ae.getTmbs.push(n)) }), i || !ae.getTmbs.length || Object.keys(ae.tmbLoading).length || we()) }, we = function (n) { var i = [], a = !1; t.oldAPI ? t.request({ data: { cmd: "tmb", current: t.cwd().hash }, preventFail: !0 }).done(function (e) { e.images && Object.keys(e.images).length && ye(e.images), e.tmb && we() }) : (n ? (a = !0, i = n.splice(0, O)) : i = ae.getTmbs.splice(0, O), i.length && (a || le[i[0]] || le[i[i.length - 1]]) && (e.each(i, function (e, t) { ae.tmbLoading[t] = !0 }), t.request({ data: { cmd: "tmb", targets: i }, preventFail: !0 }).done(function (t) { var o, r = []; t.images && ((o = Object.keys(t.images).length) ? (o < i.length && e.each(i, function (e, n) { t.images[n] || r.push(n) }), ye(t.images, a)) : r = i, r.length && e.each(r, function (e, t) { delete ae.attachTmbs[t] })), a && n.length && we(n) }).always(function () { ae.tmbLoading = {}, !a && ae.getTmbs.length && we() }))) }, xe = function (n, i) { var a, o, r, s, l, c, u = p ? Se.find("tbody") : Se, h = n.length, f = {}, m = function (e) { for (var n, i = Se.find("[id]:first"); i.length;) { if (n = t.file(t.cwdId2Hash(i.attr("id"))), !i.hasClass("elfinder-cwd-parent") && n && t.compare(e, n) < 0) return i; i = i.next("[id]") } }, g = function (e) { var n, i = ie.length; for (n = 0; n < i; n++)if (t.compare(e, ie[n]) < 0) return n; return i || -1 }, v = !!e.htmlPrefilter, b = e(v ? document.createDocumentFragment() : "<div></div>"); if (h > pe) Oe(), J = t.arrayFlip(e.map(n, function (e) { return e.hash }), !0), te(); else { for (h && Ue.removeClass("elfinder-cwd-wrapper-empty"), c = "self" === t.option("tmbUrl"); h--;)o = (a = n[h]).hash, t.cwdHash2Elm(o).length || ((r = m(a)) && !r.length && (r = null), !r && (l = g(a)) >= 0 ? ie.splice(l, 0, a) : (b.empty().append(V(a)), "directory" === a.mime && !d && be(b), s = v ? b : b.children(), r ? r.before(s) : u.append(s), ++ae.renderd), t.cwdHash2Elm(o).length && (a.tmb && (1 != a.tmb || a.size > 0) || c && 0 === a.mime.indexOf("image/")) && (f[o] = a.tmb || "self")); p && (ge(), me({ fitWidth: !H })), Ce(u), Object.keys(f).length && (Object.assign(ae.attachTmbs, f), ie.length < 1 && we()) } }, ke = function (n) { var i, a, o, r, s = n.length, l = t.searchStatus.state > 1, c = t.getCommand(t.currentReqCmd) || {}; if (!t.cwd().hash && !c.noChangeDirOnRemovedCwd) return e.each(M.reverse(), function (e, n) { if (t.file(n)) return r = !0, t.one(t.currentReqCmd + "done", function () { !t.cwd().hash && t.exec("open", n) }), !1 }), void (!r && !t.cwd().hash && t.exec("open", t.roots[Object.keys(t.roots)[0]])); for (; s--;) { if (i = n[s], (a = t.cwdHash2Elm(i)).length) try { a.remove(), --ae.renderd } catch (e) { t.debug("error", e) } else -1 !== (o = oe(i)) && ie.splice(o, 1); J[i] && delete J[i], l && -1 !== (o = e.inArray(i, E)) && E.splice(o, 1) } l && t.trigger("cwdhasheschange", E), p && (ge(), me({ fitWidth: !H })) }, Ce = function (e, n) { var i, a = e || (p ? Se.find("tbody") : Se), o = He[t.viewType], r = 1; ie.length > 0 && (ae.hpi ? p || (r = Math.floor(a.width() / o.width)) : (!function (e) { var t; e.height || (t = (p ? Se.find("tbody") : Se).find(p ? "tr:first" : "[id]:first"), e.height = t.outerHeight(!0), p || (e.width = t.outerWidth(!0))) }(o), p ? ae.row = ae.hpi = o.height : (r = Math.floor(a.width() / o.width), ae.row = o.height, ae.hpi = ae.row / r)), i = Math.ceil((ie.length + (n || 0)) / r), p && he && ++i, Me.css({ top: ae.row * i + "px" }).show()) }, ze = function (e) { e.preventDefault(), void 0 === Se.data("longtap") ? t.trigger("contextmenu", { type: "cwd", targets: [t.cwd().hash], x: e.pageX, y: e.pageY }) : e.stopPropagation() }, Te = function (e) { e.originalEvent.touches.length > 1 || (!1 !== Se.data("longtap") && (Ie.data("touching", { x: e.originalEvent.touches[0].pageX, y: e.originalEvent.touches[0].pageY }), Se.data("tmlongtap", setTimeout(function () { Se.data("longtap", !0), t.trigger("contextmenu", { type: "cwd", targets: [t.cwd().hash], x: Ie.data("touching").x, y: Ie.data("touching").y }) }, 500))), Se.data("longtap", null)) }, Ae = function (e) { "touchmove" === e.type ? (!Ie.data("touching") || Math.abs(Ie.data("touching").x - e.originalEvent.touches[0].pageX) + Math.abs(Ie.data("touching").y - e.originalEvent.touches[0].pageY) > 4) && Ie.data("touching", null) : setTimeout(function () { Se.removeData("longtap") }, 80), clearTimeout(Se.data("tmlongtap")) }, je = function (e) { Se.data("longtap") && (e.preventDefault(), e.stopPropagation()) }, Oe = function () { t.lazy(function () { var n; Ue.append(Ee).removeClass("elfinder-cwd-wrapper-empty elfinder-search-result elfinder-incsearch-result elfinder-letsearch-result"), (t.searchStatus.state > 1 || t.searchStatus.ininc) && Ue.addClass("elfinder-search-result" + (t.searchStatus.ininc ? " elfinder-" + ("/" === S.substr(0, 1) ? "let" : "inc") + "search-result" : "")), ae.attachThumbJob && ae.attachThumbJob._abort(), Se.data("selectable") && Se.selectable("disable").selectable("destroy").removeData("selectable"), t.trigger("cwdinit"), K = e(); try { Se.empty() } catch (e) { Se.html("") } he && (Ie.off("scroll.fixheader resize.fixheader"), he.remove(), he = null), Se.removeClass("elfinder-cwd-view-icons elfinder-cwd-view-list").addClass("elfinder-cwd-view-" + (p ? "list" : "icons")).attr("style", "").css("height", "auto"), Me.hide(), Ie[p ? "addClass" : "removeClass"]("elfinder-cwd-wrapper-list")._padding = parseInt(Ie.css("padding-top")) + parseInt(Ie.css("padding-bottom")), t.UA.iOS && Ie.removeClass("overflow-scrolling-touch").addClass("overflow-scrolling-touch"), p && (Se.html("<table><thead></thead><tbody></tbody></table>"), n = e('<tr class="ui-state-default"><td class="elfinder-cwd-view-th-name">' + t.getColumnName("name") + "</td>" + function () { for (var e = "", n = "", i = 0; i < D.length; i++)e = t.getColumnName(D[i]), n += '<td class="elfinder-cwd-view-th-' + D[i] + ' sortable-item">' + e + "</td>"; return n }() + "</tr>"), Se.find("thead").hide().append(n).find("td:first").append(Ee), e.fn.sortable && n.addClass("touch-punch touch-punch-keep-default").sortable({ axis: "x", distance: 8, items: "> .sortable-item", start: function (t, n) { e(n.item[0]).data("dragging", !0), n.placeholder.width(n.helper.removeClass("ui-state-hover").width()).removeClass("ui-state-active").addClass("ui-state-hover").css("visibility", "visible") }, update: function (n, i) { var a, o, r = e(i.item[0]).attr("class").split(" ")[0].replace("elfinder-cwd-view-th-", ""); D = e.map(e(this).children(), function (t) { var n = e(t).attr("class").split(" ")[0].replace("elfinder-cwd-view-th-", ""); return o || (r === n ? o = !0 : a = n), "name" === n ? null : n }), _.row = P(), t.storage("cwdCols", D), a = ".elfinder-col-" + a + ":first", r = ".elfinder-col-" + r + ":first", t.lazy(function () { Se.find("tbody tr").each(function () { var t = e(this); t.children(a).after(t.children(r)) }) }) }, stop: function (t, n) { setTimeout(function () { e(n.item[0]).removeData("dragging") }, 100) } }), n.find("td").addClass("touch-punch").resizable({ handles: "ltr" === t.direction ? "e" : "w", start: function (t, n) { var i = Se.find("td.elfinder-col-" + n.element.attr("class").split(" ")[0].replace("elfinder-cwd-view-th-", "") + ":first"); n.element.data("dragging", !0).data("resizeTarget", i).data("targetWidth", i.width()), R = !0, "fixed" !== Se.find("table").css("table-layout") && (Se.find("tbody tr:first td").each(function () { e(this).width(e(this).width()) }), Se.find("table").css("table-layout", "fixed")) }, resize: function (e, t) { t.element.data("resizeTarget").width(t.element.data("targetWidth") - (t.originalSize.width - t.size.width)) }, stop: function (n, i) { R = !1, me({ fitWidth: !0 }), H = {}, Se.find("tbody tr:first td").each(function () { var t = e(this).attr("class").split(" ")[0].replace("elfinder-col-", ""); H[t] = e(this).width() }), t.storage("cwdColWidth", H), setTimeout(function () { i.element.removeData("dragging") }, 100) } }).find(".ui-resizable-handle").addClass("ui-icon ui-icon-grip-dotted-vertical")), ie = e.map(F || E, function (e) { return t.file(e) || null }), ie = t.sortFiles(ie), F ? F = e.map(ie, function (e) { return e.hash }) : E = e.map(ie, function (e) { return e.hash }), ae = { renderd: 0, attachTmbs: {}, getTmbs: [], tmbLoading: {}, lazyOpts: { tm: 0 } }, Ue[ie.length < 1 ? "addClass" : "removeClass"]("elfinder-cwd-wrapper-empty"), Ie.off("elfscrstop", ue).on("elfscrstop", ue).trigger("elfscrstop"), t.cwd().write ? (Ie[t.isCommandEnabled("upload") ? "addClass" : "removeClass"]("native-droppable"), Ie.droppable(t.isCommandEnabled("paste") ? "enable" : "disable")) : Ie.removeClass("native-droppable").droppable("disable").removeClass("ui-state-disabled") }) }, Se = e(this).addClass("ui-helper-clearfix elfinder-cwd").attr("unselectable", "on").on("click." + t.namespace, b, function (n) { var i, a, o, r, s, l = this.id ? e(this) : e(this).parents("[id]:first"), c = e(n.target); if (q && (c.is("input:checkbox." + j) || c.hasClass("elfinder-cwd-select"))) return n.stopPropagation(), n.preventDefault(), l.trigger(l.hasClass(y) ? h : u), te(), void requestAnimationFrame(function () { c.prop("checked", l.hasClass(y)) }); if (Se.data("longtap") || c.hasClass("elfinder-cwd-nonselect")) n.stopPropagation(); else { if (U || (U = l.attr("id"), setTimeout(function () { U = "" }, 500)), n.shiftKey && (i = l.prevAll(ee || ".ui-selected:first"), a = l.nextAll(ee || ".ui-selected:first"), o = i.length, r = a.length), n.shiftKey && (o || r)) s = (s = o ? l.prevUntil("#" + i.attr("id")) : l.nextUntil("#" + a.attr("id"))).add(l), o || (s = e(s.get().reverse())), s.trigger(u); else if (n.ctrlKey || n.metaKey) l.trigger(l.hasClass(y) ? h : u); else { if (Ie.data("touching") && l.hasClass(y)) return Ie.data("touching", null), void t.dblclick({ file: t.cwdId2Hash(this.id) }); Z({ notrigger: !0 }), l.trigger(u) } te() } }).on("dblclick." + t.namespace, b, function (n) { if (U) { var i = t.cwdId2Hash(U); n.stopPropagation(), this.id !== U && (e(this).trigger(h), e("#" + U).trigger(u), te()), t.dblclick({ file: i }) } }).on("touchstart." + t.namespace, b, function (n) { if (!(n.originalEvent.touches.length > 1)) { var i = this.id ? e(this) : e(this).parents("[id]:first"), a = e(n.target), o = n.target.nodeName; if ("INPUT" === o && "text" === n.target.type || "TEXTAREA" === o || a.hasClass("elfinder-cwd-nonselect")) n.stopPropagation(); else { if (i.find("input:text,textarea").length) return n.stopPropagation(), void n.preventDefault(); Ie.data("touching", { x: n.originalEvent.touches[0].pageX, y: n.originalEvent.touches[0].pageY }), q && (a.is("input:checkbox." + j) || a.hasClass("elfinder-cwd-select")) || (i.prevAll(".ui-selected:first").length + i.nextAll(".ui-selected:first").length, Se.data("longtap", null), (Object.keys(J).length || p && "TD" !== n.target.nodeName || !p && this !== n.target) && (Se.data("longtap", !1), i.addClass(C), i.data("tmlongtap", setTimeout(function () { Se.data("longtap", !0), i.trigger(u), te(), t.trigger("contextmenu", { type: "files", targets: t.selected(), x: n.originalEvent.touches[0].pageX, y: n.originalEvent.touches[0].pageY }) }, 500)))) } } }).on("touchmove." + t.namespace + " touchend." + t.namespace, b, function (n) { var i, a = e(n.target); q && (a.is("input:checkbox." + j) || a.hasClass("elfinder-cwd-select")) || ("INPUT" != n.target.nodeName && "TEXTAREA" != n.target.nodeName ? (i = this.id ? e(this) : e(this).parents("[id]:first"), clearTimeout(i.data("tmlongtap")), "touchmove" === n.type ? (Ie.data("touching", null), i.removeClass(C)) : (Ie.data("touching") && !Se.data("longtap") && i.hasClass(y) && (n.preventDefault(), Ie.data("touching", null), t.dblclick({ file: t.cwdId2Hash(this.id) })), setTimeout(function () { Se.removeData("longtap") }, 80))) : n.stopPropagation()) }).on("mouseenter." + t.namespace, b, function (i) { if (!re) { var a = e(this), o = null; if (!(d || a.data("dragRegisted") || a.hasClass(A) || a.hasClass(x) || a.hasClass(w))) { if (a.data("dragRegisted", !0), !t.isCommandEnabled("copy", t.searchStatus.state > 1 || a.hasClass("isroot") ? t.cwdId2Hash(a.attr("id")) : void 0)) return; a.on("mousedown", function (i) { var o = n.metakeyDragout && !t.UA.IE && (i.shiftKey || i.altKey), r = !1; o && Se.data("selectable") && (Se.selectable("disable").selectable("destroy").removeData("selectable"), requestAnimationFrame(function () { Se.selectable(se).selectable("option", { disabled: !1 }).selectable("refresh").data("selectable", !0) })), a.removeClass("ui-state-disabled"), o ? a.draggable("option", "disabled", !0).attr("draggable", "true") : (a.hasClass(y) || (r = p ? e(i.target).closest("span,tr").is("tr") : e(i.target).hasClass("elfinder-cwd-file")), r ? a.draggable("option", "disabled", !0).removeClass("ui-state-disabled") : a.draggable("option", "disabled", !1).removeAttr("draggable").draggable("option", "cursorAt", { left: 50 - parseInt(e(i.currentTarget).css("margin-left")), top: 47 })) }).on("dragstart", function (n) { var i = n.dataTransfer || n.originalEvent.dataTransfer || null; if (o = null, i && !t.UA.IE) { var a, r = this.id ? e(this) : e(this).parents("[id]:first"), s = e("<span>"), l = "", c = null, d = null, p = [], h = function (n) { var i, a = n.mime, o = t.tmb(n); return i = '<div class="elfinder-cwd-icon elfinder-cwd-icon-drag ' + t.mime2class(a) + ' ui-corner-all"></div>', o && (i = e(i).addClass(o.className).css("background-image", "url('" + o.url + "')").get(0).outerHTML), i }, f = []; if (r.trigger(u), te(), e.each(J, function (n) { var i = t.file(n), a = i.url; if (i && "directory" !== i.mime) { if (a) { if ("1" == a) return f.push(n), !0 } else a = t.url(i.hash); a && (a = t.convAbsUrl(a), p.push(n), e("<a>").attr("href", a).text(a).appendTo(s), l += a + "\n", c || (c = i.mime + ":" + i.name + ":" + a), d || (d = a + "\n" + i.name)) } }), f.length) return e.each(f, function (e, n) { var i = t.file(n); i.url = "", t.request({ data: { cmd: "url", target: n }, notify: { type: "url", cnt: 1 }, preventDefault: !0 }).always(function (e) { i.url = e.url ? e.url : "1" }) }), !1; if (!l) return !1; i.setDragImage && (o = e('<div class="elfinder-drag-helper html5-native"></div>').append(h(t.file(p[0]))).appendTo(e(document.body)), (a = p.length) > 1 && o.append(h(t.file(p[a - 1])) + '<span class="elfinder-drag-num">' + a + "</span>"), i.setDragImage(o.get(0), 50, 47)), i.effectAllowed = "copyLink", i.setData("DownloadURL", c), i.setData("text/x-moz-url", d), i.setData("text/uri-list", l), i.setData("text/plain", l), i.setData("text/html", s.html()), i.setData("elfinderfrom", window.location.href + t.cwd().hash), i.setData("elfinderfrom:" + i.getData("elfinderfrom"), "") } }).on("dragend", function (e) { Z({ notrigger: !0 }), o && o.remove() }).draggable(t.draggable) } } }).on(u, b, function (n) { var i = e(this), a = t.cwdId2Hash(i.attr("id")); X || i.hasClass(w) || (ee = "#" + this.id, i.addClass(y).children().addClass(C).find("input:checkbox." + j).prop("checked", !0), J[a] || (J[a] = !0), K = Se.find("[id].ui-selected:last").next()) }).on(h, b, function (n) { var i = e(this), a = t.cwdId2Hash(i.attr("id")); X || (i.removeClass(y).children().removeClass(C).find("input:checkbox." + j).prop("checked", !1), Se.hasClass("elfinder-cwd-allselected") && (q && Ee.children("input").prop("checked", !1), Se.removeClass("elfinder-cwd-allselected")), J[a] && delete J[a]) }).on(f, b, function () { var t = e(this).removeClass(C + " " + y).addClass(w), n = t.children(), i = p ? t : n.find("div.elfinder-cwd-file-wrapper,div.elfinder-cwd-filename"); n.removeClass(C + " " + y), t.hasClass(k) && t.droppable("disable"), i.hasClass(x) && i.draggable("disable") }).on(m, b, function () { var t = e(this).removeClass(w), n = p ? t : t.children("div.elfinder-cwd-file-wrapper,div.elfinder-cwd-filename"); t.hasClass(k) && t.droppable("enable"), n.hasClass(x) && n.draggable("enable") }).on("scrolltoview", b, function (t, n) { ne(e(this), !n || void 0 === n.blink || n.blink) }).on("mouseenter." + t.namespace + " mouseleave." + t.namespace, b, function (n) { "mouseenter" === n.type && (re || t.UA.Mobile) || (t.trigger("hover", { hash: t.cwdId2Hash(e(this).attr("id")), type: n.type }), e(this).toggleClass(C, "mouseenter" == n.type)) }).on("mouseenter." + t.namespace + " mouseleave." + t.namespace, ".elfinder-cwd-file-wrapper,.elfinder-cwd-filename", function (t) { "mouseenter" === t.type && re || e(this).closest(b).children(".elfinder-cwd-file-wrapper,.elfinder-cwd-filename").toggleClass(z, "mouseenter" == t.type) }).on("contextmenu." + t.namespace, function (n) { var i = e(n.target).closest(b); (i.get(0) !== n.target || J[t.cwdId2Hash(i.get(0).id)]) && (i.find("input:text,textarea").length ? n.stopPropagation() : i.length && ("TD" != n.target.nodeName || J[t.cwdId2Hash(i.get(0).id)]) && (n.stopPropagation(), n.preventDefault(), i.hasClass(w) || Ie.data("touching") || (i.hasClass(y) || (Z({ notrigger: !0 }), i.trigger(u), te()), t.trigger("contextmenu", { type: "files", targets: t.selected(), x: n.pageX, y: n.pageY })))) }).on("click." + t.namespace, function (e) { e.target !== this || Se.data("longtap") || !e.shiftKey && !e.ctrlKey && !e.metaKey && Z() }).on("create." + t.namespace, function (n, i) { var a = p ? Se.find("tbody") : Se, o = a.find(".elfinder-cwd-parent"), r = i.move || !1, s = e(V(i)).addClass(A), l = t.selected(); l.length ? r && t.trigger("lockfiles", { files: l }) : Z(), o.length ? o.after(s) : a.prepend(s), ge(), Ie.scrollTop(0).scrollLeft(0) }).on("unselectall", Z).on("selectfile", function (e, n) { t.cwdHash2Elm(n).trigger(u), te() }).on("colwidth", function () { p && (Se.find("table").css("table-layout", "").find("td").css("width", ""), me({ fitWidth: !0 }), t.storage("cwdColWidth", H = null)) }).on("iconpref", function (e, t) { Se.removeClass(function (e, t) { return (t.match(/\belfinder-cwd-size\S+/g) || []).join(" ") }), s = t && parseInt(t.size) || 0, p || (s > 0 && Se.addClass("elfinder-cwd-size" + s), ae.renderd && requestAnimationFrame(function () { He.icons = {}, ae.hpi = null, Ce(Se, ae.renderd), ce() })) }).on("onwheel" in document ? "wheel" : "mousewheel", function (e) { var i, a; !p && (e.ctrlKey && !e.metaKey || !e.ctrlKey && e.metaKey) && (e.stopPropagation(), e.preventDefault(), void 0 !== (i = Se.data("wheelTm")) ? (clearTimeout(i), Se.data("wheelTm", setTimeout(function () { Se.removeData("wheelTm") }, 200))) : (Se.data("wheelTm", !1), a = s || 0, (e.originalEvent.deltaY ? e.originalEvent.deltaY : -e.originalEvent.wheelDelta) > 0 ? s > 0 && (a = s - 1) : s < n.iconsView.sizeMax && (a = s + 1), a !== s && (t.storage("iconsize", a), Se.trigger("iconpref", { size: a })))) }), Ie = e('<div class="elfinder-cwd-wrapper"></div>').droppable(Object.assign({}, ve, { autoDisable: !1 })).on("contextmenu." + t.namespace, ze).on("touchstart." + t.namespace, Te).on("touchmove." + t.namespace + " touchend." + t.namespace, Ae).on("click." + t.namespace, je).on("scroll." + t.namespace, function () { re || (Se.data("selectable") && Se.selectable("disable"), Ie.trigger("elfscrstart")), re = !0, ae.scrtm && cancelAnimationFrame(ae.scrtm), ae.scrtm && Math.abs((ae.scrolltop || 0) - (ae.scrolltop = this.scrollTop || e(this).scrollTop())) < 5 && (ae.scrtm = 0, Ie.trigger("elfscrstop")), ae.scrtm = requestAnimationFrame(function () { ae.scrtm = 0, Ie.trigger("elfscrstop") }) }).on("elfscrstop", function () { re = !1, ce() }), Me = e("<div>&nbsp;</div>").css({ position: "absolute", width: "1px", height: "1px" }).hide(), Ee = q ? e('<div class="elfinder-cwd-selectall"><input type="checkbox"/></div>').attr("title", t.i18n("selectall")).on("click", function (t) { if (t.stopPropagation(), t.preventDefault(), e(this).data("pending")) return !1; Ee.data("pending", !0), Se.hasClass("elfinder-cwd-allselected") ? (Ee.find("input").prop("checked", !1), requestAnimationFrame(function () { Z() })) : Q() }) : e(), Fe = null, De = function (t) { var n = function () { if (void 0 !== ae.renderd) { var t = 0; Ie.siblings("div.elfinder-panel:visible").each(function () { t += e(this).outerHeight(!0) }), Ie.height(Ue.height() - t - Ie._padding) } }; t && n(), Fe && cancelAnimationFrame(Fe), Fe = requestAnimationFrame(function () { var e; !t && n(), Se.css("height", "auto"), e = Ie[0].clientHeight - parseInt(Ie.css("padding-top")) - parseInt(Ie.css("padding-bottom")) - parseInt(Se.css("margin-top")), Se.outerHeight(!0) < e && Se.height(e) }), p && !R && (t ? Ie.trigger("resize.fixheader") : me()), ce() }, Ue = e(this).parent().on("resize", De).children(".elfinder-workzone").append(Ie.append(this).append(Me)), Pe = e('<div class="elfinder-cwd-message-board"></div>').insertAfter(Se), qe = e('<div class="elfinder-cwd-expires" ></div>'), Re = function () { var e, n, i; o && clearTimeout(o), l && t.volumeExpires[l] && (i = (n = t.volumeExpires[l] - +new Date / 1e3) % 60 + .1, e = Math.floor(n / 60), qe.html(t.i18n(["minsLeft", e])).show(), e && (o = setTimeout(Re, 1e3 * i))) }, He = { icons: {}, list: {} }; t.UA.ltIE10 || Pe.append(e('<div class="elfinder-cwd-trash" ></div>').html(t.i18n("volume_Trash"))).append(qe), B = Object.assign(B, n.replacement || {}); try { H = t.storage("cwdColWidth") ? t.storage("cwdColWidth") : null } catch (e) { H = null } t.bind("columnpref", function (i) { var a = i.data || {}; (D = t.storage("cwdCols")) ? (D = e.grep(D, function (e) { return -1 !== n.listView.columns.indexOf(e) }), n.listView.columns.length > D.length && e.each(n.listView.columns, function (e, t) { -1 === D.indexOf(t) && D.push(t) })) : D = n.listView.columns; var o = t.storage("columnhides") || null; o && Object.keys(o).length && (D = e.grep(D, function (e) { return !o[e] })), _.row = P(), p && a.repaint && Oe() }).trigger("columnpref"), d && e("body").on("touchstart touchmove touchend", function (e) { }), q && Se.addClass("elfinder-has-checkbox"), e(window).on("scroll." + t.namespace, function () { c && cancelAnimationFrame(c), c = requestAnimationFrame(function () { Ie.trigger("elfscrstop") }) }), e(document).on("keydown." + t.namespace, function (n) { n.keyCode == e.ui.keyCode.ESCAPE && (t.getUI().find(".ui-widget:visible").length || Z()) }), t.one("init", function () { var i, a, o, s, l = document.createElement("style"), c = 0; document.head && (document.head.appendChild(l), (i = l.sheet).insertRule('.elfinder-cwd-wrapper-empty .elfinder-cwd:not(.elfinder-table-header-sticky):after{ content:"' + t.i18n("emptyFolder") + '" }', c++), i.insertRule('.elfinder-cwd-wrapper-empty .native-droppable .elfinder-cwd:not(.elfinder-table-header-sticky):after{ content:"' + t.i18n("emptyFolder" + (d ? "LTap" : "Drop")) + '" }', c++), i.insertRule('.elfinder-cwd-wrapper-empty .ui-droppable-disabled .elfinder-cwd:not(.elfinder-table-header-sticky):after{ content:"' + t.i18n("emptyFolder") + '" }', c++), i.insertRule('.elfinder-cwd-wrapper-empty.elfinder-search-result .elfinder-cwd:not(.elfinder-table-header-sticky):after{ content:"' + t.i18n("emptySearch") + '" }', c++), i.insertRule('.elfinder-cwd-wrapper-empty.elfinder-search-result.elfinder-incsearch-result .elfinder-cwd:not(.elfinder-table-header-sticky):after{ content:"' + t.i18n("emptyIncSearch") + '" }', c++), i.insertRule('.elfinder-cwd-wrapper-empty.elfinder-search-result.elfinder-letsearch-result .elfinder-cwd:not(.elfinder-table-header-sticky):after{ content:"' + t.i18n("emptyLetSearch") + '" }', c++)), (s = t.storage("iconsize") || n.iconsView.size || 0) && (s = Math.min(s, n.iconsView.sizeMax), Se.trigger("iconpref", { size: s })), d || (t.one("open", function () { i && t.zIndex && i.insertRule(".ui-selectable-helper{z-index:" + t.zIndex + ";}", c++) }), o = e('<div style="position:absolute"></div>'), (a = t.getUI()).on("resize", function (e, t) { var n; e.preventDefault(), e.stopPropagation(), t && t.fullscreen && (n = a.offset(), "on" === t.fullscreen ? (o.css({ top: -1 * n.top, left: -1 * n.left }).appendTo(a), se.appendTo = o) : (o.detach(), se.appendTo = "body"), Se.data("selectable") && Se.selectable("option", { appendTo: se.appendTo })) })), r = t.getUI("tree").length }).bind("enable", function () { De() }).bind("request.open", function () { ae.getTmbs = [] }).one("open", function () { t.maxTargets && (O = Math.min(t.maxTargets, O)) }).bind("open add remove searchend", function () { var n, i = t.cwd().hash, a = this.type; if (("open" === a || "searchend" === a || t.searchStatus.state < 2) && (E = e.map(t.files(i), function (e) { return e.hash }), t.trigger("cwdhasheschange", E)), "open" === a) { var o = i && (!t.file(i) || r) ? r ? (n = e.Deferred(), t.one("treesync", function (e) { e.data.always(function () { n.resolve() }) }), n) : t.request({ data: { cmd: "parents", target: t.cwd().hash }, preventFail: !0 }) : null, s = t.cwd(); s.volumeid !== l && (qe.empty().hide(), l && Ie.removeClass("elfinder-cwd-wrapper-" + l), l = s.volumeid, Re(), Ie.addClass("elfinder-cwd-wrapper-" + l)), e.when(o).done(function () { var n; M = t.parents(s.hash), Ie[(n = !1, e.each(M, function (e, i) { if (t.trashes[i]) return n = !0, !1 }), n ? "addClass" : "removeClass")]("elfinder-cwd-wrapper-trash") }), F = void 0, Z({ notrigger: !0 }), Oe() } }).bind("search", function (n) { E = e.map(n.data.files, function (e) { return e.hash }), t.trigger("cwdhasheschange", E), F = void 0, t.searchStatus.ininc = !1, Oe(), t.autoSync("stop") }).bind("searchend", function (e) { (S || F) && (S = "", F ? t.trigger("incsearchend", e.data) : e.data && e.data.noupdate || Oe()), t.autoSync() }).bind("searchstart", function (e) { Z(), S = e.data.query }).bind("incsearchstart", function (n) { var i = n.data.query || "", a = n.data.type || "SearchName", o = t.options.commandsOptions.search.searchTypes || {}; (o[a] && o[a].incsearch || "SearchName" === a) && (J = {}, t.lazy(function () { var n, r, s = ""; if (S = i, i) { if ("/" === i.substr(0, 1) && (i = i.substr(1), s = "^"), n = new RegExp(s + i.replace(/([\\*\;\.\?\[\]\{\}\(\)\^\$\-\|])/g, "\\$1"), "i"), "SearchName" === a) F = e.grep(E, function (e) { var i = t.file(e); return !(!i || !(i.name.match(n) || i.i18 && i.i18.match(n))) }); else if ("string" == typeof (r = o[a].incsearch)) F = e.grep(E, function (e) { var i = t.file(e); return !!(i && i[r] && (i[r] + "").match(n)) }); else if ("function" == typeof r) try { F = e.grep(r({ val: i, regex: n }, E, t), function (e) { return !!t.file(e) }) } catch (e) { F = [] } t.trigger("incsearch", { hashes: F, query: i }).searchStatus.ininc = !0, Oe(), t.autoSync("stop") } else t.trigger("incsearchend") })) }).bind("incsearchend", function (e) { S = "", t.searchStatus.ininc = !1, F = void 0, e.data && e.data.noupdate || Oe(), t.autoSync() }).bind("sortchange", function () { var e = Ie.scrollLeft(), n = Se.hasClass("elfinder-cwd-allselected"); Oe(), t.one("cwdrender", function () { Ie.scrollLeft(e), n && (J = t.arrayFlip(F || E, !0)), (n || Object.keys(J).length) && te() }) }).bind("viewchange", function () { var e = "list" != t.viewType, n = Se.hasClass("elfinder-cwd-allselected"); e != p && (p = e, t.viewType = p ? "list" : "icons", s && t.one("cwdinit", function () { Se.trigger("iconpref", { size: s }) }), Oe(), De(), n && (Se.addClass("elfinder-cwd-allselected"), Ee.find("input").prop("checked", !0)), Object.keys(J).length && te()) }).bind("wzresize", function () { var e, n = p ? Se.find("tbody") : Se; De(!0), ae.hpi && Ce(n, n.find("[id]").length), e = Se.offset(), Ue.data("rectangle", Object.assign({ width: Ue.width(), height: Ue.height(), cwdEdge: "ltr" === t.direction ? e.left : e.left + Se.width() }, Ue.offset())), ae.itemH = (p ? n.find("tr:first") : n.find("[id]:first")).outerHeight(!0) }).bind("changeclipboard", function (t) { I = {}, t.data && t.data.clipboard && t.data.clipboard.length && e.each(t.data.clipboard, function (e, t) { t.cut && (I[t.hash] = !0) }) }).bind("resMixinMake", function () { ge() }).bind("tmbreload", function (t) { var n = {}, i = t.data && t.data.files ? t.data.files : null; e.each(i, function (e, t) { t.tmb && "1" != t.tmb && (n[t.hash] = t.tmb) }), Object.keys(n).length && ye(n, !0) }).add(function (n) { var i = S ? new RegExp(S.replace(/([\\*\;\.\?\[\]\{\}\(\)\^\$\-\|])/g, "\\$1"), "i") : null, a = t.searchStatus.mime, o = t.searchStatus.state > 1, r = o && t.searchStatus.target ? t.searchStatus.target : t.cwd().hash, s = t.path(r), l = e.grep(n.data.added || [], function (n) { return !!function (n) { var l, c; return !(l = n.phash === r) && o && (c = n.path || t.path(n.hash), !(l = s && 0 === c.indexOf(s)) && t.searchStatus.mixed && (l = !!e.grep(t.searchStatus.mixed, function (e) { return 0 === n.hash.indexOf(e) }).length)), l && o && (l = a ? 0 === n.mime.indexOf(a) : !!(n.name.match(i) || n.i18 && n.i18.match(i))), l }(n) }); xe(l), 2 === t.searchStatus.state && (e.each(l, function (t, n) { -1 === e.inArray(n.hash, E) && E.push(n.hash) }), t.trigger("cwdhasheschange", E)), p && De(), Ie.trigger("elfscrstop") }).change(function (n) { var i, a = t.cwd().hash, o = t.selected(); S ? e.each(n.data.changed || [], function (n, a) { t.cwdHash2Elm(a.hash).length && (ke([a.hash]), xe([a]), -1 !== e.inArray(a.hash, o) && G(a.hash), i = !0) }) : e.each(e.grep(n.data.changed || [], function (e) { return e.phash == a }), function (n, a) { t.cwdHash2Elm(a.hash).length && (ke([a.hash]), xe([a]), -1 !== e.inArray(a.hash, o) && G(a.hash), i = !0) }), i && (t.trigger("cwdhasheschange", E), p && De(), Ie.trigger("elfscrstop")), te() }).remove(function (e) { var t = p ? Se.find("tbody") : Se; ke(e.data.removed || []), te(), ie.length < 1 && t.children(b + (n.oldSchool ? ":not(.elfinder-cwd-parent)" : "")).length < 1 ? (Ue.addClass("elfinder-cwd-wrapper-empty"), q && Ee.find("input").prop("checked", !1), Me.hide(), Ie.off("elfscrstop", ue), De()) : (Ce(t), Ie.trigger("elfscrstop")) }).dragstart(function (t) { var n = e(t.data.target), i = t.data.originalEvent; n.hasClass(v) && (n.hasClass(y) || (!(i.ctrlKey || i.metaKey || i.shiftKey) && Z({ notrigger: !0 }), n.trigger(u), te())), Se.removeClass(w).data("selectable") && Se.selectable("disable"), X = !0 }).dragstop(function () { Se.data("selectable") && Se.selectable("enable"), X = !1 }).bind("lockfiles unlockfiles selectfiles unselectfiles", function (n) { var i, a, o, r = { lockfiles: f, unlockfiles: m, selectfiles: u, unselectfiles: h }[n.type], s = n.data.files || [], l = s.length, c = n.data.helper || e(); if (l > 0 && (i = t.parents(s[0])), r !== u && r !== h || (o = r === u, e.each(s, function (e, t) { var n = Se.hasClass("elfinder-cwd-allselected"); J[t] ? (n && (q && Ee.children("input").prop("checked", !1), Se.removeClass("elfinder-cwd-allselected"), n = !1), !o && delete J[t]) : o && (J[t] = !0) })), !c.data("locked")) { for (; l--;)try { t.cwdHash2Elm(s[l]).trigger(r) } catch (n) { } !n.data.inselect && te() } Ie.data("dropover") && -1 !== i.indexOf(Ie.data("dropover")) && (a = "lockfiles" !== n.type, c.toggleClass("elfinder-drag-helper-plus", a), Ie.toggleClass(T, a)) }).bind("mkdir mkfile duplicate upload rename archive extract paste multiupload", function (n) { if ("upload" != n.type || !n.data._multiupload) { var i = t.cwd().hash; Z({ notrigger: !0 }), e.each((n.data.added || []).concat(n.data.changed || []), function (e, t) { t && t.phash == i && G(t.hash) }), te() } }).shortcut({ pattern: "ctrl+a", description: "selectall", callback: Q }).shortcut({ pattern: "ctrl+shift+i", description: "selectinvert", callback: function () { var n = {}; Y ? Z() : Object.keys(J).length ? (e.each(F || E, function (e, i) { var a = t.cwdHash2Elm(i); J[i] ? a.length && a.trigger(h) : (n[i] = !0, a.length && a.trigger(u)) }), J = n, te()) : Q() } }).shortcut({ pattern: "left right up down shift+left shift+right shift+up shift+down", description: "selectfiles", type: "keydown", callback: function (t) { !function (t, n) { var i, a, o, r, s, l = e.ui.keyCode, c = t == l.LEFT || t == l.UP, d = Se.find("[id].ui-selected"); function f(e, t) { return e[t + "All"]("[id]:not(." + w + "):not(.elfinder-cwd-parent):first") } if (d.length) if ((o = f(i = d.filter(c ? ":first" : ":last"), c ? "prev" : "next")).length) if (p || t == l.LEFT || t == l.RIGHT) a = o; else if (r = i.position().top, s = i.position().left, a = i, c) { do { a = a.prev("[id]") } while (a.length && !(a.position().top < r && a.position().left <= s)); a.hasClass(w) && (a = f(a, "next")) } else { do { a = a.next("[id]") } while (a.length && !(a.position().top > r && a.position().left >= s)); a.hasClass(w) && (a = f(a, "prev")), a.length || (o = Se.find("[id]:not(." + w + "):last")).position().top > r && (a = o) } else a = i; else a = K.length ? c ? K.prev() : K : Se.find("[id]:not(." + w + "):not(.elfinder-cwd-parent):" + (c ? "last" : "first")); a && a.length && !a.hasClass("elfinder-cwd-parent") && (i && n ? a = i.add(i[c ? "prevUntil" : "nextUntil"]("#" + a.attr("id"))).add(a) : d.trigger(h), a.trigger(u), ne(a.filter(c ? ":first" : ":last")), te()) }(t.keyCode, t.shiftKey) } }).shortcut({ pattern: "home", description: "selectffile", callback: function (e) { Z({ notrigger: !0 }), ne(Se.find("[id]:first").trigger(u)), te() } }).shortcut({ pattern: "end", description: "selectlfile", callback: function (e) { Z({ notrigger: !0 }), ne(Se.find("[id]:last").trigger(u)), te() } }).shortcut({ pattern: "page_up", description: "pageTurning", callback: function (e) { ae.itemH && Ie.scrollTop(Math.round(Ie.scrollTop() - Math.floor((Ie.height() + (p ? -1 * ae.itemH : 16)) / ae.itemH) * ae.itemH)) } }).shortcut({ pattern: "page_down", description: "pageTurning", callback: function (e) { ae.itemH && Ie.scrollTop(Math.round(Ie.scrollTop() + Math.floor((Ie.height() + (p ? -1 * ae.itemH : 16)) / ae.itemH) * ae.itemH)) } }) }), this }, e.fn.elfinderdialog = function (t, n) { var i, a, o, r, s, l = -1 != window.navigator.platform.indexOf("Win"), c = {}, d = { enabled: !1, width: !1, height: !1, defaultSize: null }, p = function (t) { var i, a; d.enabled && (a = n.options.dialogContained ? r : e(window), i = { maxWidth: d.width ? a.width() - c.width : null, maxHeight: d.height ? a.height() - c.height : null }, Object.assign(s, i), t.css(i).trigger("resize"), t.data("hasResizable") && (t.resizable("option", "maxWidth") < i.maxWidth || t.resizable("option", "maxHeight") < i.maxHeight) && t.resizable("option", i)) }, u = function (e) { var t = e.data; a && cancelAnimationFrame(a), a = requestAnimationFrame(function () { d.enabled && p(t) }) }, h = function () { var e = r.children(".elfinder-dialog." + n.res("class", "editing") + ":visible"); n[e.length ? "disable" : "enable"]() }; return n && n.ui ? r = n.getUI() : (r = this.closest(".elfinder"), n || (n = r.elfinder("instance"))), "string" == typeof t ? ((o = this.closest(".ui-dialog")).length && ("open" === t ? "none" === o.css("display") && (o.trigger("posinit").show().trigger("open").hide(), o.fadeIn(120, function () { n.trigger("dialogopened", { dialog: o }) })) : "close" === t || "destroy" === t ? (o.stop(!0), (o.is(":visible") || r.is(":hidden")) && (o.trigger("close"), n.trigger("dialogclosed", { dialog: o })), "destroy" === t ? (o.remove(), n.trigger("dialogremoved", { dialog: o })) : o.data("minimized") && o.data("minimized").close()) : "toTop" === t ? (o.trigger("totop"), n.trigger("dialogtotoped", { dialog: o })) : "posInit" === t ? (o.trigger("posinit"), n.trigger("dialogposinited", { dialog: o })) : "tabstopsInit" === t ? (o.trigger("tabstopsInit"), n.trigger("dialogtabstopsinited", { dialog: o })) : "checkEditing" === t && h()), this) : ((t = Object.assign({}, e.fn.elfinderdialog.defaults, t)).allowMinimize && "auto" === t.allowMinimize && (t.allowMinimize = !!this.find("textarea,input").length), t.openMaximized = t.allowMinimize && t.openMaximized, t.headerBtnPos && "auto" === t.headerBtnPos && (t.headerBtnPos = l ? "right" : "left"), t.headerBtnOrder && "auto" === t.headerBtnOrder && (t.headerBtnOrder = l ? "close:maximize:minimize" : "close:minimize:maximize"), t.modal && t.allowMinimize && (t.allowMinimize = !1), n.options.dialogContained ? d.width = d.height = d.enabled = !0 : (d.width = "window" === t.maxWidth, d.height = "window" === t.maxHeight, (d.width || d.height) && (d.enabled = !0)), i = n.arrayFlip(t.propagationEvents, !0), this.filter(":not(.ui-dialog-content)").each(function () { var a, o, f = e(this).addClass("ui-dialog-content ui-widget-content"), m = "elfinder-dialog", g = "ui-state-hover", v = "elfinder-tabstop", b = parseInt(1e6 * Math.random()), y = e('<div class="ui-dialog-titlebar ui-widget-header ui-corner-top ui-helper-clearfix"><span class="elfinder-dialog-title">' + t.title + "</span></div>"), w = e('<div class="ui-dialog-buttonset"></div>'), x = e('<div class=" ui-helper-clearfix ui-dialog-buttonpane ui-widget-content"></div>').append(w), k = 0, C = 0, z = e(), T = e('<div style="width:100%;height:100%;position:absolute;top:0px;left:0px;"></div>').hide(), A = function () { (z = S.find("." + v)).length && (z.attr("tabindex", "-1"), z.filter(".elfinder-focus").length || w.children("." + v + ":" + (l ? "first" : "last")).addClass("elfinder-focus")) }, j = function (t) { var n = z.filter(":visible:enabled"), i = t ? null : n.filter(".elfinder-focus:first"); return i && i.length || (i = n.first()), t && e.each(n, function (e, a) { if (a === t && n[e + 1]) return i = n.eq(e + 1), !1 }), i }, O = { close: function () { y.prepend(e('<span class="ui-widget-header ui-dialog-titlebar-close ui-corner-all elfinder-titlebar-button"><span class="ui-icon ui-icon-closethick"></span></span>').on("mousedown touchstart", function (e) { e.preventDefault(), e.stopPropagation(), f.elfinderdialog("close") })) }, maximize: function () { t.allowMaximize && (S.on("resize", function (e, t) { var n, i; if (e.preventDefault(), e.stopPropagation(), t && t.maximize) { if (i = y.find(".elfinder-titlebar-full"), n = "on" === t.maximize, i.children("span.ui-icon").toggleClass("ui-icon-plusthick", !n).toggleClass("ui-icon-arrowreturnthick-1-s", n), n) { try { S.hasClass("ui-draggable") && S.draggable("disable"), S.hasClass("ui-resizable") && S.resizable("disable") } catch (e) { } f.css("width", "100%").css("height", S.height() - S.children(".ui-dialog-titlebar").outerHeight(!0) - x.outerHeight(!0)) } else { f.attr("style", i.data("style")), i.removeData("style"), I(); try { S.hasClass("ui-draggable") && S.draggable("enable"), S.hasClass("ui-resizable") && S.resizable("enable") } catch (e) { } } S.trigger("resize", { init: !0 }) } }), y.prepend(e('<span class="ui-widget-header ui-corner-all elfinder-titlebar-button elfinder-titlebar-full"><span class="ui-icon ui-icon-plusthick"></span></span>').on("mousedown touchstart", function (i) { var a = e(this); i.preventDefault(), i.stopPropagation(), S.hasClass("elfinder-maximized") || void 0 !== a.data("style") || (f.height(f.height()), a.data("style", f.attr("style") || "")), n.toggleMaximize(S), "function" == typeof t.maximize && t.maximize.call(f[0]) }))) }, minimize: function () { var i, a, o; t.allowMinimize && (i = e('<span class="ui-widget-header ui-corner-all elfinder-titlebar-button elfinder-titlebar-minimize"><span class="ui-icon ui-icon-minusthick"></span></span>').on("mousedown touchstart", function (i) { var r = e(this), s = n.getUI("bottomtray"), l = { width: 70, height: 24 }, c = e("<div></div>").css(l).addClass(S.get(0).className + " elfinder-dialog-minimized"), d = function () { a.remove(), S.removeData("minimized").show(), f.elfinderdialog("close") }, p = {}; i.preventDefault(), i.stopPropagation(), S.data("minimized") ? (S.removeData("minimized").before(a.css(Object.assign({ position: "absolute" }, a.offset()))), n.toFront(a), a.animate(Object.assign({ width: S.width(), height: S.height() }, o), function () { S.show(), n.toFront(S), a.remove(), I(), h(), S.trigger("resize", { init: !0 }), "function" == typeof t.minimize && t.minimize.call(f[0]) })) : (o = S.data("minimized", { dialog: function () { return a }, show: function () { a.show() }, hide: function () { a.hide() }, close: d, title: function (e) { a.children(".ui-dialog-titlebar").children(".elfinder-dialog-title").text(e) } }).position(), a = S.clone().on("mousedown", function () { r.trigger("mousedown") }).removeClass("ui-draggable ui-resizable elfinder-frontmost"), s.append(c), Object.assign(p, c.offset(), l), c.remove(), a.height(S.height()).children(".ui-dialog-content:first").empty(), n.toHide(S.before(a)), a.children(".ui-dialog-content:first,.ui-dialog-buttonpane,.ui-resizable-handle").remove(), a.find(".elfinder-titlebar-minimize,.elfinder-titlebar-full").remove(), a.find(".ui-dialog-titlebar-close").on("mousedown", function (e) { e.stopPropagation(), e.preventDefault(), d() }), a.animate(p, function () { a.attr("style", "").css({ maxWidth: S.width() }).addClass("elfinder-dialog-minimized").appendTo(s), h(), "function" == typeof t.minimize && t.minimize.call(f[0]) })) }), y.on("dblclick", function (t) { e(this).children(".elfinder-titlebar-minimize").trigger("mousedown") }).prepend(i), S.on("togleminimize", function () { i.trigger("mousedown") })) } }, S = e('<div class="ui-front ui-dialog ui-widget ui-widget-content ui-corner-all ui-draggable std42-dialog touch-punch ' + m + " " + t.cssClass + '"></div>').hide().append(f).appendTo(r).draggable({ containment: n.options.dialogContained ? r : null, handle: ".ui-dialog-titlebar", start: function () { T.show() }, drag: function (e, t) { var i = t.offset.top, a = t.offset.left; i < 0 && (t.position.top = t.position.top - i), a < 0 && (t.position.left = t.position.left - a), n.options.dialogContained && (t.position.top < 0 && (t.position.top = 0), t.position.left < 0 && (t.position.left = 0)) }, stop: function (e, n) { T.hide(), S.css({ height: t.height }), f.data("draged", !0) } }).css({ width: t.width, height: t.height, minWidth: t.minWidth, minHeight: t.minHeight, maxWidth: t.maxWidth, maxHeight: t.maxHeight }).on("touchstart touchmove touchend click dblclick mouseup mouseenter mouseleave mouseout mouseover mousemove", function (e) { !i[e.type] && e.stopPropagation() }).on("mousedown", function (t) { !i[t.type] && t.stopPropagation(), requestAnimationFrame(function () { S.is(":visible") && !S.hasClass("elfinder-frontmost") && ((o = e(":focus")).length || (o = void 0), S.trigger("totop")) }) }).on("open", function () { S.data("margin-y", f.outerHeight(!0) - f.height()), d.enabled && (t.height && "auto" !== t.height && S.trigger("resize", { init: !0 }), d.defaultSize || (d.defaultSize = { width: f.width(), height: f.height() }), p(S), S.trigger("resize").trigger("posinit"), r.on("resize." + n.namespace, S, u)), S.hasClass("elfinder-dialog-notify") || r.children("." + m + ":visible:not(.elfinder-dialog-notify)").each(function () { var t = e(this), n = parseInt(t.css("top")), i = parseInt(t.css("left")), a = parseInt(S.css("top")), o = parseInt(S.css("left")), r = Math.abs(n - a) < 10, s = Math.abs(i - o) < 10; t[0] != S[0] && (r || s) && S.css({ top: r ? n + 10 : a, left: s ? i + 10 : o }) }), S.data("modal") && (S.addClass("elfinder-dialog-modal"), n.getUI("overlay").elfinderoverlay("show")), S.trigger("totop"), t.openMaximized && n.toggleMaximize(S), n.trigger("dialogopen", { dialog: S }), "function" == typeof t.open && e.proxy(t.open, f[0])(), t.closeOnEscape && e(document).on("keydown." + b, function (t) { t.keyCode == e.ui.keyCode.ESCAPE && S.hasClass("elfinder-frontmost") && f.elfinderdialog("close") }), S.hasClass(n.res("class", "editing")) && h() }).on("close", function (i) { var a; t.beforeclose && "function" == typeof t.beforeclose ? (a = t.beforeclose()) && a.promise || (a = a ? e.Deferred().resolve() : e.Deferred().reject()) : a = e.Deferred().resolve(), a.done(function () { d.enabled && r.off("resize." + n.namespace, u), t.closeOnEscape && e(document).off("keyup." + b), t.allowMaximize && n.toggleMaximize(S, !1), n.toHide(S), S.data("modal") && n.getUI("overlay").elfinderoverlay("hide"), "function" == typeof t.close && e.proxy(t.close, f[0])(), t.destroyOnClose && S.parent().length && S.hide().remove(), r.children("." + m + ":visible"), S.hasClass(n.res("class", "editing")) && h() }) }).on("totop frontmost", function () { var e = n.storage("autoFocusDialog"); S.data("focusOnMouseOver", e ? e > 0 : n.options.uiOptions.dialog.focusOnMouseOver), S.data("minimized") && y.children(".elfinder-titlebar-minimize").trigger("mousedown"), !S.data("modal") && n.getUI("overlay").is(":visible") ? n.getUI("overlay").before(S) : n.toFront(S), r.children("." + m + ":not(.elfinder-dialog-modal)").removeClass("elfinder-dialog-active"), S.addClass("elfinder-dialog-active"), !n.UA.Mobile && (o || j()).trigger("focus"), o = void 0 }).on("posinit", function () { var i, a, o, l, c, d, p, u = t.position; if (!S.hasClass("elfinder-maximized")) { if (!u && !S.data("resizing")) { if (p = r.hasClass("elfinder-fullscreen") || n.options.enableAlways, S.css(p ? { maxWidth: "100%", maxHeight: "100%", overflow: "auto" } : s), n.UA.Mobile && !p && S.data("rotated") === n.UA.Rotated) return; S.data("rotated", n.UA.Rotated), c = e(window), i = r.offset(), (l = { width: S.outerWidth(!0), height: S.outerHeight(!0) }).right = i.left + l.width, l.bottom = i.top + l.height, (d = { scrLeft: c.scrollLeft(), scrTop: c.scrollTop(), width: c.width(), height: c.height() }).right = d.scrLeft + d.width, d.bottom = d.scrTop + d.height, n.options.dialogContained || p ? (a = 0, o = 0) : (a = -1 * i.top + d.scrTop, o = -1 * i.left + d.scrLeft), u = { top: l.height >= d.height ? a : Math.max(a, parseInt((r.height() - l.height) / 2 - 42)), left: l.width >= d.width ? o : Math.max(o, parseInt((r.width() - l.width) / 2)) }, l.right + u.left > d.right && (u.left = Math.max(o, d.right - l.right)), l.bottom + u.top > d.bottom && (u.top = Math.max(a, d.bottom - l.bottom)) } t.absolute && (u.position = "absolute"), u && S.css(u) } }).on("resize", function (n, i) { var a, o, r, s, l = 0, c = i && i.init; i && (i.minimize || i.maxmize) || S.data("minimized") || (n.stopPropagation(), n.preventDefault(), S.children(".ui-widget-header,.ui-dialog-buttonpane").each(function () { l += e(this).outerHeight(!0) }), (s = "auto" === t.height) && f.css({ "max-height": "", height: "auto" }), c || !d.enabled || n.originalEvent || S.hasClass("elfinder-maximized") ? a = S.height() - l - S.data("margin-y") : (a = S.height(), o = S.css("min-height") || a, r = S.css("max-height") || a, o = o.match(/%/) ? Math.floor(parseInt(o) / 100 * S.parent().height()) : parseInt(o), r = r.match(/%/) ? Math.floor(parseInt(r) / 100 * S.parent().height()) : parseInt(r), a = Math.min(s ? S.height() : d.defaultSize.height, Math.max(r, o) - l - S.data("margin-y"))), f.css(s ? "max-height" : "height", a), c || (I(), o = a < (o = f.height()) ? o + l + S.data("margin-y") : t.minHeight, S.css("min-height", o), S.data("hasResizable") && S.resizable("option", { minHeight: o }), "function" == typeof t.resize && e.proxy(t.resize, f[0])(n, i))) }).on("tabstopsInit", A).on("focus", "." + v, function () { e(this).addClass(g).parent("label").addClass(g), this.id && e(this).parent().find("label[for=" + this.id + "]").addClass(g) }).on("click", "select." + v, function () { var t = e(this); t.data("keepFocus") ? t.removeData("keepFocus") : t.data("keepFocus", !0) }).on("blur", "." + v, function () { e(this).removeClass(g).removeData("keepFocus").parent("label").removeClass(g), this.id && e(this).parent().find("label[for=" + this.id + "]").removeClass(g) }).on("mouseenter mouseleave", "." + v + ",label", function (n) { var i, a = e(this); ("LABEL" !== this.nodeName || a.children("." + v).length || (i = a.attr("for")) && e("#" + i).hasClass(v)) && (t.btnHoverFocus && S.data("focusOnMouseOver") ? "mouseenter" !== n.type || e(":focus").data("keepFocus") || a.trigger("focus") : a.toggleClass(g, "mouseenter" == n.type)) }).on("keydown", "." + v, function (t) { var n, i, a = e(this); if (a.is(":focus")) { if (n = t.keyCode === e.ui.keyCode.ESCAPE, t.keyCode === e.ui.keyCode.ENTER ? (t.preventDefault(), a.trigger("click")) : t.keyCode === e.ui.keyCode.TAB && t.shiftKey || t.keyCode === e.ui.keyCode.LEFT || t.keyCode == e.ui.keyCode.UP ? i = "prev" : t.keyCode !== e.ui.keyCode.TAB && t.keyCode != e.ui.keyCode.RIGHT && t.keyCode != e.ui.keyCode.DOWN || (i = "next"), i && (a.is("textarea") && !t.ctrlKey && !t.metaKey || a.is("select,span.ui-slider-handle") && t.keyCode !== e.ui.keyCode.TAB || a.is("input:not(:checkbox,:radio)") && !t.ctrlKey && !t.metaKey && t.keyCode === e.ui.keyCode["prev" === i ? "LEFT" : "RIGHT"])) return void t.stopPropagation(); n ? a.is("input:not(:checkbox,:radio),textarea") && "" !== a.val() && (a.val(""), t.stopPropagation()) : t.stopPropagation(), i && (t.preventDefault(), ("prev" === i ? function (t) { var n = z.filter(":visible:enabled"), i = n.last(); return e.each(n, function (e, a) { if (a === t && n[e - 1]) return i = n.eq(e - 1), !1 }), i } : j)(this).trigger("focus")) } }).data({ modal: t.modal }), I = function () { var e, t = n.getUI(); t.hasClass("elfinder-fullscreen") && (e = S.position(), S.css("top", Math.max(Math.min(Math.max(e.top, 0), t.height() - 100), 0)), S.css("left", Math.max(Math.min(Math.max(e.left, 0), t.width() - 200), 0))) }; S.prepend(y), e.each(t.headerBtnOrder.split(":").reverse(), function (e, t) { O[t] && O[t]() }), l && y.children(".elfinder-titlebar-button").addClass("elfinder-titlebar-button-right"), e.each(t.buttons, function (t, n) { var i = e('<button type="button" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only elfinder-btncnt-' + C++ + " " + v + '"><span class="ui-button-text">' + t + "</span></button>").on("click", e.proxy(n, f[0])); n._cssClass && i.addClass(n._cssClass), l ? w.append(i) : w.prepend(i) }), w.children().length && (S.append(x), S.show(), x.find("button").each(function (t, n) { k += e(n).outerWidth(!0) }), S.hide(), k += 20, S.width() < k && S.width(k)), S.append(T), d.enabled && (c.width = S.outerWidth(!0) - S.width() + (S.outerWidth() - S.width()) / 2, c.height = S.outerHeight(!0) - S.height() + (S.outerHeight() - S.height()) / 2), n.options.dialogContained && (a = { maxWidth: r.width() - c.width, maxHeight: r.height() - c.height }, t.maxWidth = t.maxWidth ? Math.min(a.maxWidth, t.maxWidth) : a.maxWidth, t.maxHeight = t.maxHeight ? Math.min(a.maxHeight, t.maxHeight) : a.maxHeight, S.css(a)), s = { maxWidth: S.css("max-width"), maxHeight: S.css("max-height"), overflow: S.css("overflow") }, t.resizable && S.resizable({ minWidth: t.minWidth, minHeight: t.minHeight, maxWidth: t.maxWidth, maxHeight: t.maxHeight, start: function () { T.show(), !0 !== S.data("resizing") && S.data("resizing") && clearTimeout(S.data("resizing")), S.data("resizing", !0) }, stop: function (e, t) { T.hide(), S.data("resizing", setTimeout(function () { S.data("resizing", !1) }, 200)), d.enabled && (d.defaultSize = { width: f.width(), height: f.height() }) } }).data("hasResizable", !0), t.optimizeNumber && S.find("input[type=number]").each(function () { e(this).attr("inputmode", "numeric"), e(this).attr("pattern", "[0-9]*") }), A(), "function" == typeof t.create && e.proxy(t.create, this)(), t.autoOpen && (t.open ? requestAnimationFrame(function () { f.elfinderdialog("open") }) : f.elfinderdialog("open")), t.resize && n.bind("themechange", function () { setTimeout(function () { S.data("margin-y", f.outerHeight(!0) - f.height()), S.trigger("resize", { init: !0 }) }, 300) }) }), this) }, e.fn.elfinderdialog.defaults = { cssClass: "", title: "", modal: !1, resizable: !0, autoOpen: !0, closeOnEscape: !0, destroyOnClose: !1, buttons: {}, btnHoverFocus: !0, position: null, absolute: !1, width: 320, height: "auto", minWidth: 200, minHeight: 70, maxWidth: null, maxHeight: null, allowMinimize: "auto", allowMaximize: !1, openMaximized: !1, headerBtnPos: "auto", headerBtnOrder: "auto", optimizeNumber: !0, propagationEvents: ["mousemove", "mouseup"] }, e.fn.elfinderfullscreenbutton = function (t) { return this.each(function () { var n, i = e(this).elfinderbutton(t).children(".elfinder-button-icon"); t.change(function () { n && cancelAnimationFrame(n), n = requestAnimationFrame(function () { var e = t.value; i.addClass("elfinder-button-icon-fullscreen").toggleClass("elfinder-button-icon-unfullscreen", e), t.className = e ? "unfullscreen" : "" }) }) }) }, e.fn.elfindernavbar = function (t, n) { return this.not(".elfinder-navbar").each(function () { var i, a, o, r, s, l, c, d = e(this).hide().addClass("ui-state-default elfinder-navbar"), p = d.css("overflow", "hidden").parent().children(".elfinder-workzone").append(d), u = "ltr" == t.direction, h = function () { var e = t.getUI("cwd"), n = t.getUI("workzone"), i = n.data("rectangle"), a = e.offset(); n.data("rectangle", Object.assign(i, { cwdEdge: "ltr" === t.direction ? a.left : a.left + e.width() })) }, f = function () { d.css("overflow", "hidden"), i = Math.round(d.outerHeight() - d.height()), a = Math.round(c.outerWidth() - c.innerWidth()), d.css("overflow", "auto") }; t.one("init", function () { c = t.getUI("navdock"); var e = function () { f(), t.bind("wzresize", function () { var e = 0; c.width(d.outerWidth() - a), c.children().length > 1 && (e = c.outerHeight(!0)), d.height(p.height() - e - i) }).trigger("wzresize") }; t.cssloaded ? e() : t.one("cssloaded", e) }).one("opendone", function () { o && o.trigger("resize"), d.css("overflow", "auto") }).bind("themechange", f), t.UA.Touch && (void 0 === (s = t.storage("autoHide") || {}).navbar && (s.navbar = n.autoHideUA && n.autoHideUA.length > 0 && e.grep(n.autoHideUA, function (e) { return !!t.UA[e] }).length, t.storage("autoHide", s)), s.navbar && t.one("init", function () { d.children().length && t.uiAutoHide.push(function () { d.stop(!0, !0).trigger("navhide", { duration: "slow", init: !0 }) }) }), t.bind("load", function () { d.children().length && "none" !== (r = e('<div class="elfinder-navbar-swipe-handle"></div>').hide().appendTo(p)).css("pointer-events") && (r.remove(), r = null) }), d.on("navshow navhide", function (e, n) { var i = "navshow" === e.type ? "show" : "hide", a = n && n.duration ? n.duration : "fast", o = n && n.handleW ? n.handleW : Math.max(50, t.getUI().width() / 10); d.stop(!0, !0)[i]({ duration: a, step: function () { t.trigger("wzresize") }, complete: function () { r && ("show" === i ? r.stop(!0, !0).hide() : (r.width(o || ""), t.resources.blink(r, "slowonce"))), t.trigger("navbar" + i), n.init && t.trigger("uiautohide"), h() } }), s.navbar = "show" !== i, t.storage("autoHide", Object.assign(t.storage("autoHide"), { navbar: s.navbar })) }).on("touchstart", function (n) { e(this)["scroll" + ("ltr" === t.direction ? "Right" : "Left")]() > 5 && (n.originalEvent._preventSwipeX = !0) })), t.UA.Mobile || (o = d.resizable({ handles: u ? "e" : "w", minWidth: n.minWidth || 150, maxWidth: n.maxWidth || 500, resize: function () { t.trigger("wzresize") }, stop: function (e, n) { t.storage("navbarWidth", n.size.width), h() } }).on("resize scroll", function (n) { var i = e(this), a = i.data("posinit"); n.preventDefault(), n.stopPropagation(), u || "resize" !== n.type || d.css("left", 0), a && cancelAnimationFrame(a), i.data("posinit", requestAnimationFrame(function () { var e = t.UA.Opera && d.scrollLeft() ? 20 : 2; o.css("top", 0).css({ top: parseInt(d.scrollTop()) + "px", left: u ? "auto" : -1 * parseInt(d.scrollRight() - e), right: u ? -1 * parseInt(d.scrollLeft() - e) : "auto" }), "resize" === n.type && t.getUI("cwd").trigger("resize") })) }).children(".ui-resizable-handle").addClass("ui-front")), (l = t.storage("navbarWidth")) ? d.width(l) : t.UA.Mobile && t.one(t.cssloaded ? "init" : "cssloaded", function () { var n = function () { l = d.parent().width() / 2, d.data("defWidth") > l ? d.width(l) : d.width(d.data("defWidth")), d.data("width", d.width()), t.trigger("wzresize") }; d.data("defWidth", d.width()), e(window).on("resize." + t.namespace, n), n() }) }), this }, e.fn.elfindernavdock = function (t, n) { return this.not(".elfinder-navdock").each(function () { var i, a, o = e(this).hide().addClass("ui-state-default elfinder-navdock touch-punch"), r = (o.parent().children(".elfinder-workzone").append(o), function (n, i) { var a, r = n - (i || o.height()), s = Object.keys(l).length, c = s ? r / s : 0; r && (a = o.css("overflow"), o.css("overflow", "hidden"), o.height(n), e.each(l, function (e, n) { n.height(n.height() + c).trigger("resize." + t.namespace) }), t.trigger("wzresize"), o.css("overflow", a)) }), s = e('<div class="ui-front ui-resizable-handle ui-resizable-n"></div>').appendTo(o), l = {}, c = (parseInt(n.initMaxHeight) || 50) / 100, d = (parseInt(n.maxHeight) || 90) / 100; o.data("addNode", function (e, n) { var p, u, h = t.getUI("workzone").height(), f = h * c; return n = Object.assign({ first: !1, sizeSync: !0, init: !1 }, n), e.attr("id") || e.attr("id", t.namespace + "-navdock-" + +new Date), n.sizeSync && (l[e.attr("id")] = e), p = o.height() + e.outerHeight(!0), n.first ? s.after(e) : o.append(e), a = !0, o.resizable("enable").height(p).show(), t.trigger("wzresize"), n.init && (u = t.storage("navdockHeight"), i = p = u || (p > f ? f : p)), r(Math.min(p, h * d)), o }).data("removeNode", function (n, i) { var r = e("#" + n); return delete l[n], o.height(o.height() - e("#" + n).outerHeight(!0)), i ? "detach" === i ? r = r.detach() : i.append(r) : r.remove(), o.children().length <= 1 && (a = !1, o.resizable("disable").height(0).hide()), t.trigger("wzresize"), r }), n.disabled || t.one("init", function () { var e; t.getUI("navbar").children().not(".ui-resizable-handle").length && (o.data("dockEnabled", !0), o.resizable({ maxHeight: t.getUI("workzone").height() * d, handles: { n: s }, start: function (n, i) { e = o.css("overflow"), o.css("overflow", "hidden"), t.trigger("navdockresizestart", { event: n, ui: i }, !0) }, resize: function (e, n) { o.css("top", ""), t.trigger("wzresize", { inNavdockResize: !0 }) }, stop: function (n, a) { t.trigger("navdockresizestop", { event: n, ui: a }, !0), o.css("top", ""), i = a.size.height, t.storage("navdockHeight", i), r(i, a.originalSize.height), o.css("overflow", e) } }), t.bind("wzresize", function (e) { var n, a; o.is(":visible") && (n = t.getUI("workzone").height() * d, e.data && e.data.inNavdockResize || (a = o.height(), n < i ? Math.abs(a - n) > 1 && r(n) : Math.abs(a - i) > 1 && r(i)), o.resizable("option", "maxHeight", n)) }).bind("themechange", function () { var e = Math.round(o.height()); requestAnimationFrame(function () { var t = Math.round(o.height()), n = e - t; 0 !== n && r(o.height(), t - n) }) })), t.bind("navbarshow navbarhide", function (e) { o[a && "navbarshow" === e.type ? "show" : "hide"]() }) }) }), this }, e.fn.elfinderoverlay = function (t) { var n, i, a, o, r = this.parent().elfinder("instance"); return this.filter(":not(.elfinder-overlay)").each(function () { t = Object.assign({}, t), e(this).addClass("ui-front ui-widget-overlay elfinder-overlay").hide().on("mousedown", function (e) { e.preventDefault(), e.stopPropagation() }).data({ cnt: 0, show: "function" == typeof t.show ? t.show : function () { }, hide: "function" == typeof t.hide ? t.hide : function () { } }) }), "show" == t && (i = (n = this.eq(0)).data("cnt") + 1, a = n.data("show"), r.toFront(n), n.data("cnt", i), n.is(":hidden") && (n.show(), a())), "hide" == t && (i = (n = this.eq(0)).data("cnt") - 1, o = n.data("hide"), n.data("cnt", i), i <= 0 && (n.hide(), o())), this }, e.fn.elfinderpanel = function (t) { return this.each(function () { var n = e(this).addClass("elfinder-panel ui-state-default ui-corner-all"), i = "margin-" + ("ltr" == t.direction ? "left" : "right"); t.one("load", function (e) { var a = t.getUI("navbar"); n.css(i, parseInt(a.outerWidth(!0))), a.on("resize", function (e) { e.preventDefault(), e.stopPropagation(), n.is(":visible") && n.css(i, parseInt(a.outerWidth(!0))) }) }) }) }, e.fn.elfinderpath = function (t, n) { return this.each(function () { var i, a, o = "", r = "", s = [], l = "statusbar", c = t.res("class", "hover"), d = "path" + (h.prototype.uniqueid ? h.prototype.uniqueid : "") + "-", p = e('<div class="ui-widget-header ui-helper-clearfix elfinder-workzone-path"></div>'), u = e(this).addClass("elfinder-path").html("&nbsp;").on("mousedown", "span.elfinder-path-dir", function (n) { var i = e(this).attr("id").substr(d.length); n.preventDefault(), i != t.cwd().hash && (e(this).addClass(c), o ? t.exec("search", o, { target: i, mime: s.join(" ") }) : t.trigger("select", { selected: [i] }).exec("open", i)) }).prependTo(t.getUI("statusbar").show()), f = e('<div class="elfinder-path-roots"></div>').on("click", function (n) { n.stopPropagation(), n.preventDefault(); var i = e.map(t.roots, function (e) { return t.file(e) }), a = []; e.each(i, function (e, n) { n.phash || t.root(t.cwd().hash, !0) === n.hash || a.push({ label: t.escape(n.i18 || n.name), icon: "home", callback: function () { t.exec("open", n.hash) }, options: { iconClass: n.csscls || "", iconImg: n.icon || "" } }) }), t.trigger("contextmenu", { raw: a, x: n.pageX, y: n.pageY }) }).append('<span class="elfinder-button-icon elfinder-button-icon-menu" ></span>').appendTo(p), m = function (n) { var i = [], a = []; return e.each(t.parents(n), function (e, o) { var r = n === o ? "elfinder-path-dir elfinder-path-cwd" : "elfinder-path-dir", s = t.file(o), l = t.escape(s.i18 || s.name); a.push(l), i.push('<span id="' + d + o + '" class="' + r + '" title="' + a.join(t.option("separator")) + '">' + l + "</span>") }), i.join('<span class="elfinder-path-other">' + t.option("separator") + "</span>") }, g = function () { var n; u.children("span.elfinder-path-dir").attr("style", ""), n = "ltr" === t.direction ? e("#" + d + t.cwd().hash).prevAll("span.elfinder-path-dir:first") : e(), u.scrollLeft(n.length ? n.position().left : 0) }, v = function () { if (!t.UA.CSS.flex) { var n, i, a = u.children("span.elfinder-path-dir"), o = a.length; "workzone" === l || o < 2 ? a.attr("style", "") : (u.width(u.css("max-width")), a.css({ maxWidth: 100 / o + "%", display: "inline-block" }), n = u.width() - 9, u.children("span.elfinder-path-other").each(function () { n -= e(this).width() }), i = [], a.each(function (t) { var a = e(this).width(); n -= a, a < this.scrollWidth && i.push(t) }), u.width(""), i.length ? (n > 0 && (n /= i.length, e.each(i, function (t, i) { var o = e(a[i]); o.css("max-width", o.width() + n) })), a.last().attr("style", "")) : a.attr("style", "")) } }; t.one("init", function () { i = t.getUI("tree").length, a = t.getUI("stat").length, !i && n.toWorkzoneWithoutNavbar && (p.append(u).insertBefore(t.getUI("workzone")), l = "workzone", t.bind("open", g).one("opendone", function () { t.getUI().trigger("resize") })) }).bind("open searchend parents", function () { o = "", r = "", s = [], u.html(m(t.cwd().hash)), Object.keys(t.roots).length > 1 ? (u.css("margin", ""), f.show()) : (u.css("margin", 0), f.hide()), !a && v() }).bind("searchstart", function (e) { e.data && (o = e.data.query || "", r = e.data.target || "", s = e.data.mimes || []) }).bind("search", function (e) { var n = ""; n = r ? m(r) : t.i18n("btnAll"), u.html('<span class="elfinder-path-other">' + t.i18n("searcresult") + ": </span>" + n), v() }).bind("navbarshow navbarhide", function () { var e = t.getUI("workzone"); "navbarshow" === this.type ? (t.unbind("open", g), u.prependTo(t.getUI("statusbar")), p.detach(), l = "statusbar") : (p.append(u).insertBefore(e), l = "workzone", g(), t.bind("open", g)), t.trigger("uiresize") }).bind("resize uistatchange", v) }) }, e.fn.elfinderplaces = function (t, n) { return this.each(function () { var i = {}, a = "class", o = t.res(a, "navdir"), r = t.res(a, "navcollapse"), s = t.res(a, "navexpand"), l = t.res(a, "hover"), c = t.res(a, "treeroot"), d = t.res(a, "adroppable"), p = t.res("tpl", "placedir"), u = t.res("tpl", "perms"), h = e(t.res("tpl", "navspinner")), f = n.suffix ? n.suffix : "", m = "places" + f, g = null, v = function (e) { return e.substr(6) }, b = function (e) { return "place-" + e }, y = function (t) { return e(document.getElementById(b(t))) }, w = function () { var n = [], a = {}; (n = e.map(S.children().find("[id]"), function (e) { return v(e.id) })).length ? e.each(n.reverse(), function (e, t) { a[t] = i[t] }) : a = null, t.storage(m, a) }, x = function () { var a, o; m = "places" + (n.suffix ? n.suffix : ""), i = {}, "string" == typeof (a = t.storage(m)) ? (a = e.grep(a.split(","), function (e) { return !!e }), e.each(a, function (e, t) { var n = t.split("#"); i[n[0]] = n[1] ? n[1] : n[0] })) : e.isPlainObject(a) && (i = a), t.trigger("placesload", { dirs: i, storageKey: m }, !0), (o = Object.keys(i)).length && (O.prepend(h), t.request({ data: { cmd: "info", targets: o }, preventDefault: !0 }).done(function (n) { var a = {}; n.files && n.files.length && t.cache(n.files), e.each(n.files, function (e, t) { var n = t.hash; a[n] = t }), e.each(i, function (e, t) { C(a[e] || Object.assign({ notfound: !0 }, t)) }), t.storage("placesState") > 0 && O.trigger("click") }).always(function () { h.remove() })) }, k = function (n, i) { return e(p.replace(/\{id\}/, b(n ? n.hash : i)).replace(/\{name\}/, t.escape(n ? n.i18 || n.name : i)).replace(/\{cssclass\}/, n ? t.perms2class(n) + (n.notfound ? " elfinder-na" : "") + (n.csscls ? " " + n.csscls : "") : "").replace(/\{permissions\}/, !n || n.read && n.write && !n.notfound ? "" : u).replace(/\{title\}/, n ? ' title="' + t.escape(t.path(n.hash, !0) || n.i18 || n.name) + '"' : "").replace(/\{symlink\}/, "").replace(/\{style\}/, n && n.icon ? t.getIconStyle(n) : "")) }, C = function (e) { var n, a; return "directory" === e.mime && (a = e.hash, t.files().hasOwnProperty(a) || t.trigger("tree", { tree: [e] }), n = k(e, a), i[a] = e, S.prepend(n), O.addClass(r), A.toggle(S.children().length > 1), !0) }, z = function (e) { var t, n, a = null; return i[e] && (delete i[e], (t = y(e)).length && (a = t.text(), t.parent().remove(), n = S.children().length, A.toggle(n > 1), n || (O.removeClass(r), I.removeClass(s), S.slideToggle(!1)))), a }, T = function (e, t) { var n = e.hash, a = y(t || n), o = k(e, n); return a.length > 0 && (a.parent().replaceWith(o), i[n] = e, !0) }, A = e('<span class="elfinder-button-icon elfinder-button-icon-sort elfinder-places-root-icon" title="' + t.i18n("cmdsort") + '"></span>').hide().on("click", function (n) { n.stopPropagation(), S.empty(), e.each(i, function (n, i) { var a = t.file(n) || i, r = k(a, n), s = null; if (a || r.hide(), S.children().length && (e.each(S.children(), function () { var t = e(this); if ((a.i18 || a.name).localeCompare(t.children("." + o).text()) < 0) return s = !r.insertBefore(t) }), null !== s)) return !0; !y(n).length && S.append(r) }), w() }), j = k({ hash: "root-" + t.namespace, name: t.i18n(n.name, "places"), read: !0, write: !0 }), O = j.children("." + o).addClass(c).on("click", function (e) { e.stopPropagation(), O.hasClass(r) && (I.toggleClass(s), S.slideToggle(), t.storage("placesState", I.hasClass(s) ? 1 : 0)) }).append(A), S = j.children("." + t.res(a, "navsubtree")), I = e(this).addClass(t.res(a, "tree") + " elfinder-places ui-corner-all").hide().append(j).appendTo(t.getUI("navbar")).on("mouseenter mouseleave", "." + o, function (t) { e(this).toggleClass("ui-state-hover", "mouseenter" == t.type) }).on("click", "." + o, function (n) { var i = e(this); i.data("longtap") ? n.stopPropagation() : !i.hasClass("elfinder-na") && t.exec("open", i.attr("id").substr(6)) }).on("contextmenu", "." + o + ":not(." + c + ")", function (n) { var i = e(this), a = i.attr("id").substr(6); n.preventDefault(), t.trigger("contextmenu", { raw: [{ label: t.i18n("moveUp"), icon: "up", remain: !0, callback: function () { !function (e) { var n = y(e), i = n.parent(), a = i.prev("div"), o = "ui-state-hover", r = t.getUI("contextmenu"); g && clearTimeout(g), a.length && (r.find(":first").data("placesHash", e), n.addClass(o), i.insertBefore(a), a = i.prev("div"), g = setTimeout(function () { n.removeClass(o), r.find(":first").data("placesHash") === e && r.hide().empty() }, 1500)), a.length || (n.removeClass(o), r.hide().empty()) }(a), w() } }, "|", { label: t.i18n("rmFromPlaces"), icon: "rm", callback: function () { z(a), w() } }], x: n.pageX, y: n.pageY }), i.addClass("ui-state-hover"), t.getUI("contextmenu").children().on("mouseenter", function () { i.addClass("ui-state-hover") }), t.bind("closecontextmenu", function () { i.removeClass("ui-state-hover") }) }).droppable({ tolerance: "pointer", accept: ".elfinder-cwd-file-wrapper,.elfinder-tree-dir,.elfinder-cwd-file", hoverClass: t.res("class", "adroppable"), classes: { "ui-droppable-hover": t.res("class", "adroppable") }, over: function (n, a) { var o = a.helper, r = e.grep(o.data("files"), function (e) { return "directory" === t.file(e).mime && !i[e] }); n.stopPropagation(), o.data("dropover", o.data("dropover") + 1), t.insideWorkzone(n.pageX, n.pageY) && (r.length > 0 ? (o.addClass("elfinder-drag-helper-plus"), t.trigger("unlockfiles", { files: o.data("files"), helper: o })) : e(this).removeClass(d)) }, out: function (t, n) { var i = n.helper; t.stopPropagation(), i.removeClass("elfinder-drag-helper-move elfinder-drag-helper-plus").data("dropover", Math.max(i.data("dropover") - 1, 0)), e(this).removeData("dropover").removeClass(d) }, drop: function (n, a) { var o = a.helper, r = !0; e.each(o.data("files"), function (e, n) { var a = t.file(n); a && "directory" == a.mime && !i[a.hash] ? C(a) : r = !1 }), w(), r && o.hide() } }).on("touchstart", "." + o + ":not(." + c + ")", function (n) { if (!(n.originalEvent.touches.length > 1)) var i = e(this).attr("id").substr(6), a = e(this).addClass(l).data("longtap", null).data("tmlongtap", setTimeout(function () { a.data("longtap", !0), t.trigger("contextmenu", { raw: [{ label: t.i18n("rmFromPlaces"), icon: "rm", callback: function () { z(i), w() } }], x: n.originalEvent.touches[0].pageX, y: n.originalEvent.touches[0].pageY }) }, 500)) }).on("touchmove touchend", "." + o + ":not(." + c + ")", function (t) { clearTimeout(e(this).data("tmlongtap")), "touchmove" == t.type && e(this).removeClass(l) }); e.fn.sortable && S.addClass("touch-punch").sortable({ appendTo: t.getUI(), revert: !1, helper: function (n) { var i = e(n.target).parent(); return i.children().removeClass("ui-state-hover"), e('<div class="ui-widget elfinder-place-drag elfinder-' + t.direction + '"></div>').append(e('<div class="elfinder-navbar"></div>').show().append(i.clone())) }, stop: function (t, n) { var i = e(n.item[0]), a = I.offset().top, o = I.offset().left, r = I.width(), s = I.height(), l = t.pageX, c = t.pageY; l > o && l < o + r && c > a && c < c + s || (z(v(i.children(":first").attr("id"))), w()) }, update: function (e, t) { w() } }), e(this).on("regist", function (t, n) { var a = !1; e.each(n, function (e, t) { t && "directory" == t.mime && !i[t.hash] && C(t) && (a = !0) }), a && w() }), t.one("load", function () { t.oldAPI || (I.show().parent().show(), x(), t.change(function (t) { var n = !1; e.each(t.data.changed, function (e, t) { i[t.hash] && ("directory" !== t.mime ? z(t.hash) && (n = !0) : T(t) && (n = !0)) }), n && w() }).bind("rename", function (t) { var n = !1; t.data.removed && e.each(t.data.removed, function (e, i) { t.data.added[e] && T(t.data.added[e], i) && (n = !0) }), n && w() }).bind("rm paste", function (t) { var n = [], i = !1; t.data.removed && e.each(t.data.removed, function (e, t) { var i = z(t); i && n.push(i) }), n.length && (i = !0), t.data.added && n.length && e.each(t.data.added, function (t, i) { 1 !== e.inArray(i.name, n) && "directory" == i.mime && C(i) }), i && w() }).bind("sync netmount", function () { var a, o = this, l = n.suffix ? n.suffix : ""; if ("sync" === o.type && f !== l) return f = l, S.empty(), O.removeClass(r), I.removeClass(s), S.slideToggle(!1), void x(); (a = Object.keys(i)).length && (O.prepend(h), t.request({ data: { cmd: "info", targets: a }, preventDefault: !0 }).done(function (n) { var a = {}, r = !1, s = t.cwd().hash; e.each(n.files || [], function (e, n) { var i = n.hash; a[i] = n, t.files().hasOwnProperty(n.hash) || t.updateCache({ tree: [n] }) }), e.each(i, function (e, t) { Boolean(t.notfound) === Boolean(a[e]) ? t.phash === s && "netmount" !== o.type || a[e] && "directory" !== a[e].mime ? z(e) && (r = !0) : T(a[e] || Object.assign({ notfound: !0 }, t)) && (r = !0) : a[e] && a[e].phash != s && T(a[e]) }), r && w() }).always(function () { h.remove() })) })) }) }) }, e.fn.elfindersearchbutton = function (t) { return this.each(function () { var n, i, a, o, r = !1, s = t.fm, l = (s.res("class", "disabled"), t.options.incsearch || { enable: !1 }), c = t.options.searchTypes, d = function (e) { return s.namespace + s.escape(e) }, p = s.getUI("toolbar"), u = s.res("class", "searchbtn"), h = e(this).hide().addClass("ui-widget-content elfinder-button " + u).on("click", function (e) { e.stopPropagation() }), f = function () { v.data("inctm") && clearTimeout(v.data("inctm")); var n = e.trim(v.val()), a = !e("#" + d("SearchFromAll")).prop("checked"), o = e("#" + d("SearchMime")).prop("checked"), l = ""; a && (a = e("#" + d("SearchFromVol")).prop("checked") ? s.root(s.cwd().hash) : s.cwd().hash), o && (o = n, n = "."), i && (l = i.children("input:checked").val()), n ? (v.trigger("focus"), t.exec(n, a, o, l).done(function () { r = !0 }).fail(function () { m() })) : s.trigger("searchend") }, m = function () { v.data("inctm") && clearTimeout(v.data("inctm")), v.val("").trigger("blur"), (r || g) && (r = !1, g = "", s.lazy(function () { s.trigger("searchend") })) }, g = "", v = e('<input type="text" size="42"/>').on("focus", function () { var e, t; !h.hasClass("ui-state-active") && s.getUI().click(), o = !0, g = "", h.addClass("ui-state-active"), s.trigger("uiresize"), n && n.css((e = s.getUI(), t = e.offset(), { top: h.offset().top - t.top, maxHeight: e.height() - 40 })).slideDown(function () { h.addClass("ui-state-active"), s.toFront(n) }) }).on("blur", function () { o = !1, n ? n.data("infocus") ? n.data("infocus", !1) : n.slideUp(function () { h.removeClass("ui-state-active"), s.trigger("uiresize"), s.toHide(n) }) : h.removeClass("ui-state-active") }).appendTo(h).on("keypress", function (e) { e.stopPropagation() }).on("keydown", function (t) { t.stopPropagation(), t.keyCode === e.ui.keyCode.ENTER ? f() : t.keyCode === e.ui.keyCode.ESCAPE && (t.preventDefault(), m()) }); l.enable && (l.minlen = l.minlen || 2, l.wait = l.wait || 500, v.attr("title", s.i18n("incSearchOnly")).on("compositionstart", function () { v.data("composing", !0) }).on("compositionend", function () { v.removeData("composing"), v.trigger("input") }).on("input", function () { v.data("composing") || (v.data("inctm") && clearTimeout(v.data("inctm")), v.data("inctm", setTimeout(function () { var e = v.val(); (0 === e.length || e.length >= l.minlen) && (g !== e && s.trigger("incsearchstart", { query: e, type: i ? i.children("input:checked").val() : "searchName" }), g = e, "" === e && s.searchStatus.state > 1 && s.searchStatus.query && v.val(s.searchStatus.query).trigger("select")) }, l.wait))) }), s.UA.ltIE8 && v.on("keydown", function (e) { 229 === e.keyCode && (v.data("imetm") && clearTimeout(v.data("imetm")), v.data("composing", !0), v.data("imetm", setTimeout(function () { v.removeData("composing") }, 100))) }).on("keyup", function (t) { v.data("imetm") && clearTimeout(v.data("imetm")), v.data("composing") ? t.keyCode === e.ui.keyCode.ENTER && v.trigger("compositionend") : v.trigger("input") })), e('<span class="ui-icon ui-icon-search" title="' + t.title + '"></span>').appendTo(h).on("mousedown", function (e) { e.stopPropagation(), e.preventDefault(), h.hasClass("ui-state-active") ? f() : v.trigger("focus") }), e('<span class="ui-icon ui-icon-close"></span>').appendTo(h).on("mousedown", function (e) { e.stopPropagation(), e.preventDefault(), "" !== v.val() || h.hasClass("ui-state-active") ? m() : v.trigger("focus") }), s.bind("toolbarload", function () { var e = h.parent(); if (e.length && (p.prepend(h.show()), e.remove(), s.UA.ltIE7)) { var t = h.children("ltr" == s.direction ? ".ui-icon-close" : ".ui-icon-search"); t.css({ right: "", left: parseInt(h.width()) - t.outerWidth(!0) }) } }), s.one("init", function () { s.getUI("cwd").on("touchstart click", function () { o && v.trigger("blur") }) }).one("open", function () { (n = s.api < 2.1 ? null : e('<div class="ui-front ui-widget ui-widget-content elfinder-button-menu elfinder-button-search-menu ui-corner-all"></div>').append(e('<div class="buttonset"></div>').append(e('<input id="' + d("SearchFromCwd") + '" name="serchfrom" type="radio" checked="checked"/><label for="' + d("SearchFromCwd") + '">' + s.i18n("btnCwd") + "</label>"), e('<input id="' + d("SearchFromVol") + '" name="serchfrom" type="radio"/><label for="' + d("SearchFromVol") + '">' + s.i18n("btnVolume") + "</label>"), e('<input id="' + d("SearchFromAll") + '" name="serchfrom" type="radio"/><label for="' + d("SearchFromAll") + '">' + s.i18n("btnAll") + "</label>")), e('<div class="buttonset elfinder-search-type"></div>').append(e('<input id="' + d("SearchName") + '" name="serchcol" type="radio" checked="checked" value="SearchName"/><label for="' + d("SearchName") + '">' + s.i18n("btnFileName") + "</label>"))).hide().appendTo(s.getUI())) && (c && (i = n.find(".elfinder-search-type"), e.each(t.options.searchTypes, function (t, n) { i.append(e('<input id="' + d(t) + '" name="serchcol" type="radio" value="' + s.escape(t) + '"/><label for="' + d(t) + '">' + s.i18n(n.name) + "</label>")) })), n.find("div.buttonset").buttonset(), e("#" + d("SearchFromAll")).next("label").attr("title", s.i18n("searchTarget", s.i18n("btnAll"))), c && e.each(c, function (t, n) { n.title && e("#" + d(t)).next("label").attr("title", s.i18n(n.title)) }), n.on("mousedown", "div.buttonset", function (e) { e.stopPropagation(), n.data("infocus", !0) }).on("click", "input", function (t) { t.stopPropagation(), e.trim(v.val()) ? f() : v.trigger("focus") }).on("close", function () { v.trigger("blur") })) }).bind("searchend", function () { v.val("") }).bind("open parents", function () { var t = [], n = s.file(s.root(s.cwd().hash)); n && (e.each(s.parents(s.cwd().hash), function (e, n) { t.push(s.file(n).name) }), e("#" + d("SearchFromCwd")).next("label").attr("title", s.i18n("searchTarget", t.join(s.option("separator")))), e("#" + d("SearchFromVol")).next("label").attr("title", s.i18n("searchTarget", n.name))) }).bind("open", function () { g && m() }).bind("cwdinit", function () { a = !1 }).bind("cwdrender", function () { a = !0 }).bind("keydownEsc", function () { g && "/" === g.substr(0, 1) && (g = "", v.val(""), s.trigger("searchend")) }).shortcut({ pattern: "ctrl+f f3", description: t.title, callback: function () { v.trigger("select").trigger("focus") } }).shortcut({ pattern: "a b c d e f g h i j k l m n o p q r s t u v w x y z dig0 dig1 dig2 dig3 dig4 dig5 dig6 dig7 dig8 dig9 num0 num1 num2 num3 num4 num5 num6 num7 num8 num9", description: s.i18n("firstLetterSearch"), callback: function (t) { if (a) { var n, i = t.originalEvent.keyCode, o = function () { var t = s.selected(), n = e.ui.keyCode[!t.length || s.cwdHash2Elm(t[0]).next("[id]").length ? "RIGHT" : "HOME"]; e(document).trigger(e.Event("keydown", { keyCode: n, ctrlKey: !1, shiftKey: !1, altKey: !1, metaKey: !1 })) }; i >= 96 && i <= 105 && (i -= 48), n = "/" + String.fromCharCode(i), g !== n ? (v.val(n), g = n, s.trigger("incsearchstart", { query: n }).one("cwdrender", o)) : o() } } }) }) }, e.fn.elfindersortbutton = function (t) { return this.each(function () { var n, i = t.fm, a = t.name, o = "class", r = i.res(o, "disabled"), s = i.res(o, "hover"), l = "elfinder-button-menu-item", c = l + "-selected", d = c + "-asc", p = c + "-desc", u = e('<span class="elfinder-button-text">' + t.title + "</span>"), h = e(this).addClass("ui-state-default elfinder-button elfinder-menubutton elfiner-button-" + a).attr("title", t.title).append('<span class="elfinder-button-icon elfinder-button-icon-' + a + '"></span>', u).on("mouseenter mouseleave", function (e) { !h.hasClass(r) && h.toggleClass(s, "mouseenter" === e.type) }).on("click", function (e) { h.hasClass(r) || (e.stopPropagation(), m.is(":hidden") && i.getUI().click(), m.css(v()).slideToggle({ duration: 100, done: function (e) { i[m.is(":visible") ? "toFront" : "toHide"](m) } })) }), f = function () { i.toHide(m) }, m = e('<div class="ui-front ui-widget ui-widget-content elfinder-button-menu elfinder-button-sort-menu ui-corner-all"></div>').hide().appendTo(i.getUI()).on("mouseenter mouseleave", "." + l, function (t) { e(this).toggleClass(s, "mouseenter" === t.type) }).on("click", function (e) { e.preventDefault(), e.stopPropagation() }).on("close", f), g = function () { m.children("[rel]").removeClass(c + " " + d + " " + p).filter('[rel="' + i.sortType + '"]').addClass(c + " " + ("asc" == i.sortOrder ? d : p)), m.children(".elfinder-sort-stick").toggleClass(c, i.sortStickFolders), m.children(".elfinder-sort-tree").toggleClass(c, i.sortAlsoTreeview) }, v = function () { var e = i.getUI().offset(), t = h.offset(); return { top: t.top - e.top, left: t.left - e.left } }; u.hide(), e.each(i.sortRules, function (t, n) { m.append(e('<div class="' + l + '" rel="' + t + '"><span class="ui-icon ui-icon-arrowthick-1-n"></span><span class="ui-icon ui-icon-arrowthick-1-s"></span>' + i.i18n("sort" + t) + "</div>").data("type", t)) }), m.children().on("click", function (n) { t.exec([], e(this).removeClass(s).attr("rel")) }), e('<div class="' + l + " " + l + '-separated elfinder-sort-ext elfinder-sort-stick"><span class="ui-icon ui-icon-check"></span>' + i.i18n("sortFoldersFirst") + "</div>").appendTo(m).on("click", function () { t.exec([], "stick") }), i.one("init", function () { i.ui.tree && null !== i.options.sortAlsoTreeview && e('<div class="' + l + " " + l + '-separated elfinder-sort-ext elfinder-sort-tree"><span class="ui-icon ui-icon-check"></span>' + i.i18n("sortAlsoTreeview") + "</div>").appendTo(m).on("click", function () { t.exec([], "tree") }) }).bind("disable select", f).bind("sortchange", g).getUI().on("click", f), m.children().length > 1 ? t.change(function () { n && cancelAnimationFrame(n), n = requestAnimationFrame(function () { h.toggleClass(r, t.disabled()), g() }) }).change() : h.addClass(r) }) }, e.fn.elfinderstat = function (t) { return this.each(function () { var n = e(this).addClass("elfinder-stat-size"), i = e('<div class="elfinder-stat-selected"></div>').on("click", "a", function (n) { var i = e(this).data("hash"); n.preventDefault(), t.exec("opendir", [i]) }), a = t.i18n("items"), o = t.i18n("selected"), r = t.i18n("size"), s = function (e) { n.find("span.elfinder-stat-incsearch").html(e ? e.hashes.length + " / " : ""), n.attr("title", n.text()), t.trigger("uistatchange") }, l = function (n) { var a, s, l = 0, c = 0, d = []; 1 === n.length ? (s = n[0], l = s.size, 2 === t.searchStatus.state && (a = t.escape(s.path ? s.path.replace(/\/[^\/]*$/, "") : ".."), d.push('<a href="#elf_' + s.phash + '" data-hash="' + s.hash + '" title="' + a + '">' + a + "</a>")), d.push(t.escape(s.i18 || s.name)), i.html(d.join("/") + (l > 0 ? ", " + t.formatSize(l) : ""))) : n.length ? (e.each(n, function (e, t) { c++, l += parseInt(t.size) || 0 }), i.html(c ? o + ": " + c + ", " + r + ": " + t.formatSize(l) : "&nbsp;")) : i.html(""), i.attr("title", i.text()), t.trigger("uistatchange") }; t.getUI("statusbar").prepend(n).append(i).show(), t.UA.Mobile && e.fn.tooltip && t.getUI("statusbar").tooltip({ classes: { "ui-tooltip": "elfinder-ui-tooltip ui-widget-shadow" }, tooltipClass: "elfinder-ui-tooltip ui-widget-shadow", track: !0 }), t.bind("cwdhasheschange", function (i) { var o, r, s, l, c, d; o = e.map(i.data, function (e) { return t.file(e) }), r = 0, s = 0, l = t.cwd(), c = !0, d = !0, (l.sizeInfo || l.size) && (s = l.size, c = !1), e.each(o, function (e, t) { r++, c && (s += parseInt(t.size) || 0, !0 !== d || "directory" !== t.mime || t.sizeInfo || (d = !1)) }), n.html(a + ': <span class="elfinder-stat-incsearch"></span>' + r + ',&nbsp;<span class="elfinder-stat-size' + (d ? " elfinder-stat-size-recursive" : "") + '">' + t.i18n(d ? "sum" : "size") + ": " + t.formatSize(s) + "</span>").attr("title", n.text()), t.trigger("uistatchange") }).change(function (i) { var a = i.data.changed || [], o = t.cwd().hash; e.each(a, function () { if (this.hash === o) return this.size && (n.children(".elfinder-stat-size").addClass("elfinder-stat-size-recursive").html(t.i18n("sum") + ": " + t.formatSize(this.size)), n.attr("title", n.text())), !1 }) }).select(function () { l(t.selectedFiles()) }).bind("open", function () { l([]) }).bind("incsearch", function (e) { s(e.data) }).bind("incsearchend", function () { s() }) }) }, e.fn.elfindertoast = function (t, n) { var i = Object.assign({ mode: "success", msg: "", showMethod: "fadeIn", showDuration: 300, showEasing: "swing", onShown: void 0, hideMethod: "fadeOut", hideDuration: 1500, hideEasing: "swing", onHidden: void 0, timeOut: 3e3, extNode: void 0, button: void 0, width: void 0 }, e.isPlainObject(n.options.uiOptions.toast.defaults) ? n.options.uiOptions.toast.defaults : {}); return this.each(function () { t = Object.assign({}, i, t || {}); var a, o = e(this), r = function (e) { o.stop(), n.toFront(o), o[t.showMethod]({ duration: t.showDuration, easing: t.showEasing, complete: function () { t.onShown && t.onShown(), !e && t.timeOut && (a = setTimeout(s, t.timeOut)) } }) }, s = function () { o[t.hideMethod]({ duration: t.hideDuration, easing: t.hideEasing, complete: function () { t.onHidden && t.onHidden(), o.remove() } }) }; o.on("click", function (e) { e.stopPropagation(), e.preventDefault(), a && clearTimeout(a), t.onHidden && t.onHidden(), o.stop().remove() }).on("mouseenter mouseleave", function (e) { t.timeOut && (a && clearTimeout(a), a = null, "mouseenter" === e.type ? r(!0) : a = setTimeout(s, t.timeOut)) }).hide().addClass("toast-" + t.mode).append(e('<div class="elfinder-toast-msg"></div>').html(t.msg.replace(/%([a-zA-Z0-9]+)%/g, function (e, t) { return n.i18n(t) }))), t.extNode && o.append(t.extNode), t.button && o.append(e('<button class="ui-button ui-widget ui-state-default ui-corner-all elfinder-tabstop"></button>').append(e('<span class="ui-button-text"></span>').text(n.i18n(t.button.text))).on("mouseenter mouseleave", function (t) { e(this).toggleClass("ui-state-hover", "mouseenter" == t.type) }).on("click", t.button.click || function () { })), t.width && o.css("max-width", t.width), r() }) }, e.fn.elfindertoolbar = function (t, n) { return this.not(".elfinder-toolbar").each(function () { var i, a, o, r, s, l, c, d, p, u = t._commands, h = e(this).addClass("ui-helper-clearfix ui-widget-header elfinder-toolbar"), f = { displayTextLabel: !1, labelExcludeUA: ["Mobile"], autoHideUA: ["Mobile"], showPreferenceButton: "none" }, m = function (n) { var l, c; for (e.each(g, function (e, t) { t.detach() }), h.empty(), i = v.length; i--;)if (v[i]) { for (r = e('<div class="ui-widget-content ui-corner-all elfinder-buttonset"></div>'), a = v[i].length; a--;)l = v[i][a], n && n[l] || !(o = u[l]) || (s = "elfinder" + o.options.ui, !g[l] && e.fn[s] && (g[l] = e("<div></div>")[s](o)), g[l] && (g[l].children(".elfinder-button-text")[d ? "show" : "hide"](), r.prepend(g[l]))); r.children().length && h.prepend(r), r.children(":gt(0)").before('<span class="ui-widget-content elfinder-toolbar-button-separator"></span>') } (c = u.preference) && ("always" === f.showPreferenceButton || !h.children().length && "auto" === f.showPreferenceButton) && (r = e('<div class="ui-widget-content ui-corner-all elfinder-buttonset"></div>'), l = "preference", s = "elfinder" + o.options.ui, g[l] = e("<div></div>")[s](c), g[l].children(".elfinder-button-text")[d ? "show" : "hide"](), r.prepend(g[l]), h.append(r)), !h.data("swipeClose") && h.children().length ? h.show() : h.hide(), w = h[0].clientHeight, t.trigger("toolbarload").trigger("uiresize") }, g = {}, v = function (t) { return e.grep(t, function (t) { return !e.isPlainObject(t) || (f = Object.assign(f, t), !1) }) }(n || []), b = null, y = "", w = 0, x = []; f.showPreferenceButton = f.showPreferenceButton.toLowerCase(), "none" !== f.displayTextLabel && (d = null === (d = t.storage("toolbarTextLabel")) ? f.displayTextLabel && (!f.labelExcludeUA || !f.labelExcludeUA.length || !e.grep(f.labelExcludeUA, function (e) { return !!t.UA[e] }).length) : 1 == d, x.push({ label: t.i18n("textLabel"), icon: "text", callback: function () { d = !d, h.css("height", "").find(".elfinder-button-text")[d ? "show" : "hide"](), t.trigger("uiresize").storage("toolbarTextLabel", d ? "1" : "0") } })), f.preferenceInContextmenu && u.preference && x.push({ label: t.i18n("toolbarPref"), icon: "preference", callback: function () { t.exec("preference", void 0, { tab: "toolbar" }) } }), x.length && h.on("contextmenu", function (e) { e.stopPropagation(), e.preventDefault(), t.trigger("contextmenu", { raw: x, x: e.pageX, y: e.pageY }) }).on("touchstart", function (e) { e.originalEvent.touches.length > 1 || (h.data("tmlongtap") && clearTimeout(h.data("tmlongtap")), h.removeData("longtap").data("longtap", { x: e.originalEvent.touches[0].pageX, y: e.originalEvent.touches[0].pageY }).data("tmlongtap", setTimeout(function () { h.removeData("longtapTm").trigger({ type: "contextmenu", pageX: h.data("longtap").x, pageY: h.data("longtap").y }).data("longtap", { longtap: !0 }) }, 500))) }).on("touchmove touchend", function (e) { h.data("tmlongtap") && (("touchend" === e.type || Math.abs(h.data("longtap").x - e.originalEvent.touches[0].pageX) + Math.abs(h.data("longtap").y - e.originalEvent.touches[0].pageY) > 4) && clearTimeout(h.data("tmlongtap")), h.removeData("longtapTm")) }).on("click", function (e) { h.data("longtap") && h.data("longtap").longtap && (e.stopImmediatePropagation(), e.preventDefault()) }).on("touchend click", ".elfinder-button", function (e) { h.data("longtap") && h.data("longtap").longtap && (e.stopImmediatePropagation(), e.preventDefault()) }), h.prev().length && h.parent().prepend(this), m(), t.bind("open sync select toolbarpref", function () { var n, i, a, o = Object.assign({}, t.option("disabledFlip")), r = t.storage("toolbarhides"); if (!r && Array.isArray(f.defaultHides) && (r = {}, e.each(f.defaultHides, function () { r[this] = !0 }), t.storage("toolbarhides", r)), "select" === this.type) { if (t.searchStatus.state < 2) return; (i = t.selected()).length && (o = t.getDisabledCmds(i, !0)) } e.each(r, function (e) { o[e] || (o[e] = !0) }), Object.keys(t.commandMap).length && e.each(t.commandMap, function (e, t) { "hidden" === t && (o[e] = !0) }), a = Object.keys(o), b && b.toString() === a.sort().toString() || (m(a.length ? o : null), n = !0), b = a.sort(), (n || y !== JSON.stringify(t.commandMap)) && (y = JSON.stringify(t.commandMap), n || e.each(e("div.elfinder-button"), function () { var t = e(this).data("origin"); t && e(this).after(t).detach() }), Object.keys(t.commandMap).length && e.each(t.commandMap, function (n, i) { var a, o = t._commands[i], r = o ? "elfinder" + o.options.ui : null; r && e.fn[r] && (a = g[n]) && (!g[i] && e.fn[r] && (g[i] = e("<div></div>")[r](o), g[i] && (g[i].children(".elfinder-button-text")[d ? "show" : "hide"](), o.extendsCmd && g[i].children("span.elfinder-button-icon").addClass("elfinder-button-icon-" + o.extendsCmd))), g[i] && (a.after(g[i]), g[i].data("origin", a.detach()))) })) }).bind("resize", function (e) { p && cancelAnimationFrame(p), p = requestAnimationFrame(function () { var e = h[0].clientHeight; w !== e && (w = e, t.trigger("uiresize")) }) }), t.UA.Touch && (void 0 === (c = t.storage("autoHide") || {}).toolbar && (c.toolbar = f.autoHideUA && f.autoHideUA.length > 0 && e.grep(f.autoHideUA, function (e) { return !!t.UA[e] }).length, t.storage("autoHide", c)), c.toolbar && t.one("init", function () { t.uiAutoHide.push(function () { h.stop(!0, !0).trigger("toggle", { duration: 500, init: !0 }) }) }), t.bind("load", function () { "none" !== (l = e('<div class="elfinder-toolbar-swipe-handle"></div>').hide().appendTo(t.getUI())).css("pointer-events") && (l.remove(), l = null) }), h.on("toggle", function (e, n) { var i = t.getUI("workzone"), a = h.is(":hidden"), o = i.height(), r = h.height(), s = h.outerHeight(!0) - r, d = Object.assign({ step: function (e) { i.height(o + (a ? -1 * (e + s) : r - e)), t.trigger("resize") }, always: function () { requestAnimationFrame(function () { h.css("height", ""), t.trigger("uiresize"), l && (a ? l.stop(!0, !0).hide() : (l.height(n.handleH ? n.handleH : ""), t.resources.blink(l, "slowonce"))), a && h.scrollTop("0px"), n.init && t.trigger("uiautohide") }) } }, n); h.data("swipeClose", !a).stop(!0, !0).animate({ height: "toggle" }, d), c.toolbar = !a, t.storage("autoHide", Object.assign(t.storage("autoHide"), { toolbar: c.toolbar })) }).on("touchstart", function (e) { h.scrollBottom() > 5 && (e.originalEvent._preventSwipeY = !0) })) }), this }, e.fn.elfindertree = function (t, n) { var i = t.res("class", "tree"); return this.not("." + i).each(function () { var a, o, r, s, l = "class", c = t.UA.Mobile, d = t.res(l, "treeroot"), p = n.openRootOnLoad, u = n.openCwdOnOpen, h = u || n.syncTree, f = t.res(l, "navsubtree"), m = t.res(l, "treedir"), g = "span." + m, v = t.res(l, "navcollapse"), b = t.res(l, "navexpand"), y = "elfinder-subtree-loaded", w = t.res(l, "navarrow"), x = t.res(l, "active"), k = t.res(l, "adroppable"), C = t.res(l, "hover"), z = t.res(l, "disabled"), T = t.res(l, "draggable"), A = t.res(l, "droppable"), j = "elfinder-navbar-wrapper-root", O = "elfinder-navbar-wrapper-pastable", S = "elfinder-navbar-wrapper-uploadable", I = function (e) { var t = re.offset().left; return t <= e && e <= t + re.width() }, M = {}, E = [], F = function (n) { var i = []; if (e.each(n, function (e, n) { M[n] && i.push(t.navId2Hash(n)), delete M[n] }), i.length) return t.request({ data: { cmd: "subdirs", targets: i, preventDefault: !0 } }).done(function (n) { n && n.subdirs && e.each(n.subdirs, function (e, n) { var i = t.navHash2Elm(e); i.removeClass("elfinder-subtree-chksubdir"), i[n ? "addClass" : "removeClass"](v) }) }) }, D = null, U = function () { var n = Object.keys(M); n.length && (D && D._abort(), a && clearTimeout(a), E = [], D = t.asyncJob(function (n) { return t.isInWindow(e("#" + n)) ? n : null }, n, { numPerOnce: 200 }).done(function (e) { e.length && (E = e, q()) })) }, P = 0, q = function () { var e, i = n.subdirsMaxConn - P, o = t.maxTargets ? Math.min(t.maxTargets, n.subdirsAtOnce) : n.subdirsAtOnce; if (a && cancelAnimationFrame(a), E.length) if (i > 0) for (e = 0; e < i; e++)E.length && (P++, F(E.splice(0, o)).always(function () { P--, q() })); else a = requestAnimationFrame(function () { E.length && q() }) }, R = t.droppable.drop, H = e.extend(!0, {}, t.droppable, { over: function (n, i) { var a, o, r = e(this), s = i.helper, l = C + " " + k; if (n.stopPropagation(), s.data("dropover", s.data("dropover") + 1), r.data("dropover", !0), i.helper.data("namespace") !== t.namespace || !t.insideWorkzone(n.pageX, n.pageY)) return r.removeClass(l), void s.removeClass("elfinder-drag-helper-move elfinder-drag-helper-plus"); I(n.clientX) ? (s.removeClass("elfinder-drag-helper-move elfinder-drag-helper-plus"), r.addClass(C), r.is("." + v + ":not(." + b + ")") && r.data("expandTimer", setTimeout(function () { r.is("." + v + "." + C) && r.children("." + w).trigger("click") }, 500)), r.is(".elfinder-ro,.elfinder-na") ? r.removeClass(k) : (a = t.navId2Hash(r.attr("id")), r.data("dropover", a), e.each(i.helper.data("files"), function (e, n) { if (n === a || t.file(n).phash === a && !i.helper.hasClass("elfinder-drag-helper-plus")) return r.removeClass(l), !1 }), s.data("locked") ? o = "elfinder-drag-helper-plus" : (o = "elfinder-drag-helper-move", (n.shiftKey || n.ctrlKey || n.metaKey) && (o += " elfinder-drag-helper-plus")), r.hasClass(k) && s.addClass(o), requestAnimationFrame(function () { r.hasClass(k) && s.addClass(o) }))) : r.removeClass(l) }, out: function (t, n) { var i = e(this), a = n.helper; t.stopPropagation(), I(t.clientX) && a.removeClass("elfinder-drag-helper-move elfinder-drag-helper-plus"), a.data("dropover", Math.max(a.data("dropover") - 1, 0)), i.data("expandTimer") && clearTimeout(i.data("expandTimer")), i.removeData("dropover").removeClass(C + " " + k) }, deactivate: function () { e(this).removeData("dropover").removeClass(C + " " + k) }, drop: function (e, t) { I(e.clientX) && R.call(this, e, t) } }), _ = e(t.res("tpl", "navspinner")), N = t.res("tpl", "navdir"), L = t.res("tpl", "perms"), W = (t.res("tpl", "lock"), t.res("tpl", "symlink")), B = {}, $ = { id: function (e) { return t.navHash2Id(e.hash) }, name: function (e) { return t.escape(e.i18 || e.name) }, cssclass: function (e) { var i = (e.phash && !e.isroot ? "" : d) + " " + m + " " + t.perms2class(e); return e.dirs && !e.link && (i += " " + v) && -1 == e.dirs && (i += " elfinder-subtree-chksubdir"), n.getClass && (i += " " + n.getClass(e)), e.csscls && (i += " " + t.escape(e.csscls)), i }, title: function (e) { return n.attrTitle ? ' title="' + t.escape(t.path(e.hash, !0) || e.i18 || e.name) + '"' : "" }, root: function (t) { var n = ""; return !t.phash || t.isroot ? (n += " " + j, !t.disabled || t.disabled.length < 1 ? n += " " + O + " " + S : (-1 === e.inArray("paste", t.disabled) && (n += " " + O), -1 === e.inArray("upload", t.disabled) && (n += " " + S)), n) : "" }, permissions: function (e) { return e.read && e.write ? "" : L }, symlink: function (e) { return e.alias ? W : "" }, style: function (e) { return e.icon ? t.getIconStyle(e) : "" } }, V = function (e) { return N.replace(/(?:\{([a-z]+)\})/gi, function (t, n) { var i = $[n] ? $[n](e) : e[n] || ""; return "id" === n && -1 == e.dirs && (M[i] = i), i }) }, K = function (n, i) { return e.map(n || [], function (e) { return "directory" !== e.mime || i && !t.navHash2Elm(e.hash).length ? null : e }) }, X = function (e) { return e ? t.navHash2Elm(e).next("." + f) : ae }, J = function (e, n) { for (var i, a = e.children(":first"); a.length;) { if (t.file(t.navId2Hash(a.children("[id]").attr("id"))), (i = t.file(t.navId2Hash(a.children("[id]").attr("id")))) && Y(n, i) < 0) return a; a = a.next() } return e.children("button.elfinder-navbar-pager-next") }, G = function (i) { for (var a, o, r, s, l, d, p, u = i.length, h = [], f = u, m = e(), g = {}, v = t.cwd(), b = function (i, a, o, r) { var s = {}, l = 0, d = t.newAPI ? Math.min(1e4, Math.max(10, n.subTreeMax)) : 1e4, p = function () { s = {}, e.each(a, function (e, t) { s[t.hash] = e }) }, u = function (t, n) { var o, r; (t.stopPropagation(), n.select) ? m(h(n.select)) : n.change ? "prepare" === (r = n.change) ? e.each(a, function (e, t) { t.node && i.append(t.node.hide()) }) : "done" === r && e.each(a, function (e, t) { t.node && t.node.detach().show() }) : (n.removed && n.removed.length && (a = e.grep(a, function (e) { return -1 === n.removed.indexOf(e.hash) || (!o && (o = !0), !1) })), n.added && n.added.length && (a = a.concat(e.grep(n.added, function (e) { return void 0 === s[e.hash] && (!o && (o = !0), !0) }))), o && (a.sort(Y), p(), m(l))) }, h = function (e) { if (void 0 !== s[e]) return Math.floor(s[e] / d) * d }, f = t.navId2Hash(i.prev("[id]").attr("id")), m = function (n, o) { var r, s, b, y, w, x, k, C = [], z = {}; delete B[f], l = n, i.off("update." + t.namespace, u), a.length > d && (i.on("update." + t.namespace, u), void 0 === n && (0, p(), void 0 === (n = h(v.hash)) && (n = 0)), b = a.slice(n, n + d), B[f] = i, y = n ? Math.max(-1, n - d) : -1, w = n + d >= a.length ? 0 : n + d, r = Math.ceil(a.length / d), s = Math.ceil(n / d)), e.each(b || a, function (e, t) { C.push(V(t)), t.node && (z[t.hash] = t.node) }), x = y > -1 ? e('<button class="elfinder-navbar-pager elfinder-navbar-pager-prev"></button>').text(t.i18n("btnPrevious", s, r)).button({ icons: { primary: "ui-icon-caret-1-n" } }).on("click", function (e) { e.preventDefault(), e.stopPropagation(), m(y, "up") }) : e(), k = w ? e('<button class="elfinder-navbar-pager elfinder-navbar-pager-next"></button>').text(t.i18n("btnNext", s + 2, r)).button({ icons: { primary: "ui-icon-caret-1-s" } }).on("click", function (e) { e.preventDefault(), e.stopPropagation(), m(w, "down") }) : e(), g(), i.empty()[b ? "addClass" : "removeClass"]("elfinder-navbar-hasmore").append(x, C.join(""), k), e.each(z, function (e, n) { t.navHash2Elm(e).parent().replaceWith(n) }), o && Q(t.navHash2Id(b["up" === o ? b.length - 1 : 0].hash)), !c && t.lazy(function () { ne(null, i) }) }, g = function () { e.each(i.children(".elfinder-navbar-wrapper"), function (n, i) { var o, r, l = e(i), c = l.children("[id]:first"); c.hasClass(y) && (o = t.navId2Hash(c.attr("id"))) && void 0 !== (r = s[o]) && (a[r].node = l.detach()) }) }; m() }, w = {}, x = [], k = {}; f--;)g[(a = i[f]).hash] || t.navHash2Elm(a.hash).length || (g[a.hash] = !0, (o = X(a.phash)).length ? (void 0 === k[p = a.phash || "treeroot"] && (k[p] = o.children(":last")), s = !k[p].length, a.phash && (s || o.hasClass("elfinder-navbar-hasmore") || (r = J(o, a)).length) ? s ? (w[a.phash] || (w[a.phash] = []), w[a.phash].push(a)) : r ? (d = V(a), r.before(d), !c && (m = m.add(d))) : x.push(a) : (d = V(a), s ? o.prepend(d) : k[p].after(d), a.phash && !a.isroot || (l = t.navHash2Elm(a.hash).parent()), !c && ne(null, l))) : h.push(a)); Object.keys(w).length && e.each(w, function (e, t) { var n = X(e); t.sort(Y), b(n, t) }), x.length && o.trigger("update." + t.namespace, { added: x }), h.length && h.length < u ? G(h) : !c && m.length && t.lazy(function () { ne(m) }) }, Y = function (e, n) { if (t.sortAlsoTreeview) { var i, a = "asc" == t.sortOrder, o = t.sortType, r = t.sortRules; return i = a ? r[t.sortType](e, n) : r[t.sortType](n, e), "name" !== o && 0 === i ? i = a ? r.name(e, n) : r.name(n, e) : i } return t.sortRules.name(e, n) }, Q = function (i) { var a, r, s, l, c, d, p = e.Deferred(); return o && clearTimeout(o), o = setTimeout(function () { (a = e(document.getElementById(i || t.navHash2Id(t.cwd().hash)))).length ? ((u ? a : a.parent()).parents(".elfinder-navbar-wrapper").children("." + y).addClass(b).next("." + f).show(), r = ae.parent().stop(!1, !0), s = r.offset().top, l = r.height(), c = s + l - a.outerHeight(), (d = a.offset().top) < s || d > c ? r.animate({ scrollTop: r.scrollTop() + d - s - l / 3 }, { duration: n.durations.autoScroll, complete: function () { p.resolve() } }) : p.resolve()) : p.reject() }, 100), p }, Z = function (e) { var n, i, a, o = e || t.cwd(), r = o.hash ? [o.hash] : []; for (i = t.root(o.hash), a = t.file(i); a && (n = a.phash) && (r.unshift(n), i = t.root(n), a = t.file(i), !t.navHash2Elm(a.hash).hasClass(y));); return r }, ee = function (e) { var n = e || t.cwd(), i = n.hash, a = t.navHash2Elm(i); if (!a.length) { for (; n && n.phash;)B[n.phash] && !t.navHash2Elm(n.hash).length && B[n.phash].trigger("update." + t.namespace, { select: n.hash }), n = t.file(n.phash); a = t.navHash2Elm(i) } return a }, te = function (n, i) { var a, o, s, l, c, d, u, f, k = t.cwd(), C = k.hash, z = void 0 === i ? h : i, T = function (i, o) { var r, s = function () { p && a && (X(a.hash).show().prev(g).addClass(b), p = !1), z ? Q().done(U) : U() }; i && e.each(i, function (e, n) { n && G(n), ee(t.file(e)), n && ie(n, y) }), n && (t.api < 2.1 && n.push(k), G(n)), (r = ee()).hasClass(x) || (ae.find(g + "." + x).removeClass(x), r.addClass(x)), r.parents(".elfinder-navbar-wrapper").children("." + m).addClass(y), i ? t.lazy(s).done(function () { o.resolve() }) : (s(), o.resolve()) }, A = function (e) { a && (o.remove(), a.addClass(v + (e ? "" : " " + y))) }, j = e.Deferred(); return t.navHash2Elm(C).length ? T(void 0, j) : (r = !0, (u = e.Deferred(), f = Z(s), (l = e.map(f, function (e) { var n, i, a = t.file(e), o = !!a && t.isRoot(a), r = t.navHash2Elm(e), s = function (e, n) { var i, a, o = n || 1; return (a = !!(i = t.file(e)) && i.phash) && o > 1 ? s(a, --o) : a }, l = function () { var i = s(e); for (n = i; i && !t.navHash2Elm(i).hasClass(y);)n = i, i = s(i); return i || (n = void 0, i = t.root(e)), i }(); return r.hasClass(y) || !o && a && t.navHash2Elm(a.phash).hasClass(y) ? null : (o || l === s(e) || l === s(e, 2) ? (n = void 0, i = "tree", o || (e = s(e))) : i = "parents", c || (c = "tree" === i ? e : l), function (e, n, i) { var a = { cmd: e, target: n }; return i && (a.until = i), t.request({ data: a, preventFail: !0 }) }(i, e, n)) })).length ? (ee(t.file(c)), d = t.navHash2Id(c), z && Q(d), a = e("#" + d), o = e(t.res("tpl", "navspinner")).insertBefore(a.children("." + w)), a.removeClass(v), e.when.apply(e, l).done(function () { var e, t, n, i = {}; if ((t = arguments.length) > 0) for (n = 0; n < t; n++)e = arguments[n].tree || [], i[f[n]] = Object.assign([], K(e)); u.resolve(i) }).fail(function () { u.reject() }), u) : u.resolve()).done(function (e) { T(e, j), A() }).fail(function () { A(!0), j.reject() }).always(function () { r = !1 })), t.trigger("treesync", j), j }, ne = function (n, i) { n || (i && !i.closest("div." + j).hasClass(S) || (i || ae.find("div." + S)).find(g + ":not(.elfinder-ro,.elfinder-na)").addClass("native-droppable"), n = !i || i.closest("div." + j).hasClass(O) ? (i || ae.find("div." + O)).find(g + ":not(." + A + ")") : e(), i && i.children("div." + j).each(function () { ne(null, e(this)) })), n.length && t.asyncJob(function (t) { e(t).droppable(H) }, e.makeArray(n), { interval: 20, numPerOnce: 100 }) }, ie = function (n, i) { var a = i == y ? "." + v + ":not(." + y + ")" : ":not(." + v + ")"; e.each(n, function (n, o) { t.navHash2Elm(o.phash).filter(a).filter(function () { return e.grep(e(this).next("." + f).children(), function (t) { return !e(t).children().hasClass(d) }).length > 0 }).addClass(i) }) }, ae = e(this).addClass(i).on("mouseenter mouseleave", g, function (i) { var a = "mouseenter" === i.type; if (!a || !oe) { var o, r, s = e(this); s.hasClass(k + " " + z) || (c || !a || s.data("dragRegisted") || s.hasClass(d + " " + T + " elfinder-na elfinder-wo") || (s.data("dragRegisted", !0), t.isCommandEnabled("copy", o = t.navId2Hash(s.attr("id"))) && s.draggable(t.draggable)), s.toggleClass(C, a)), a && n.attrTitle && ((r = t.file(o || t.navId2Hash(s.attr("id")))).isroot || s.attr("title") !== (r.i18 || r.name) || s.attr("title", t.path(o, !0))) } }).on("dragenter", g, function (t) { if (t.originalEvent.dataTransfer) { var n = e(this); n.addClass(C), n.is("." + v + ":not(." + b + ")") && n.data("expandTimer", setTimeout(function () { n.is("." + v + "." + C) && n.children("." + w).trigger("click") }, 500)) } }).on("dragleave", g, function (t) { if (t.originalEvent.dataTransfer) { var n = e(this); n.data("expandTimer") && clearTimeout(n.data("expandTimer")), n.removeClass(C) } }).on("click", g, function (n) { var i = e(this), a = t.navId2Hash(i.attr("id")); t.file(a); if (i.data("longtap")) return i.removeData("longtap"), void n.stopPropagation(); i.hasClass(x) || (ae.find(g + "." + x).removeClass(x), i.addClass(x)), a == t.cwd().hash || i.hasClass(z) ? (i.hasClass(v) && i.children("." + w).trigger("click"), t.select({ selected: [a], origin: "navbar" })) : t.exec("open", a).done(function () { t.one("opendone", function () { t.select({ selected: [a], origin: "navbar" }) }) }) }).on("touchstart", g, function (n) { if (!(n.originalEvent.touches.length > 1)) { var i, a = n.originalEvent; "INPUT" !== n.target.nodeName ? i = e(this).addClass(C).removeData("longtap").data("tmlongtap", setTimeout(function (e) { i.data("longtap", !0), t.trigger("contextmenu", { type: "navbar", targets: [t.navId2Hash(i.attr("id"))], x: a.touches[0].pageX, y: a.touches[0].pageY }) }, 500)) : n.stopPropagation() } }).on("touchmove touchend", g, function (t) { "INPUT" !== t.target.nodeName ? (clearTimeout(e(this).data("tmlongtap")), e(this).removeData("tmlongtap"), "touchmove" == t.type && e(this).removeClass(C)) : t.stopPropagation() }).on("click", g + "." + v + " ." + w, function (i) { var a = e(this), o = a.parent(g), r = o.next("." + f), s = e.Deferred(); i.stopPropagation(), o.hasClass(y) ? (o.toggleClass(b), t.lazy(function () { (o.hasClass(b) ? r.children().length + r.find("div.elfinder-navbar-subtree[style*=block]").children().length : r.find("div:visible").length) > 30 ? (r.toggle(), t.draggingUiHelper && t.draggingUiHelper.data("refreshPositions", 1), U()) : r.stop(!0, !0)[o.hasClass(b) ? "slideDown" : "slideUp"](n.durations.slideUpDown, function () { t.draggingUiHelper && t.draggingUiHelper.data("refreshPositions", 1), U() }) }).always(function () { s.resolve() })) : (_.insertBefore(a), o.removeClass(v), t.request({ cmd: "tree", target: t.navId2Hash(o.attr("id")) }).done(function (e) { G(Object.assign([], K(e.tree))), r.children().length && (o.addClass(v + " " + b), r.children().length > 30 ? (r.show(), t.draggingUiHelper && t.draggingUiHelper.data("refreshPositions", 1), U()) : r.stop(!0, !0).slideDown(n.durations.slideUpDown, function () { t.draggingUiHelper && t.draggingUiHelper.data("refreshPositions", 1), U() })) }).always(function (e) { _.remove(), o.addClass(y), t.one("treedone", function () { s.resolve() }) })), a.data("dfrd", s) }).on("contextmenu", g, function (n) { var i = e(this); i.find("input:text").length ? n.stopPropagation() : (n.preventDefault(), i.data("tmlongtap") || t.trigger("contextmenu", { type: "navbar", targets: [t.navId2Hash(e(this).attr("id"))], x: n.pageX, y: n.pageY }), i.addClass("ui-state-hover"), t.getUI("contextmenu").children().on("mouseenter", function () { i.addClass("ui-state-hover") }), t.bind("closecontextmenu", function () { i.removeClass("ui-state-hover") })) }).on("scrolltoview", g, function (n, i) { var a = e(this); Q(a.attr("id")).done(function () { i && "undefined" !== i.blink && !i.blink || t.resources.blink(a, "lookme") }) }).on("create." + t.namespace, function (n, i) { var a = X(i.phash), o = i.move || !1, r = e(V(i)).addClass("elfinder-navbar-wrapper-tmp"), s = t.selected(); o && s.length && t.trigger("lockfiles", { files: s }), a.prepend(r) }), oe = !1, re = t.getUI("navbar").append(ae).show().on("scroll", function () { oe = !0, s && cancelAnimationFrame(s), s = requestAnimationFrame(function () { oe = !1, U() }) }), se = t.sortAlsoTreeview; t.open(function (e) { var n = e.data, i = K(n.files), a = t.getUI("contextmenu"); n.init && ae.empty(), t.UA.iOS && re.removeClass("overflow-scrolling-touch").addClass("overflow-scrolling-touch"), i.length ? t.lazy(function () { a.data("cmdMaps") || a.data("cmdMaps", {}), G(i), ie(i, y), te(i) }) : te() }).add(function (e) { var t = K(e.data.added); t.length && (G(t), ie(t, v)) }).change(function (n) { if (!r) { var i, a, o, s, l, d, p, u, h, m, v, w, x = K(n.data.changed, !0), k = x.length, C = k; e(); for (e.each(B, function (e, n) { n.trigger("update." + t.namespace, { change: "prepare" }) }); C--;)if (a = (i = x[C]).phash, (o = t.navHash2Elm(i.hash)).length) { if (v = o.parent(), a) { if (l = o.closest("." + f), d = X(a), p = o.parent().next(), u = J(d, i), !d.length) continue; d[0] === l[0] && p.get(0) === u.get(0) || (u.length ? u.before(v) : d.append(v)) } h = o.hasClass(b), m = o.hasClass(y), s = e(V(i)), o.replaceWith(s.children(g)), !c && ne(null, v), i.dirs && (h || m) && (o = t.navHash2Elm(i.hash)) && o.next("." + f).children().length && (h && o.addClass(b), m && o.addClass(y)), w |= -1 == i.dirs } w && U(), e.each(B, function (e, n) { n.trigger("update." + t.namespace, { change: "done" }) }), k && te(void 0, !1) } }).remove(function (n) { var i, a, o, r = n.data.removed, s = r.length; for (e.each(B, function (e, n) { n.trigger("update." + t.namespace, { removed: r }), n.trigger("update." + t.namespace, { change: "prepare" }) }); s--;)(i = t.navHash2Elm(r[s])).length && (o = !0, a = i.closest("." + f), i.parent().detach(), a.children().length || a.hide().prev(g).removeClass(v + " " + b + " " + y)); o && t.getUI("navbar").children(".ui-resizable-handle").trigger("resize"), e.each(B, function (e, n) { n.trigger("update." + t.namespace, { change: "done" }) }) }).bind("lockfiles unlockfiles", function (n) { var i = "lockfiles" == n.type, a = !!n.data.helper && n.data.helper.data("locked"), o = i && !a ? "disable" : "enable", r = e.grep(n.data.files || [], function (e) { var n = t.file(e); return !(!n || "directory" != n.mime) }); e.each(r, function (e, n) { var r = t.navHash2Elm(n); r.length && !a && (r.hasClass(T) && r.draggable(o), r.hasClass(A) && r.droppable(o), r[i ? "addClass" : "removeClass"](z)) }) }).bind("sortchange", function () { if (t.sortAlsoTreeview || se !== t.sortAlsoTreeview) { var n, i = [], a = {}, o = {}, r = "", s = !1; t.lazy(function () { n = K(t.files()), se = t.sortAlsoTreeview, ae.empty(), G(e.map(t.roots, function (e) { var n = t.file(e); return n && !n.phash ? n : null })), Object.keys(B).length ? ((i = Z()).length > 1 ? (e.each(i, function (e, n) { var i = t.file(t.root(n)).volumeid; 0 === e && (r = i), o[i] = n, a[n] = [] }), e.each(n, function (e, t) { if (!t.volumeid) return s = !0, !1; a[o[t.volumeid] || o[r]].push(t) })) : s = !0, s ? e.each(i, function (e, i) { G(n), ee(t.file(i)), ie(n, y) }) : e.each(a, function (e, n) { G(n), ee(t.file(e)), ie(n, y) })) : (G(n), ee(), ie(n, y)), te() }, 100) } }) }), this }, e.fn.elfinderuploadbutton = function (t) { return this.each(function () { var n, i = t.fm, a = e(this).elfinderbutton(t).off("click"), o = e("<form></form>").appendTo(a), r = e('<input type="file" multiple="true" title="' + t.fm.i18n("selectForUpload") + '"/>').on("change", function () { var t = e(this); t.val() && (i.exec("upload", { input: t.remove()[0] }, void 0, i.cwd().hash), r.clone(!0).appendTo(o)) }).on("dragover", function (e) { e.originalEvent.dataTransfer.dropEffect = "copy" }); o.append(r.clone(!0)), t.change(function () { n && cancelAnimationFrame(n), n = requestAnimationFrame(function () { var e = t.disabled(); o.is("visible") ? !e && o.hide() : e && o.show() }) }).change() }) }, e.fn.elfinderviewbutton = function (t) { return this.each(function () { var n, i = e(this).elfinderbutton(t), a = i.children(".elfinder-button-icon"), o = i.children(".elfinder-button-text"); t.change(function () { n && cancelAnimationFrame(n), n = requestAnimationFrame(function () { var e = "icons" == t.value; a.toggleClass("elfinder-button-icon-view-list", e), t.className = e ? "view-list" : "", t.title = t.fm.i18n(e ? "viewlist" : "viewicons"), i.attr("title", t.title), o.html(t.title) }) }) }) }, e.fn.elfinderworkzone = function (t) { var n = "elfinder-workzone"; return this.not("." + n).each(function () { var i, a = e(this).addClass(n), o = Math.round(a.height()), r = a.parent(), s = function () { i = a.outerHeight(!0) - a.height() }, l = function (s) { var l = r.height() - i, c = r.attr("style"), d = Math.round(a.height()); s && (s.preventDefault(), s.stopPropagation()), r.css("overflow", "hidden").children(":visible:not(." + n + ")").each(function () { var t = e(this); "absolute" != t.css("position") && "fixed" != t.css("position") && (l -= t.outerHeight(!0)) }), r.attr("style", c || ""), l = Math.max(0, Math.round(l)), o === l && d === l || (o = Math.round(a.height()), a.height(l), t.trigger("wzresize")) }; s(), r.on("resize." + t.namespace, l), t.one("cssloaded", function () { i = a.outerHeight(!0) - a.height(), l() }).bind("uiresize", l).bind("themechange", s) }), this }, h.prototype.commands.archive = function () { var t, n = this, i = n.fm, a = []; this.variants = [], this.disableOnSearch = !1, this.nextAction = {}, i.bind("open reload", function () { n.variants = [], e.each(a = i.option("archivers").create || [], function (e, t) { n.variants.push([t, i.mime2kind(t)]) }), n.change() }), this.getstate = function (n) { var o, r = this.files(n), s = r.length, l = s && !i.isRoot(r[0]) && (i.file(r[0].phash) || {}).write && !e.grep(r, function (e) { return !e.read }).length; return l && i.searchStatus.state > 1 && (o = i.cwd().volumeid, l = s === e.grep(r, function (e) { return !(!e.read || 0 !== e.hash.indexOf(o)) }).length), l && !this._disabled && a.length && (s || t && "pending" == t.state()) ? 0 : -1 }, this.exec = function (o, r) { var s, l = this.files(o), c = l.length, d = r || a[0], p = i.file(l[0].phash) || null, u = ["errArchive", "errPerm", "errCreatingTempDir", "errFtpDownloadFile", "errFtpUploadFile", "errFtpMkdir", "errArchiveExec", "errExtractExec", "errRm"]; if (t = e.Deferred().fail(function (e) { e && i.error(e) }), !c || !a.length || -1 === e.inArray(d, a)) return t.reject(); if (!p.write) return t.reject(u); for (s = 0; s < c; s++)if (!l[s].read) return t.reject(u); return n.mime = d, n.prefix = (c > 1 ? "Archive" : l[0].name) + (i.option("archivers").createext ? "." + i.option("archivers").createext[d] : ""), n.data = { targets: n.hashes(o), type: d }, i.cwd().hash !== p.hash ? i.exec("open", p.hash).done(function () { i.one("cwdrender", function () { i.selectfiles({ files: o }), t = e.proxy(i.res("mixin", "make"), n)() }) }) : (i.selectfiles({ files: o }), t = e.proxy(i.res("mixin", "make"), n)()), t } }, (h.prototype.commands.back = function () { this.alwaysEnabled = !0, this.updateOnSelect = !1, this.shortcuts = [{ pattern: "ctrl+left backspace" }], this.getstate = function () { return this.fm.history.canBack() ? 0 : -1 }, this.exec = function () { return this.fm.history.back() } }).prototype = { forceLoad: !0 }, h.prototype.commands.chmod = function () { this.updateOnSelect = !1; var t = this.fm, n = { 0: "owner", 1: "group", 2: "other" }, i = { read: t.i18n("read"), write: t.i18n("write"), execute: t.i18n("execute"), perm: t.i18n("perm"), kind: t.i18n("kind"), files: t.i18n("files") }, a = function (e) { return !isNaN(parseInt(e, 8) && parseInt(e, 8) <= 511) || e.match(/^([r-][w-][x-]){3}$/i) }; this.tpl = { main: '<div class="ui-helper-clearfix elfinder-info-title"><span class="elfinder-cwd-icon {class} ui-corner-all"></span>{title}</div>{dataTable}', itemTitle: '<strong>{name}</strong><span id="elfinder-info-kind">{kind}</span>', groupTitle: "<strong>{items}: {num}</strong>", dataTable: '<table id="{id}-table-perm"><tr><td>{0}</td><td>{1}</td><td>{2}</td></tr></table><div class="">' + i.perm + ': <input class="elfinder-tabstop elfinder-focus" id="{id}-perm" type="text" size="4" maxlength="3" value="{value}"></div>', fieldset: '<fieldset id="{id}-fieldset-{level}"><legend>{f_title}{name}</legend><input type="checkbox" value="4" class="elfinder-tabstop" id="{id}-read-{level}-perm"{checked-r}> <label for="{id}-read-{level}-perm">' + i.read + '</label><br><input type="checkbox" value="6" class="elfinder-tabstop" id="{id}-write-{level}-perm"{checked-w}> <label for="{id}-write-{level}-perm">' + i.write + '</label><br><input type="checkbox" value="5" class="elfinder-tabstop" id="{id}-execute-{level}-perm"{checked-x}> <label for="{id}-execute-{level}-perm">' + i.execute + "</label><br>" }, this.shortcuts = [{}], this.getstate = function (e) { var t = this.fm; return 0 == (e = e || t.selected()).length && (e = [t.cwd().hash]), this.checkstate(this.files(e)) ? 0 : -1 }, this.checkstate = function (t) { var n = t.length; if (!n) return !1; var i = e.grep(t, function (e) { return !(!(e.isowner && e.perm && a(e.perm)) || 1 != n && "directory" == e.mime) }).length; return n == i }, this.exec = function (t) { var o = this.hashes(t), r = this.files(o); r.length || (o = [this.fm.cwd().hash], r = this.files(o)); var s, l, c = this.fm, d = e.Deferred().always(function () { c.enable() }), p = this.tpl, u = r.length, h = r[0], f = c.namespace + "-perm-" + h.hash, m = p.main, g = ' checked="checked"', v = function () { var t, n = e.trim(e("#" + f + "-perm").val()); if (!a(n)) return !1; x.elfinderdialog("close"), t = { cmd: "chmod", targets: o, mode: n }, c.request({ data: t, notify: { type: "chmod", cnt: u } }).fail(function (e) { d.reject(e) }).done(function (n) { n.changed && n.changed.length && (n.undo = { cmd: "chmod", callback: function () { var t = []; return e.each(k, function (e, n) { t.push(c.request({ data: { cmd: "chmod", targets: n, mode: e }, notify: { type: "undo", cnt: n.length } })) }), e.when.apply(null, t) } }, n.redo = { cmd: "chmod", callback: function () { return c.request({ data: t, notify: { type: "redo", cnt: o.length } }) } }), d.resolve(n) }) }, b = function () { for (var t, i = "", a = 0; a < 3; a++)t = 0, e("#" + f + "-read-" + n[a] + "-perm").is(":checked") && (t |= 4), e("#" + f + "-write-" + n[a] + "-perm").is(":checked") && (t |= 2), e("#" + f + "-execute-" + n[a] + "-perm").is(":checked") && (t |= 1), i += t.toString(8); e("#" + f + "-perm").val(i) }, y = function (e) { if (isNaN(parseInt(e, 8))) { for (var t = e.split(""), n = [], i = 0, a = t.length; i < a; i++)0 === i || 3 === i || 6 === i ? t[i].match(/[r]/i) ? n.push(1) : t[i].match(/[-]/) && n.push(0) : 1 === i || 4 === i || 7 === i ? t[i].match(/[w]/i) ? n.push(1) : t[i].match(/[-]/) && n.push(0) : t[i].match(/[x]/i) ? n.push(1) : t[i].match(/[-]/) && n.push(0); n.splice(3, 0, ","), n.splice(7, 0, ","); for (var o = n.join("").split(","), r = [], s = 0, l = o.length; s < l; s++) { var c = parseInt(o[s], 2).toString(8); r.push(c) } e = r.join("") } else e = parseInt(e, 8).toString(8); return e }, w = { title: this.title, width: "auto", buttons: function () { var e = {}; return e[c.i18n("btnApply")] = v, e[c.i18n("btnCancel")] = function () { x.elfinderdialog("close") }, e }(), close: function () { e(this).elfinderdialog("destroy") } }, x = c.getUI().find("#" + f), k = {}, C = ""; return x.length ? (x.elfinderdialog("toTop"), e.Deferred().resolve()) : (m = m.replace("{class}", u > 1 ? "elfinder-cwd-icon-group" : c.mime2class(h.mime)), u > 1 ? s = p.groupTitle.replace("{items}", c.i18n("items")).replace("{num}", u) : (s = p.itemTitle.replace("{name}", h.name).replace("{kind}", c.mime2kind(h)), C = c.tmb(h)), l = function (e, t) { for (var a, o, r, s = "", l = p.dataTable, d = 0; d < 3; d++)s += (a = parseInt(e.slice(d, d + 1), 8)).toString(8), o = p.fieldset.replace("{f_title}", c.i18n(n[d])).replace("{name}", (r = t[n[d]], r ? ":" + r : "")).replace(/\{level\}/g, n[d]), l = l.replace("{" + d + "}", o).replace("{checked-r}", 4 == (4 & a) ? g : "").replace("{checked-w}", 2 == (2 & a) ? g : "").replace("{checked-x}", 1 == (1 & a) ? g : ""); return l = l.replace("{value}", s).replace("{valueCaption}", i.perm) }(function (e) { for (var t, n, i, a = "777", o = "", r = e.length, s = 0; s < r; s++) { t = y(e[s].perm), k[t] || (k[t] = []), k[t].push(e[s].hash), o = ""; for (var l = 0; l < 3; l++)n = parseInt(t.slice(l, l + 1), 8), i = parseInt(a.slice(l, l + 1), 8), 4 != (4 & n) && 4 == (4 & i) && (i -= 4), 2 != (2 & n) && 2 == (2 & i) && (i -= 2), 1 != (1 & n) && 1 == (1 & i) && (i -= 1), o += i.toString(8); a = o } return a }(r), 1 == r.length ? r[0] : {}), m = m.replace("{title}", s).replace("{dataTable}", l).replace(/{id}/g, f), (x = this.fmDialog(m, w)).attr("id", f), C && e("<img/>").on("load", function () { x.find(".elfinder-cwd-icon").addClass(C.className).css("background-image", "url('" + C.url + "')") }).attr("src", C.url), e("#" + f + "-table-perm :checkbox").on("click", function () { b() }), e("#" + f + "-perm").on("keydown", function (t) { if (t.keyCode == e.ui.keyCode.ENTER) return t.stopPropagation(), void v() }).on("focus", function (t) { e(this).trigger("select") }).on("keyup", function (t) { 3 == e(this).val().length && (e(this).trigger("select"), function (t) { for (var i, a = 0; a < 3; a++)i = parseInt(t.slice(a, a + 1), 8), e("#" + f + "-read-" + n[a] + "-perm").prop("checked", !1), e("#" + f + "-write-" + n[a] + "-perm").prop("checked", !1), e("#" + f + "-execute-" + n[a] + "-perm").prop("checked", !1), 4 == (4 & i) && e("#" + f + "-read-" + n[a] + "-perm").prop("checked", !0), 2 == (2 & i) && e("#" + f + "-write-" + n[a] + "-perm").prop("checked", !0), 1 == (1 & i) && e("#" + f + "-execute-" + n[a] + "-perm").prop("checked", !0); b() }(e(this).val())) }), d) } }, h.prototype.commands.colwidth = function () { this.alwaysEnabled = !0, this.updateOnSelect = !1, this.getstate = function () { return "fixed" === this.fm.getUI("cwd").find("table").css("table-layout") ? 0 : -1 }, this.exec = function () { return this.fm.getUI("cwd").trigger("colwidth"), e.Deferred().resolve() } }, h.prototype.commands.copy = function () { this.shortcuts = [{ pattern: "ctrl+c ctrl+insert" }], this.getstate = function (t) { var n = this.files(t), i = n.length; return i && e.grep(n, function (e) { return !!e.read }).length == i ? 0 : -1 }, this.exec = function (t) { var n = this.fm, i = e.Deferred().fail(function (e) { n.error(e) }); return e.each(this.files(t), function (e, t) { if (!t.read) return !i.reject(["errCopy", t.name, "errPerm"]) }), "rejected" == i.state() ? i : i.resolve(n.clipboard(this.hashes(t))) } }, h.prototype.commands.cut = function () { var t = this.fm; this.shortcuts = [{ pattern: "ctrl+x shift+insert" }], this.getstate = function (n) { var i = this.files(n), a = i.length; return a && e.grep(i, function (e) { return !(!e.read || e.locked || t.isRoot(e)) }).length == a ? 0 : -1 }, this.exec = function (n) { var i = e.Deferred().fail(function (e) { t.error(e) }); return e.each(this.files(n), function (e, n) { return !n.read || n.locked || t.isRoot(n) ? !i.reject(["errCopy", n.name, "errPerm"]) : n.locked ? !i.reject(["errLocked", n.name]) : void 0 }), "rejected" == i.state() ? i : i.resolve(t.clipboard(this.hashes(n), !0)) } }, h.prototype.commands.zipdl = function () { }, h.prototype.commands.download = function () { var t = this, n = this.fm, i = null, a = !1, o = !1, r = !1, s = window.location.pathname || "/", l = function (r, s) { var l, c; if (null !== i && (n.searchStatus.state > 1 ? o = n.searchStatus.mixed : n.leafRoots[n.cwd().hash] && (l = n.cwd().volumeid, e.each(r, function (e, t) { if (0 !== t.indexOf(l)) return o = !0, !1 })), a = n.isCommandEnabled("zipdl", r[0])), o) { if (c = i ? "zipdl" : "download", !(r = e.grep(r, function (e) { var t = n.file(e), a = !(!t || !i && "directory" === t.mime || !n.isCommandEnabled(c, e)); return t && s && !a && n.cwdHash2Elm(t.hash).trigger("unselect"), a })).length) return [] } else if (!n.isCommandEnabled("download", r[0])) return []; return e.grep(t.files(r), function (e) { var t = !(!e.read || !a && "directory" == e.mime); return s && !t && n.cwdHash2Elm(e.hash).trigger("unselect"), t }) }; this.linkedCmds = ["zipdl"], this.shortcuts = [{ pattern: "shift+enter" }], this.getstate = function (e) { var t = this.hashes(e), i = t.length, o = this.options.maxRequests || 10; return i < 1 ? -1 : (i = l(t).length) && (a || i <= o && (!n.UA.IE && !n.UA.Mobile || 1 == i)) ? 0 : -1 }, n.bind("contextmenu", function (n) { var i, a, o, r = t.fm, s = null, l = function (t) { var n = t.url || r.url(t.hash); return { icon: "link", node: e("<a></a>").attr({ href: n, target: "_blank", title: r.i18n("link") }).text(t.name).on("mousedown click touchstart touchmove touchend contextmenu", function (e) { e.stopPropagation() }).on("dragstart", function (n) { var i, a, o, l, c = n.dataTransfer || n.originalEvent.dataTransfer || null; if (s = null, c) { c.effectAllowed = "copyLink", c.setDragImage && (s = e('<div class="elfinder-drag-helper html5-native">').append((i = t, o = i.mime, l = r.tmb(i), a = '<div class="elfinder-cwd-icon ' + r.mime2class(o) + ' ui-corner-all"></div>', l && (a = e(a).addClass(l.className).css("background-image", "url('" + l.url + "')").get(0).outerHTML), a)).appendTo(e(document.body)), c.setDragImage(s.get(0), 50, 47)), r.UA.IE || (c.setData("elfinderfrom", window.location.href + t.phash), c.setData("elfinderfrom:" + c.getData("elfinderfrom"), "")) } }).on("dragend", function (e) { s && s.remove() }) } }; (t.extra = null, n.data) && (1 === (i = n.data.targets || []).length && (a = r.file(i[0])) && "directory" !== a.mime && ("1" != a.url ? t.extra = l(a) : (t.extra = { icon: "link", node: e("<a></a>").attr({ href: "#", title: r.i18n("getLink"), draggable: "false" }).text(a.name).on("click touchstart", function (e) { if (!("touchstart" === e.type && e.originalEvent.touches.length > 1)) { var t = o.parent(); e.stopPropagation(), e.preventDefault(), t.removeClass("ui-state-disabled").addClass("elfinder-button-icon-spinner"), r.request({ data: { cmd: "url", target: a.hash }, preventDefault: !0 }).always(function (e) { (t.removeClass("elfinder-button-icon-spinner"), e.url) ? (r.file(a.hash).url = e.url, o.replaceWith(l(a).node)) : t.addClass("ui-state-disabled") }) } }) }, (o = t.extra.node).ready(function () { requestAnimationFrame(function () { o.parent().addClass("ui-state-disabled").css("pointer-events", "auto") }) })))) }).one("open", function () { n.api >= 2.1012 && (i = n.getCommand("zipdl")), r = n.cookieEnabled && n.api > 2.1038 && !n.isCORS }), this.exec = function (n) { var i, c, d, p, u, h, f, m, g, v = this.hashes(n), b = this.fm, y = (b.options.url, l(v, !0)), w = e.Deferred(), x = "", k = {}, C = !1, z = function (e) { var t; "function" == typeof MouseEvent ? t = new MouseEvent("click") : (t = document.createEvent("MouseEvents")).initMouseEvent("click", !0, !0, window, 0, 0, 0, 0, 0, !1, !1, !1, !1, 0, null), b.pauseUnloadCheck(!0), e.dispatchEvent(t) }, T = function (e) { var t = "elfdl" + e; 2 === document.cookie.split(t + "=").length ? (h && clearTimeout(h), document.cookie = t + "=; path=" + s + "; max-age=0", A()) : setTimeout(function () { T(e) }, 200) }, A = function () { b.ui.notify.children(".elfinder-notify-download").length && b.notify({ type: "download", cnt: -1 }) }, j = []; if (!y.length) return w.reject(); if (u = e.grep(y, function (e) { return "directory" !== e.mime }).length, d = e("<a>").hide().appendTo("body"), p = "string" == typeof d.get(0).download, a && (u !== y.length || u >= (this.options.minFilesZipdl || 1))) return d.remove(), C = !p && b.UA.Mobile, o ? (k = {}, e.each(y, function (e, t) { var n = t.hash.split("_", 2); k[n[0]] ? k[n[0]].push(t.hash) : k[n[0]] = [t.hash] }), !C && b.UA.Mobile && Object.keys(k).length > 1 && (C = !0)) : k = [e.map(y, function (e) { return e.hash })], w = b.sequence(e.map(k, function (n) { return i = n, function () { var n, a, o, r = e.Deferred(), s = b.file(b.root(i[0])), l = 1 === i.length, d = s ? s.i18 || s.name : null; return l ? (n = b.file(i[0])) && (a = n.i18 || n.name) : (e.each(i, function () { var e = b.file(this); if (!e || o && o !== e.phash) return o = null, !1; o = e.phash }), o && (n = b.file(o)) && (a = (n.i18 || n.name) + "-" + i.length)), a && (d = a), d && (d = " (" + d + ")"), b.request({ data: { cmd: "zipdl", targets: i }, notify: { type: "zipdl", cnt: 1, hideCnt: !0, msg: b.i18n("ntfzipdl") + d }, cancel: !0, eachCancel: !0, preventDefault: !0 }).done(function (n) { var o, s, l, d, u, h, f = {}, m = "dlw" + +new Date, g = function (n) { l = e("<a></a>").attr("href", n).attr("download", b.escape(a)).on("click", function () { r.resolve(), s && s.elfinderdialog("destroy") }), C ? (l.attr("target", "_blank").append('<span class="elfinder-button-icon elfinder-button-icon-download"></span>' + b.escape(a)), f[b.i18n("btnCancel")] = function () { s.elfinderdialog("destroy") }, s = t.fmDialog(l, { title: b.i18n("link"), buttons: f, width: "200px", destroyOnClose: !0, close: function () { "resolved" !== r.state() && r.resolve() } })) : (z(l.hide().appendTo("body").get(0)), l.remove()) }; n.error ? (b.error(n.error), r.resolve()) : n.zipdl && (o = n.zipdl, a ? (h = b.splitFileExtention(o.name || ""), a += h[1] ? "." + h[1] : ".zip") : a = o.name, p || C ? (c = b.options.url + (-1 === b.options.url.indexOf("?") ? "?" : "&") + "cmd=zipdl&download=1", e.each([i[0], o.file, a, o.mime], function (e, t) { c += "&targets%5B%5D=" + encodeURIComponent(t) }), e.each(b.customData, function (e, t) { c += "&" + encodeURIComponent(e) + "=" + encodeURIComponent(t) }), c += "&" + encodeURIComponent(a), b.hasParrotHeaders() ? b.getBinaryByUrl({ url: c }, function (e) { e instanceof Blob ? (c = (window.URL || window.webkitURL).createObjectURL(e), g(c)) : b.error(["errUploadTransfer", b.i18n("kindZIP")]) }) : g(c)) : (d = e('<form action="' + b.options.url + '" method="post" target="' + m + '" style="display:none"></form>').append('<input type="hidden" name="cmd" value="zipdl"/>').append('<input type="hidden" name="download" value="1"/>'), e.each([i[0], o.file, a, o.mime], function (e, t) { d.append('<input type="hidden" name="targets[]" value="' + b.escape(t) + '"/>') }), e.each(b.customData, function (e, t) { d.append('<input type="hidden" name="' + e + '" value="' + b.escape(t) + '"/>') }), d.attr("target", m).appendTo("body"), u = e('<iframe style="display:none" name="' + m + '">').appendTo("body").ready(function () { d.submit().remove(), r.resolve(), setTimeout(function () { u.remove() }, 2e4) }))) }).fail(function (e) { e && b.error(e), r.resolve() }), r.promise() }; var i })).always(function () { b.trigger("download", { files: y }) }); for (j = [], m = e.Deferred().done(function (t) { for (i = 0; i < t.length; i++)c = t[i], r && c.substr(0, b.options.url.length) === b.options.url && (f = b.getRequestId(), j.push(f), c += "&cpath=" + s + "&reqid=" + f, h = setTimeout(function () { b.notify({ type: "download", cnt: 1, cancel: b.UA.IE || b.UA.Edge ? void 0 : function () { j.length && e.each(j, function () { b.request({ data: { cmd: "abort", id: this }, preventDefault: !0 }) }), j = [] } }) }, b.notifyDelay), T(f)), p ? z(d.attr("href", c).attr("download", b.escape(y[i].name)).get(0)) : b.UA.Mobile ? setTimeout(function () { window.open(c) || (b.error("errPopup"), h && cleaerTimeout(h), A()) }, 100) : x += '<iframe class="downloader" id="downloader-' + y[i].hash + '" style="display:none" src="' + c + '"></iframe>'; d.remove(), e(x).appendTo("body").ready(function () { setTimeout(function () { e(x).each(function () { e("#" + e(this).attr("id")).remove() }) }, 2e4 + 1e4 * i) }), b.trigger("download", { files: y }), w.resolve() }), u = y.length, g = [], i = 0; i < y.length; i++)b.openUrl(y[i].hash, !0, function (e) { e && g.push(e), --u < 1 && m.resolve(g) }); return w } }, h.prototype.commands.duplicate = function () { var t = this.fm; this.getstate = function (n) { var i = this.files(n), a = i.length; return a && t.cwd().write && e.grep(i, function (e) { return !(!e.read || e.phash !== t.cwd().hash || t.isRoot(e)) }).length == a ? 0 : -1 }, this.exec = function (t) { var n = this.fm, i = this.files(t), a = i.length, o = e.Deferred().fail(function (e) { e && n.error(e) }); return a ? (e.each(i, function (e, t) { if (!t.read || !n.file(t.phash).write) return !o.reject(["errCopy", t.name, "errPerm"]) }), "rejected" == o.state() ? o : n.request({ data: { cmd: "duplicate", targets: this.hashes(t) }, notify: { type: "copy", cnt: a }, navigate: { toast: { inbuffer: { msg: n.i18n(["complete", n.i18n("cmdduplicate")]) } } } })) : o.reject() } }, h.prototype.commands.edit = function () { var t, n = this, i = this.fm, a = i.res("class", "editing"), o = [], r = [], s = !1, l = function (t) { var a, o = e('<select class="ui-corner-all"></select>'); return t && e.each(t, function (e, t) { a = i.escape(t.value), o.append('<option value="' + a + '">' + (t.caption ? i.escape(t.caption) : a) + "</option>") }), e.each(n.options.encodings, function (e, t) { o.append('<option value="' + t + '">' + t + "</option>") }), o }, c = function () { if (n.options.dialogHeight) { var t, a, o = i.options.dialogContained ? i.getUI() : e(window); return a = "string" == typeof n.options.dialogHeight && (t = n.options.dialogHeight.match(/(\d+)%/)) ? parseInt(o.height() * (t[1] / 100)) : parseInt(n.options.dialogHeight || o.height()), Math.min(a, o.height()) } }, d = function (t) { var a, l, c, d = t.length; return d > 1 && (a = t[0].mime, l = t[0].name.replace(/^.*(\.[^.]+)$/, "$1")), e.grep(t, function (t) { var p; return !c && "directory" !== t.mime && ((p = t.read && (s || i.mimeIsText(t.mime) || -1 !== e.inArray(t.mime, 1 === d ? o : r)) && (!n.onlyMimes.length || -1 !== e.inArray(t.mime, n.onlyMimes)) && (1 === d || t.mime === a && t.name.substr(-1 * l.length) === l) && !!i.uploadMimeCheck(t.mime, t.phash) && m(t, d) && Object.keys(h).length) || (c = !0), p) }) }, p = function (e) { var t, n = i.file(e); i.request({ cmd: "info", targets: [e], preventDefault: !0 }).done(function (e) { var a; e && e.files && e.files.length && (t = e.files[0], n.ts == t.ts && n.size == t.size || (a = { changed: [t] }, i.updateCache(a), i.change(a))) }) }, u = function (t, o, r) { var s, d, h, f = t.hash, m = (i.options, e.Deferred()), g = "edit-" + i.namespace + "-" + t.hash, v = i.getUI().find("#" + g), y = o || 0, w = !1; if (v.length) return v.elfinderdialog("toTop"), m.resolve(); if (!(t.read && (t.write || r.info && r.info.converter))) return d = ["errOpen", t.name, "errPerm"], m.reject(d); if (r && r.info) { if ("function" == typeof r.info.edit) return (h = r.info.edit.call(i, t, r)).promise ? h.done(function () { m.resolve() }).fail(function (e) { m.reject(e) }) : h ? m.resolve() : m.reject(), m; w = r.info.preventGet || r.info.noContent, r.info.urlAsContent || w ? (s = e.Deferred(), r.info.urlAsContent ? i.url(f, { async: !0, onetime: !0, temporary: !0 }).done(function (e) { s.resolve({ content: e }) }) : s.resolve({})) : (y && (t.encoding = y, i.cache(t, "change")), s = i.request({ data: { cmd: "get", target: f, conv: y, _t: t.ts }, options: { type: "get", cache: !0 }, notify: { type: "file", cnt: 1 }, preventDefault: !0 })), s.done(function (o) { var s, d, h; o.doconv ? i.confirm({ title: n.title, text: "unknown" === o.doconv ? "confirmNonUTF8" : "confirmConvUTF8", accept: { label: "btnConv", callback: function () { m = u(t, s.val(), r) } }, cancel: { label: "btnCancel", callback: function () { m.reject() } }, optionsCallback: function (t) { t.create = function () { var t = e('<div class="elfinder-dialog-confirm-encoding"></div>'), n = { value: o.doconv }; "unknown" === o.doconv && (n.caption = "-"), s = l([n]), e(this).next().find(".ui-dialog-buttonset").prepend(t.append(e("<label>" + i.i18n("encoding") + " </label>").append(s))) } } }) : (!w && i.mimeIsText(t.mime) && (d = new RegExp("^(data:" + t.mime.replace(/([.+])/g, "\\$1") + ";base64,)", "i"), r.info.dataScheme ? window.btoa && !o.content.match(d) && (o.content = "data:" + t.mime + ";base64," + btoa(o.content)) : window.atob && (h = o.content.match(d)) && (o.content = atob(o.content.substr(h[1].length)))), function (t, o, r, s, d, h) { var f, m, g, v, y, w, x, k, C, z = e.Deferred(), T = !1, A = function () { return !!T || (i.toast({ mode: "warning", msg: i.i18n("nowLoading") }), !1) }, j = function () { h && Array.isArray(h) && e.each(h, function () { this.msg && i.toast(this) }) }, O = function () { var t, n, a, o = v ? v.val() : void 0, r = e.Deferred().fail(function (e) { g.show().find("button.elfinder-btncnt-0,button.elfinder-btncnt-1").hide() }); return A() ? (f.editor && (f.editor.save(f[0], f.editor.instance), (t = f.editor.confObj).info && (t.info.schemeContent || t.info.arrayBufferContent) && (o = "scheme")), n = U(), P(n), n.promise ? (a = setTimeout(function () { i.notify({ type: "chkcontent", cnt: 1, hideCnt: !0, cancel: function () { n.reject() } }) }, 100), n.always(function () { a && clearTimeout(a), i.notify({ type: "chkcontent", cnt: -1 }) }).done(function (e) { z.notifyWith(f, [o, f.data("hash"), m, r]) }).fail(function (e) { r.reject(e) })) : z.notifyWith(f, [o, f.data("hash"), m, r]), r) : r.resolve() }, S = function () { A() && O().fail(function (e) { e && i.error(e) }) }, I = function () { f.elfinderdialog("close") }, M = function () { A() && (g.hide(), O().done(function () { T = !1, g.show(), I() }).fail(function (e) { g.show(), e && i.error(e) })) }, E = function () { if (A()) { var t = m, r = o.phash, s = function (e) { p.addClass(a).fadeIn(function () { e && i.error(e) }), m = t, i.disable() }, l = function () { n.mime = H.mime || o.mime, n.prefix = (H.name || o.name).replace(/ \d+(\.[^.]+)?$/, "$1"), n.requestCmd = "mkfile", n.nextAction = {}, n.data = { target: r }, e.proxy(i.res("mixin", "make"), n)().done(function (e) { var t; e.added && e.added.length ? (t = f.data("hash"), f.data("hash", e.added[0].hash), O().done(function () { T = !1, g.show(), I(), p.fadeIn() }).fail(function () { i.exec("rm", [e.added[0].hash], { forceRm: !0, quiet: !0 }), f.data("hash", t), g.find("button.elfinder-btncnt-2").hide(), s() })) : s() }).progress(function (e) { e && "errUploadMime" === e && f.trigger("saveAsFail") }).fail(s).always(function () { delete n.mime, delete n.prefix, delete n.nextAction, delete n.data }), i.trigger("unselectfiles", { files: [o.hash] }) }, c = null, d = null, p = i.getUI().children("." + n.dialogClass + ":visible"); g.is(":hidden") && (p = p.add(g)), p.removeClass(a).fadeOut(), i.enable(), i.searchStatus.state < 2 && r !== i.cwd().hash ? c = i.exec("open", [r], { thash: r }) : i.file(r) || (d = i.request({ cmd: "info", targets: [r] })), e.when([c, d]).done(function () { d ? i.one("infodone", function () { i.file(r) ? l() : s("errFolderNotFound") }) : c ? i.one("cwdrender", l) : l() }).fail(s) } }, F = function () { var t, n, a = e.Deferred(); return T ? (f.editor && f.editor.save(f[0], f.editor.instance), (t = U()) && t.promise ? (n = setTimeout(function () { i.notify({ type: "chkcontent", cnt: 1, hideCnt: !0, cancel: function () { t.reject() } }) }, 100), t.always(function () { n && clearTimeout(n), i.notify({ type: "chkcontent", cnt: -1 }) }).done(function (e) { a.resolve(m !== e) }).fail(function (e) { a.resolve(e || void 0 !== m) })) : a.resolve(m !== t), a) : a.resolve(!1) }, D = { title: i.escape(o.name), width: (C = i.options.dialogContained ? i.getUI() : e(window), k = "string" == typeof n.options.dialogWidth && (x = n.options.dialogWidth.match(/(\d+)%/)) ? parseInt(C.width() * (x[1] / 100)) : parseInt(n.options.dialogWidth || 650), Math.min(k, C.width())), height: c(), buttons: {}, cssClass: a, maxWidth: "window", maxHeight: "window", allowMinimize: !0, allowMaximize: !0, openMaximized: b() || d && d.info && d.info.openMaximized, btnHoverFocus: !1, closeOnEscape: !1, propagationEvents: ["mousemove", "mouseup", "click"], minimize: function () { var e; f.editor && g.closest(".ui-dialog").is(":hidden") && (e = f.editor.confObj).info && e.info.syncInterval && p(o.hash) }, close: function () { var e = function () { var e; z.resolve(), f.editor && (f.editor.close(f[0], f.editor.instance), (e = f.editor.confObj).info && e.info.syncInterval && p(o.hash)), f.elfinderdialog("destroy") }, t = void 0 !== H.name, a = t ? { label: "btnSaveAs", callback: function () { requestAnimationFrame(E) } } : { label: "btnSaveClose", callback: function () { O().done(function () { e() }) } }; F().done(function (o) { var r = ["confirmNotSave"]; o ? ("string" == typeof o && r.unshift(o), i.confirm({ title: n.title, text: r, accept: a, cancel: { label: "btnClose", callback: e }, buttons: t ? null : [{ label: "btnSaveAs", callback: function () { requestAnimationFrame(E) } }] })) : e() }) }, open: function () { var e, n, a; if (f.initEditArea.call(f, t, o, r, i), f.editor) { if ((e = f.editor.load(f[0]) || null) && e.done) e.always(function () { T = !0 }).done(function (e) { f.editor.instance = e, f.editor.focus(f[0], f.editor.instance), P(U()), requestAnimationFrame(function () { g.trigger("resize") }) }).fail(function (e) { e && i.error(e), f.elfinderdialog("destroy") }).always(j); else { if (T = !0, e && ("string" == typeof e || Array.isArray(e))) return i.error(e), void f.elfinderdialog("destroy"); f.editor.instance = e, f.editor.focus(f[0], f.editor.instance), P(U()), requestAnimationFrame(function () { g.trigger("resize") }), j() } (n = f.editor.confObj).info && n.info.syncInterval && (a = parseInt(n.info.syncInterval)) && setTimeout(function () { q(a) }, a) } else T = !0, P(U()) }, resize: function (e, t) { f.editor && f.editor.resize(f[0], f.editor.instance, e, t || {}) } }, U = function () { var t = f.getContent.call(f, f[0]); return void 0 !== t && !1 !== t && null !== t || (t = e.Deferred().reject()), t }, P = function (e) { e && e.promise ? e.done(function (e) { m = e }) : m = e }, q = function (e) { g.is(":visible") && (p(o.hash), setTimeout(function () { q(e) }, e)) }, R = function () { v && F().done(function (e) { e ? v.attr("title", i.i18n("saveAsEncoding")).addClass("elfinder-edit-changed") : v.attr("title", i.i18n("openAsEncoding")).removeClass("elfinder-edit-changed") }) }, H = {}; if (d && (d.html && (f = e(d.html)), y = { init: d.init || null, load: d.load, getContent: d.getContent || null, save: d.save, beforeclose: "function" == typeof d.beforeclose ? d.beforeclose : void 0, close: "function" == typeof d.close ? d.close : function () { }, focus: "function" == typeof d.focus ? d.focus : function () { }, resize: "function" == typeof d.resize ? d.resize : function () { }, instance: null, doSave: S, doCancel: I, doClose: M, file: o, fm: i, confObj: d, trigger: function (e, t) { i.trigger("editEditor" + e, Object.assign({}, d.info || {}, t)) } }), !f) { if (!i.mimeIsText(o.mime)) return z.reject("errEditorNotFound"); f = e('<textarea class="elfinder-file-edit" rows="20" id="' + t + '-ta"></textarea>').on("input propertychange", R), d && d.info && !d.info.useTextAreaEvent || f.on("keydown", function (t) { var n, i, a = t.keyCode; t.stopPropagation(), a == e.ui.keyCode.TAB && (t.preventDefault(), this.setSelectionRange && (n = this.value, i = this.selectionStart, this.value = n.substr(0, i) + "\t" + n.substr(this.selectionEnd), i += 1, this.setSelectionRange(i, i))), (t.ctrlKey || t.metaKey) && (a != "Q".charCodeAt(0) && a != "W".charCodeAt(0) || (t.preventDefault(), I()), a == "S".charCodeAt(0) && (t.preventDefault(), S())) }).on("mouseenter", function () { this.focus() }), f.initEditArea = function (e, t, n) { f.hide().val(n), this._setupSelEncoding(n) } } return f._setupSelEncoding = function (t) { var n = s && "unknown" !== s ? [{ value: s }] : [], a = e("<select></select>").hide(), r = function (t) { t && a.appendTo(v.parent()), a.empty().append(e("<option></option>").text(v.val())), v.width(a.width()) }; "" !== t && s && "UTF-8" === s || n.push({ value: "UTF-8" }), v = l(n).on("touchstart", function (e) { e.stopPropagation() }).on("change", function () { F().done(function (e) { e || "" === U() || (I(), u(o, v.val(), d).fail(function (e) { e && i.error(e) })) }), r() }).on("mouseover", R), f.parent().next().prepend(e('<div class="ui-dialog-buttonset elfinder-edit-extras"></div>').append(v)), r(!0) }, f.data("hash", o.hash), y && (f.editor = y, "function" == typeof y.beforeclose && (D.beforeclose = function () { return y.beforeclose(f[0], y.instance) }), "function" == typeof y.init && (f.initEditArea = y.init), "function" == typeof y.getContent && (f.getContent = y.getContent)), f.initEditArea || (f.initEditArea = function () { }), f.getContent || (f.getContent = function () { return f.val().replace(/\s+$/, "") }), d && d.info && d.info.preventGet || (D.buttons[i.i18n("btnSave")] = S, D.buttons[i.i18n("btnSaveClose")] = M, D.buttons[i.i18n("btnSaveAs")] = E, D.buttons[i.i18n("btnCancel")] = I), d && "function" == typeof d.prepare && d.prepare(f, D, o), g = n.fmDialog(f, D).attr("id", t).on("keydown keyup keypress", function (e) { e.stopPropagation() }).css({ overflow: "hidden", minHeight: "7em" }).addClass("elfinder-edit-editor").closest(".ui-dialog").on("changeType", function (t, n) { if (n.extention && n.mime) { n.extention, n.mime; var a = e(this).children(".ui-dialog-buttonpane").children(".ui-dialog-buttonset"); a.children(".elfinder-btncnt-0,.elfinder-btncnt-1").hide(), H.name = i.splitFileExtention(o.name)[0] + "." + n.extention, H.mime = n.mime, n.keepEditor || a.children(".elfinder-btncnt-2").trigger("click") } }), w = (i.options.dialogContained ? i.getUI() : e(window)).width(), g.width() > w && g.width(w), z.promise() }(g, t, o.content, o.encoding, r, o.toasts).done(function (e) { m.resolve(e) }).progress(function (e, t, n, a) { var o = this; t && (f = t), i.request({ options: { type: "post" }, data: { cmd: "put", target: f, encoding: e || n.encoding, content: n }, notify: { type: "save", cnt: 1 }, syncOnFail: !0, preventFail: !0, navigate: { target: "changed", toast: { inbuffer: { msg: i.i18n(["complete", i.i18n("btnSave")]) } } } }).fail(function (e) { m.reject(e), a.reject() }).done(function (e) { requestAnimationFrame(function () { o.trigger("focus"), o.editor && o.editor.focus(o[0], o.editor.instance) }), a.resolve() }) }).fail(function (e) { m.reject(e) })) }).fail(function (e) { var n = i.parseError(e); n = Array.isArray(n) ? n[0] : n, t.encoding && (t.encoding = "", i.cache(t, "change")), "errConvUTF8" !== n && i.sync(), m.reject(e) }) } return m.promise() }, h = {}, f = { info: { id: "textarea", name: "TextArea", useTextAreaEvent: !0 }, load: function (t) { this.trigger("Prepare", { node: t, editorObj: void 0, instance: void 0, opts: {} }), t.setSelectionRange && t.setSelectionRange(0, 0), e(t).trigger("focus").show() }, save: function () { } }, m = function (a, o) { var r = n.options.editors || [], s = i.cwd().write; return t = i.storage("storedEditors") || {}, h = {}, r.length || (r = [f]), e.each(r, function (t, n) { var r; (1 === o || !n.info.single) && (n.info && n.info.converter ? s : a.write) && (a.size > 0 || !n.info.converter && !1 !== n.info.canMakeEmpty && i.mimesCanMakeEmpty[a.mime]) && (!n.info.maxSize || a.size <= n.info.maxSize) && function (t, n) { if (n) { if ("*" === n[0] || -1 !== e.inArray(t, n)) return !0; var a, o; for (o = n.length, a = 0; a < o; a++)if (0 === t.indexOf(n[a])) return !0; return !1 } return i.mimeIsText(t) }(a.mime, n.mimes || null) && function (e, t) { if (!t || !t.length) return !0; var n, i, a = e.replace(/^.+\.([^.]+)|(.+)$/, "$1$2").toLowerCase(); for (i = t.length, n = 0; n < i; n++)if (a === t[n].toLowerCase()) return !0; return !1 }(a.name, n.exts || null) && "function" == typeof n.load && "function" == typeof n.save && (r = n.info.name ? n.info.name : "Editor " + t, n.id = n.info.id ? n.info.id : "editor" + t, n.name = r, n.i18n = i.i18n(r), h[n.id] = n) }), !!Object.keys(h).length }, g = function (n, a) { n && a && (e.isPlainObject(t) || (t = {}), t[n] = a.id, i.storage("storedEditors", t), i.trigger("selectfiles", { files: i.selected() })) }, v = function () { var e = i.storage("useStoredEditor"); return e ? e > 0 : n.options.useStoredEditor }, b = function () { var e = i.storage("editorMaximized"); return e ? e > 0 : n.options.editorMaximized }, y = function (t, n) { var a = []; return e.each(h, function (e, o) { a.push({ label: i.escape(o.i18n), icon: o.info && o.info.icon ? o.info.icon : "edit", options: { iconImg: o.info && o.info.iconImg ? i.baseUrl + o.info.iconImg : void 0 }, callback: function () { g(t[0].mime, o), n && n.call(o) } }) }), a }, w = function (e) { var n = t[e]; return n && Object.keys(h).length ? h[function (e) { return e.toLowerCase().replace(/ +/g, "") }(n)] : void 0 }; this.getEncSelect = l, this.shortcuts = [{ pattern: "ctrl+e" }], this.init = function () { var t, n, i = this, a = this.fm, l = this.options, c = []; this.onlyMimes = this.options.mimes || [], a.one("open", function () { l.editors && Array.isArray(l.editors) && (a.trigger("canMakeEmptyFile", { mimes: Object.keys(a.storage("mkfileTextMimes") || {}).concat(l.makeTextMimes || ["text/plain"]) }), e.each(l.editors, function (e, t) { t.info && t.info.cmdCheck && c.push(t.info.cmdCheck) }), c.length ? a.api >= 2.103 ? n = a.request({ data: { cmd: "editor", name: c, method: "enabled" }, preventDefault: !0 }).done(function (e) { t = e }).fail(function () { t = {} }) : (t = {}, n = e.Deferred().resolve()) : n = e.Deferred().resolve(), n.always(function () { t && (l.editors = e.grep(l.editors, function (e) { return !e.info || !e.info.cmdCheck || !!t[e.info.cmdCheck] })), e.each(l.editors, function (e, t) { t.setup && "function" == typeof t.setup && t.setup.call(t, l, a), t.disabled || (t.mimes && Array.isArray(t.mimes) && (o = o.concat(t.mimes), t.info && t.info.single || (r = r.concat(t.mimes))), !s && t.mimes && "*" === t.mimes[0] && (s = !0), t.info || (t.info = {}), t.info.integrate && a.trigger("helpIntegration", Object.assign({ cmd: "edit" }, t.info.integrate)), t.info.canMakeEmpty && a.trigger("canMakeEmptyFile", { mimes: Array.isArray(t.info.canMakeEmpty) ? t.info.canMakeEmpty : t.mimes })) }), o = (e.uniqueSort || e.unique)(o), r = (e.uniqueSort || e.unique)(r), l.editors = e.grep(l.editors, function (e) { return !e.disabled }) })) }).bind("select", function () { h = null }).bind("contextmenucreate", function (t) { var n, o, r = function (e) { var t = i.title; a.one("contextmenucreatedone", function () { i.title = t }), i.title = a.escape(e.i18n), e.info && e.info.iconImg && (i.contextmenuOpts = { iconImg: a.baseUrl + e.info.iconImg }), delete i.variants }; i.contextmenuOpts = void 0, "files" === t.data.type && i.enabled() && (n = a.file(t.data.targets[0]), m(n, t.data.targets.length) && (Object.keys(h).length > 1 ? v() && (o = w(n.mime)) ? (r(o), i.extra = { icon: "menu", node: e("<span></span>").attr({ title: a.i18n("select") }).on("click touchstart", function (t) { if (!("touchstart" === t.type && t.originalEvent.touches.length > 1)) { var n = e(this); t.stopPropagation(), t.preventDefault(), a.trigger("contextmenu", { raw: y(a.selectedFiles(), function () { var e = a.selected(); a.exec("edit", e, { editor: this }), a.trigger("selectfiles", { files: e }) }), x: n.offset().left, y: n.offset().top }) } }) }) : (delete i.extra, i.variants = [], e.each(h, function (e, t) { i.variants.push([{ editor: t }, t.i18n, t.info && t.info.iconImg ? a.baseUrl + t.info.iconImg : "edit"]) })) : (r(h[Object.keys(h)[0]]), delete i.extra))) }).bind("canMakeEmptyFile", function (t) { if (t.data && t.data.resetTexts) { var n = a.arrayFlip(i.options.makeTextMimes || ["text/plain"]), o = i.getMkfileHides(); e.each(a.storage("mkfileTextMimes") || {}, function (e, t) { n[e] || (delete a.mimesCanMakeEmpty[e], delete o[e]) }), a.storage("mkfileTextMimes", null), Object.keys(o).length ? a.storage("mkfileHides", o) : a.storage("mkfileHides", null) } }) }, this.getstate = function (e) { var t = this.files(e), n = t.length; return n && d(t).length == n ? 0 : -1 }, this.exec = function (t, n) { var i, a, o = this.fm, r = d(this.files(t)), s = e.map(r, function (e) { return e.hash }), l = [], c = n && n.editor ? n.editor : null, p = e(n && n._currentNode ? n._currentNode : o.cwdHash2Elm(s[0])), f = e.Deferred(); return null === h && m(r[0], s.length), p.length || (p = o.getUI("cwd")), (a = e.Deferred(), !c && Object.keys(h).length > 1 ? v() && (c = w(r[0].mime)) ? a.resolve(c) : (o.trigger("contextmenu", { raw: y(r, function () { a.resolve(this) }), x: p.offset().left, y: p.offset().top + 22, opened: function () { o.one("closecontextmenu", function () { requestAnimationFrame(function () { "pending" === a.state() && a.reject() }) }) } }), o.trigger("selectfiles", { files: s }), a) : (Object.keys(h).length > 1 && c && g(r[0].mime, c), a.resolve(c || (Object.keys(h).length ? h[Object.keys(h)[0]] : null)))).done(function (t) { for (; i = r.shift();)l.push(u(i, i.encoding || void 0, t).fail(function (e) { e && o.error(e) })); l.length ? e.when.apply(null, l).done(function () { f.resolve() }).fail(function () { f.reject() }) : f.reject() }).fail(function () { f.reject() }), f }, this.getMkfileHides = function () { return i.storage("mkfileHides") || i.arrayFlip(n.options.mkfileHideMimes || []) } }, h.prototype.commands.empty = function () { var t, n, i = function (e) { var i = t.files(e); return i.length || (i = [n.cwd()]), i }; this.linkedCmds = ["rm"], this.init = function () { t = this, n = this.fm }, this.getstate = function (t) { var n, a = i(t); return n = a.length, e.grep(a, function (e) { return !(!e.read || !e.write || "directory" !== e.mime) }).length == n ? 0 : -1 }, this.exec = function (t) { var a = i(t), o = a.length, r = e.Deferred().done(function () { var t = { changed: {} }; n.toast({ msg: n.i18n(['"' + s.join('", ') + '"', "complete", n.i18n("cmdempty")]) }), e.each(a, function (e, n) { t.changed[n.hash] = n }), n.change(t) }).always(function () { var t = n.cwd().hash; n.trigger("selectfiles", { files: e.map(a, function (e) { return t === e.phash ? e.hash : null }) }) }), s = [], l = function (e) { "number" == typeof e ? (s.push(a[e].name), delete a[e].dirs) : e && n.error(e), --o < 1 && r[s.length ? "resolve" : "reject"]() }; return e.each(a, function (t, i) { var a; return i.write && "directory" === i.mime ? n.isCommandEnabled("rm", i.hash) ? (a = setTimeout(function () { n.notify({ type: "search", cnt: 1, hideCnt: !(o > 1) }) }, n.notifyDelay), void n.request({ data: { cmd: "open", target: i.hash }, preventDefault: !0, asNotOpen: !0 }).done(function (r) { var s = []; a && clearTimeout(a), n.ui.notify.children(".elfinder-notify-search").length && n.notify({ type: "search", cnt: -1, hideCnt: !(o > 1) }), r && r.files && r.files.length ? r.files.length > n.maxTargets ? l(["errEmpty", i.name, "errMaxTargets", n.maxTargets]) : (n.updateCache(r), e.each(r.files, function (e, t) { if (!t.write || t.locked) return l(["errEmpty", i.name, "errRm", t.name, "errPerm"]), s = [], !1; s.push(t.hash) }), s.length && n.exec("rm", s, { _userAction: !0, addTexts: [n.i18n("folderToEmpty", i.name)] }).fail(function (e) { n.trigger("unselectfiles", { files: n.selected() }), l(n.parseError(e) || "") }).done(function () { l(t) })) : (n.toast({ mode: "warning", msg: n.i18n("filderIsEmpty", i.name) }), l("")) }).fail(function (e) { l(n.parseError(e) || "") })) : (l(["errCmdNoSupport", '"rm"']), null) : (l(["errEmpty", i.name, "errPerm"]), null) }), r } }, h.prototype.commands.extract = function () { var t = this, n = t.fm, i = []; this.variants = [], this.disableOnSearch = !0, n.bind("open reload", function () { i = n.option("archivers").extract || [], n.api > 2 ? t.variants = [[{ makedir: !0 }, n.i18n("cmdmkdir")], [{}, n.i18n("btnCwd")]] : t.variants = [[{}, n.i18n("btnCwd")]], t.change() }), this.getstate = function (t) { var n, a = this.files(t), o = a.length; return o && this.fm.cwd().write && (n = a, e.grep(n, function (t) { return !(!t.read || -1 === e.inArray(t.mime, i)) })).length == o ? 0 : -1 }, this.exec = function (t, a) { var o, r, s, l = this.files(t), c = e.Deferred(), d = l.length, p = a && a.makedir ? 1 : 0, u = !1, h = !1, f = 0, m = e.map(n.files(t), function (e) { return e.name }), g = {}; e.grep(n.files(t), function (e) { return g[e.name] = e, !1 }); var v = function (e) { switch (e) { case "overwrite_all": u = !0; break; case "omit_all": h = !0 } }, b = function (t) { t.read && n.file(t.phash).write ? -1 === e.inArray(t.mime, i) ? (r = ["errExtract", t.name, "errNoArchive"], n.error(r), c.reject(r)) : n.request({ data: { cmd: "extract", target: t.hash, makedir: p }, notify: { type: "extract", cnt: 1 }, syncOnFail: !0, navigate: { toast: p ? { incwd: { msg: n.i18n(["complete", n.i18n("cmdextract")]), action: { cmd: "open", msg: "cmdopen" } }, inbuffer: { msg: n.i18n(["complete", n.i18n("cmdextract")]), action: { cmd: "open", msg: "cmdopen" } } } : { inbuffer: { msg: n.i18n(["complete", n.i18n("cmdextract")]) } } } }).fail(function (e) { "rejected" != c.state() && c.reject(e) }).done(function () { }) : (r = ["errExtract", t.name, "errPerm"], n.error(r), c.reject(r)) }, y = function (t, i) { var a = t[i], r = n.splitFileExtention(a.name)[0], l = e.inArray(r, m) >= 0, w = function () { i + 1 < d ? y(t, i + 1) : c.resolve() }; !p && l && "directory" != g[r].mime ? n.confirm({ title: n.i18n("ntfextract"), text: ["errExists", r, "confirmRepl"], accept: { label: "btnYes", callback: function (e) { if (v(s = e ? "overwrite_all" : "overwrite"), u || h) { if (u) { for (o = i; o < d; o++)b(t[o]); c.resolve() } } else "overwrite" == s && b(a), i + 1 < d ? y(t, i + 1) : c.resolve() } }, reject: { label: "btnNo", callback: function (e) { v(s = e ? "omit_all" : "omit"), !u && !h && i + 1 < d ? y(t, i + 1) : h && c.resolve() } }, cancel: { label: "btnCancel", callback: function () { c.resolve() } }, all: i + 1 < d }) : p ? (b(a), w()) : 0 == f ? n.confirm({ title: n.i18n("cmdextract"), text: [n.i18n("cmdextract") + ' "' + a.name + '"', "confirmRepl"], accept: { label: "btnYes", callback: function (e) { e && (f = 1), b(a), w() } }, reject: { label: "btnNo", callback: function (e) { e && (f = -1), w() } }, cancel: { label: "btnCancel", callback: function () { c.resolve() } }, all: i + 1 < d }) : (f > 0 && b(a), w()) }; return this.enabled() && d && i.length ? (d > 0 && y(l, 0), c) : c.reject() } }, (h.prototype.commands.forward = function () { this.alwaysEnabled = !0, this.updateOnSelect = !0, this.shortcuts = [{ pattern: "ctrl+right" }], this.getstate = function () { return this.fm.history.canForward() ? 0 : -1 }, this.exec = function () { return this.fm.history.forward() } }).prototype = { forceLoad: !0 }, h.prototype.commands.fullscreen = function () { var t = this, n = this.fm, i = function (e, n) { e.preventDefault(), e.stopPropagation(), n && n.fullscreen && t.update(void 0, "on" === n.fullscreen) }; this.alwaysEnabled = !0, this.updateOnSelect = !1, this.syncTitleOnChange = !0, this.value = !1, this.options = { ui: "fullscreenbutton" }, this.getstate = function () { return 0 }, this.exec = function () { var i = n.getUI().get(0), a = i === n.toggleFullscreen(i); return t.title = n.i18n(a ? "reinstate" : "cmdfullscreen"), t.update(void 0, a), e.Deferred().resolve() }, n.bind("init", function () { n.getUI().off("resize." + n.namespace, i).on("resize." + n.namespace, i) }) }, (h.prototype.commands.getfile = function () { var t = this, n = this.fm; this.alwaysEnabled = !0, this.callback = n.options.getFileCallback, this._disabled = "function" == typeof this.callback, this.getstate = function (n) { var i, a, o = this.files(n), r = o.length; return this.callback && r && (i = o, a = t.options, i = e.grep(i, function (e) { return !("directory" == e.mime && !a.folders || !e.read) }), a.multiple || 1 == i.length ? i : []).length == r ? 0 : -1 }, this.exec = function (n) { var i, a, o, r = this.fm, s = this.options, l = this.files(n), c = l.length, d = r.option("url"), p = r.option("tmbUrl"), u = e.Deferred().done(function (e) { var n, i = function () { "close" == s.oncomplete ? r.hide() : "destroy" == s.oncomplete && r.destroy() }, a = function (e) { "close" == s.onerror ? r.hide() : "destroy" == s.onerror ? r.destroy() : e && r.error(e) }; r.trigger("getfile", { files: e }); try { n = t.callback(e, r) } catch (e) { return void a(["Error in `getFileCallback`.", e.message]) } "object" == typeof n && "function" == typeof n.done ? n.done(i).fail(a) : i() }), h = function (t) { return s.onlyURL ? s.multiple ? e.map(l, function (e) { return e.url }) : l[0].url : s.multiple ? l : l[0] }, f = []; for (i = 0; i < c; i++) { if ("directory" == (a = l[i]).mime && !s.folders) return u.reject(); a.baseUrl = d, "1" == a.url ? f.push(r.request({ data: { cmd: "url", target: a.hash }, notify: { type: "url", cnt: 1, hideCnt: !0 }, preventDefault: !0 }).done(function (e) { e.url && (r.file(this.hash).url = this.url = e.url) }.bind(a))) : a.url = r.url(a.hash), s.onlyURL || (s.getPath && (a.path = r.path(a.hash), "" === a.path && a.phash && function () { var t = e.Deferred(); f.push(t), r.path(a.hash, !1, {}).done(function (e) { a.path = e }).fail(function () { a.path = "" }).always(function () { t.resolve() }) }()), a.tmb && 1 != a.tmb && (a.tmb = p + a.tmb), a.width || a.height || (a.dim ? (o = a.dim.split("x"), a.width = o[0], a.height = o[1]) : s.getImgSize && -1 !== a.mime.indexOf("image") && f.push(r.request({ data: { cmd: "dim", target: a.hash }, notify: { type: "dim", cnt: 1, hideCnt: !0 }, preventDefault: !0 }).done(function (e) { if (e.dim) { var t = e.dim.split("x"), n = r.file(this.hash); n.width = this.width = t[0], n.height = this.height = t[1] } }.bind(a))))) } return f.length ? (e.when.apply(null, f).always(function () { u.resolve(h()) }), u) : u.resolve(h()) } }).prototype = { forceLoad: !0 }, (h.prototype.commands.help = function () { var t, n, i, a, o, r, s = this.fm, l = this, c = '<div class="elfinder-help-link"> <a href="{url}" target="_blank">{link}</a></div>', d = '<div class="elfinder-help-team"><div>{author}</div>{work}</div>', p = /\{url\}/, u = /\{link\}/, h = /\{author\}/, f = /\{work\}/, m = "replace", g = "ui-priority-primary", v = "ui-priority-secondary", b = "elfinder-help-license", y = '<li class="' + s.res("class", "tabstab") + ' elfinder-help-tab-{id}"><a href="#' + s.namespace + '-help-{id}" class="ui-tabs-anchor">{title}</a></li>', w = ['<div class="ui-tabs ui-widget ui-widget-content ui-corner-all elfinder-help">', '<ul class="ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-top">'], x = '<div class="elfinder-help-separator"></div>', k = e("base").length ? document.location.href.replace(/#.*$/, "") : "", C = s.res("class", "tabsactive"), z = function () { return s.theme && s.theme.author ? d[m]("elfinder-help-team", "elfinder-help-team elfinder-help-term-theme")[m](h, s.i18n(s.theme.author) + (s.theme.email ? " &lt;" + s.theme.email + "&gt;" : ""))[m](f, s.i18n("theme") + " (" + s.i18n(s.theme.name) + ")") : '<div class="elfinder-help-team elfinder-help-term-theme" style="display:none"></div>' }, T = !1, A = !1, j = ""; this.alwaysEnabled = !0, this.updateOnSelect = !1, this.state = -1, this.shortcuts = [{ pattern: "f1", description: this.title }], s.bind("load", function () { var O, S, I, M, E, F, D, U = l.options.view || ["about", "shortcuts", "help", "integrations", "debug"]; -1 !== (O = e.inArray("preference", U)) && U.splice(O, 1), e.fn.tabs || -1 !== (O = e.inArray(U, "debug")) && U.splice(O, 1), e.each(U, function (e, t) { w.push(y[m](/\{id\}/g, t)[m](/\{title\}/, s.i18n(t))) }), w.push("</ul>"), -1 !== e.inArray("about", U) && (w.push('<div id="' + s.namespace + '-help-about" class="ui-tabs-panel ui-widget-content ui-corner-bottom"><div class="elfinder-help-logo"></div>'), w.push("<h3>elFinder</h3>"), w.push('<div class="' + g + '">' + s.i18n("webfm") + "</div>"), w.push('<div class="' + v + '">' + s.i18n("ver") + ": " + s.version + "</div>"), w.push('<div class="' + v + '">' + s.i18n("protocolver") + ': <span class="apiver"></span></div>'), w.push('<div class="' + v + '">jQuery/jQuery UI: ' + e().jquery + "/" + e.ui.version + "</div>"), w.push(x), w.push(c[m](p, "https://studio-42.github.io/elFinder/")[m](u, s.i18n("homepage"))), w.push(c[m](p, "https://github.com/Studio-42/elFinder/wiki")[m](u, s.i18n("docs"))), w.push(c[m](p, "https://github.com/Studio-42/elFinder")[m](u, s.i18n("github"))), w.push(x), w.push('<div class="' + g + '">' + s.i18n("team") + "</div>"), w.push(d[m](h, 'Dmitry "dio" Levashov &lt;dio@std42.ru&gt;')[m](f, s.i18n("chiefdev"))), w.push(d[m](h, "Naoki Sawada &lt;hypweb+elfinder@gmail.com&gt;")[m](f, s.i18n("developer"))), w.push(d[m](h, "Troex Nevelin &lt;troex@fury.scancode.ru&gt;")[m](f, s.i18n("maintainer"))), w.push(d[m](h, "Alexey Sukhotin &lt;strogg@yandex.ru&gt;")[m](f, s.i18n("contributor"))), s.i18[s.lang].translator && e.each(s.i18[s.lang].translator.split(", "), function () { w.push(d[m](h, e.trim(this))[m](f, s.i18n("translator") + " (" + s.i18[s.lang].language + ")")) }), w.push(z()), w.push(x), w.push('<div class="' + b + '">' + s.i18n("icons") + ': Pixelmixer, <a href="http://p.yusukekamiyamane.com" target="_blank">Fugue</a>, <a href="https://icons8.com" target="_blank">Icons8</a></div>'), w.push(x), w.push('<div class="' + b + '">Licence: 3-clauses BSD Licence</div>'), w.push('<div class="' + b + '">Copyright © 2009-2020, Studio 42</div>'), w.push('<div class="' + b + '">„ …' + s.i18n("dontforget") + " ”</div>"), w.push("</div>")), -1 !== e.inArray("shortcuts", U) && (D = s.shortcuts(), w.push('<div id="' + s.namespace + '-help-shortcuts" class="ui-tabs-panel ui-widget-content ui-corner-bottom">'), D.length ? (w.push('<div class="ui-widget-content elfinder-help-shortcuts">'), e.each(D, function (e, t) { w.push('<div class="elfinder-help-shortcut"><div class="elfinder-help-shortcut-pattern">{pattern}</div> {descrip}</div>'.replace(/\{pattern\}/, t[0]).replace(/\{descrip\}/, t[1])) }), w.push("</div>")) : w.push('<div class="elfinder-help-disabled">' + s.i18n("shortcutsof") + "</div>"), w.push("</div>")), -1 !== e.inArray("help", U) && (S = s.i18nBaseUrl + "help/%s.html.js", w.push('<div id="' + s.namespace + '-help-help" class="ui-tabs-panel ui-widget-content ui-corner-bottom">'), w.push('<a href="https://github.com/Studio-42/elFinder/wiki" target="_blank" class="elfinder-dont-panic"><span>DON\'T PANIC</span></a>'), w.push("</div>")), -1 !== e.inArray("integrations", U) && (T = !0, w.push('<div id="' + s.namespace + '-help-integrations" class="ui-tabs-panel ui-widget-content ui-corner-bottom"></div>')), -1 !== e.inArray("debug", U) && (A = !0, w.push('<div id="' + s.namespace + '-help-debug" class="ui-tabs-panel ui-widget-content ui-corner-bottom">'), w.push('<div class="ui-widget-content elfinder-help-debug"><ul></ul></div>'), w.push("</div>")), w.push("</div>"), (j = e(w.join(""))).find(".ui-tabs-nav li").on("mouseenter mouseleave", function (t) { e(this).toggleClass("ui-state-hover", "mouseenter" === t.type) }).on("focus blur", "a", function (t) { e(t.delegateTarget).toggleClass("ui-state-focus", "focusin" === t.type) }).children().on("click", function (t) { var n = e(this); t.preventDefault(), t.stopPropagation(), n.parent().addClass(C).siblings().removeClass(C), j.children(".ui-tabs-panel").hide().filter(n.attr("href")).show() }).filter(":first").trigger("click"), T && (n = j.find(".elfinder-help-tab-integrations").hide(), i = j.find("#" + s.namespace + "-help-integrations").hide().append(e('<div class="elfinder-help-integrations-desc"></div>').html(s.i18n("integrationWith"))), s.bind("helpIntegration", function (t) { var a, o, r, l, c = i.children("ul:first"); t.data && (e.isPlainObject(t.data) ? ((a = Object.assign({ link: "", title: "", banner: "" }, t.data)).title || a.link) && (a.title || (a.title = a.link), o = a.link ? e("<a></a>").attr("href", a.link).attr("target", "_blank").text(a.title) : e("<span></span>").text(a.title), a.banner && (o = e("<span></span>").append(e("<img/>").attr(a.banner), o))) : (o = e(t.data)).filter("a").each(function () { var t = e(this); t.attr("target") || t.attr("target", "_blank") }), o && (n.show(), c.length || (c = e('<ul class="elfinder-help-integrations"></ul>').appendTo(i)), a && a.cmd ? (l = "elfinder-help-integration-" + a.cmd, (r = c.find("ul." + l)).length || (r = e('<ul class="' + l + '"></ul>'), c.append(e("<li></li>").append(e("<span></span>").html(s.i18n("cmd" + a.cmd))).append(r))), o = r.append(e("<li></li>").append(o))) : c.append(e("<li></li>").append(o)))) }).bind("themechange", function () { j.find("div.elfinder-help-term-theme").replaceWith(z()) })), A && (a = j.find(".elfinder-help-tab-debug").hide(), o = j.find("#" + s.namespace + "-help-debug").children("div:first"), r = o.children("ul:first").on("click", function (e) { e.preventDefault(), e.stopPropagation() }), l.debug = {}, s.bind("backenddebug", function (n) { var i, a, c, d, p, u, h, f; A && n.data && n.data.debug && (l.debug = { options: n.data.options, debug: Object.assign({ cmd: s.currentReqCmd }, n.data.debug) }, l.dialog && (h = function (t, n) { return e.each(n, function (n, i) { t.append(e("<dt></dt>").text(n)), void 0 === i ? t.append(e("<dd></dd>").append(e("<span></span>").text("undfined"))) : "object" != typeof i || i ? "object" == typeof i && (e.isPlainObject(i) || i.length) ? t.append(e("<dd></dd>").append(h(e("<dl></dl>"), i))) : t.append(e("<dd></dd>").append(e("<span></span>").text(i && "object" == typeof i ? "[]" : i || '""'))) : t.append(e("<dd></dd>").append(e("<span></span>").text("null"))) }), t }, f = r.children("li").length, (l.debug.options || l.debug.debug) && (f >= 5 && (p = r.children("li:last"), (u = o.children("div:last")).is(":hidden") ? (p.remove(), u.remove()) : (p.prev().remove(), u.prev().remove())), c = s.namespace + "-help-debug-" + +new Date, i = e("<li></li>").html('<a href="' + k + "#" + c + '">' + l.debug.debug.cmd + "</a>").prependTo(r), a = e('<div id="' + c + '"></div>').data("debug", l.debug), i.on("click.debugrender", function () { var t = a.data("debug"); a.removeData("debug"), t && (a.hide(), t.debug && (d = e("<fieldset>").append(e("<legend></legend>").text("debug"), h(e("<dl></dl>"), t.debug)), a.append(d)), t.options && (d = e("<fieldset>").append(e("<legend></legend>").text("options"), h(e("<dl></dl>"), t.options)), a.append(d)), a.show()), i.off("click.debugrender") }), r.after(a), t && o.tabs("refresh")))) })), j.find("#" + s.namespace + "-help-about").find(".apiver").text(s.api), l.dialog = l.fmDialog(j, { title: l.title, width: 530, maxWidth: "window", maxHeight: "window", autoOpen: !1, destroyOnClose: !1, close: function () { A && (a.hide(), o.tabs("destroy")), t = !1 } }).on("click", function (e) { e.stopPropagation() }).css({ overflow: "hidden" }), I = l.dialog.children(".ui-tabs"), M = I.children(".ui-tabs-nav:first"), E = I.children(".ui-tabs-panel"), F = l.dialog.outerHeight(!0) - l.dialog.height(), l.dialog.closest(".ui-dialog").on("resize", function () { E.height(l.dialog.height() - F - M.outerHeight(!0) - 20) }), S && l.dialog.one("initContents", function () { e.ajax({ url: l.options.helpSource ? l.options.helpSource : S.replace("%s", s.lang), dataType: "html" }).done(function (t) { e("#" + s.namespace + "-help-help").html(t) }).fail(function () { e.ajax({ url: S.replace("%s", "en"), dataType: "html" }).done(function (t) { e("#" + s.namespace + "-help-help").html(t) }) }) }), l.state = 0, s.trigger("helpBuilded", l.dialog) }).one("open", function () { var e = !1; s.one("backenddebug", function () { e = !0 }).one("opendone", function () { requestAnimationFrame(function () { !e && A && (A = !1, a.hide(), o.hide(), r.hide()) }) }) }), this.getstate = function () { return 0 }, this.exec = function (n, i) { var s = i ? i.tab : void 0; return A && (o.tabs(), r.find("a:first").trigger("click"), a.show(), t = !0), this.dialog.trigger("initContents").elfinderdialog("open").find((s ? ".elfinder-help-tab-" + s : ".ui-tabs-nav li") + " a:first").trigger("click"), e.Deferred().resolve() } }).prototype = { forceLoad: !0 }, h.prototype.commands.hidden = function () { this.hidden = !0, this.updateOnSelect = !1, this.getstate = function () { return -1 } }, h.prototype.commands.hide = function () { var t, n, i, a, o = this, r = {}; this.syncTitleOnChange = !0, this.shortcuts = [{ pattern: "ctrl+shift+dot", description: this.fm.i18n("toggleHidden") }], this.init = function () { var e = this.fm; t = e.storage("hide") || { items: {} }, n = Object.keys(t.items).length, this.title = e.i18n(t.show ? "hideHidden" : "showHidden"), o.update(void 0, o.title) }, this.fm.bind("select contextmenucreate closecontextmenu", function (e, r) { var s = (e.data ? e.data.selected || e.data.targets : null) || r.selected(); "select" === e.type && e.data ? a = e.data.origin : "contextmenucreate" === e.type && (i = e.data.type), !s.length || ("contextmenucreate" !== e.type && "navbar" !== a || "cwd" === i) && s[0] === r.cwd().hash ? o.title = r.i18n(t.show ? "hideHidden" : "showHidden") : o.title = r.i18n("cmdhide"), "closecontextmenu" !== e.type ? o.update("cwd" === i ? n ? 0 : -1 : void 0, o.title) : (i = "", requestAnimationFrame(function () { o.update(void 0, o.title) })) }), this.getstate = function (e) { return this.fm.cookieEnabled && "cwd" !== i && (e || this.fm.selected()).length || n ? 0 : -1 }, this.exec = function (i, s) { var l, c, d = this.fm, p = e.Deferred().done(function () { d.trigger("hide", { items: h, opts: s }) }).fail(function (e) { d.error(e) }), u = s || {}, h = u.targets ? u.targets : i || d.selected(), f = []; if (t = d.storage("hide") || {}, e.isPlainObject(t) || (t = {}), e.isPlainObject(t.items) || (t.items = {}), ("shortcut" === s._currentType || !h.length || "navbar" !== s._currentType && "navbar" !== a && h[0] === d.cwd().hash) && (t.show ? u.hide = !0 : Object.keys(t.items).length && (u.show = !0)), u.reset && (u.show = !0, n = 0), u.show || u.hide) { if (u.show ? t.show = !0 : delete t.show, u.show) return d.storage("hide", u.reset ? null : t), o.title = d.i18n("hideHidden"), o.update(u.reset ? -1 : void 0, o.title), e.each(t.items, function (e) { var t = d.file(e, !0); t && (d.searchStatus.state || !t.phash || d.file(t.phash)) && f.push(t) }), f.length && (d.updateCache({ added: f }), d.add({ added: f })), u.reset && (t = { items: {} }), p.resolve(); h = Object.keys(t.items) } return h.length && (e.each(h, function (e, n) { var i; t.items[n] || ((i = d.file(n)) && (r[n] = i.i18 || i.name), t.items[n] = r[n] ? r[n] : n) }), n = Object.keys(t.items).length, l = this.files(h), d.storage("hide", t), d.remove({ removed: h }), t.show && this.exec(void 0, { hide: !0 }), u.hide || ((c = {}).undo = { cmd: "hide", callback: function () { var t = d.storage("hide"); t && (e.each(h, function (e, n) { delete t.items[n] }), n = Object.keys(t.items).length, d.storage("hide", t), d.trigger("hide", { items: h, opts: {} }), o.update(n ? 0 : -1)), d.updateCache({ added: l }), d.add({ added: l }) } }, c.redo = { cmd: "hide", callback: function () { return d.exec("hide", void 0, { targets: h }) } })), "rejected" == p.state() ? p : p.resolve(c) } }, (h.prototype.commands.home = function () { this.title = "Home", this.alwaysEnabled = !0, this.updateOnSelect = !1, this.shortcuts = [{ pattern: "ctrl+home ctrl+shift+up", description: "Home" }], this.getstate = function () { var e = this.fm.root(), t = this.fm.cwd().hash; return e && t && e != t ? 0 : -1 }, this.exec = function () { return this.fm.exec("open", this.fm.root()) } }).prototype = { forceLoad: !0 }, (h.prototype.commands.info = function () { var t = this.fm, n = "elfinder-spinner", i = { calc: t.i18n("calc"), size: t.i18n("size"), unknown: t.i18n("unknown"), path: t.i18n("path"), aliasfor: t.i18n("aliasfor"), modify: t.i18n("modify"), perms: t.i18n("perms"), locked: t.i18n("locked"), dim: t.i18n("dim"), kind: t.i18n("kind"), files: t.i18n("files"), folders: t.i18n("folders"), roots: t.i18n("volumeRoots"), items: t.i18n("items"), yes: t.i18n("yes"), no: t.i18n("no"), link: t.i18n("link"), owner: t.i18n("owner"), group: t.i18n("group"), perm: t.i18n("perm"), getlink: t.i18n("getLink") }, a = function (e, t) { return t ? e.replace(/\u200B/g, "") : e.replace(/(\/|\\)/g, "$1​") }; this.items = ["size", "aliasfor", "path", "link", "dim", "modify", "perms", "locked", "owner", "group", "perm"], this.options.custom && Object.keys(this.options.custom).length && e.each(this.options.custom, function (e, t) { t.label && this.items.push(t.label) }), this.tpl = { main: '<div class="ui-helper-clearfix elfinder-info-title {dirclass}"><span class="elfinder-cwd-icon {class} ui-corner-all"{style}></span>{title}</div><table class="elfinder-info-tb">{content}</table>', itemTitle: '<strong>{name}</strong><span class="elfinder-info-kind">{kind}</span>', groupTitle: "<strong>{items}: {num}</strong>", row: '<tr><td class="elfinder-info-label">{label} : </td><td class="{class}">{value}</td></tr>', spinner: '<span>{text}</span> <span class="' + n + " " + n + '-{name}"></span>' }, this.alwaysEnabled = !0, this.updateOnSelect = !1, this.shortcuts = [{ pattern: "ctrl+i" }], this.init = function () { e.each(i, function (e, n) { i[e] = t.i18n(n) }) }, this.getstate = function () { return 0 }, this.exec = function (t) { var o = this.files(t); o.length || (o = this.files([this.fm.cwd().hash])); var r, s, l, c, d, p, u, h, f, m = this.fm, g = this.options, v = this.tpl, b = v.row, y = o.length, w = [], x = v.main, k = "{label}", C = "{value}", z = [], T = null, A = { title: m.i18n("selectionInfo"), width: "auto", close: function () { e(this).elfinderdialog("destroy"), T && "pending" === T.state() && T.reject(), e.grep(z, function (e) { e && "pending" === e.state() && e.reject() }) } }, j = [], O = function (e, t, i) { I.find("." + n + "-" + t).parent().html(e).addClass(i || "") }, S = m.namespace + "-info-" + e.map(o, function (e) { return e.hash }).join("-"), I = m.getUI().find("#" + S), M = [], E = "", F = "elfinder-font-mono elfinder-info-hash", D = [], U = m.ui.notify; if (U.is(":hidden") && U.children(".elfinder-notify").length && U.elfinderdialog("open").height("auto"), !y) return e.Deferred().reject(); if (I.length) return I.elfinderdialog("toTop"), e.Deferred().resolve(); if (h = m.storage("infohides") || m.arrayFlip(g.hideItems, !0), 1 === y) { if ((l = o[0]).icon && (E = " " + m.getIconStyle(l)), x = x.replace("{dirclass}", l.csscls ? m.escape(l.csscls) : "").replace("{class}", m.mime2class(l.mime)).replace("{style}", E), c = v.itemTitle.replace("{name}", m.escape(l.i18 || l.name)).replace("{kind}", '<span title="' + m.escape(l.mime) + '">' + m.mime2kind(l) + "</span>"), s = m.tmb(l), l.read ? "directory" != l.mime || l.alias ? r = m.formatSize(l.size) : (r = v.spinner.replace("{text}", i.calc).replace("{name}", "size"), j.push(l.hash)) : r = i.unknown, !h.size && w.push(b.replace(k, i.size).replace(C, r)), !h.aleasfor && l.alias && w.push(b.replace(k, i.aliasfor).replace(C, l.alias)), h.path || ((u = m.path(l.hash, !0)) ? w.push(b.replace(k, i.path).replace(C, a(m.escape(u))).replace("{class}", "elfinder-info-path")) : (w.push(b.replace(k, i.path).replace(C, v.spinner.replace("{text}", i.calc).replace("{name}", "path")).replace("{class}", "elfinder-info-path")), z.push(m.path(l.hash, !0, { notify: null }).fail(function () { O(i.unknown, "path") }).done(function (e) { O(a(e), "path") })))), !h.link && l.read) { var P, q = m.escape(l.name); if ("1" == l.url) w.push(b.replace(k, i.link).replace(C, '<button class="elfinder-info-button ' + n + '-url">' + i.getlink + "</button>")); else { if (l.url) P = l.url; else if ("directory" === l.mime) if (g.nullUrlDirLinkSelf && null === l.url) { var R = window.location; P = R.pathname + R.search + "#elf_" + l.hash } else "" !== l.url && m.option("url", !m.isRoot(l) && l.phash || l.hash) && (P = m.url(l.hash)); else P = m.url(l.hash); P && w.push(b.replace(k, i.link).replace(C, '<a href="' + P + '" target="_blank">' + q + "</a>")) } } h.dim || (l.dim ? w.push(b.replace(k, i.dim).replace(C, l.dim)) : -1 !== l.mime.indexOf("image") && (l.width && l.height ? w.push(b.replace(k, i.dim).replace(C, l.width + "x" + l.height)) : l.size && "0" !== l.size && (w.push(b.replace(k, i.dim).replace(C, v.spinner.replace("{text}", i.calc).replace("{name}", "dim"))), z.push(m.request({ data: { cmd: "dim", target: l.hash }, preventDefault: !0 }).fail(function () { O(i.unknown, "dim") }).done(function (e) { if (O(e.dim || i.unknown, "dim"), e.dim) { var t = e.dim.split("x"), n = m.file(l.hash); n.width = t[0], n.height = t[1] } }))))), !h.modify && w.push(b.replace(k, i.modify).replace(C, m.formatDate(l))), !h.perms && w.push(b.replace(k, i.perms).replace(C, m.formatPermissions(l))), !h.locked && w.push(b.replace(k, i.locked).replace(C, l.locked ? i.yes : i.no)), !h.owner && l.owner && w.push(b.replace(k, i.owner).replace(C, l.owner)), !h.group && l.group && w.push(b.replace(k, i.group).replace(C, l.group)), !h.perm && l.perm && w.push(b.replace(k, i.perm).replace(C, m.formatFileMode(l.perm))), window.ArrayBuffer && (m.options.cdns.sparkmd5 || m.options.cdns.jssha) && "directory" !== l.mime && l.size > 0 && (!g.showHashMaxsize || l.size <= g.showHashMaxsize) && (D = [], e.each(m.storage("hashchekcer") || g.showHashAlgorisms, function (e, t) { l[t] ? w.push(b.replace(k, m.i18n(t)).replace(C, l[t]).replace("{class}", F)) : (w.push(b.replace(k, m.i18n(t)).replace(C, v.spinner.replace("{text}", i.calc).replace("{name}", t))), D.push(t)) }), D.length && (f = e('<div class="elfinder-quicklook-info-progress"></div>'), z.push(m.getContentsHashes(l.hash, D, g.showHashOpts, { progressBar: f }).progress(function (t) { e.each(D, function (e, n) { t[n] && O(t[n], n, F) }) }).always(function () { e.each(D, function (e, t) { O(i.unknown, t) }) })))), g.custom && e.each(g.custom, function (t, n) { h[n.label] || n.mimes && !e.grep(n.mimes, function (e) { return l.mime === e || 0 === l.mime.indexOf(e + "/") }).length || n.hashRegex && !l.hash.match(n.hashRegex) || (w.push(b.replace(k, m.i18n(n.label)).replace(C, n.tpl.replace("{id}", S))), n.action && "function" == typeof n.action && M.push(n.action)) }) } else x = x.replace("{class}", "elfinder-cwd-icon-group"), c = v.groupTitle.replace("{items}", i.items).replace("{num}", y), (d = e.grep(o, function (e) { return "directory" == e.mime }).length) ? (d -= p = e.grep(o, function (e) { return !("directory" !== e.mime || e.phash && !e.isroot) }).length, w.push(b.replace(k, i.kind).replace(C, p === y || d === y ? i[p ? "roots" : "folders"] : e.map({ roots: p, folders: d, files: y - p - d }, function (e, t) { return e ? i[t] + " " + e : null }).join(", "))), !h.size && w.push(b.replace(k, i.size).replace(C, v.spinner.replace("{text}", i.calc).replace("{name}", "size"))), j = e.map(o, function (e) { return e.hash })) : (r = 0, e.each(o, function (e, t) { var n = parseInt(t.size); n >= 0 && r >= 0 ? r += n : r = "unknown" }), w.push(b.replace(k, i.kind).replace(C, i.files)), !h.size && w.push(b.replace(k, i.size).replace(C, m.formatSize(r)))); return x = x.replace("{title}", c).replace("{content}", w.join("").replace(/{class}/g, "")), (I = this.fmDialog(x, A)).attr("id", S).one("mousedown", ".elfinder-info-path", function () { e(this).html(a(e(this).html(), !0)) }), D.length && f.appendTo(I.find("." + n + "-" + D[0]).parent()), m.UA.Mobile && e.fn.tooltip && I.children(".ui-dialog-content .elfinder-info-title").tooltip({ classes: { "ui-tooltip": "elfinder-ui-tooltip ui-widget-shadow" }, tooltipClass: "elfinder-ui-tooltip ui-widget-shadow", track: !0 }), l && "1" == l.url && I.on("click", "." + n + "-url", function () { e(this).parent().html(v.spinner.replace("{text}", m.i18n("ntfurl")).replace("{name}", "url")), m.request({ data: { cmd: "url", target: l.hash }, preventDefault: !0 }).fail(function () { O(q, "url") }).done(function (e) { e.url ? (O('<a href="' + e.url + '" target="_blank">' + q + "</a>" || q, "url"), m.file(l.hash).url = e.url) : O(q, "url") }) }), s && e("<img/>").on("load", function () { I.find(".elfinder-cwd-icon").addClass(s.className).css("background-image", "url('" + s.url + "')") }).attr("src", s.url), j.length && (T = m.getSize(j).done(function (e) { O(e.formated, "size") }).fail(function () { O(i.unknown, "size") })), M.length && e.each(M, function (e, t) { try { t(l, m, I) } catch (e) { m.debug("error", e) } }), e.Deferred().resolve() } }).prototype = { forceLoad: !0 }, h.prototype.commands.mkdir = function () { var t, n = this.fm, i = this; this.value = "", this.disableOnSearch = !0, this.updateOnSelect = !1, this.syncTitleOnChange = !0, this.mime = "directory", this.prefix = "untitled folder", this.exec = function (a, o) { var r; return a && a.length && o && o._currentType && "navbar" === o._currentType ? (this.origin = o._currentType, this.data = { target: a[0] }) : (r = n.cwd().hash === a[0], this.origin = t && !r ? t : "cwd", delete this.data), a || this.options.intoNewFolderToolbtn || n.getUI("cwd").trigger("unselectall"), this.move = this.value === n.i18n("cmdmkdirin"), e.proxy(n.res("mixin", "make"), i)() }, this.shortcuts = [{ pattern: "ctrl+shift+n" }], this.init = function () { this.options.intoNewFolderToolbtn && (this.syncTitleOnChange = !0) }, n.bind("select contextmenucreate closecontextmenu", function (e) { var a = (e.data ? e.data.selected || e.data.targets : null) || n.selected(); i.className = "mkdir", t = e.data && a.length && (e.data.origin || e.data.type) || "", i.options.intoNewFolderToolbtn || "" !== t || (t = "cwd"), a.length && "navbar" !== t && "cwd" !== t && n.cwd().hash !== a[0] ? (i.title = n.i18n("cmdmkdirin"), i.className += " elfinder-button-icon-mkdirin") : i.title = n.i18n("cmdmkdir"), "closecontextmenu" !== e.type ? i.update(void 0, i.title) : requestAnimationFrame(function () { i.update(void 0, i.title) }) }), this.getstate = function (i) { var a = n.cwd(), o = "navbar" === t || i && i[0] !== a.hash ? this.files(i || n.selected()) : [], r = o.length; return "navbar" === t ? r && o[0].write && o[0].read ? 0 : -1 : !a.write || r && e.grep(o, function (e) { return !(!e.read || e.locked) }).length != r ? -1 : 0 } }, h.prototype.commands.mkfile = function () { var t = this; this.disableOnSearch = !0, this.updateOnSelect = !1, this.mime = "text/plain", this.prefix = "untitled file.txt", this.variants = [], this.getTypeName = function (e, n) { var i, a = t.fm; return i = (i = a.messages["kind" + a.kinds[e]]) ? a.i18n(["extentiontype", n.toUpperCase(), i]) : a.i18n(["extentionfile", n.toUpperCase()]) }, this.fm.bind("open reload canMakeEmptyFile", function () { var n = t.fm, i = n.getCommand("edit").getMkfileHides(); t.variants = [], n.mimesCanMakeEmpty && e.each(n.mimesCanMakeEmpty, function (e, a) { a && !i[e] && n.uploadMimeCheck(e) && t.variants.push([e, t.getTypeName(e, a)]) }), t.change() }), this.getstate = function () { return this.fm.cwd().write ? 0 : -1 }, this.exec = function (n, i) { var a, o, r = t.fm; if (a = r.mimesCanMakeEmpty[i]) { if (r.uploadMimeCheck(i)) return this.mime = i, this.prefix = r.i18n(["untitled file", a]), e.proxy(r.res("mixin", "make"), t)(); o = ["errMkfile", t.getTypeName(i, a)] } return e.Deferred().reject(o) } }, h.prototype.commands.netmount = function () { var t, n = this, i = !1; this.alwaysEnabled = !0, this.updateOnSelect = !1, this.drivers = [], this.handlers = { load: function () { var t = n.fm; t.cookieEnabled && t.one("open", function () { n.drivers = t.netDrivers, n.drivers.length && e.each(n.drivers, function () { var e = n.options[this]; e && (i = !0, e.integrateInfo && t.trigger("helpIntegration", Object.assign({ cmd: "netmount" }, e.integrateInfo))) }) }) } }, this.getstate = function () { return i ? 0 : -1 }, this.exec = function () { var i, a, o, r, s, l, c, d, p = n.fm, u = e.Deferred(), h = n.options; return n.dialog ? n.dialog.elfinderdialog("open") : n.dialog = (o = function () { r.protocol.trigger("change", "winfocus") }, r = { protocol: e("<select></select>").on("change", function (e, n) { var a = this.value; t.find(".elfinder-netmount-tr").hide(), t.find(".elfinder-netmount-tr-" + a).show(), i && i.children(".ui-dialog-buttonpane:first").find("button").show(), "function" == typeof h[a].select && h[a].select(p, e, n) }).addClass("ui-corner-all") }, s = { title: p.i18n("netMountDialogTitle"), resizable: !0, modal: !0, destroyOnClose: !1, open: function () { e(window).on("focus." + p.namespace, o), r.protocol.trigger("change") }, close: function () { "pending" == u.state() && u.reject(), e(window).off("focus." + p.namespace, o) }, buttons: {} }, l = function () { var i, a = r.protocol.val(), o = { cmd: "netmount", protocol: a }, s = h[a]; if (e.each(t.find("input.elfinder-netmount-inputs-" + a), function (t, n) { var i, a; (a = e(n)).is(":radio,:checkbox") ? a.is(":checked") && (i = e.trim(a.val())) : i = e.trim(a.val()), i && (o[n.name] = i) }), !o.host) return p.trigger("error", { error: "errNetMountHostReq", opts: { modal: !0 } }); o.mnt2res && (i = !0), p.request({ data: o, notify: { type: "netmount", cnt: 1, hideCnt: !0 } }).done(function (e) { var t; e.added && e.added.length && (i && r.protocol.trigger("change", "reset"), e.added[0].phash && (t = p.file(e.added[0].phash)) && (t.dirs || (t.dirs = 1, p.change({ changed: [t] }))), p.one("netmountdone", function () { p.exec("open", e.added[0].hash) })), u.resolve() }).fail(function (e) { s.fail && "function" == typeof s.fail && s.fail(p, p.parseError(e)), u.reject(e) }), n.dialog.elfinderdialog("close") }, c = e('<form autocomplete="off"></form>').on("keydown", "input", function (t) { var n, i = !0; t.keyCode === e.ui.keyCode.ENTER && (e.each(c.find("input:visible:not(.elfinder-input-optional)"), function () { if ("" === e(this).val()) return i = !1, n = e(this), !1 }), i ? l() : n.trigger("focus")) }), d = e("<div></div>"), t = e('<table class="elfinder-info-tb elfinder-netmount-tb"></table>').append(e("<tr></tr>").append(e("<td>" + p.i18n("protocol") + "</td>")).append(e("<td></td>").append(r.protocol))), e.each(n.drivers, function (n, i) { h[i] && (r.protocol.append('<option value="' + i + '">' + p.i18n(h[i].name || i) + "</option>"), e.each(h[i].inputs, function (n, a) { a.attr("name", n), "hidden" != a.attr("type") ? (a.addClass("ui-corner-all elfinder-netmount-inputs-" + i), t.append(e("<tr></tr>").addClass("elfinder-netmount-tr elfinder-netmount-tr-" + i).append(e("<td>" + p.i18n(n) + "</td>")).append(e("<td></td>").append(a)))) : (a.addClass("elfinder-netmount-inputs-" + i), d.append(a)) }), h[i].protocol = r.protocol) }), t.append(d), t.find(".elfinder-netmount-tr").hide(), t.find(".elfinder-netmount-tr-" + n.drivers[0]).show(), s.buttons[p.i18n("btnMount")] = l, s.buttons[p.i18n("btnCancel")] = function () { n.dialog.elfinderdialog("close") }, t.find("select,input").addClass("elfinder-tabstop"), a = n.fmDialog(c.append(t), s).ready(function () { r.protocol.trigger("change"), a.elfinderdialog("posInit") }), i = a.closest(".ui-dialog"), a), u.promise() }, n.fm.bind("netmount", function (e) { var i = e.data || null, a = n.options, o = function () { a[i.protocol] && "function" == typeof a[i.protocol].done && (a[i.protocol].done(n.fm, i), t.find("select,input").addClass("elfinder-tabstop"), n.dialog.elfinderdialog("tabstopsInit")) }; i && i.protocol && (i.mode && "redirect" === i.mode ? n.fm.request({ data: { cmd: "netmount", protocol: i.protocol, host: i.host, user: "init", pass: "return", options: i.options }, preventDefault: !0 }).done(function (e) { i = JSON.parse(e.body), o() }) : o()) }) }, h.prototype.commands.netunmount = function () { this.alwaysEnabled = !0, this.updateOnSelect = !1, this.drivers = [], this.handlers = { load: function () { this.drivers = this.fm.netDrivers } }, this.getstate = function (e) { var t, n = this.fm; return e && this.drivers.length && !this._disabled && (t = n.file(e[0])) && t.netkey ? 0 : -1 }, this.exec = function (t) { var n = this, i = this.fm, a = e.Deferred().fail(function (e) { e && i.error(e) }), o = i.file(t[0]); return this._disabled ? a.reject() : ("pending" == a.state() && i.confirm({ title: n.title, text: i.i18n("confirmUnmount", o.name), accept: { label: "btnUnmount", callback: function () { var t, r = o.hash, s = function (t) { var n, a = []; return i.leafRoots && (n = [], e.each(i.leafRoots, function (a, o) { var r, s = i.parents(a); -1 !== (r = e.inArray(t, s)) && (r = s.length - r, e.each(o, function (e, t) { n.push({ i: r, hash: t }) })) }), n.length && (n.sort(function (e, t) { return e.i < t.i }), e.each(n, function (e, t) { a.push(t.hash) }))), a }(r), l = [], c = [], d = function () { e.when(l).done(function () { i.request({ data: { cmd: "netmount", protocol: "netunmount", host: o.netkey, user: r, pass: "dum" }, notify: { type: "netunmount", cnt: 1, hideCnt: !0 }, preventFail: !0 }).fail(function (e) { a.reject(e) }).done(function (e) { o.volumeid && delete i.volumeExpires[o.volumeid], a.resolve() }) }).fail(function (e) { c.length && i.remove({ removed: c }), a.reject(e) }) }; s.length ? i.confirm({ title: n.title, text: (t = ["unmountChildren"], e.each(s, function (e, n) { t.push([i.file(n).name]) }), t), accept: { label: "btnUnmount", callback: function () { e.each(s, function (e, t) { var n = i.file(t); n.netkey && l.push(i.request({ data: { cmd: "netmount", protocol: "netunmount", host: n.netkey, user: n.hash, pass: "dum" }, notify: { type: "netunmount", cnt: 1, hideCnt: !0 }, preventDefault: !0 }).done(function (e) { e.removed && (n.volumeid && delete i.volumeExpires[n.volumeid], c = c.concat(e.removed)) })) }), d() } }, cancel: { label: "btnCancel", callback: function () { a.reject() } } }) : (l = null, d()) } }, cancel: { label: "btnCancel", callback: function () { a.reject() } } }), a) } }, (h.prototype.commands.open = function () { var t = this.fm, n = this; this.alwaysEnabled = !0, this.noChangeDirOnRemovedCwd = !0, this._handlers = { dblclick: function (e) { var i = e.data && e.data.file ? [e.data.file] : void 0; 0 === n.getstate(i) && (e.preventDefault(), t.exec("open", i)) }, "select enable disable reload": function (e) { this.update("disable" == e.type ? -1 : void 0) } }, this.shortcuts = [{ pattern: "ctrl+down numpad_enter" + ("mac" != t.OS && " enter") }], this.getstate = function (n) { var i = this.files(n), a = i.length; return 1 == a ? i[0].read ? 0 : -1 : a && !t.UA.Mobile && e.grep(i, function (e) { return !("directory" == e.mime || !e.read) }).length == a ? 0 : -1 }, this.exec = function (n, i) { var a, o, r, s, l, c, d, p, u, h, f, m, g = e.Deferred().fail(function (e) { e && t.error(e) }), v = this.files(n), b = v.length, y = "object" == typeof i && i.thash, w = this.options, x = w.into || "window"; if (!b && !y) return g.reject(); if (y || 1 == b && (a = v[0]) && "directory" == a.mime) return y || !a || a.read ? t.keyState.ctrlKey && (t.keyState.shiftKey || "function" != typeof t.options.getFileCallback) && t.getCommand("opennew") ? t.exec("opennew", [y || a.hash]) : t.request({ data: { cmd: "open", target: y || a.hash }, notify: { type: "open", cnt: 1, hideCnt: !0 }, syncOnFail: !0, lazy: !1 }) : g.reject(["errOpen", a.name, "errPerm"]); if (v = e.grep(v, function (e) { return "directory" != e.mime }), b != v.length) return g.reject(); var k = function () { var i, f, m = function (n) { var p = e("<a>").hide().appendTo(e("body")); if (t.UA.Mobile || !h) { if (u) h ? p.attr("target", "_blank") : p.attr("download", a.name), p.attr("href", n).get(0).click(); else if (!(i = window.open(n))) return g.reject("errPopup") } else { if (!("string" == typeof w.method && "get" === w.method.toLowerCase()) && 0 === n.indexOf(t.options.url) && t.customData && Object.keys(t.customData).length && !a.mime.match(/^(?:video|audio)/) && (n = ""), "window" === x ? (s = c = Math.round(2 * screen.availWidth / 3), l = d = Math.round(2 * screen.availHeight / 3), parseInt(a.width) && parseInt(a.height) ? (s = parseInt(a.width), l = parseInt(a.height)) : a.dim && (o = a.dim.split("x"), s = parseInt(o[0]), l = parseInt(o[1])), c >= s && d >= l ? (c = s, d = l) : s - c > l - d ? d = Math.round(l * (c / s)) : c = Math.round(s * (d / l)), r = "width=" + c + ",height=" + d, i = window.open(n, f, r + ",top=50,left=50,scrollbars=yes,resizable=yes,titlebar=no")) : ("tabs" === x && (f = a.hash), i = window.open("about:blank", f)), !i) return g.reject("errPopup"); if ("" === n) { var m = document.createElement("form"); m.action = t.options.url, m.method = "POST", m.target = f, m.style.display = "none"; var v = Object.assign({}, t.customData, { cmd: "file", target: a.hash, _t: a.ts || parseInt(+new Date / 1e3) }); e.each(v, function (e, t) { var n = document.createElement("input"); n.name = e, n.value = t, m.appendChild(n) }), document.body.appendChild(m), m.submit() } else "window" !== x && (i.location = n); e(i).trigger("focus") } p.remove() }; try { p = new RegExp(t.option("dispInlineRegex"), "i") } catch (e) { p = !1 } for (u = "string" == typeof e("<a>").get(0).download, b = v.length; b--;) { if (f = "elf_open_window", !(a = v[b]).read) return g.reject(["errOpen", a.name, "errPerm"]); h = p && a.mime.match(p), t.openUrl(a.hash, !h, m) } return g.resolve(n) }; if (b > 1) t.confirm({ title: "openMulti", text: ["openMultiConfirm", b + ""], accept: { label: "cmdopen", callback: function () { k() } }, cancel: { label: "btnCancel", callback: function () { g.reject() } }, buttons: t.getCommand("zipdl") && t.isCommandEnabled("zipdl", t.cwd().hash) ? [{ label: "cmddownload", callback: function () { t.exec("download", n), g.reject() } }] : [] }); else { if ((f = t.storage("selectAction") || w.selectAction) && (e.each(f.split("/"), function () { var e = this.valueOf(); if ("open" !== e && (m = t.getCommand(e)) && m.enabled()) return !1; m = null }), m)) return t.exec(m.name); k() } return g } }).prototype = { forceLoad: !0 }, h.prototype.commands.opendir = function () { this.alwaysEnabled = !0, this.getstate = function () { return 1 !== this.fm.selected().length ? -1 : this.fm.getUI("workzone").hasClass("elfinder-search-result") ? 0 : -1 }, this.exec = function (t) { var n, i = this.fm, a = e.Deferred(), o = this.files(t); return o.length && o[0].phash ? (n = o[0].phash, i.trigger("searchend", { noupdate: !0 }), i.request({ data: { cmd: "open", target: n }, notify: { type: "open", cnt: 1, hideCnt: !0 }, syncOnFail: !1 }), a) : a.reject() } }, h.prototype.commands.opennew = function () { var t = this.fm; this.shortcuts = [{ pattern: ("function" == typeof t.options.getFileCallback ? "shift+" : "") + "ctrl+enter" }], this.getstate = function (e) { var t = this.files(e); return 1 === t.length && "directory" === t[0].mime && t[0].read ? 0 : -1 }, this.exec = function (t) { var n, i, a, o, r = e.Deferred(), s = this.files(t), l = s.length, c = this.options; return 1 === l && (n = s[0]) && "directory" === n.mime ? (i = window.location, a = c.url ? c.url : i.pathname, c.useOriginQuery && (a.match(/\?/) ? i.search && (a += "&" + i.search.substr(1)) : a += i.search), a += "#elf_" + n.hash, o = window.open(a, "_blank"), setTimeout(function () { o.focus() }, 1e3), r.resolve()) : r.reject() } }, h.prototype.commands.paste = function () { this.updateOnSelect = !1, this.handlers = { changeclipboard: function () { this.update() } }, this.shortcuts = [{ pattern: "ctrl+v shift+insert" }], this.getstate = function (e) { if (this._disabled) return -1; if (e) { if (Array.isArray(e)) { if (1 != e.length) return -1; e = this.fm.file(e[0]) } } else e = this.fm.cwd(); return this.fm.clipboard().length && "directory" == e.mime && e.write ? 0 : -1 }, this.exec = function (t, n) { var i, a, o, r = this, s = r.fm, l = n || {}, c = t ? this.files(t)[0] : s.cwd(), d = s.clipboard(), p = d.length, u = !!p && d[0].cut, h = l._cmd ? l._cmd : u ? "move" : "copy", f = "err" + h.charAt(0).toUpperCase() + h.substr(1), m = [], g = [], v = e.Deferred().fail(function (e) { e && s.error(e) }).always(function () { s.unlockfiles({ files: e.map(d, function (e) { return e.hash }) }) }); return p && c && "directory" == c.mime ? c.write ? (i = s.parents(c.hash), e.each(d, function (t, n) { return n.read ? u && n.locked ? !v.reject(["errLocked", n.name]) : -1 !== e.inArray(n.hash, i) ? !v.reject(["errCopyInItself", n.name]) : n.mime && "directory" !== n.mime && !s.uploadMimeCheck(n.mime, c.hash) ? !v.reject([f, n.name, "errUploadMime"]) : ((a = s.parents(n.hash)).pop(), -1 !== e.inArray(c.hash, a) && e.grep(a, function (e) { var t = s.file(e); return t.phash == c.hash && t.name == n.name }).length ? !v.reject(["errReplByChild", n.name]) : void (n.phash == c.hash ? g.push(n.hash) : m.push({ hash: n.hash, phash: n.phash, name: n.name }))) : !v.reject([f, n.name, "errPerm"]) }), "rejected" === v.state() ? v : (o = e.Deferred(), u && r.options.moveConfirm ? s.confirm({ title: "moveFiles", text: s.i18n("confirmMove", c.i18 || c.name), accept: { label: "btnYes", callback: function () { o.resolve() } }, cancel: { label: "btnCancel", callback: function () { o.reject() } } }) : o.resolve(), o.done(function () { var t; e.when((t = g, t.length && s._commands.duplicate ? s.exec("duplicate", t) : e.Deferred().resolve()), function (t) { var n, i = e.Deferred(), a = [], o = {}, d = function (t, n) { for (var i = [], a = t.length; a--;)-1 !== e.inArray(t[a].name, n) && i.unshift(a); return i }, p = function (e) { var n = a[e], o = t[n], r = e == a.length - 1; o && s.confirm({ title: s.i18n(h + "Files"), text: ["errExists", o.name, "restore" === h ? "confirmRest" : "confirmRepl"], all: !r, accept: { label: "btnYes", callback: function (n) { r || n ? m(t) : p(++e) } }, reject: { label: "btnNo", callback: function (n) { var i; if (n) for (i = a.length; e < i--;)t[a[i]].remove = !0; else t[a[e]].remove = !0; r || n ? m(t) : p(++e) } }, cancel: { label: "btnCancel", callback: function () { i.resolve() } }, buttons: [{ label: "btnBackup", callback: function (n) { var i; if (n) for (i = a.length; e < i--;)t[a[i]].rename = !0; else t[a[e]].rename = !0; r || n ? m(t) : p(++e) } }] }) }, f = function (n) { var i, r = {}; n && (Array.isArray(n) ? n.length && ("string" == typeof n[0] ? a = d(t, n) : (e.each(n, function (e, t) { r[t.name] = t.hash }), a = d(t, e.map(r, function (e, t) { return t })), e.each(t, function (e, t) { r[t.name] && (o[r[t.name]] = t.name) }))) : (i = [], a = e.map(n, function (e) { return "string" == typeof e ? e : (i = i.concat(e), !1) }), i.length && (a = a.concat(i)), a = d(t, a), o = n)), a.length ? p(0) : m(t) }, m = function (t) { var n, a, r = [], d = e.grep(t, function (e) { return e.rename && r.push(e.name), !e.remove }), p = d.length; if (!p) return i.resolve(); n = e.map(d, function (e) { return e.hash }), a = { cmd: "paste", dst: c.hash, targets: n, cut: u ? 1 : 0, renames: r, hashes: o, suffix: s.options.backupSuffix }, s.api < 2.1 && (a.src = d[0].phash), s.request({ data: a, notify: { type: h, cnt: p }, cancel: !0, navigate: { toast: l.noToast ? {} : { inbuffer: { msg: s.i18n(["complete", s.i18n("cmd" + h)]), action: { cmd: "open", msg: "cmdopendir", data: [c.hash], done: "select", cwdNot: c.hash } } } } }).done(function (t) { var n = {}, o = t.added && t.added.length ? t.added : null; u && o && (e.each(d, function (t, i) { var a, r, s = i.phash, l = (a = i.name, e.each(o, function (e, t) { if (t.name === a) return r = t.hash, !1 }), r); l && (n[s] ? n[s].push(l) : n[s] = [l]) }), Object.keys(n).length && (t.undo = { cmd: "move", callback: function () { var t = []; return e.each(n, function (e, n) { t.push(s.request({ data: { cmd: "paste", dst: e, targets: n, cut: 1 }, notify: { type: "undo", cnt: n.length } })) }), e.when.apply(null, t) } }, t.redo = { cmd: "move", callback: function () { return s.request({ data: a, notify: { type: "redo", cnt: p } }) } })), i.resolve(t) }).fail(function (e) { i.reject(), 0 === e && s.sync() }).always(function () { s.unlockfiles({ files: d }) }) }; return s.isCommandEnabled(r.name, c.hash) && t.length ? (s.oldAPI ? m(t) : s.option("copyOverwrite", c.hash) ? (n = e.map(t, function (e) { return e.name }), c.hash == s.cwd().hash ? f(e.map(s.files(), function (e) { return e.phash == c.hash ? { hash: e.hash, name: e.name } : null })) : s.request({ data: { cmd: "ls", target: c.hash, intersect: n }, notify: { type: "prepare", cnt: 1, hideCnt: !0 }, preventFail: !0 }).always(function (e) { f(e.list) })) : m(t), i) : i.resolve() }(m)).done(function (e, t) { v.resolve(t && t.undo ? t : void 0) }).fail(function () { v.reject() }).always(function () { u && s.clipboard([]) }) }).fail(function () { v.reject() }), v)) : v.reject([f, d[0].name, "errPerm"]) : v.reject() } }, h.prototype.commands.places = function () { var t = this, n = this.fm, i = null; this.getstate = function (n) { var a, o = this.hashes(n), r = o.length; return i && r && r == (a = o, e.grep(t.files(a), function (e) { return "directory" == e.mime })).length ? 0 : -1 }, this.exec = function (t) { var n = this.files(t); return i.trigger("regist", [n]), e.Deferred().resolve() }, n.one("load", function () { i = n.ui.places }) }, h.prototype.commands.preference = function () { var t, n, i = this, a = this.fm, o = "replace", r = '<li class="' + a.res("class", "tabstab") + ' elfinder-preference-tab-{id}"><a href="#' + a.namespace + '-preference-{id}" id="' + a.namespace + '-preference-tab-{id}" class="ui-tabs-anchor {class}">{title}</a></li>', s = e('<div class="ui-tabs ui-widget ui-widget-content ui-corner-all elfinder-preference">'), l = e('<ul class="ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-top">'), c = e('<div class="elfinder-preference-tabs ui-tabs-panel ui-widget-content ui-corner-bottom"></div>'), d = (e("base").length && document.location.href.replace(/#.*$/, ""), function (t) { e("#" + a.namespace + "-preference-tab-" + t).trigger("mouseover").trigger("click"), n = t }), p = a.res("class", "tabsactive"); this.shortcuts = [{ pattern: "ctrl+comma", description: this.title }], this.alwaysEnabled = !0, this.getstate = function () { return 0 }, this.exec = function (u, h) { var f, m, g, v, b, y, w, x, k, C, z, T; return !t && (z = i.options.categories || { language: ["language"], theme: ["theme"], toolbar: ["toolbarPref"], workspace: ["iconSize", "columnPref", "selectAction", "makefileTypes", "useStoredEditor", "editorMaximized", "useFullscreen", "showHidden"], dialog: ["autoFocusDialog"], selectionInfo: ["infoItems", "hashChecker"], reset: ["clearBrowserData"], all: !0 }, T = i.options.prefs || ["language", "theme", "toolbarPref", "iconSize", "columnPref", "selectAction", "makefileTypes", "useStoredEditor", "editorMaximized", "useFullscreen", "showHidden", "infoItems", "hashChecker", "autoFocusDialog", "clearBrowserData"], a.cookieEnabled || delete z.language, T = a.arrayFlip(T, !0), a.options.getFileCallback && delete T.selectAction, a.UA.Fullscreen || delete T.useFullscreen, T.language && (T.language = (f = e("<select></select>").on("change", function () { var t = e(this).val(); a.storage("lang", t), e("#" + a.id).elfinder("reload") }), m = [], g = i.options.langs || { ar: "العربية", bg: "Български", ca: "Català", cs: "Čeština", da: "Dansk", de: "Deutsch", el: "Ελληνικά", en: "English", es: "Español", fa: "فارسی", fo: "Føroyskt", fr: "Français", fr_CA: "Français (Canada)", he: "עברית", hr: "Hrvatski", hu: "Magyar", id: "Bahasa Indonesia", it: "Italiano", ja: "日本語", ko: "한국어", nl: "Nederlands", no: "Norsk", pl: "Polski", pt_BR: "Português", ro: "Română", ru: "Pусский", si: "සිංහල", sk: "Slovenčina", sl: "Slovenščina", sr: "Srpski", sv: "Svenska", tr: "Türkçe", ug_CN: "ئۇيغۇرچە", uk: "Український", vi: "Tiếng Việt", zh_CN: "简体中文", zh_TW: "正體中文" }, a.cookieEnabled ? (e.each(g, function (e, t) { m.push('<option value="' + e + '">' + t + "</option>") }), f.append(m.join("")).val(a.lang)) : e())), T.theme && (T.theme = function () { var t = a.options.themes ? Object.keys(a.options.themes).length : 0; if (0 === t || 1 === t && a.options.themes.default) return null; var n = e("<select></select>").on("change", function () { var t = e(this).val(); a.changeTheme(t).storage("theme", t) }), i = { image: '<img class="elfinder-preference-theme elfinder-preference-theme-image" src="$2" />', link: '<a href="$1" target="_blank" title="$3">$2</a>', data: '<dt>$1</dt><dd><span class="elfinder-preference-theme elfinder-preference-theme-$0">$2</span></dd>' }, o = ["image", "description", "author", "email", "license"], r = e('<button class="ui-button ui-corner-all ui-widget elfinder-preference-theme-default"></button>').text(a.i18n("default")).on("click", function (e) { n.val("default").trigger("change") }), s = e('<div class="elfinder-reference-hide-taball"></div>').on("click", "button", function () { var t = e(this).data("themeid"); n.val(t).trigger("change") }); return a.options.themes.default || n.append('<option value="default">' + a.i18n("default") + "</option>"), e.each(a.options.themes, function (t, r) { var l, c = e('<option class="elfinder-theme-option-' + t + '" value="' + t + '">' + a.i18n(t) + "</option>"), d = e('<fieldset class="ui-widget ui-widget-content ui-corner-all elfinder-theme-list-' + t + '"><legend>' + a.i18n(t) + '</legend><div><span class="elfinder-spinner"></span></div></fieldset>'); n.append(c), s.append(d), l = setTimeout(function () { d.find("span.elfinder-spinner").replaceWith(a.i18n(["errRead", t])) }, 1e4), a.getTheme(t).always(function () { l && clearTimeout(l) }).done(function (r) { var s, l = e(), p = e("<dl></dl>"); s = r.link ? i.link.replace(/\$1/g, r.link).replace(/\$3/g, a.i18n("website")) : "$2", r.name && c.html(a.i18n(r.name)), d.children("legend").html(s.replace(/\$2/g, a.i18n(r.name) || t)), e.each(o, function (o, s) { var l, c = i[s] || i.data; r[s] && (l = c.replace(/\$0/g, a.escape(s)).replace(/\$1/g, a.i18n(s)).replace(/\$2/g, a.i18n(r[s])), "image" === s && r.link && (l = e(l).on("click", function () { n.val(t).trigger("change") }).attr("title", a.i18n("select"))), p.append(l)) }), l = (l = l.add(p)).add(e('<div class="elfinder-preference-theme-btn"></div>').append(e('<button class="ui-button ui-corner-all ui-widget"></button>').data("themeid", t).html(a.i18n("select")))), d.find("span.elfinder-spinner").replaceWith(l) }).fail(function () { d.find("span.elfinder-spinner").replaceWith(a.i18n(["errRead", t])) }) }), e("<div></div>").append(n.val(a.theme && a.theme.id ? a.theme.id : "default"), r, s) }()), T.toolbarPref && (T.toolbarPref = (v = e.map(a.options.uiOptions.toolbar, function (t) { return e.isArray(t) ? t : null }), b = [], y = a.storage("toolbarhides") || {}, e.each(v, function () { var e = a.i18n("cmd" + this); e === "cmd" + this && (e = a.i18n(this)), b.push('<span class="elfinder-preference-toolbar-item"><label><input type="checkbox" value="' + this + '" ' + (y[this] ? "" : "checked") + "/>" + e + "</label></span>") }), e(b.join(" ")).on("change", "input", function () { var t = e(this).val(), n = e(this).is(":checked"); n || y[t] ? n && y[t] && delete y[t] : y[t] = !0, a.storage("toolbarhides", y), a.trigger("toolbarpref") }))), T.iconSize && (T.iconSize = (w = a.options.uiOptions.cwd.iconsView.sizeMax || 3, x = a.storage("iconsize") || a.options.uiOptions.cwd.iconsView.size || 0, k = e('<div class="touch-punch"></div>').slider({ classes: { "ui-slider-handle": "elfinder-tabstop" }, value: x, max: w, slide: function (e, t) { a.getUI("cwd").trigger("iconpref", { size: t.value }) }, change: function (e, t) { a.storage("iconsize", t.value) } }), a.getUI("cwd").on("iconpref", function (e, t) { k.slider("option", "value", t.size) }), k)), T.columnPref && (T.columnPref = function () { var t = a.options.uiOptions.cwd.listView.columns, n = [], i = a.storage("columnhides") || {}; return e.each(t, function () { var e = a.getColumnName(this); n.push('<span class="elfinder-preference-column-item"><label><input type="checkbox" value="' + this + '" ' + (i[this] ? "" : "checked") + "/>" + e + "</label></span>") }), e(n.join(" ")).on("change", "input", function () { var t = e(this).val(), n = e(this).is(":checked"); n || i[t] ? n && i[t] && delete i[t] : i[t] = !0, a.storage("columnhides", i), a.trigger("columnpref", { repaint: !0 }) }) }()), T.selectAction && (T.selectAction = function () { var t = e("<select></select>").on("change", function () { var t = e(this).val(); a.storage("selectAction", "default" === t ? null : t) }), n = [], o = i.options.selectActions, r = a.getCommand("open").options.selectAction || "open"; return -1 === e.inArray(r, o) && o.unshift(r), e.each(o, function (t, i) { var o = e.map(i.split("/"), function (e) { var t = a.i18n("cmd" + e); return t === "cmd" + e && (t = a.i18n(e)), t }); n.push('<option value="' + i + '">' + o.join("/") + "</option>") }), t.append(n.join("")).val(a.storage("selectAction") || r) }()), T.makefileTypes && (T.makefileTypes = function () { var t = a.getCommand("edit").getMkfileHides(), n = function () { var n = []; return t = a.getCommand("edit").getMkfileHides(), e.each(a.mimesCanMakeEmpty, function (e, i) { var o = a.getCommand("mkfile").getTypeName(e, i); n.push('<span class="elfinder-preference-column-item" title="' + a.escape(o) + '"><label><input type="checkbox" value="' + e + '" ' + (t[e] ? "" : "checked") + "/>" + i + "</label></span>") }), n.join(" ") }, i = e("<div></div>").on("change", "input", function () { var n = e(this).val(), i = e(this).is(":checked"); i || t[n] ? i && t[n] && delete t[n] : t[n] = !0, a.storage("mkfileHides", t), a.trigger("canMakeEmptyFile") }).append(n()), o = e("<div></div>").append(e('<input type="text" placeholder="' + a.i18n("typeOfTextfile") + '"/>').on("keydown", function (t) { t.keyCode === e.ui.keyCode.ENTER && e(this).next().trigger("click") }), e('<button class="ui-button"></button>').html(a.i18n("add")).on("click", function () { var t, n = e(this).prev(), i = n.val(), o = a.getUI("toast"), r = function () { return o.appendTo(n.closest(".ui-dialog")), a.toast({ msg: a.i18n("errUsupportType"), mode: "warning", onHidden: function () { 1 === o.children().length && o.appendTo(a.getUI()) } }), n.trigger("focus"), !1 }; if (!i.match(/\//)) { if (!(i = a.arrayFlip(a.mimeTypes)[i])) return r(); n.val(i) } if (!a.mimeIsText(i) || !a.mimeTypes[i]) return r(); a.trigger("canMakeEmptyFile", { mimes: [i], unshift: !0 }), (t = {})[i] = a.mimeTypes[i], a.storage("mkfileTextMimes", Object.assign(t, a.storage("mkfileTextMimes") || {})), n.val(""), o.appendTo(n.closest(".ui-dialog")), a.toast({ msg: a.i18n(["complete", i + " (" + t[i] + ")"]), onHidden: function () { 1 === o.children().length && o.appendTo(a.getUI()) } }) }), e('<button class="ui-button"></button>').html(a.i18n("reset")).on("click", function () { a.one("canMakeEmptyFile", { done: function () { i.empty().append(n()) } }), a.trigger("canMakeEmptyFile", { resetTexts: !0 }) })); return a.bind("canMakeEmptyFile", { done: function (e) { e.data && e.data.mimes && e.data.mimes.length && i.empty().append(n()) } }), e("<div></div>").append(i, o) }()), T.useStoredEditor && (T.useStoredEditor = e('<input type="checkbox"/>').prop("checked", (C = a.storage("useStoredEditor"), C ? C > 0 : a.options.commandsOptions.edit.useStoredEditor)).on("change", function (t) { a.storage("useStoredEditor", e(this).is(":checked") ? 1 : -1) })), T.editorMaximized && (T.editorMaximized = e('<input type="checkbox"/>').prop("checked", function () { var e = a.storage("editorMaximized"); return e ? e > 0 : a.options.commandsOptions.edit.editorMaximized }()).on("change", function (t) { a.storage("editorMaximized", e(this).is(":checked") ? 1 : -1) })), T.useFullscreen && (T.useFullscreen = e('<input type="checkbox"/>').prop("checked", function () { var e = a.storage("useFullscreen"); return e ? e > 0 : "screen" === a.options.commandsOptions.fullscreen.mode }()).on("change", function (t) { a.storage("useFullscreen", e(this).is(":checked") ? 1 : -1) })), T.showHidden && function () { var t, n, i = function () { var n, i = a.storage("hide"), o = []; i && i.items && e.each(i.items, function (e, t) { o.push(a.escape(t)) }), s.prop("disabled", !o.length)[o.length ? "removeClass" : "addClass"]("ui-state-disabled"), n = o.length ? o.join("\n") : "", T.showHidden.attr("title", n), t && T.showHidden.tooltip("option", "content", n.replace(/\n/g, "<br>")).tooltip("close") }, o = e('<input type="checkbox"/>').prop("checked", (n = a.storage("hide"), n && n.show)).on("change", function (t) { var n = {}; n[e(this).is(":checked") ? "show" : "hide"] = !0, a.exec("hide", void 0, n) }), r = e('<button class="ui-button ui-corner-all ui-widget"></button>').append(a.i18n("reset")).on("click", function () { a.exec("hide", void 0, { reset: !0 }), e(this).parent().find("input:first").prop("checked", !1), i() }), s = e().add(o).add(r); T.showHidden = e("<div></div>").append(o, r), a.bind("hide", function (e) { var t = e.data; t.opts && (t.opts.show || t.opts.hide) || i() }), a.UA.Mobile && e.fn.tooltip && (t = !0, T.showHidden.tooltip({ classes: { "ui-tooltip": "elfinder-ui-tooltip ui-widget-shadow" }, tooltipClass: "elfinder-ui-tooltip ui-widget-shadow", track: !0 }).css("user-select", "none"), r.css("user-select", "none")), i() }(), T.infoItems && (T.infoItems = function () { var t = a.getCommand("info").items, n = [], i = a.storage("infohides") || a.arrayFlip(a.options.commandsOptions.info.hideItems, !0); return e.each(t, function () { var e = a.i18n(this); n.push('<span class="elfinder-preference-info-item"><label><input type="checkbox" value="' + this + '" ' + (i[this] ? "" : "checked") + "/>" + e + "</label></span>") }), e(n.join(" ")).on("change", "input", function () { var t = e(this).val(), n = e(this).is(":checked"); n || i[t] ? n && i[t] && delete i[t] : i[t] = !0, a.storage("infohides", i), a.trigger("infopref", { repaint: !0 }) }) }()), T.hashChecker && a.hashCheckers.length && (T.hashChecker = function () { var t = [], n = a.arrayFlip(a.storage("hashchekcer") || a.options.commandsOptions.info.showHashAlgorisms, !0); return e.each(a.hashCheckers, function () { var e = a.i18n(this); t.push('<span class="elfinder-preference-hashchecker-item"><label><input type="checkbox" value="' + this + '" ' + (n[this] ? "checked" : "") + "/>" + e + "</label></span>") }), e(t.join(" ")).on("change", "input", function () { var t = e(this).val(); e(this).is(":checked") ? n[t] = !0 : n[t] && delete n[t], a.storage("hashchekcer", e.grep(a.hashCheckers, function (e) { return n[e] })) }) }()), T.autoFocusDialog && (T.autoFocusDialog = e('<input type="checkbox"/>').prop("checked", function () { var e = a.storage("autoFocusDialog"); return e ? e > 0 : a.options.uiOptions.dialog.focusOnMouseOver }()).on("change", function (t) { a.storage("autoFocusDialog", e(this).is(":checked") ? 1 : -1) })), T.clearBrowserData && (T.clearBrowserData = e("<button></button>").text(a.i18n("reset")).button().on("click", function (t) { t.preventDefault(), a.storage(), e("#" + a.id).elfinder("reload") })), e.each(z, function (t, i) { var s, d; !0 === i ? d = 1 : i && (s = e(), e.each(i, function (t, n) { var i, o, r, l = ""; (i = T[n]) && (d = 2, o = a.i18n(n), (r = e(i).filter('input[type="checkbox"]')).length || (r = e(i).find('input[type="checkbox"]')), 1 === r.length ? (r.attr("id") || r.attr("id", "elfinder-preference-" + n + "-checkbox"), o = '<label for="' + r.attr("id") + '">' + o + "</label>") : r.length > 1 && (l = " elfinder-preference-checkboxes"), s = s.add(e('<dt class="elfinder-preference-' + n + l + '">' + o + "</dt>")).add(e('<dd class="elfinder-preference-' + n + l + '"></dd>').append(i))) })), d && (l.append(r[o](/\{id\}/g, t)[o](/\{title\}/, a.i18n(t))[o](/\{class\}/, n === t ? "elfinder-focus" : "")), 2 === d && c.append(e('<div id="' + a.namespace + "-preference-" + t + '" class="elfinder-preference-content"></div>').hide().append(e("<dl></dl>").append(s)))) }), l.on("click", "a", function (t) { var n = e(t.target), i = n.attr("href"); t.preventDefault(), t.stopPropagation(), l.children().removeClass(p), n.removeClass("ui-state-hover").parent().addClass(p), i.match(/all$/) ? c.addClass("elfinder-preference-taball").children().show() : (c.removeClass("elfinder-preference-taball").children().hide(), e(i).show()) }).on("focus blur", "a", function (t) { e(this).parent().toggleClass("ui-state-focus", "focusin" === t.type) }).on("mouseenter mouseleave", "li", function (t) { e(this).toggleClass("ui-state-hover", "mouseenter" === t.type) }), c.find("a,input,select,button").addClass("elfinder-tabstop"), s.append(l, c), (t = i.fmDialog(s, { title: i.title, width: i.options.width || 600, height: i.options.height || 400, maxWidth: "window", maxHeight: "window", autoOpen: !1, destroyOnClose: !1, allowMinimize: !1, open: function () { n && d(n), n = null }, resize: function () { c.height(t.height() - l.outerHeight(!0) - (c.outerHeight(!0) - c.height()) - 5) } }).on("click", function (e) { e.stopPropagation() }).css({ overflow: "hidden" })).closest(".ui-dialog").css({ overflow: "hidden" }).addClass("elfinder-bg-translucent"), n = "all"), h && (h.tab ? d(h.tab) : "cwd" === h._currentType && d("workspace")), t.elfinderdialog("open"), e.Deferred().resolve() } }, (h.prototype.commands.quicklook = function () { var t, n, i, a, o, r, s, l, c, d, p = this, u = p.fm, h = 0, f = Element.update ? "quicklookupdate" : "update", m = "elfinder-quicklook-navbar-icon", g = "elfinder-quicklook-fullscreen", v = "elfinder-quicklook-info-wrapper", b = function (t) { e(document).trigger(e.Event("keydown", { keyCode: t, ctrlKey: !1, shiftKey: !1, altKey: !1, metaKey: !1 })) }, y = function (e) { var t, n = u.getUI().offset(), i = (t = e.find(".elfinder-cwd-file-wrapper")).length ? t : e, a = i.offset() || { top: 0, left: 0 }; return { opacity: 0, width: i.width(), height: i.height() - 30, top: a.top - n.top, left: a.left - n.left } }, w = {}, x = function (e, t) { var n = t || e.substr(0, e.indexOf("/")), i = w[n] ? w[n] : w[n] = document.createElement(n), a = !1; try { a = i.canPlayType && i.canPlayType(e) } catch (e) { } return !(!a || "" === a || "no" == a) }, k = -1 != window.navigator.platform.indexOf("Win"), C = !1, z = !1, T = !1, A = null, j = e.ui.keyCode.LEFT, O = e.ui.keyCode.RIGHT, S = "mousemove touchstart " + ("onwheel" in document ? "wheel" : "onmousewheel" in document ? "mousewheel" : "DOMMouseScroll"), I = e('<span class="elfinder-dialog-title elfinder-quicklook-title"></span>'), M = e("<div></div>"), E = e('<div class="elfinder-quicklook-info"></div>'), F = e('<div class="ui-front elfinder-quicklook-cover"></div>'), D = e('<div class="' + m + " " + m + '-fullscreen"></div>').on("click touchstart", function (t) { if (!T) { var n = p.window, i = n.hasClass(g), o = e(window), r = function () { p.preview.trigger("changesize") }; t.stopPropagation(), t.preventDefault(), i ? (B = "", P(), n.toggleClass(g).css(n.data("position")), o.trigger(p.resize).off(p.resize, r), _.off("mouseenter mouseleave"), F.off(S)) : (n.toggleClass(g).data("position", { left: n.css("left"), top: n.css("top"), width: n.width(), height: n.height(), display: "block" }).removeAttr("style"), e(window).on(p.resize, r).trigger(p.resize), F.on(S, function (e) { z || ("mousemove" !== e.type && "touchstart" !== e.type || (P(), A = setTimeout(function () { (u.UA.Mobile || _.parent().find(".elfinder-quicklook-navbar:hover").length < 1) && _.fadeOut("slow", function () { F.show() }) }, 3e3)), F.is(":visible") && (q(), F.data("tm", setTimeout(function () { F.show() }, 3e3)))) }).show().trigger("mousemove"), _.on("mouseenter mouseleave", function (e) { z || ("mouseenter" === e.type ? P() : F.trigger("mousemove")) })), u.zIndex && n.css("z-index", u.zIndex + 1), u.UA.Mobile ? _.attr("style", B) : _.attr("style", B).draggable(i ? "destroy" : { start: function () { z = !0, T = !0, F.show(), P() }, stop: function () { z = !1, B = p.navbar.attr("style"), requestAnimationFrame(function () { T = !1 }) } }), e(this).toggleClass(m + "-fullscreen-off"); var s = n; a.is(".ui-resizable") && (s = s.add(a)), s.resizable(i ? "enable" : "disable").removeClass("ui-state-disabled"), n.trigger("viewchange") } }), U = function () { p.update(void 0, function () { var t, n = p.fm, i = n.selectedFiles(), a = i.length; p.docked(); return a || (a = 1, i = [n.cwd()]), 1 === a ? i[0] : (t = 0, e.each(i, function (e, n) { var i = parseInt(n.ts); t >= 0 ? i > t && (t = i) : t = "unknown" }), { hash: i[0].hash + "/" + +new Date, name: n.i18n("items") + ": " + a, mime: "group", size: W, ts: t, files: e.map(i, function (e) { return e.hash }), getSize: !0 }) }()) }, P = function () { p.window.hasClass(g) && (A && clearTimeout(A), A = null, _.stop(!0, !0).css("display", "block"), q()) }, q = function () { F.data("tm") && clearTimeout(F.data("tm")), F.removeData("tm"), F.hide() }, R = e('<div class="' + m + " " + m + '-prev"></div>').on("click touchstart", function (e) { return !T && b(j), !1 }), H = e('<div class="' + m + " " + m + '-next"></div>').on("click touchstart", function (e) { return !T && b(O), !1 }), _ = e('<div class="elfinder-quicklook-navbar"></div>').append(R).append(D).append(H).append('<div class="elfinder-quicklook-navbar-separator"></div>').append(e('<div class="' + m + " " + m + '-close"></div>').on("click touchstart", function (e) { return !T && p.window.trigger("close"), !1 })), N = e('<span class="ui-front ui-icon elfinder-icon-close ui-icon-closethick"></span>').on("mousedown", function (e) { e.stopPropagation(), p.window.trigger("close") }), L = e('<span class="ui-front ui-icon elfinder-icon-minimize ui-icon-minusthick"></span>').on("mousedown", function (e) { e.stopPropagation(), p.docked() ? p.window.trigger("navdockout") : p.window.trigger("navdockin") }), W = '<span class="elfinder-spinner-text">' + u.i18n("calc") + '</span><span class="elfinder-spinner"></span>', B = "", $ = !0; this.flags = {}, this.cover = F, this.evUpdate = f, (this.navbar = _)._show = P, this.resize = "resize." + u.namespace, this.info = e("<div></div>").addClass(v).append(M).append(E), this.autoPlay = function () { return !!p.opened() && !!p.options[p.docked() ? "dockAutoplay" : "autoplay"] }, this.preview = e('<div class="elfinder-quicklook-preview ui-helper-clearfix"></div>').on("change", function () { P(), _.attr("style", B), p.docked() && _.hide(), p.preview.attr("style", "").removeClass("elfinder-overflow-auto"), p.info.attr("style", "").hide(), p.cover.removeClass("elfinder-quicklook-coverbg"), M.removeAttr("class").attr("style", ""), E.html("") }).on(f, function (t) { p.preview; var n, i, a, r = t.file, s = '<div class="elfinder-quicklook-info-data">{value}</div>', c = []; r && !Object.keys(r).length && (r = u.cwd()), r && l && "pending" === l.state() && l._hash !== r.hash && l.reject(), r && (t.forceUpdate || p.window.data("hash") !== r.hash) ? (a = p.window.css("overflow", "hidden"), i = u.escape(r.i18 || r.name), !r.read && t.stopImmediatePropagation(), p.window.data("hash", r.hash), p.preview.off("changesize").trigger("change").children().remove(), I.html(i), R.css("visibility", ""), H.css("visibility", ""), r.hash === u.cwdId2Hash(o.find("[id]:not(.elfinder-cwd-parent):first").attr("id")) && R.css("visibility", "hidden"), r.hash === u.cwdId2Hash(o.find("[id]:last").attr("id")) && H.css("visibility", "hidden"), "directory" === r.mime ? c = [r.hash] : "group" === r.mime && r.getSize && (c = r.files), E.html(s.replace(/\{value\}/, i) + s.replace(/\{value\}/, u.mime2kind(r)) + s.replace(/\{value\}/, c.length ? W : u.formatSize(r.size)) + s.replace(/\{value\}/, u.i18n("modify") + ": " + u.formatDate(r))), c.length && ((l = u.getSize(c).done(function (e) { E.find("span.elfinder-spinner").parent().html(e.formated) }).fail(function () { E.find("span.elfinder-spinner").parent().html(u.i18n("unknown")) }).always(function () { l = null }))._hash = r.hash), M.addClass("elfinder-cwd-icon ui-corner-all " + u.mime2class(r.mime)), r.icon && M.css(u.getIconStyle(r, !0)), p.info.attr("class", v), r.csscls && p.info.addClass(r.csscls), r.read && (n = u.tmb(r)) && e("<img/>").hide().appendTo(p.preview).on("load", function () { M.addClass(n.className).css("background-image", "url('" + n.url + "')"), e(this).remove() }).attr("src", n.url), p.info.delay(100).fadeIn(10), p.window.hasClass(g) && F.trigger("mousemove"), a.css("overflow", "")) : t.stopImmediatePropagation() }), this.window = e('<div class="ui-front ui-helper-reset ui-widget elfinder-quicklook touch-punch" style="position:absolute"></div>').hide().addClass(u.UA.Touch ? "elfinder-touch" : "").on("click", function (e) { var t = this; e.stopPropagation(), 2 === h && requestAnimationFrame(function () { 2 === h && u.toFront(t) }) }).append(e('<div class="ui-dialog-titlebar ui-widget-header ui-corner-top ui-helper-clearfix elfinder-quicklook-titlebar"></div>').append(e('<span class="ui-widget-header ui-dialog-titlebar-close ui-corner-all elfinder-titlebar-button elfinder-quicklook-titlebar-icon' + (k ? " elfinder-titlebar-button-right" : "") + '"></span>').append(N, L), I), this.preview, p.info.hide(), F.hide(), _).draggable({ handle: "div.elfinder-quicklook-titlebar" }).on("open", function (i, a) { var o = p.window, s = p.value, l = u.getUI("cwd"), d = function (e) { h = e, p.update(1, p.value), p.change(), o.trigger("resize." + u.namespace) }; $ || 0 !== h ? 4 === h && (u.getUI("navdock").data("addNode")(c), d(3), p.preview.trigger("changesize"), u.storage("previewDocked", "1"), 0 === u.getUI("navdock").width() && o.trigger("navdockout")) : (s && s.hash !== r && (l = u.cwdHash2Elm(s.hash.split("/", 2)[0])), B = "", _.attr("style", ""), h = 1, l.trigger("scrolltoview"), q(), o.css(a || y(l)).show().animate(function () { var i = p.options.contain || u.options.dialogContained, a = i ? u.getUI() : e(window), o = u.getUI().offset(), r = Math.min(t, a.width() - 10), s = Math.min(n, a.height() - 80); return { opacity: 1, width: r, height: s, top: parseInt((a.height() - s - 60) / 2 + (i ? 0 : a.scrollTop() - o.top)), left: parseInt((a.width() - r) / 2 + (i ? 0 : a.scrollLeft() - o.left)) } }(), 550, function () { d(2), P() }), u.toFront(o)) }).on("close", function (e, t) { var n, i = p.window, a = p.preview.trigger("change"), r = (p.value, (i.data("hash") || "").split("/", 2)[0]), s = function (e, n) { h = e, n && u.toHide(i), a.children().remove(), p.update(0, p.value), i.data("hash", ""), t && t.resolve() }; p.opened() && (l && "pending" === l.state() && l.reject(), p.docked() ? (c = u.getUI("navdock").data("removeNode")(p.window.attr("id"), "detach"), s(4), u.storage("previewDocked", "2")) : (h = 1, i.hasClass(g) && D.click(), r && (n = o.find("#" + r)).length ? i.animate(y(n), 500, function () { a.off("changesize"), s(0, !0) }) : s(0, !0))) }).on("navdockin", function (e, t) { var n = p.window, a = u.getUI("navdock"), o = s || a.width(), r = t || {}; $ && (r.init = !0), h = 3, i = n.attr("style"), n.toggleClass("ui-front").removeClass("ui-widget").draggable("disable").resizable("disable").removeAttr("style").css({ width: "100%", height: o, boxSizing: "border-box", paddingBottom: 0, zIndex: "unset" }), _.hide(), L.toggleClass("ui-icon-plusthick ui-icon-minusthick elfinder-icon-full elfinder-icon-minimize"), u.toHide(n, !0), a.data("addNode")(n, r), p.preview.trigger("changesize"), u.storage("previewDocked", "1") }).on("navdockout", function (t) { var n = p.window, a = u.getUI("navdock"), o = (e.Deferred(), y(p.preview)); s = n.outerHeight(), a.data("removeNode")(n.attr("id"), u.getUI()), n.toggleClass("ui-front").addClass("ui-widget").draggable("enable").resizable("enable").attr("style", i), L.toggleClass("ui-icon-plusthick ui-icon-minusthick elfinder-icon-full elfinder-icon-minimize"), h = 0, n.trigger("open", o), u.storage("previewDocked", "0") }).on("resize." + u.namespace, function () { p.preview.trigger("changesize") }), this.alwaysEnabled = !0, this.value = null, this.handlers = { select: function (e, t) { d && cancelAnimationFrame(d), e.data && e.data.selected && e.data.selected.length ? p.opened() && U() : d = requestAnimationFrame(function () { p.opened() && U() }) }, error: function () { p.window.is(":visible") && p.window.trigger("close") }, "searchshow searchhide": function () { this.opened() && this.window.trigger("close") }, navbarshow: function () { requestAnimationFrame(function () { p.docked() && p.preview.trigger("changesize") }) }, destroy: function () { p.window.remove() } }, this.shortcuts = [{ pattern: "space" }], this.support = { audio: { ogg: x("audio/ogg;"), webm: x("audio/webm;"), mp3: x("audio/mpeg;"), wav: x("audio/wav;"), m4a: x("audio/mp4;") || x("audio/x-m4a;") || x("audio/aac;"), flac: x("audio/flac;"), amr: x("audio/amr;") }, video: { ogg: x("video/ogg;"), webm: x("video/webm;"), mp4: x("video/mp4;"), mkv: x("video/x-matroska;") || x("video/webm;"), "3gp": x("video/3gpp;") || x("video/mp4;"), m3u8: x("application/x-mpegURL", "video") || x("application/vnd.apple.mpegURL", "video"), mpd: x("application/dash+xml", "video") } }, w = {}, this.closed = function () { return 0 == h || 4 == h }, this.opened = function () { return 2 == h || 3 == h }, this.docked = function () { return 3 == h }, this.addIntegration = function (e) { requestAnimationFrame(function () { u.trigger("helpIntegration", Object.assign({ cmd: "quicklook" }, e)) }) }, this.init = function () { var i, l = this.options, c = this.window, d = this.preview; t = l.width > 0 ? parseInt(l.width) : 450, n = l.height > 0 ? parseInt(l.height) : 300, "auto" !== l.dockHeight && ((s = parseInt(l.dockHeight)) || (s = void 0)), u.one("load", function () { !(C = u.getUI("navdock").data("dockEnabled")) && L.hide(), a = u.getUI(), o = u.getUI("cwd"), u.zIndex && c.css("z-index", u.zIndex + 1), c.appendTo(a), e(document).on("keydown." + u.namespace, function (t) { t.keyCode == e.ui.keyCode.ESCAPE && p.opened() && !p.docked() && c.hasClass("elfinder-frontmost") && c.trigger("close") }), c.resizable({ handles: "se", minWidth: 350, minHeight: 120, resize: function () { d.trigger("changesize") } }), p.change(function () { p.opened() && p.value && (p.value.tmb && 1 == p.value.tmb && (p.value = Object.assign({}, u.file(p.value.hash))), d.trigger(e.Event(f, { file: p.value }))) }), d.on(f, function (e) { var t, n, a; if (t = e.file) { if (n = t.hash, a = u.searchStatus.mixed && u.searchStatus.state > 1, "directory" !== t.mime) if (parseInt(t.size) || t.mime.match(l.mimeRegexNotEmptyCheck)) { if (p.dispInlineRegex = i, a || u.optionsByHashes[n]) try { p.dispInlineRegex = new RegExp(u.option("dispInlineRegex", n), "i") } catch (e) { try { p.dispInlineRegex = new RegExp(u.isRoot(t) ? u.options.dispInlineRegex : u.option("dispInlineRegex", t.phash), "i") } catch (e) { p.dispInlineRegex = /^$/ } } } else e.stopImmediatePropagation(); else p.dispInlineRegex = /^$/; p.info.show() } else e.stopImmediatePropagation() }), e.each(u.commands.quicklook.plugins || [], function (e, t) { "function" == typeof t && new t(p) }) }).one("open", function () { var e, t = Number(u.storage("previewDocked") || l.docked); C && t >= 1 && (e = p.window, p.exec(), e.trigger("navdockin", { init: !0 }), 2 === t ? e.trigger("close") : (p.update(void 0, u.cwd()), p.change())), $ = !1 }).bind("open", function () { r = u.cwd().hash, p.value = u.cwd(); try { i = new RegExp(u.option("dispInlineRegex"), "i") } catch (e) { i = /^$/ } }).bind("change", function (t) { t.data && t.data.changed && p.opened() && e.each(t.data.changed, function () { if (p.window.data("hash") === this.hash) return p.window.data("hash", null), p.preview.trigger(f), !1 }) }).bind("navdockresizestart navdockresizestop", function (e) { F["navdockresizestart" === e.type ? "show" : "hide"]() }) }, this.getstate = function () { return p.opened() ? 1 : 0 }, this.exec = function () { return p.closed() && U(), p.enabled() && p.window.trigger(p.opened() ? "close" : "open"), e.Deferred().resolve() }, this.hideinfo = function () { this.info.stop(!0, !0).hide() } }).prototype = { forceLoad: !0 }, h.prototype.commands.quicklook.plugins = [function (t) { var n, i, a = ["image/jpeg", "image/png", "image/gif", "image/svg+xml", "image/x-ms-bmp"], o = t.fm.returnBytes(t.options.getDimThreshold || 0), r = t.preview; (n = new Image).onload = n.onerror = function () { 2 == n.height && a.push("image/webp") }, n.src = "data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA", e.each(navigator.mimeTypes, function (t, n) { var i = n.type; 0 === i.indexOf("image/") && e.inArray(i, a) && a.push(i) }), r.on(t.evUpdate, function (n) { var s, l, c, d, p = t.fm, u = n.file, h = !1, f = null, m = function (e) { var t = p.file(u.hash); t.width = e[0], t.height = e[1] }, g = function () { var e, t, n, i, a; f && f.state && "pending" === f.state() && f.reject(), h || (h = !0, e = s.get(0), (t = u.width && u.height ? { w: u.width, h: u.height } : e.naturalWidth ? null : { w: s.width(), h: s.height() }) && s.removeAttr("width").removeAttr("height"), n = u.width || e.naturalWidth || e.width || s.width(), i = u.height || e.naturalHeight || e.height || s.height(), u.width && u.height || m([n, i]), t && s.width(t.w).height(t.h), a = (n / i).toFixed(2), r.on("changesize", function () { var e, t, n = parseInt(r.width()), i = parseInt(r.height()); a < (n / i).toFixed(2) ? (t = i, e = Math.floor(t * a)) : (e = n, t = Math.floor(e / a)), s.width(e).height(t).css("margin-top", t < i ? Math.floor((i - t) / 2) : 0) }).trigger("changesize"), s.fadeIn(100)) }; i || (i = p.arrayFlip(a)), i[u.mime] && t.dispInlineRegex.test(u.mime) && (n.stopImmediatePropagation(), l = e('<div class="elfinder-quicklook-info-data"><span class="elfinder-spinner-text">' + p.i18n("nowLoading") + '</span><span class="elfinder-spinner"></span></div>').appendTo(t.info.find(".elfinder-quicklook-info")), c = e('<div class="elfinder-quicklook-info-progress"></div>').appendTo(l), s = e("<img/>").hide().appendTo(r).on("load", function () { l.remove(), t.hideinfo(), g() }).on("error", function () { l.remove() }), d = p.openUrl(u.hash, !1, function (e) { s.attr("src", e) }, { progressBar: c }), r.one("change", function () { d && d.state && "pending" === d.state() && d.reject() }), u.width && u.height ? g() : u.size > o && (f = p.request({ data: { cmd: "dim", target: u.hash }, preventDefault: !0 }).done(function (e) { if (e.dim) { var t = e.dim.split("x"); u.width = t[0], u.height = t[1], m(t), g() } }))) }) }, function (t) { var n = t.fm, i = t.preview; window.Worker && window.Uint8Array && i.on(t.evUpdate, function (a) { var o, r, s, l, c, d = a.file, p = function (e) { l && l.terminate(), o.remove(), n.debug("error", e) }; "image/tiff" === d.mime && (a.stopImmediatePropagation(), o = e('<div class="elfinder-quicklook-info-data"><span class="elfinder-spinner-text">' + n.i18n("nowLoading") + '</span><span class="elfinder-spinner"></span></div>').appendTo(t.info.find(".elfinder-quicklook-info")), r = e('<div class="elfinder-quicklook-info-progress"></div>').appendTo(o), i.one("change", function () { l && l.terminate(), o.remove() }), c = n.getContents(d.hash, "arraybuffer", { progressBar: r }).done(function (a) { if (a) { s = e("<div></div>").css({ width: "100%", height: "100%" }).hide().appendTo(i); try { (l = n.getWorker()).onmessage = function (a) { var r, c, p, u, h, f, m = a.data; l && l.terminate(), c = (r = document.createElement("canvas")).getContext("2d"), r.width = m.width, r.height = m.height, (p = c.createImageData(m.width, m.height)).data.set(new Uint8Array(m.image)), c.putImageData(p, 0, 0), s.append(r).show(), o.remove(), u = (m.width / m.height).toFixed(2), i.on("changesize", function () { var t, n, a = parseInt(i.width()), o = parseInt(i.height()); u < (a / o).toFixed(2) ? (n = o, t = Math.floor(n * u)) : (t = a, n = Math.floor(t / u)), e(r).width(t).height(n).css("margin-top", n < o ? Math.floor((o - n) / 2) : 0) }).trigger("changesize"), d.width && d.height || (h = [m.width, m.height], (f = n.file(d.hash)).width = h[0], f.height = h[1]), t.hideinfo() }, l.onerror = p, l.postMessage({ scripts: [n.options.cdns.tiff, n.getWorkerUrl("quicklook.tiff.js")], data: { data: a } }) } catch (e) { p(e) } } else p() }), i.one("change", function () { c && c.state && "pending" === c.state() && c.reject() })) }) }, function (t) { var n, i = t.fm, a = i.arrayFlip(["image/vnd.adobe.photoshop", "image/x-photoshop"]), o = t.preview, r = function (e, a, r) { try { i.replaceXhrSend(), n.fromURL(e).then(function (e) { var n; a.attr("src", e.image.toBase64()), requestAnimationFrame(function () { n = (a.width() / a.height()).toFixed(2), o.on("changesize", function () { var e, t, i = parseInt(o.width()), r = parseInt(o.height()); n < (i / r).toFixed(2) ? (t = r, e = Math.floor(t * n)) : (e = i, t = Math.floor(e / n)), a.width(e).height(t).css("margin-top", t < r ? Math.floor((r - t) / 2) : 0) }).trigger("changesize"), r.remove(), t.hideinfo(), a.fadeIn(100) }) }, function () { r.remove(), a.remove() }), i.restoreXhrSend() } catch (e) { i.restoreXhrSend(), r.remove(), a.remove() } }; o.on(t.evUpdate, function (s) { var l, c, d, p, u, h, f = s.file; a[f.mime] && i.options.cdns.psd && !i.UA.ltIE10 && t.dispInlineRegex.test(f.mime) && (s.stopImmediatePropagation(), c = e('<div class="elfinder-quicklook-info-data"><span class="elfinder-spinner-text">' + i.i18n("nowLoading") + '</span><span class="elfinder-spinner"></span></div>').appendTo(t.info.find(".elfinder-quicklook-info")), d = e('<div class="elfinder-quicklook-info-progress"></div>').appendTo(c), h = i.openUrl(f.hash, "sameorigin", function (t) { t && (l = e("<img/>").hide().appendTo(o), n ? r(t, l, c) : (p = window.define, u = window.require, window.require = null, window.define = null, i.loadScript([i.options.cdns.psd], function () { n = require("psd"), p ? window.define = p : delete window.define, u ? window.require = u : delete window.require, r(t, l, c) }))) }, { progressBar: d }), o.one("change", function () { h && h.state && "pending" === h.state() && h.reject() })) }) }, function (t) { var n = t.fm, i = n.arrayFlip(["text/html", "application/xhtml+xml"]), a = t.preview; a.on(t.evUpdate, function (o) { var r, s, l, c = o.file; i[c.mime] && t.dispInlineRegex.test(c.mime) && (!t.options.getSizeMax || c.size <= t.options.getSizeMax) && (o.stopImmediatePropagation(), s = e('<div class="elfinder-quicklook-info-data"><span class="elfinder-spinner-text">' + n.i18n("nowLoading") + '</span><span class="elfinder-spinner"></span></div>').appendTo(t.info.find(".elfinder-quicklook-info")), l = e('<div class="elfinder-quicklook-info-progress"></div>').appendTo(s), a.one("change", function () { "pending" == r.state() && r.reject() }).addClass("elfinder-overflow-auto"), r = n.request({ data: { cmd: "get", target: c.hash, conv: 1, _t: c.ts }, options: { type: "get", cache: !0 }, preventDefault: !0, progressBar: l }).done(function (n) { t.hideinfo(); var i = e('<iframe class="elfinder-quicklook-preview-html"></iframe>').appendTo(a)[0].contentWindow.document; i.open(), i.write(n.content), i.close() }).always(function () { s.remove() })) }) }, function (t) { var n = t.fm, i = n.arrayFlip(["text/x-markdown"]), a = t.preview, o = null, r = function (n, i) { t.hideinfo(); var r = e('<iframe class="elfinder-quicklook-preview-html"></iframe>').appendTo(a)[0].contentWindow.document; r.open(), r.write(o(n.content)), r.close(), i.remove() }, s = function (e) { o = !1, e.remove() }; a.on(t.evUpdate, function (l) { var c, d, p, u = l.file; i[u.mime] && n.options.cdns.marked && !1 !== o && t.dispInlineRegex.test(u.mime) && (!t.options.getSizeMax || u.size <= t.options.getSizeMax) && (l.stopImmediatePropagation(), d = e('<div class="elfinder-quicklook-info-data"><span class="elfinder-spinner-text">' + n.i18n("nowLoading") + '</span><span class="elfinder-spinner"></span></div>').appendTo(t.info.find(".elfinder-quicklook-info")), p = e('<div class="elfinder-quicklook-info-progress"></div>').appendTo(d), a.one("change", function () { "pending" == c.state() && c.reject() }).addClass("elfinder-overflow-auto"), c = n.request({ data: { cmd: "get", target: u.hash, conv: 1, _t: u.ts }, options: { type: "get", cache: !0 }, preventDefault: !0, progressBar: p }).done(function (e) { o || window.marked ? (o || (o = window.marked), r(e, d)) : n.loadScript([n.options.cdns.marked], function (t) { o = t || window.marked || !1, delete window.marked, o ? r(e, d) : s(d) }, { tryRequire: !0, error: function () { s(d) } }) }).fail(function () { s(d) })) }) }, function (t) { if (t.options.viewerjs) { var n = t.fm, i = t.preview, a = t.options.viewerjs, o = a.url ? n.arrayFlip(a.mimes || []) : [], r = t.window, s = t.navbar, l = function () { s.css("bottom", r.hasClass("elfinder-quicklook-fullscreen") ? "30px" : "") }; a.url && i.on("update", function (s) { var c, d, p, u, h = s.file; !o[h.mime] || "application/pdf" === h.mime && a.pdfNative && t.flags.pdfNative || (s.stopImmediatePropagation(), d = e('<div class="elfinder-quicklook-info-data"><span class="elfinder-spinner-text">' + n.i18n("nowLoading") + '</span><span class="elfinder-spinner"></span></div>').appendTo(t.info.find(".elfinder-quicklook-info")), p = e('<div class="elfinder-quicklook-info-progress"></div>').appendTo(d), u = n.openUrl(h.hash, "sameorigin", function (n) { n && (c = e('<iframe class="elfinder-quicklook-preview-iframe"></iframe>').css("background-color", "transparent").on("load", function () { t.hideinfo(), d.remove(), c.css("background-color", "#fff") }).on("error", function () { d.remove(), c.remove() }).appendTo(i).attr("src", a.url + "#" + n), r.on("viewchange.viewerjs", l), l(), i.one("change", function () { r.off("viewchange.viewerjs"), d.remove(), c.off("load").remove() })) }, { progressBar: p }), i.one("change", function () { u && u.state && "pending" === u.state() && u.reject() })) }) } }, function (t) { var n = t.fm, i = "application/pdf", a = t.preview, o = !1, r = ""; n.UA.Safari && "mac" === n.OS && !n.UA.iOS || n.UA.IE || n.UA.Firefox ? o = !0 : e.each(navigator.plugins, function (t, n) { e.each(n, function (e, t) { if (t.type === i) return !(o = !0) }) }), t.flags.pdfNative = o, o && (void 0 === t.options.pdfToolbar || t.options.pdfToolbar || (r = "#toolbar=0"), a.on(t.evUpdate, function (s) { var l, c = s.file; o && c.mime === i && t.dispInlineRegex.test(c.mime) && (s.stopImmediatePropagation(), l = n.openUrl(c.hash, !1, function (i) { i && (t.hideinfo(), t.cover.addClass("elfinder-quicklook-coverbg"), e('<object class="elfinder-quicklook-preview-pdf" data="' + i + r + '" type="application/pdf" ></object>').on("error", function (e) { o = !1, t.update(void 0, n.cwd()), t.update(void 0, c) }).appendTo(a)) }), a.one("change", function () { l && l.state && "pending" === l.state() && l.reject() })) })) }, function (t) { var n = t.fm, i = "application/x-shockwave-flash", a = t.preview, o = !1; e.each(navigator.plugins, function (t, n) { e.each(n, function (e, t) { if (t.type === i) return !(o = !0) }) }), o && a.on(t.evUpdate, function (o) { var r, s = o.file; s.mime === i && t.dispInlineRegex.test(s.mime) && (o.stopImmediatePropagation(), r = n.openUrl(s.hash, !1, function (n) { n && (t.hideinfo(), e('<embed class="elfinder-quicklook-preview-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" src="' + n + '" quality="high" type="application/x-shockwave-flash" wmode="transparent" />').appendTo(a)) }), a.one("change", function () { r && r.state && "pending" === r.state() && r.reject() })) }) }, function (t) { var n, i, a, o, r, s, l = t.fm, c = t.preview, d = { "audio/mpeg": "mp3", "audio/mpeg3": "mp3", "audio/mp3": "mp3", "audio/x-mpeg3": "mp3", "audio/x-mp3": "mp3", "audio/x-wav": "wav", "audio/wav": "wav", "audio/x-m4a": "m4a", "audio/aac": "m4a", "audio/mp4": "m4a", "audio/x-mp4": "m4a", "audio/ogg": "ogg", "audio/webm": "webm", "audio/flac": "flac", "audio/x-flac": "flac", "audio/amr": "amr" }, p = t.window, u = t.navbar, h = "string" == typeof t.options.mediaControlsList && t.options.mediaControlsList ? ' controlsList="' + l.escape(t.options.mediaControlsList) + '"' : "", f = function () { u.css("bottom", p.hasClass("elfinder-quicklook-fullscreen") ? "50px" : "") }, m = function (t, i) { return e('<audio class="elfinder-quicklook-preview-audio ui-front" controls' + h + ' preload="auto" autobuffer><source src="' + t + '" ></source></audio>').on("change", function (e) { e.stopPropagation() }).on("error", function (e) { n && n.data("hash") === i && v() }).data("hash", i).appendTo(c) }, g = function (e) { var t, i = n.data("hash"); o && (t = e.play()), t && t.catch && t.catch(function (t) { e.paused || n && n.data("hash") === i && v() }) }, v = function () { if (n && n.parent().length) { var e = n[0], t = n.children("source").attr("src"); p.off("viewchange.audio"); try { e.pause(), n.empty(), t.match(/^blob:/) && URL.revokeObjectURL(t), e.src = "", e.load() } catch (e) { } n.remove(), n = null } }; c.on(t.evUpdate, function (u) { var h, v, b, y, w, x, k = u.file, C = d[k.mime]; d[k.mime] && t.dispInlineRegex.test(k.mime) && ((h = t.support.audio[C]) || "amr" === C) && (o = t.autoPlay(), i = k.hash, h ? (u.stopImmediatePropagation(), r = e('<div class="elfinder-quicklook-info-data"><span class="elfinder-spinner-text">' + l.i18n("nowLoading") + '</span><span class="elfinder-spinner"></span></div>').appendTo(t.info.find(".elfinder-quicklook-info")), s = e('<div class="elfinder-quicklook-info-progress"></div>').appendTo(r), v = l.openUrl(i, !1, function (e) { r.remove(), e ? (n = m(e, i), g(n[0]), p.on("viewchange.audio", f), f()) : n.remove() }, { progressBar: s }), c.one("change", function () { v && v.state && "pending" === v.state() && v.reject() })) : l.options.cdns.amr && "amr" === C && !1 !== a && (u.stopImmediatePropagation(), r = e('<div class="elfinder-quicklook-info-data"><span class="elfinder-spinner-text">' + l.i18n("nowLoading") + '</span><span class="elfinder-spinner"></span></div>').appendTo(t.info.find(".elfinder-quicklook-info")), s = e('<div class="elfinder-quicklook-info-progress"></div>').appendTo(r), n = m("", i), (b = k.hash, w = e.Deferred(), x = e.Deferred().done(function () { var e; e = l.getContents(b, "arraybuffer", { progressBar: s }).done(function (e) { try { var t = a.toWAV(new Uint8Array(e)); t ? w.resolve(URL.createObjectURL(new Blob([t], { type: "audio/x-wav" }))) : w.reject() } catch (e) { w.reject() } }).fail(function () { w.reject() }), c.one("change", function () { e && e.state && "pending" === e.state() && e.reject() }) }).fail(function () { a = !1, w.reject() }), window.TextEncoder && window.URL && URL.createObjectURL && void 0 === a ? (y = window.AMR, delete window.AMR, l.loadScript([l.options.cdns.amr], function () { a = !!window.AMR && window.AMR, window.AMR = y, x[a ? "resolve" : "reject"]() }, { error: function () { x.reject() } })) : x[a ? "resolve" : "reject"](), w).done(function (e) { if (r.remove(), i === k.hash) { var t = n[0]; try { n.children("source").attr("src", e), t.pause(), t.load(), g(t), p.on("viewchange.audio", f), f() } catch (t) { URL.revokeObjectURL(e), n.remove() } } else URL.revokeObjectURL(e) }).fail(function () { n.remove() }))) }).one("change", v) }, function (t) { var n, i, a, o, r, s, l, c, d, p, u = t.fm, h = t.preview, f = { "video/mp4": "mp4", "video/x-m4v": "mp4", "video/quicktime": "mp4", "video/mpeg": "mpeg", "video/ogg": "ogg", "application/ogg": "ogg", "video/webm": "webm", "video/x-matroska": "mkv", "video/3gpp": "3gp", "application/vnd.apple.mpegurl": "m3u8", "application/x-mpegurl": "m3u8", "application/dash+xml": "mpd", "video/x-flv": "flv", "video/x-msvideo": "avi" }, m = t.window, g = t.navbar, v = "string" == typeof t.options.mediaControlsList && t.options.mediaControlsList ? ' controlsList="' + u.escape(t.options.mediaControlsList) + '"' : "", b = function () { u.UA.iOS ? m.hasClass("elfinder-quicklook-fullscreen") ? (h.css("height", "-webkit-calc(100% - 50px)"), g._show()) : h.css("height", "") : g.css("bottom", m.hasClass("elfinder-quicklook-fullscreen") ? "50px" : "") }, y = function (i, a) { var r, s = function (e) { l > 1 && (c && clearTimeout(c), c = setTimeout(function () { !r && T(!0) }, 800)) }, l = 0; o = null, a = a || {}, t.hideinfo(), (n = e('<video class="elfinder-quicklook-preview-video" controls' + v + ' preload="auto" autobuffer playsinline></video>').on("change", function (e) { e.stopPropagation() }).on("timeupdate progress", s).on("canplay", function () { r = !0 }).data("hash", i.hash))[0].addEventListener("error", function (e) { a.src && u.convAbsUrl(a.src) === u.convAbsUrl(e.target.src) && (++l, s()) }, !0), a.src && n.append('<source src="' + a.src + '" type="' + i.mime + '"></source><source src="' + a.src + '"></source>'), n.appendTo(h), m.on("viewchange.video", b), b() }, w = function (e) { var t, a; a = u.openUrl(e.hash, !1, function (a) { d.remove(), a && (y(e), (t = new i).loadSource(a), t.attachMedia(n[0]), l && t.on(i.Events.MANIFEST_PARSED, function () { z(n[0]) })) }, { progressBar: p }), h.one("change", function () { a && a.state && "pending" === a.state() && a.reject() }) }, x = function (e) { var t; t = u.openUrl(e.hash, !1, function (t) { var i; d.remove(), t && (y(e), (i = (o = window.dashjs.MediaPlayer().create()).getDebug()).setLogLevel ? i.setLogLevel(dashjs.Debug.LOG_LEVEL_FATAL) : i.setLogToBrowserConsole && i.setLogToBrowserConsole(!1), o.initialize(n[0], t, l), o.on("error", function (e) { T(!0) })) }, { progressBar: p }), h.one("change", function () { t && t.state && "pending" === t.state() && t.reject() }) }, k = function (e) { var t; r.isSupported() ? (t = u.openUrl(e.hash, !1, function (t) { if (d.remove(), t) { var i = r.createPlayer({ type: "flv", url: t }); y(e), i.on(r.Events.ERROR, function () { i.destroy(), T(!0) }), i.attachMediaElement(n[0]), i.load(), z(i) } }, { progressBar: p }), h.one("change", function () { t && t.state && "pending" === t.state() && t.reject() })) : r = !1 }, C = function (e) { var t; t = u.openUrl(e.hash, !1, function (t) { d.remove(), t && (y(e), n[0].src = t, s(n[0], { src: t })) }, { progressBar: p }), h.one("change", function () { t && t.state && "pending" === t.state() && t.reject() }) }, z = function (e) { var t, i = n.data("hash"); l && (t = e.play()), t && t.catch && t.catch(function (t) { e.paused || n && n.data("hash") === i && T(!0) }) }, T = function (e) { if (c && clearTimeout(c), n && n.parent().length) { var i = n[0]; m.off("viewchange.video"), o && o.reset(); try { i.pause(), n.empty(), i.src = "", i.load() } catch (e) { } n.remove(), n = null } e && t.info.show() }; h.on(t.evUpdate, function (o) { var c, m, g = o.file, v = g.mime.toLowerCase(), b = f[v]; f[v] && t.dispInlineRegex.test(g.mime) && (l = t.autoPlay(), d = e('<div class="elfinder-quicklook-info-data"><span class="elfinder-spinner-text">' + u.i18n("nowLoading") + '</span><span class="elfinder-spinner"></span></div>'), p = e('<div class="elfinder-quicklook-info-progress"></div>').appendTo(d), t.support.video[b] && ("m3u8" !== b || u.UA.Safari) ? (o.stopImmediatePropagation(), d.appendTo(t.info.find(".elfinder-quicklook-info")), m = u.openUrl(g.hash, !1, function (e) { d.remove(), e && (y(g, { src: e }), z(n[0])) }, { progressBar: p }), h.one("change", function () { m && m.state && "pending" === m.state() && m.reject() })) : !1 !== i && u.options.cdns.hls && "m3u8" === b ? (o.stopImmediatePropagation(), d.appendTo(t.info.find(".elfinder-quicklook-info")), i ? w(g) : (c = window.Hls, delete window.Hls, u.loadScript([u.options.cdns.hls], function (e) { i = e || window.Hls || !1, window.Hls = c, i && w(g) }, { tryRequire: !0, error: function () { i = !1 } }))) : !1 !== a && u.options.cdns.dash && "mpd" === b ? (o.stopImmediatePropagation(), d.appendTo(t.info.find(".elfinder-quicklook-info")), a ? x(g) : u.loadScript([u.options.cdns.dash], function () { (a = !!window.dashjs) && x(g) }, { tryRequire: !0, error: function () { a = !1 } })) : !1 !== r && u.options.cdns.flv && "flv" === b ? (o.stopImmediatePropagation(), d.appendTo(t.info.find(".elfinder-quicklook-info")), r ? k(g) : (c = window.flvjs, delete window.flvjs, u.loadScript([u.options.cdns.flv], function (e) { r = e || window.flvjs || !1, window.flvjs = c, r && k(g) }, { tryRequire: !0, error: function () { r = !1 } }))) : u.options.cdns.videojs && (o.stopImmediatePropagation(), d.appendTo(t.info.find(".elfinder-quicklook-info")), s ? C(g) : u.loadScript([u.options.cdns.videojs + "/video.min.js"], function (e) { (s = e || window.videojs || !1) && C(g) }, { tryRequire: !0, error: function () { s = !1 } }).loadCss([u.options.cdns.videojs + "/video-js.min.css"]))) }).one("change", T) }, function (t) { var n, i = t.preview, a = [], o = t.window, r = t.navbar; e.each(navigator.plugins, function (t, n) { e.each(n, function (e, t) { (0 === t.type.indexOf("audio/") || 0 === t.type.indexOf("video/")) && a.push(t.type) }) }), a = t.fm.arrayFlip(a), i.on(t.evUpdate, function (s) { var l, c, d, p, u = s.file, h = u.mime, f = function () { r.css("bottom", o.hasClass("elfinder-quicklook-fullscreen") ? "50px" : "") }; a[u.mime] && t.dispInlineRegex.test(u.mime) && (s.stopImmediatePropagation(), d = e('<div class="elfinder-quicklook-info-data"><span class="elfinder-spinner-text">' + fm.i18n("nowLoading") + '</span><span class="elfinder-spinner"></span></div>').appendTo(t.info.find(".elfinder-quicklook-info")), p = e('<div class="elfinder-quicklook-info-progress"></div>').appendTo(d), c = t.fm.openUrl(u.hash, !1, function (a) { d.remove(), a && ((l = 0 === h.indexOf("video/")) && t.hideinfo(), n = e('<embed src="' + a + '" type="' + h + '" class="elfinder-quicklook-preview-' + (l ? "video" : "audio") + '"/>').appendTo(i), o.on("viewchange.embed", f), f()) }, { progressBar: p }), i.one("change", function () { c && c.state && "pending" === c.state() && c.reject() })) }).one("change", function () { n && n.parent().length && (o.off("viewchange.embed"), n.remove(), n = null) }) }, function (t) { var n = t.fm, i = n.arrayFlip(["application/zip", "application/x-gzip", "application/x-tar", "application/x-bzip2"]), a = t.preview, o = n.returnBytes(t.options.unzipMaxSize || 0), r = !(!n.options.cdns.zlibUnzip || !n.options.cdns.zlibGunzip), s = !!n.options.cdns.bzip2; window.Worker && window.Uint8Array && window.DataView && a.on(t.evUpdate, function (l) { var c = l.file, d = "application/x-tar" === c.mime, p = "application/x-bzip2" === c.mime, u = "application/zip" === c.mime || "application/x-gzip" === c.mime; if (i[c.mime] && (!o || c.size <= o) && (d || p && s || u && r)) { var h, f, m, g, v = function (i) { var o, r, s = 0; i && i.length && ((i = e.map(i, function (e) { return n.decodeRawString(e) })).sort(), r = n.escape(i.join("\n").replace(/\{formatSize\((\d+)\)\}/g, function (e, t) { return s += parseInt(t), n.formatSize(t) })), o = "<strong>" + n.escape(c.mime) + "</strong> (" + n.formatSize(c.size) + " / " + n.formatSize(s) + ")<hr/>", e('<div class="elfinder-quicklook-preview-archive-wrapper">' + o + '<pre class="elfinder-quicklook-preview-text">' + r + "</pre></div>").on("touchstart", function (t) { e(this)["scroll" + ("ltr" === n.direction ? "Right" : "Left")]() > 5 && (t.originalEvent._preventSwipeX = !0) }).appendTo(a), t.hideinfo()), m.remove() }; l.stopImmediatePropagation(), m = e('<div class="elfinder-quicklook-info-data"><span class="elfinder-spinner-text">' + n.i18n("nowLoading") + '</span><span class="elfinder-spinner"></span></div>').appendTo(t.info.find(".elfinder-quicklook-info")), g = e('<div class="elfinder-quicklook-info-progress"></div>').appendTo(m), a.one("change", function () { "pending" === h.state() && h.reject(), f && f.terminate(), m.remove() }), h = n.getContents(c.hash, "arraybuffer", { progressBar: g }).fail(function () { m.remove() }).done(function (e) { var t = function (e) { f && f.terminate(), m.remove(), u ? r = !1 : p && (s = !1), n.debug("error", e) }; try { (f = n.getWorker()).onmessage = function (e) { f && f.terminate(), m.remove(), !e.data || e.data.error ? new Error(e.data && e.data.error ? e.data.error : "") : v(e.data.files) }, f.onerror = t, "application/x-tar" === c.mime ? f.postMessage({ scripts: [n.getWorkerUrl("quicklook.unzip.js")], data: { type: "tar", bin: e } }) : "application/zip" === c.mime ? f.postMessage({ scripts: [n.options.cdns.zlibUnzip, n.getWorkerUrl("quicklook.unzip.js")], data: { type: "zip", bin: e } }) : "application/x-gzip" === c.mime ? f.postMessage({ scripts: [n.options.cdns.zlibGunzip, n.getWorkerUrl("quicklook.unzip.js")], data: { type: "gzip", bin: e } }) : "application/x-bzip2" === c.mime && f.postMessage({ scripts: [n.options.cdns.bzip2, n.getWorkerUrl("quicklook.unzip.js")], data: { type: "bzip2", bin: e } }) } catch (e) { t(e) } }) } }) }, function (t) { var n, i = t.fm, a = i.arrayFlip(["application/x-rar"]), o = t.preview; window.DataView && o.on(t.evUpdate, function (r) { var s = r.file; if (a[s.mime] && i.options.cdns.rar && !1 !== n) { var l, c, d, p, u, h, f = function (a) { if (p) l.remove(); else try { d = n({ file: a, type: 2, xhrHeaders: i.customHeaders, xhrFields: i.xhrFields }, function (n) { l.remove(); var a, r = []; p || n ? n && i.debug("error", n) : (e.each(d.entries, function () { r.push(this.path + (this.size ? " (" + i.formatSize(this.size) + ")" : "")) }), r.length && ((r = e.map(r, function (e) { return i.decodeRawString(e) })).sort(), a = "<strong>" + i.escape(s.mime) + "</strong> (" + i.formatSize(s.size) + ")<hr/>", e('<div class="elfinder-quicklook-preview-archive-wrapper">' + a + '<pre class="elfinder-quicklook-preview-text">' + i.escape(r.join("\n")) + "</pre></div>").on("touchstart", function (t) { e(this)["scroll" + ("ltr" === i.direction ? "Right" : "Left")]() > 5 && (t.originalEvent._preventSwipeX = !0) }).appendTo(o), t.hideinfo())) }) } catch (e) { l.remove() } }, m = function () { n = !1, l.remove() }; r.stopImmediatePropagation(), l = e('<div class="elfinder-quicklook-info-data"><span class="elfinder-spinner-text">' + i.i18n("nowLoading") + '</span><span class="elfinder-spinner"></span></div>').appendTo(t.info.find(".elfinder-quicklook-info")), c = e('<div class="elfinder-quicklook-info-progress"></div>').appendTo(l), o.one("change", function () { d && (d.abort = !0), l.remove(), p = !0 }), h = i.openUrl(s.hash, "sameorigin", function (e) { e && (n ? f(e) : (window.RarArchive && (u = window.RarArchive, delete window.RarArchive), i.loadScript([i.options.cdns.rar], function () { i.hasRequire ? require(["rar"], function (t) { n = t, f(e) }, m) : (n = window.RarArchive) ? (u ? window.RarArchive = u : delete window.RarArchive, f(e)) : m() }, { tryRequire: !0, error: m }))) }, { progressBar: c, temporary: !0 }), o.one("change", function () { h && h.state && "pending" === h.state() && h.reject() }) } }) }, function (t) { var n, i = t.fm, a = i.arrayFlip(t.options.sharecadMimes || []), o = t.preview; t.window; t.options.sharecadMimes.length && t.addIntegration({ title: "ShareCAD.org CAD and 3D-Models viewer", link: "https://sharecad.org/DWGOnlinePlugin" }), o.on(t.evUpdate, function (r) { var s = r.file; if (a[s.mime.toLowerCase()] && i.option("onetimeUrl", s.hash)) { var l, c, d; t.window; r.stopImmediatePropagation(), "1" == s.url && (o.hide(), e('<div class="elfinder-quicklook-info-data"><button class="elfinder-info-button">' + i.i18n("getLink") + "</button></div>").appendTo(t.info.find(".elfinder-quicklook-info")).on("click", function () { var n = e(this); n.html('<span class="elfinder-spinner">'), i.request({ data: { cmd: "url", target: s.hash }, preventDefault: !0, progressBar: c }).always(function () { n.html("") }).done(function (e) { var n = i.file(s.hash); s.url = n.url = e.url || "", s.url && o.trigger({ type: t.evUpdate, file: s, forceUpdate: !0 }) }) })), "" !== s.url && "1" != s.url && (o.one("change", function () { l.remove(), n.off("load").remove(), n = null }).addClass("elfinder-overflow-auto"), l = e('<div class="elfinder-quicklook-info-data"><span class="elfinder-spinner-text">' + i.i18n("nowLoading") + '</span><span class="elfinder-spinner"></span></div>').appendTo(t.info.find(".elfinder-quicklook-info")), c = e('<div class="elfinder-quicklook-info-progress"></div>').appendTo(l), d = i.convAbsUrl(i.url(s.hash)), n = e('<iframe class="elfinder-quicklook-preview-iframe" scrolling="no"></iframe>').css("background-color", "transparent").appendTo(o).on("load", function () { t.hideinfo(), l.remove(), t.preview.after(t.info), e(this).css("background-color", "#fff").show() }).on("error", function () { l.remove(), t.preview.after(t.info) }).attr("src", "//sharecad.org/cadframe/load?url=" + encodeURIComponent(d)), t.info.after(t.preview)) } }) }, function (t) { var n, i, a, o, r, s = t.fm, l = { "application/vnd.google-earth.kml+xml": !0, "application/vnd.google-earth.kmz": !0 }, c = t.preview; t.options.googleMapsApiKey && (t.addIntegration({ title: "Google Maps", link: "https://www.google.com/intl/" + s.lang.replace("_", "-") + "/help/terms_maps.html" }), n = window.google && google.maps, i = function (e, i, a) { var r = t.options.googleMapsOpts.maps; s.forExternalUrl(e.hash, { progressBar: a }).done(function (e) { if (e) try { new n.KmlLayer(e, Object.assign({ map: new n.Map(i.get(0), r) }, t.options.googleMapsOpts.kml)), t.hideinfo() } catch (e) { o() } else o() }) }, a = window.gm_authFailure, o = function () { r = null }, r = "https://maps.googleapis.com/maps/api/js?key=" + t.options.googleMapsApiKey, window.gm_authFailure = function () { o(), a && a() }, c.on(t.evUpdate, function (a) { var o = a.file; if (r && l[o.mime.toLowerCase()]) { t.window; var d, p, u, h = "1" == o.url && !s.option("onetimeUrl", o.hash); a.stopImmediatePropagation(), d = e('<div class="elfinder-quicklook-info-data"><span class="elfinder-spinner-text">' + s.i18n("nowLoading") + '</span><span class="elfinder-spinner"></span></div>').appendTo(t.info.find(".elfinder-quicklook-info")), p = e('<div class="elfinder-quicklook-info-progress"></div>').appendTo(d), h && (c.hide(), e('<div class="elfinder-quicklook-info-data"><button class="elfinder-info-button">' + s.i18n("getLink") + "</button></div>").appendTo(t.info.find(".elfinder-quicklook-info")).on("click", function () { var n = e(this); n.html('<span class="elfinder-spinner">'), s.request({ data: { cmd: "url", target: o.hash }, preventDefault: !0, progressBar: p }).always(function () { d.remove(), n.html("") }).done(function (e) { var n = s.file(o.hash); o.url = n.url = e.url || "", o.url && c.trigger({ type: t.evUpdate, file: o, forceUpdate: !0 }) }) })), "" === o.url || h || (u = e('<div style="width:100%;height:100%;"></div>').appendTo(c), c.one("change", function () { u.remove(), u = null }), n ? i(o, u, p) : s.loadScript([r], function () { (n = window.google && google.maps) && i(o, u, p) })) } })) }, function (t) { var n, i, a = t.fm, o = Object.assign(a.arrayFlip(t.options.googleDocsMimes || [], "g"), a.arrayFlip(t.options.officeOnlineMimes || [], "m")), r = t.preview, s = (t.window, t.navbar), l = { g: "docs.google.com/gview?embedded=true&url=", m: "view.officeapps.live.com/op/embed.aspx?wdStartOn=0&src=" }, c = { g: "56px", m: "24px" }, d = { xls: 5242880, xlsb: 5242880, xlsx: 5242880, xlsm: 5242880, other: 10485760 }; t.options.googleDocsMimes.length && (i = !0, t.addIntegration({ title: "Google Docs Viewer", link: "https://docs.google.com/" })), t.options.officeOnlineMimes.length && (i = !0, t.addIntegration({ title: "MS Online Doc Viewer", link: "https://products.office.com/office-online/view-office-documents-online" })), i && r.on(t.evUpdate, function (i) { var p, u, h = i.file; if (h.size <= 26214400 && (p = o[h.mime])) { var f, m, g, v = t.window, b = function () { s.css("bottom", v.hasClass("elfinder-quicklook-fullscreen") ? c[p] : "") }, y = a.mimeTypes[h.mime], w = "1" == h.url && !a.option("onetimeUrl", h.hash); "m" === p && (d[y] && h.size > d[y] || h.size > d.other) && (p = "g"), w && (r.hide(), e('<div class="elfinder-quicklook-info-data"><button class="elfinder-info-button">' + a.i18n("getLink") + "</button></div>").appendTo(t.info.find(".elfinder-quicklook-info")).on("click", function () { var n = e(this); n.html('<span class="elfinder-spinner">'), a.request({ data: { cmd: "url", target: h.hash }, preventDefault: !0 }).always(function () { n.html("") }).done(function (e) { var n = a.file(h.hash); h.url = n.url = e.url || "", h.url && r.trigger({ type: t.evUpdate, file: h, forceUpdate: !0 }) }) })), "" === h.url || w || (i.stopImmediatePropagation(), r.one("change", function () { u && u.status && "pending" === u.status() && u.reject(), v.off("viewchange.googledocs"), f.remove(), n.off("load").remove(), n = null }).addClass("elfinder-overflow-auto"), f = e('<div class="elfinder-quicklook-info-data"><span class="elfinder-spinner-text">' + a.i18n("nowLoading") + '</span><span class="elfinder-spinner"></span></div>').appendTo(t.info.find(".elfinder-quicklook-info")), m = e('<div class="elfinder-quicklook-info-progress"></div>').appendTo(f), n = e('<iframe class="elfinder-quicklook-preview-iframe"></iframe>').css("background-color", "transparent").appendTo(r), u = a.forExternalUrl(h.hash, { progressBar: m }).done(function (i) { var a = function () { try { !n || n.attr("src") && !n.get(0).contentWindow.document || (n.attr("src", "https://" + l[p] + encodeURIComponent(i)), g = setTimeout(a, 2e3)) } catch (e) { } }; i ? (h.ts && (i += (i.match(/\?/) ? "&" : "?") + "_t=" + h.ts), n.on("load", function () { g && clearTimeout(g), t.hideinfo(), f.remove(), t.preview.after(t.info), e(this).css("background-color", "#fff").show() }).on("error", function () { g && clearTimeout(g), f.remove(), t.preview.after(t.info) }), a()) : (f.remove(), n.remove()) }), v.on("viewchange.googledocs", b), b(), t.info.after(t.preview)) } }) }, function (t) { "use strict"; var n, i, a = t.fm, o = t.preview, r = parseInt(t.options.textInitialLines) || 150, s = parseInt(t.options.prettifyMaxLines) || 500, l = function () { c = function () { return !1 }, i && (window.PR = i), n = !1 }, c = function (e) { a.options.cdns.prettify ? (c = function (e) { return setTimeout(function () { p(e) }, 100), "pending" }, window.PR && (i = window.PR), a.loadScript([a.options.cdns.prettify + (a.options.cdns.prettify.match(/\?/) ? "&" : "?") + "autorun=false"], function (t) { "object" == typeof (n = t || window.PR) ? (c = function () { return !0 }, i ? window.PR = i : delete window.PR, d(e)) : l() }, { tryRequire: !0, error: l })) : l() }, d = function (e) { e && !e.hasClass("prettyprinted") && (e.css("cursor", "wait"), requestAnimationFrame(function () { n.prettyPrint && n.prettyPrint(null, e.get(0)), e.css("cursor", "") })) }, p = function (e) { !0 === c(e) && d(e) }; o.on(t.evUpdate, function (i) { var l, c, d, u, h = i.file; h.mime; a.mimeIsText(h.mime) && (!t.options.getSizeMax || h.size <= t.options.getSizeMax) && !1 !== n && (i.stopImmediatePropagation(), c = e('<div class="elfinder-quicklook-info-data"><span class="elfinder-spinner-text">' + a.i18n("nowLoading") + '</span><span class="elfinder-spinner"></span></div>').appendTo(t.info.find(".elfinder-quicklook-info")), d = e('<div class="elfinder-quicklook-info-progress"></div>').appendTo(c), o.one("change", function () { "pending" == l.state() && l.reject(), u && u.remove() }), l = a.request({ data: { cmd: "get", target: h.hash, conv: h.encoding || 1, _t: h.ts }, options: { type: "get", cache: !0 }, preventDefault: !0, progressBar: d }).done(function (n) { var i, l, c, d, u, f = new RegExp("^(data:" + h.mime.replace(/([.+])/g, "\\$1") + ";base64,)", "i"), m = n.content; "string" == typeof m && (t.hideinfo(), window.atob && (u = m.match(f)) && (m = atob(m.substr(u[1].length))), (l = (d = m.match(/([^\r\n]{1,100}[\r\n]*)/g)).length - r) > 10 ? i = d.splice(0, r).join("") : l = 0, c = e('<div class="elfinder-quicklook-preview-text-wrapper"><pre class="elfinder-quicklook-preview-text prettyprint"></pre></div>'), l && c.append(e('<div class="elfinder-quicklook-preview-charsleft"><hr/><span>' + a.i18n("linesLeft", a.toLocaleString(l)) + "</span></div>").on("click", function () { var t = c.scrollTop(); e(this).remove(), c.children("pre").removeClass("prettyprinted").text(m).scrollTop(t), d.length <= s && p(c) })), c.children("pre").text(i || m), c.on("touchstart", function (t) { e(this)["scroll" + ("ltr" === a.direction ? "Right" : "Left")]() > 5 && (t.originalEvent._preventSwipeX = !0) }).appendTo(o), n.toasts && Array.isArray(n.toasts) && e.each(n.toasts, function () { this.msg && a.toast(this) }), p(c)) }).always(function (n) { var i, r, s; (i = a.getCommand("edit")) && (s = [], n && n.encoding && s.push({ value: n.encoding }), s.push({ value: "UTF-8" }), (r = i.getEncSelect(s)).on("change", function () { h.encoding = r.val(), a.cache(h, "change"), o.trigger({ type: t.evUpdate, file: h, forceUpdate: !0 }) }), u = e('<div class="elfinder-quicklook-encoding"></div>').append(r), t.window.append(u)), c.remove() })) }) }], (h.prototype.commands.reload = function () { "use strict"; var t = this, n = !1; this.alwaysEnabled = !0, this.updateOnSelect = !0, this.shortcuts = [{ pattern: "ctrl+shift+r f5" }], this.getstate = function () { return 0 }, this.init = function () { this.fm.bind("search searchend", function () { n = "search" == this.type }) }, this.fm.bind("contextmenu", function () { var n = t.fm; n.options.sync >= 1e3 && (t.extra = { icon: "accept", node: e("<span></span>").attr({ title: n.i18n("autoSync") }).on("click touchstart", function (t) { "touchstart" === t.type && t.originalEvent.touches.length > 1 || (t.stopPropagation(), t.preventDefault(), e(this).parent().toggleClass("ui-state-disabled", n.options.syncStart).parent().removeClass("ui-state-hover"), n.options.syncStart = !n.options.syncStart, n.autoSync(n.options.syncStart ? null : "stop")) }).on("ready", function () { e(this).parent().toggleClass("ui-state-disabled", !n.options.syncStart).css("pointer-events", "auto") }) }) }), this.exec = function () { var t = this.fm; if (!n) { var i = t.sync(), a = setTimeout(function () { t.notify({ type: "reload", cnt: 1, hideCnt: !0 }), i.always(function () { t.notify({ type: "reload", cnt: -1 }) }) }, t.notifyDelay); return i.always(function () { clearTimeout(a), t.trigger("reload") }) } e("div.elfinder-toolbar > div." + t.res("class", "searchbtn") + " > span.ui-icon-search").click() } }).prototype = { forceLoad: !0 }, h.prototype.commands.rename = function () { "use strict"; this.alwaysEnabled = !0, this.syncTitleOnChange = !0; var t = this, n = t.fm, i = function (t, i, a, o) { var r, s = i ? [a.hash].concat(i) : [a.hash], l = s.length, c = {}; if (n.lockfiles({ files: s }), n.isRoot(a) && !a.netkey) { if ((r = n.storage("rootNames")) || (r = {}), "" === o) { if (!r[a.hash]) return t && t.reject(), void n.unlockfiles({ files: s }).trigger("selectfiles", { files: s }); a.name = a._name, a.i18 = a._i18, delete r[a.hash], delete a._name, delete a._i18 } else void 0 === a._name && (a._name = a.name, a._i18 = a.i18), a.name = r[a.hash] = o, delete a.i18; return n.storage("rootNames", r), c = { changed: [a] }, n.updateCache(c), n.change(c), t && t.resolve(c), void n.unlockfiles({ files: s }).trigger("selectfiles", { files: s }) } c = { cmd: "rename", name: o, target: a.hash }, l > 1 && (c.targets = i, o.match(/\*/) && (c.q = o)), n.request({ data: c, notify: { type: "rename", cnt: l }, navigate: {} }).fail(function (e) { var i = n.parseError(e); t && t.reject(), i && Array.isArray(i) && "errRename" === i[0] || n.sync() }).done(function (i) { var r; i.added && i.added.length && 1 === l && (i.undo = { cmd: "rename", callback: function () { return n.request({ data: { cmd: "rename", target: i.added[0].hash, name: a.name }, notify: { type: "undo", cnt: 1 } }) } }, i.redo = { cmd: "rename", callback: function () { return n.request({ data: { cmd: "rename", target: a.hash, name: o }, notify: { type: "rename", cnt: 1 } }) } }), t && t.resolve(i), (r = n.cwd().hash) && r !== a.hash || n.exec("open", e.map(i.added, function (e) { return "directory" === e.mime ? e.hash : null })[0]) }).always(function () { n.unlockfiles({ files: s }).trigger("selectfiles", { files: s }) }) }, a = function (e, t) { var i, a, o, r = t || n.selected(), s = n.splitFileExtention(e), l = n.file(r[0]), c = n.file(r[1]); return i = s[1] ? "." + s[1] : "", s[1] && "*" === s[0] ? (a = '"' + n.splitFileExtention(l.name)[0] + i + '", ', a += '"' + n.splitFileExtention(c.name)[0] + i + '"') : s[0].length > 1 && ("*" === s[0].substr(-1) ? (a = '"' + (o = s[0].substr(0, s[0].length - 1)) + l.name + '", ', a += '"' + o + c.name + '"') : "*" === s[0].substr(0, 1) && (o = s[0].substr(1), a = '"' + n.splitFileExtention(l.name)[0] + o + i + '", ', a += '"' + n.splitFileExtention(c.name)[0] + o + i + '"')), a || (a = '"' + s[0] + "1" + i + '", "' + s[0] + "2" + i + '"'), r.length > 2 && (a += " ..."), a }, o = function () { var o, r = n.selected(), s = '<input name="type" type="radio" class="elfinder-tabstop">', l = function (t, i) { return e('<label class="elfinder-rename-batch-checks">' + n.i18n(i) + "</label>").prepend(t) }, c = e('<input type="text" class="ui-corner-all elfinder-tabstop">'), d = e(s), p = e(s), u = e(s), h = e(s), f = e("<div></div>").append(l(d, "plusNumber"), l(p, "asPrefix"), l(u, "asSuffix"), l(h, "changeExtention")), m = e('<div class="elfinder-rename-batch-preview"></div>'), g = e('<div class="elfinder-rename-batch"></div>').append(e('<div class="elfinder-rename-batch-name"></div>').append(c), e('<div class="elfinder-rename-batch-type"></div>').append(f), m), v = { title: n.i18n("batchRename"), modal: !0, destroyOnClose: !0, width: Math.min(380, n.getUI().width() - 20), buttons: {}, open: function () { c.on("input", y).trigger("focus") } }, b = function () { var e = c.val(), t = n.splitFileExtention(n.file(r[0]).name)[1]; return ("" !== e || d.is(":checked")) && (p.is(":checked") ? e += "*" : u.is(":checked") ? e = "*" + e + "." + t : h.is(":checked") ? e = "*." + e : t && (e += "." + t)), e }, y = function () { var e = b(); "" !== e ? m.html(n.i18n(["renameMultiple", r.length, a(e)])) : m.empty() }, w = f.find("input:radio").on("change", y); v.buttons[n.i18n("btnApply")] = function () { var e, t, a = b(); "" !== a && (o.elfinderdialog("close"), t = r, e = n.file(t.shift()), i(void 0, t, e, a)) }, v.buttons[n.i18n("btnCancel")] = function () { o.elfinderdialog("close") }, e.fn.checkboxradio ? w.checkboxradio({ create: function (e, t) { this === d.get(0) && d.prop("checked", !0).change() } }) : f.buttonset({ create: function (e, t) { d.prop("checked", !0).change() } }), o = t.fmDialog(g, v) }; this.noChangeDirOnRemovedCwd = !0, this.shortcuts = [{ pattern: "f2" + ("mac" == n.OS ? " enter" : "") }, { pattern: "shift+f2", description: "batchRename", callback: function () { n.selected().length > 1 && o() } }], this.getstate = function (i) { var a, r, s, l, c, d, p = this.files(i), u = p.length; return u ? (u > 1 && p[0].phash && (a = p[0].phash, r = n.splitFileExtention(p[0].name)[1].toLowerCase(), s = p[0].mime), 1 === u && (d = n.isRoot(p[0])), c = 1 === u && (n.cookieEnabled && d || !p[0].locked) || n.api > 2.103 && u === e.grep(p, function (e) { return !(l || e.locked || e.phash !== a || n.isRoot(e) || s !== e.mime && r !== n.splitFileExtention(e.name)[1].toLowerCase()) || (l && (l = !0), !1) }).length ? 0 : -1, !d && 0 === c && n.option("disabledFlip", p[0].hash).rename && (c = -1), -1 !== c && u > 1 ? t.extra = { icon: "preference", node: e("<span></span>").attr({ title: n.i18n("batchRename") }).on("click touchstart", function (e) { "touchstart" === e.type && e.originalEvent.touches.length > 1 || (e.stopPropagation(), e.preventDefault(), n.getUI().trigger("click"), o()) }) } : delete t.extra, c) : -1 }, this.exec = function (t, o) { n.getUI("cwd"); var r, s = t || !!n.selected().length && n.selected() || [n.cwd().hash], l = s.length, c = n.file(s.shift()), d = o || {}, p = n.cwd().hash == c.hash, u = "files" !== ("navbar" === d._currentType || "files" === d._currentType ? d._currentType : p ? "navbar" : "files"), h = n[u ? "navHash2Elm" : "cwdHash2Elm"](c.hash), f = !u && "list" != n.storage("view"), m = function () { requestAnimationFrame(function () { y && y.trigger("blur") }) }, g = function () { C.is(":hidden") || C.elfinderoverlay("hide").off("click close", z), k.removeClass("ui-front").css("position", "").off("unselect." + n.namespace, m), f ? x && x.css("max-height", "") : u || k.css("width", "").parent("td").css("overflow", "") }, v = e.Deferred().fail(function (e) { var t = y.parent(), i = n.escape(c.i18 || c.name); y.off(), f && (i = i.replace(/([_.])/g, "&#8203;$1")), requestAnimationFrame(function () { u ? y.replaceWith(i) : t.length ? (y.remove(), t.html(i)) : h.find(".elfinder-cwd-filename").html(i) }), e && n.error(e) }).always(function () { g(), n.unbind("resize", T), n.enable() }), b = function (t) { var o = e.trim(y.val()), r = (n.splitFileExtention(o), !0), d = function () { y.off(), g(), u ? y.replaceWith(n.escape(o)) : x.html(n.escape(o)), i(v, s, c, o) }; if (C.is(":hidden") || k.css("z-index", ""), "" === o) { if (!n.isRoot(c)) return z(); u ? y.replaceWith(n.escape(c.name)) : x.html(n.escape(c.name)) } if (!A && k.length) { if (y.off("blur"), 1 === l && o === c.name) return v.reject(); if (n.options.validName && n.options.validName.test) try { r = n.options.validName.test(o) } catch (t) { r = !1 } if ("." === o || ".." === o || !r) return A = !0, n.error("directory" === c.mime ? "errInvDirname" : "errInvName", { modal: !0, close: function () { setTimeout(w, 120) } }), !1; if (1 === l && n.fileByName(o, c.phash)) return A = !0, n.error(["errExists", o], { modal: !0, close: function () { setTimeout(w, 120) } }), !1; 1 === l ? d() : (n.confirm({ title: "cmdrename", text: ["renameMultiple", l, a(o, [c.hash].concat(s))], accept: { label: "btnYes", callback: d }, cancel: { label: "btnCancel", callback: function () { setTimeout(function () { A = !0, w() }, 120) } } }), setTimeout(function () { n.trigger("unselectfiles", { files: n.selected() }).trigger("selectfiles", { files: [c.hash].concat(s) }) }, 120)) } }, y = e(f ? "<textarea></textarea>" : '<input type="text"/>').on("keyup text", function () { f ? (this.style.height = "1px", this.style.height = this.scrollHeight + "px") : r && (this.style.width = r + "px", this.scrollWidth > r && (this.style.width = this.scrollWidth + 10 + "px")) }).on("keydown", function (t) { t.stopImmediatePropagation(), t.keyCode == e.ui.keyCode.ESCAPE ? v.reject() : t.keyCode == e.ui.keyCode.ENTER && (t.preventDefault(), y.trigger("blur")) }).on("mousedown click dblclick", function (e) { e.stopPropagation(), "dblclick" === e.type && e.preventDefault() }).on("blur", b).on("dragenter dragleave dragover drop", function (e) { e.stopPropagation() }), w = function () { var e = n.splitFileExtention(y.val())[0]; A || !n.UA.Mobile || n.UA.iOS || (C.on("click close", z).elfinderoverlay("show"), k.css("z-index", C.css("z-index") + 1)), !n.enabled() && n.enable(), A && (A = !1, y.on("blur", b)), y.trigger("focus").trigger("select"), y[0].setSelectionRange && y[0].setSelectionRange(0, e.length) }, x = u ? h.contents().filter(function () { return 3 == this.nodeType && e(this).parent().attr("id") === n.navHash2Id(c.hash) }) : h.find(".elfinder-cwd-filename"), k = x.parent(), C = n.getUI("overlay"), z = function (e) { C.is(":hidden") || k.css("z-index", ""), A || (v.reject(), e && (e.stopPropagation(), e.preventDefault())) }, T = function () { h.trigger("scrolltoview", { blink: !1 }) }, A = !1; return k.addClass("ui-front").css("position", "relative").on("unselect." + n.namespace, m), n.bind("resize", T), u ? x.replaceWith(y.val(c.name)) : (f ? x.css("max-height", "none") : u || (r = k.width(), k.width(r - 15).parent("td").css("overflow", "visible")), x.empty().append(y.val(c.name))), l > 1 && n.api <= 2.103 ? v.reject() : c && x.length ? c.locked && !n.isRoot(c) ? v.reject(["errLocked", c.name]) : (n.one("select", function () { y.parent().length && c && -1 === e.inArray(c.hash, n.selected()) && y.trigger("blur") }), y.trigger("keyup"), w(), v) : v.reject("errCmdParams", this.title) }, n.bind("select contextmenucreate closecontextmenu", function (e) { var i, a = (e.data ? e.data.selected || e.data.targets : null) || n.selected(); a && 1 === a.length && (i = n.file(a[0])) && n.isRoot(i) ? t.title = n.i18n("kindAlias") + " (" + n.i18n("preference") + ")" : t.title = n.i18n("cmdrename"), "closecontextmenu" !== e.type ? t.update(void 0, t.title) : requestAnimationFrame(function () { t.update(void 0, t.title) }) }).remove(function (t) { var i; t.data && t.data.removed && (i = n.storage("rootNames")) && (e.each(t.data.removed, function (e, t) { i[t] && delete i[t] }), n.storage("rootNames", i)) }) }, h.prototype.commands.resize = function () { "use strict"; var t = this.fm, n = 0; this.updateOnSelect = !1, this.getstate = function () { var e = t.selectedFiles(); return 1 == e.length && e[0].read && e[0].write && -1 !== e[0].mime.indexOf("image/") ? 0 : -1 }, this.resizeRequest = function (n, i, a) { var o, r = i || t.file(n.target); r && r.tmb; return t.isCommandEnabled("resize", n.target) && (!r || r && r.read && r.write && -1 !== r.mime.indexOf("image/")) ? t.request({ data: Object.assign(n, { cmd: "resize" }), notify: { type: "resize", cnt: 1 } }).fail(function (e) { a && a.reject(e) }).done(function () { n.quality && t.storage("jpgQuality", n.quality === t.option("jpgQuality") ? null : n.quality), a && a.resolve() }) : (o = r ? -1 === r.mime.indexOf("image/") ? ["errResize", r.name, "errUsupportType"] : ["errResize", r.name, "errPerm"] : ["errResize", n.target, "errPerm"], a ? a.reject(o) : t.error(o), e.Deferred().reject(o)) }, this.exec = function (i) { var a, o, r, s, l = this, c = this.files(i), d = e.Deferred(), p = t.api > 1, u = this.options, h = t.getUI(), f = e().controlgroup ? "controlgroup" : "buttonset", m = void 0 === u.grid8px || "disable" !== u.grid8px, g = Array.isArray(u.presetSize) ? u.presetSize : [], v = t.res("class", "editing"), b = function (i, a, o) { var c, b, y, w, x, k, C, z = "image/jpeg" === i.mime, T = e('<div class="elfinder-resize-container"></div>'), A = '<input type="number" class="ui-corner-all"/>', j = '<div class="elfinder-resize-row"></div>', O = '<div class="elfinder-resize-label"></div>', S = null, I = !1, M = function () { I = !0 }, E = function () { I && (I = !1, F.trigger("change")) }, F = e('<div class="elfinder-resize-control"></div>').on("focus", "input[type=text],input[type=number]", function () { e(this).trigger("select") }).on("change", function () { S && cancelAnimationFrame(S), S = requestAnimationFrame(function () { var n, i, a, o, r, l, c, d, p, u, h, f; tt && !I && (a = tt.data("canvas")) && (n = F.children("div.elfinder-resize-control-panel:visible"), (i = n.find("input.elfinder-resize-quality")).is(":visible") && (o = tt.data("ctx"), r = tt.get(0), n.hasClass("elfinder-resize-uiresize") ? (d = a.width = K.val(), p = a.height = X.val(), o.drawImage(r, 0, 0, d, p)) : n.hasClass("elfinder-resize-uicrop") ? (l = J.val(), c = G.val(), d = Y.val(), p = Q.val(), a.width = d, a.height = p, o.drawImage(r, l, c, d, p, 0, 0, d, p)) : (u = ee.val(), h = ee.val() * Math.PI / 180, f = function (t, n, i) { var a = [{ x: t / 2, y: n / 2 }, { x: -t / 2, y: n / 2 }, { x: -t / 2, y: -n / 2 }, { x: t / 2, y: -n / 2 }], o = [], r = { x: Number.MAX_VALUE, y: Number.MAX_VALUE }, s = { x: Number.MIN_VALUE, y: Number.MIN_VALUE }; return e.each(a, function (e, t) { o.push({ x: t.x * Math.cos(i) - t.y * Math.sin(i), y: t.x * Math.sin(i) + t.y * Math.cos(i) }) }), e.each(o, function (e, t) { r.x = Math.min(r.x, t.x), r.y = Math.min(r.y, t.y), s.x = Math.max(s.x, t.x), s.y = Math.max(s.y, t.y) }), { width: s.x - r.x, height: s.y - r.y } }(he, fe, h), d = a.width = f.width, p = a.height = f.height, o.save(), u % 90 != 0 && (o.fillStyle = ce.val() || "#FFF", o.fillRect(0, 0, d, p)), o.translate(d / 2, p / 2), o.rotate(h), o.drawImage(r, -r.width / 2, -r.height / 2, he, fe), o.restore()), a.toBlob(function (e) { e && (s = e.size, i.next("span").text(" (" + t.formatSize(e.size) + ")")) }, "image/jpeg", Math.max(Math.min(i.val(), 100), 1) / 100))) }) }).on("mouseup", "input", function (t) { e(t.target).trigger("change") }), D = e('<div class="elfinder-resize-preview"></div>').on("touchmove", function (t) { e(t.target).hasClass("touch-punch") && (t.stopPropagation(), t.preventDefault()) }), U = e('<div class="elfinder-resize-loading">' + t.i18n("ntfloadimg") + "</div>"), P = e('<div class="elfinder-resize-handle touch-punch"></div>'), q = e('<div class="elfinder-resize-handle touch-punch"></div>'), R = e('<div class="elfinder-resize-uiresize elfinder-resize-control-panel"></div>'), H = e('<div class="elfinder-resize-uicrop elfinder-resize-control-panel"></div>'), _ = e('<div class="elfinder-resize-rotate elfinder-resize-control-panel"></div>'), N = e("<button></button>").attr("title", t.i18n("rotate-cw")).append(e('<span class="elfinder-button-icon elfinder-button-icon-rotate-l"></span>')), L = e("<button></button>").attr("title", t.i18n("rotate-ccw")).append(e('<span class="elfinder-button-icon elfinder-button-icon-rotate-r"></span>')), W = e("<span ></span>"), B = e('<button class="elfinder-resize-reset">').text(t.i18n("reset")).on("click", function () { _e() }).button({ icons: { primary: "ui-icon-arrowrefresh-1-n" }, text: !1 }), $ = e('<div class="elfinder-resize-type"></div>').append('<input type="radio" name="type" id="' + a + '-resize" value="resize" checked="checked" /><label for="' + a + '-resize">' + t.i18n("resize") + "</label>", '<input class="api2" type="radio" name="type" id="' + a + '-crop" value="crop" /><label class="api2" for="' + a + '-crop">' + t.i18n("crop") + "</label>", '<input class="api2" type="radio" name="type" id="' + a + '-rotate" value="rotate" /><label class="api2" for="' + a + '-rotate">' + t.i18n("rotate") + "</label>"), V = "resize", K = ($[f]()[f]("disable").find("input").on("change", function () { V = e(this).val(), _e(), Be(!0), $e(!0), Ve(!0), "resize" == V ? (R.show(), _.hide(), H.hide(), Be(), z && Te.insertAfter(R.find(".elfinder-resize-grid8"))) : "crop" == V ? (_.hide(), R.hide(), H.show(), $e(), z && Te.insertAfter(H.find(".elfinder-resize-grid8"))) : "rotate" == V && (R.hide(), H.hide(), _.show(), Ve()) }), e(A).on("change", function () { var e = He(parseInt(K.val())), t = He(me ? e / pe : parseInt(X.val())); e > 0 && t > 0 && (Ne.updateView(e, t), K.val(e), X.val(t)) }).addClass("elfinder-focus")), X = e(A).on("change", function () { var e = He(parseInt(X.val())), t = He(me ? e * pe : parseInt(K.val())); t > 0 && e > 0 && (Ne.updateView(t, e), K.val(t), X.val(e)) }), J = e(A).on("change", function () { Le.updateView() }), G = e(A).on("change", function () { Le.updateView() }), Y = e(A).on("change", function () { Le.updateView("w") }), Q = e(A).on("change", function () { Le.updateView("h") }), Z = z && p ? e(A).val(t.storage("jpgQuality") > 0 ? t.storage("jpgQuality") : t.option("jpgQuality")).addClass("elfinder-resize-quality").attr("min", "1").attr("max", "100").attr("title", "1 - 100").on("blur", function () { var e = Math.min(100, Math.max(1, parseInt(this.value))); F.find("input.elfinder-resize-quality").val(e) }) : null, ee = e('<input type="number" class="ui-corner-all" maxlength="3" value="0" />').on("change", function () { We.update() }), te = e('<div class="elfinder-resize-rotate-slider touch-punch"></div>').slider({ min: 0, max: 360, value: ee.val(), animate: !0, start: M, stop: E, change: function (e, t) { t.value != te.slider("value") && We.update(t.value) }, slide: function (e, t) { We.update(t.value, !1) } }).find(".ui-slider-handle").addClass("elfinder-tabstop").off("keydown").on("keydown", function (t) { t.keyCode != e.ui.keyCode.LEFT && t.keyCode != e.ui.keyCode.RIGHT || (t.stopPropagation(), t.preventDefault(), We.update(Number(ee.val()) + (t.keyCode == e.ui.keyCode.RIGHT ? 1 : -1), !1)) }).end(), ne = {}, ie = function (e) { var t, n, i, a; try { t = ne[Math.round(e.offsetX)][Math.round(e.offsetY)] } catch (e) { } t && (n = t[0], i = t[1], a = t[2], t[3], t[4], t[5], oe(n, i, a, "click" === e.type)) }, ae = function (t) { oe(e(this).css("backgroundColor"), "", "", "click" === t.type) }, oe = function (t, n, i, a) { var o, r, s; "string" == typeof t && (n = "", t && (o = e("<span>").css("backgroundColor", t).css("backgroundColor")) && (r = o.match(/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/i)) && (t = Number(r[1]), n = Number(r[2]), i = Number(r[3]))), s = "" === n ? t : "#" + re(t, n, i), ce.val(s).css({ backgroundColor: s, backgroundImage: "none", color: t + n + i < 384 ? "#fff" : "#000" }), D.css("backgroundColor", s), a && (Re.off(".picker").removeClass("elfinder-resize-picking"), de.off(".picker").removeClass("elfinder-resize-picking")) }, re = function (t, n, i) { return e.map([t, n, i], function (e) { return ("0" + parseInt(e).toString(16)).slice(-2) }).join("") }, se = e("<button>").text(t.i18n("colorPicker")).on("click", function () { Re.on("mousemove.picker click.picker", ie).addClass("elfinder-resize-picking"), de.on("mousemove.picker click.picker", "span", ae).addClass("elfinder-resize-picking") }).button({ icons: { primary: "ui-icon-pin-s" }, text: !1 }), le = e("<button>").text(t.i18n("reset")).on("click", function () { oe("", "", "", !0) }).button({ icons: { primary: "ui-icon-arrowrefresh-1-n" }, text: !1 }), ce = e('<input class="ui-corner-all elfinder-resize-bg" type="text">').on("focus", function () { e(this).attr("style", "") }).on("blur", function () { oe(e(this).val()) }), de = e('<div class="elfinder-resize-pallet">').on("click", "span", function () { oe(e(this).css("backgroundColor")) }), pe = 1, ue = 1, he = 0, fe = 0, me = !0, ge = !1, ve = 0, be = 0, ye = 0, we = 0, xe = 0, ke = !!z && m, Ce = e("<button>").html(t.i18n("aspectRatio")).on("click", function () { me = !me, Ce.button("option", { icons: { primary: me ? "ui-icon-locked" : "ui-icon-unlocked" } }), Ne.fixHeight(), P.resizable("option", "aspectRatio", me).data("uiResizable")._aspectRatio = me }).button({ icons: { primary: me ? "ui-icon-locked" : "ui-icon-unlocked" }, text: !1 }), ze = e("<button>").html(t.i18n("aspectRatio")).on("click", function () { ge = !ge, ze.button("option", { icons: { primary: ge ? "ui-icon-locked" : "ui-icon-unlocked" } }), q.resizable("option", "aspectRatio", ge).data("uiResizable")._aspectRatio = ge }).button({ icons: { primary: ge ? "ui-icon-locked" : "ui-icon-unlocked" }, text: !1 }), Te = e("<button>").html(t.i18n(ke ? "enabled" : "disabled")).toggleClass("ui-state-active", ke).on("click", function () { ke = !ke, Te.html(t.i18n(ke ? "enabled" : "disabled")).toggleClass("ui-state-active", ke), Ae() }).button(), Ae = function () { var t = ke ? 8 : 1; e.each([K, X, Y, Q, J, G], function () { this.attr("step", t) }), ke && (K.val(He(K.val())), X.val(He(X.val())), Y.val(He(Y.val())), Q.val(He(Q.val())), J.val(He(J.val())), G.val(He(G.val())), R.is(":visible") ? Ne.updateView(K.val(), X.val()) : H.is(":visible") && Le.updateView()) }, je = function () { var n, a = function () { ce.parent().hide(), de.hide() }; n = Math.min(ve, be) / Math.sqrt(Math.pow(he, 2) + Math.pow(fe, 2)), ye = Math.ceil(he * n), we = Math.ceil(fe * n), Re.width(ye).height(we).css("margin-top", (be - we) / 2 + "px").css("margin-left", (ve - ye) / 2 + "px"), Re.is(":visible") && ce.is(":visible") && ("image/png" !== i.mime ? (D.css("backgroundColor", ce.val()), c = e("<img>"), t.isCORS && c.attr("crossorigin", "use-credentials"), c.on("load", function () { b && b.width !== ye && Se() }).on("error", a).attr("src", et)) : a()) }, Oe = function () { Ne.updateView(he, fe), je(), Ue.width(De.width()).height(De.height()), Pe.width(De.width()).height(De.height()), Le.updateView(), nt() }, Se = function () { if (y) { var t, n, i, a, o, r, s, l, d, p, u, h, f, m, g, v, w, x, k = {}, C = [], z = function (e, t, n) { var i, a = Math.max(Math.max(e, t), n), o = Math.min(Math.min(e, t), n); return a === o ? i = 0 : e === a ? i = ((t - n) / (a - o) * 60 + 360) % 360 : t === a ? i = (n - e) / (a - o) * 60 + 120 : n === a && (i = (e - t) / (a - o) * 60 + 240), [i, (a - o) / a, (.3 * e + .59 * t + .11 * n) / 255, "hsl"] }, T = function (e) { return 8 * Math.round(e / 8) }; e: try { n = b.width = Re.width(), i = b.height = Re.height(), h = n / he, y.scale(h, h), y.drawImage(c.get(0), 0, 0), u = y.getImageData(0, 0, n, i).data, f = .1 * n, m = .9 * n, g = .1 * i, v = .9 * i; for (var A = 0; A < i - 1; A++)for (var j = 0; j < n - 1; j++) { if (a = u[t = 4 * j + A * n * 4], o = u[t + 1], r = u[t + 2], 255 !== u[t + 3]) { ce.parent().hide(), de.hide(); break e } d = z(a, o, r), p = Math.round(d[0]), s = Math.round(100 * d[1]), l = Math.round(100 * d[2]), ne[j] || (ne[j] = {}), ne[j][A] = [a, o, r, p, s, l], (j < f || j > m) && (A < g || A > v) && (k[w = T(a) + "," + T(o) + "," + T(r)] ? ++k[w] : k[w] = 1) } de.children(":first").length || (x = 1, e.each(k, function (e, t) { C.push({ c: e, v: t }) }), e.each(C.sort(function (e, t) { return e.v > t.v ? -1 : 1 }), function () { if (this.v < 2 || x > 10) return !1; de.append(e('<span style="width:20px;height:20px;display:inline-block;background-color:rgb(' + this.c + ');">')), ++x })) } catch (e) { se.hide(), de.hide() } } }, Ie = null, Me = !1, Ee = function (e) { var n = t.file(i.hash); n.width = e[0], n.height = e[1] }, Fe = function () { var a, o, r; Me || (Me = !0, Ie && Ie.state && "pending" === Ie.state() && Ie.reject(), t.api >= 2.103 ? 0 === n && t.request({ data: { cmd: "resize", target: i.hash, degree: 0, mode: "rotate" }, preventDefault: !0 }).done(function (e) { 1 === (n = e.losslessRotate ? 1 : -1) && ee.val() % 90 == 0 && _.children("div.elfinder-resize-quality").hide() }).fail(function () { n = -1 }) : n = -1, a = De.get(0), (o = i.width && i.height ? { w: i.width, h: i.height } : a.naturalWidth ? null : { w: De.width(), h: De.height() }) && De.removeAttr("width").removeAttr("height"), he = i.width || a.naturalWidth || a.width || De.width(), fe = i.height || a.naturalHeight || a.height || De.height(), i.width && i.height || Ee([he, fe]), o && De.width(o.w).height(o.h), w.show(), (r = fe / he) < 1 && D.height() > D.width() * r && D.height(D.width() * r), D.height() > De.height() + 20 && D.height(De.height() + 20), be = D.height() - (P.outerHeight() - P.height()), U.remove(), pe = he / fe, P.append(De.show()).show(), K.val(he), X.val(fe), function () { try { b = document.createElement("canvas"), y = b.getContext("2d") } catch (e) { se.hide(), de.hide() } }(), at.on("click", "span.elfinder-resize-preset", function () { var t = e(this), n = t.data("s")[0], i = t.data("s")[1], a = he / fe; t.data("s", [i, n]).text(i + "x" + n), he > n || fe > i ? he <= n ? n = He(i * a) : fe <= i ? i = He(n / a) : he - n > fe - i ? i = He(n / a) : n = He(i * a) : (n = he, i = fe), K.val(n), X.val(i), Ne.updateView(n, i), nt() }), ot.on("click", "span.elfinder-resize-preset", function () { var t = e(this), n = t.data("s")[0], i = t.data("s")[1], a = J.val(), o = G.val(); t.data("s", [i, n]).text(i + "x" + n), he >= n && fe >= i && (he - n - a < 0 && (a = he - n), fe - i - o < 0 && (o = fe - i), J.val(a), G.val(o), Y.val(n), Q.val(i), Le.updateView(), nt()) }), ot.children("span.elfinder-resize-preset").each(function () { var t = e(this), n = t.data("s")[0], i = t.data("s")[1]; t[he >= n && fe >= i ? "show" : "hide"]() }), Oe(), $[f]("enable"), F.find("input,select").prop("disabled", !1).filter(":text").on("keydown", function (n) { var i; if (n.keyCode == e.ui.keyCode.ENTER) return n.stopPropagation(), n.preventDefault(), i = { title: e("input:checked", $).val(), text: "confirmReq", accept: { label: "btnApply", callback: function () { Xe() } }, cancel: { label: "btnCancel", callback: function () { e(this).trigger("focus") } } }, rt && (i.buttons = [{ label: "btnSaveAs", callback: function () { requestAnimationFrame(Je) } }]), void t.confirm(i) }).on("keyup", function () { var t = e(this); t.hasClass("elfinder-resize-bg") || requestAnimationFrame(function () { t.val(t.val().replace(/[^0-9]/g, "")) }) }).filter(":first"), Ae(), !t.UA.Mobile && K.trigger("focus"), Be()) }, De = e("<img/>").on("load", Fe).on("error", function () { U.html(t.i18n("ntfsmth")).css("background", "transparent") }), Ue = e("<div></div>"), Pe = e("<img/>"), qe = e("<div></div>"), Re = e('<img class="elfinder-resize-imgrotate" />'), He = function (e, t) { return e = ke ? 8 * Math.round(e / 8) : Math.round(e), e = Math.max(0, e), t && e > t && (e = ke ? 8 * Math.floor(t / 8) : t), e }, _e = function () { K.val(he), X.val(fe), Ne.updateView(he, fe), J.val(0), G.val(0), Y.val(he), Q.val(fe), Le.updateView(), nt() }, Ne = { update: function () { K.val(He(De.width() / ue)), X.val(He(De.height() / ue)), nt() }, updateView: function (e, t) { e > ve || t > be ? e / ve > t / be ? (ue = ve / e, De.width(ve).height(He(t * ue))) : (ue = be / t, De.height(be).width(He(e * ue))) : De.width(He(e)).height(He(t)), ue = De.width() / e, W.text("1 : " + (1 / ue).toFixed(2)), Ne.updateHandle() }, updateHandle: function () { P.width(De.width()).height(De.height()) }, fixHeight: function () { var e, t; me && (e = K.val(), t = He(e / pe), Ne.updateView(e, t), X.val(t)) } }, Le = { update: function (e) { J.val(He((q.data("x") || q.position().left) / ue, he)), G.val(He((q.data("y") || q.position().top) / ue, fe)), "xy" !== e && (Y.val(He((q.data("w") || q.width()) / ue, he - J.val())), Q.val(He((q.data("h") || q.height()) / ue, fe - G.val()))), nt() }, updateView: function (e) { var t, n, i, a, o; J.val(He(J.val(), he - (ke ? 8 : 1))), G.val(He(G.val(), fe - (ke ? 8 : 1))), Y.val(He(Y.val(), he - J.val())), Q.val(He(Q.val(), fe - G.val())), ge && (t = qe.width() / qe.height(), "w" === e ? Q.val(He(parseInt(Y.val()) / t)) : "h" === e && Y.val(He(parseInt(Q.val()) * t))), n = Math.round(parseInt(J.val()) * ue), i = Math.round(parseInt(G.val()) * ue), "xy" !== e ? (a = Math.round(parseInt(Y.val()) * ue), o = Math.round(parseInt(Q.val()) * ue)) : (a = q.data("w"), o = q.data("h")), q.data({ x: n, y: i, w: a, h: o }).width(a).height(o).css({ left: n, top: i }), qe.width(a).height(o) }, resize_update: function (e, t) { q.data({ x: t.position.left, y: t.position.top, w: t.size.width, h: t.size.height }), Le.update(), Le.updateView() }, drag_update: function (e, t) { q.data({ x: t.position.left, y: t.position.top }), Le.update("xy") } }, We = { mouseStartAngle: 0, imageStartAngle: 0, imageBeingRotated: !1, setQuality: function () { _.children("div.elfinder-resize-quality")[n > 0 && ee.val() % 90 == 0 ? "hide" : "show"]() }, update: function (e, n) { void 0 === e && (xe = e = parseInt(ee.val())), void 0 === n && (n = !0), !n || t.UA.Opera || t.UA.ltIE8 ? Re.rotate(e) : Re.animate({ rotate: e + "deg" }), (e %= 360) < 0 && (e += 360), ee.val(parseInt(e)), te.slider("value", ee.val()), We.setQuality() }, execute: function (e) { if (We.imageBeingRotated) { var t = We.getCenter(Re), n = e.originalEvent.touches ? e.originalEvent.touches[0] : e, i = n.pageX - t[0], a = n.pageY - t[1], o = Math.atan2(a, i) - We.mouseStartAngle + We.imageStartAngle; return o = Math.round(180 * parseFloat(o) / Math.PI), e.shiftKey && (o = 15 * Math.round((o + 6) / 15)), Re.rotate(o), (o %= 360) < 0 && (o += 360), ee.val(o), te.slider("value", ee.val()), We.setQuality(), !1 } }, start: function (t) { if (!Re.hasClass("elfinder-resize-picking")) { M(), We.imageBeingRotated = !0; var n = We.getCenter(Re), i = t.originalEvent.touches ? t.originalEvent.touches[0] : t, a = i.pageX - n[0], o = i.pageY - n[1]; return We.mouseStartAngle = Math.atan2(o, a), We.imageStartAngle = parseFloat(Re.rotate()) * Math.PI / 180, e(document).on("mousemove", We.execute), Re.on("touchmove", We.execute), !1 } }, stop: function (t) { if (We.imageBeingRotated) return e(document).off("mousemove", We.execute), Re.off("touchmove", We.execute), requestAnimationFrame(function () { We.imageBeingRotated = !1 }), E(), !1 }, getCenter: function (e) { var t = Re.rotate(); Re.rotate(0); var n = Re.offset(), i = n.left + Re.width() / 2, a = n.top + Re.height() / 2; return Re.rotate(t), Array(i, a) } }, Be = function (e) { e ? (P.filter(":ui-resizable").resizable("destroy"), P.hide()) : (P.show(), P.resizable({ alsoResize: De, aspectRatio: me, resize: Ne.update, start: M, stop: function (e) { Ne.fixHeight, Ne.updateView(K.val(), X.val()), E() } }), it()) }, $e = function (e) { e ? (q.filter(":ui-resizable").resizable("destroy").filter(":ui-draggable").draggable("destroy"), Ue.hide()) : (Ue.show(), q.resizable({ containment: Ue, aspectRatio: ge, resize: Le.resize_update, start: M, stop: E, handles: "all" }).draggable({ handle: qe, containment: Pe, drag: Le.drag_update, start: M, stop: function () { Le.updateView("xy"), E() } }), it(), Le.update()) }, Ve = function (e) { e ? Re.hide() : (Re.show(), it()) }, Ke = function () { var e, n, i, a, o, l, c = ""; if ("resize" == V) e = parseInt(K.val()) || 0, n = parseInt(X.val()) || 0; else if ("crop" == V) e = parseInt(Y.val()) || 0, n = parseInt(Q.val()) || 0, i = parseInt(J.val()) || 0, a = parseInt(G.val()) || 0; else if ("rotate" == V) { if (e = he, n = fe, (o = parseInt(ee.val()) || 0) < 0 || o > 360) return t.error("Invalid rotate degree"), !1; if (0 == o || 360 == o) return t.error("errResizeNoChange"), !1; c = ce.val() } if (l = Z ? parseInt(Z.val()) : 0, "rotate" != V) { if (e <= 0 || n <= 0) return t.error("Invalid image size"), !1; if (e == he && n == fe && parseInt(r / 1e3) === parseInt(s / 1e3)) return t.error("errResizeNoChange"), !1 } return { w: e, h: n, x: i, y: a, d: o, q: l, b: c } }, Xe = function () { var e; (e = Ke()) && (T.elfinderdialog("close"), l.resizeRequest({ target: i.hash, width: e.w, height: e.h, x: e.x, y: e.y, degree: e.d, quality: e.q, bg: e.b, mode: V }, i, d)) }, Je = function () { var n, a = function () { n.addClass(v).fadeIn(function () { x.addClass("elfinder-dialog-active") }), t.disable() }, o = function () { l.mime = i.mime, l.prefix = i.name.replace(/ \d+(\.[^.]+)?$/, "$1"), l.requestCmd = "mkfile", l.nextAction = {}, l.data = { target: i.phash }, e.proxy(t.res("mixin", "make"), l)().done(function (o) { var r, s; o.added && o.added.length ? (r = o.added[0].hash, s = t.api < 2.1032 ? t.url(i.hash, { async: !0, temporary: !0 }) : null, e.when(s).done(function (e) { t.request({ options: { type: "post" }, data: { cmd: "put", target: r, encoding: s ? "scheme" : "hash", content: s ? t.convAbsUrl(e) : i.hash }, notify: { type: "copy", cnt: 1 }, syncOnFail: !0 }).fail(a).done(function (e) { e = t.normalize(e), t.updateCache(e), i = t.file(r), e.changed && e.changed.length && t.change(e), x.show().find(".elfinder-dialog-title").html(t.escape(i.name)), Xe(), n.fadeIn() }) }).fail(a)) : a() }).fail(a).always(function () { delete l.mime, delete l.prefix, delete l.nextAction, delete l.data }), t.trigger("unselectfiles", { files: [i.hash] }) }, r = null; Ke() && (n = h.children("." + l.dialogClass + ":visible").removeClass(v).fadeOut(), x.removeClass("elfinder-dialog-active"), t.enable(), t.searchStatus.state < 2 && i.phash !== t.cwd().hash && (r = t.exec("open", [i.phash], { thash: i.phash })), e.when([r]).done(function () { r ? t.one("cwdrender", o) : o() }).fail(a)) }, Ge = {}, Ye = "elfinder-resize-handle-hline", Qe = "elfinder-resize-handle-vline", Ze = "elfinder-resize-handle-point", et = o, tt = Z ? e("<img>").attr("crossorigin", t.isCORS ? "use-credentials" : "").attr("src", et).on("load", function () { try { var e = document.createElement("canvas"); tt.data("canvas", e).data("ctx", e.getContext("2d")), nt() } catch (e) { tt.removeData("canvas").removeData("ctx") } }) : null, nt = function () { F.find("input.elfinder-resize-quality:visible").trigger("change") }, it = function (n) { if (!x.hasClass("elfinder-dialog-minimized") && !x.is(":hidden")) { at.hide(), ot.hide(); var i, a, o, r = t.options.dialogContained ? h : e(window), s = r.height(), l = r.width(), c = "auto", d = !0; x.width(Math.min(650, l - 30)), D.attr("style", ""), he && fe && (ve = D.width() - (P.outerWidth() - P.width()), be = D.height() - (P.outerHeight() - P.height()), Ne.updateView(he, fe)), a = T.find("div.elfinder-resize-control").width(), (o = D.width()) > (i = T.width() - 20) ? (D.width(i), d = !1) : i - o < a && (l > s ? D.width(i - a - 20) : (D.css({ float: "none", marginLeft: "auto", marginRight: "auto" }), d = !1)), d && (c = a), ve = D.width() - (P.outerWidth() - P.width()), h.hasClass("elfinder-fullscreen") ? x.height() > s && (s -= 2, D.height(s - x.height() + D.height()), x.css("top", 0 - h.offset().top)) : (s -= 30, D.height() > s && D.height(s)), be = D.height() - (P.outerHeight() - P.height()), he && fe && Oe(), De.height() && D.height() > De.height() + 20 && (D.height(De.height() + 20), be = D.height() - (P.outerHeight() - P.height()), je()), at.css("width", c).show(), ot.css("width", c).show(), ot.children("span.elfinder-resize-preset:visible").length || ot.hide(), T.elfinderdialog("posInit") } }, at = (C = e('<fieldset class="elfinder-resize-preset-container">').append(e("<legend>").html(t.i18n("presets"))).css("box-sizing", "border-box").hide(), e.each(g, function (t, n) { 2 === n.length && (k = !0, C.append(e('<span class="elfinder-resize-preset"></span>').data("s", n).text(n[0] + "x" + n[1]).button())) }), k ? C : e()), ot = at.clone(!0), rt = t.uploadMimeCheck(i.mime, i.phash); r = s = i.size, R.append(e(j).append(e(O).text(t.i18n("width")), K), e(j).append(e(O).text(t.i18n("height")), X, e('<div class="elfinder-resize-whctrls">').append(Ce, B)), Z ? e(j).append(e(O).text(t.i18n("quality")), Z, e("<span></span>")) : e(), z ? e(j).append(e(O).text(t.i18n("8pxgrid")).addClass("elfinder-resize-grid8"), Te) : e(), e(j).append(e(O).text(t.i18n("scale")), W), e(j).append(at)), p && (H.append(e(j).append(e(O).text("X"), J), e(j).append(e(O).text("Y")).append(G), e(j).append(e(O).text(t.i18n("width")), Y), e(j).append(e(O).text(t.i18n("height")), Q, e('<div class="elfinder-resize-whctrls">').append(ze, B.clone(!0))), Z ? e(j).append(e(O).text(t.i18n("quality")), Z.clone(!0), e("<span></span>")) : e(), z ? e(j).append(e(O).text(t.i18n("8pxgrid")).addClass("elfinder-resize-grid8")) : e(), e(j).append(ot)), _.append(e(j).addClass("elfinder-resize-degree").append(e(O).text(t.i18n("rotate")), ee, e("<span></span>").text(t.i18n("degree")), e("<div></div>").append(N, L)[f]()), e(j).css("height", "20px").append(te), Z ? e(j)[n < 1 ? "show" : "hide"]().addClass("elfinder-resize-quality").append(e(O).text(t.i18n("quality")), Z.clone(!0), e("<span></span>")) : e(), e(j).append(e(O).text(t.i18n("bgcolor")), ce, se, le), e(j).css("height", "20px").append(de)), N.on("click", function () { xe -= 90, We.update(xe) }), L.on("click", function () { xe += 90, We.update(xe) })), T.append($).on("resize", function (e) { e.stopPropagation() }), p ? F.append(R, H.hide(), _.hide()) : F.append(R), P.append('<div class="' + Ye + " " + Ye + '-top"></div>', '<div class="' + Ye + " " + Ye + '-bottom"></div>', '<div class="' + Qe + " " + Qe + '-left"></div>', '<div class="' + Qe + " " + Qe + '-right"></div>', '<div class="' + Ze + " " + Ze + '-e"></div>', '<div class="' + Ze + " " + Ze + '-se"></div>', '<div class="' + Ze + " " + Ze + '-s"></div>'), D.append(U).append(P.hide()).append(De.hide()), p && (q.css("position", "absolute").append('<div class="' + Ye + " " + Ye + '-top"></div>', '<div class="' + Ye + " " + Ye + '-bottom"></div>', '<div class="' + Qe + " " + Qe + '-left"></div>', '<div class="' + Qe + " " + Qe + '-right"></div>', '<div class="' + Ze + " " + Ze + '-n"></div>', '<div class="' + Ze + " " + Ze + '-e"></div>', '<div class="' + Ze + " " + Ze + '-s"></div>', '<div class="' + Ze + " " + Ze + '-w"></div>', '<div class="' + Ze + " " + Ze + '-ne"></div>', '<div class="' + Ze + " " + Ze + '-se"></div>', '<div class="' + Ze + " " + Ze + '-sw"></div>', '<div class="' + Ze + " " + Ze + '-nw"></div>'), D.append(Ue.css("position", "absolute").hide().append(Pe, q.append(qe))), D.append(Re.hide())), D.css("overflow", "hidden"), T.append(D, F), Ge[t.i18n("btnApply")] = Xe, rt && (Ge[t.i18n("btnSaveAs")] = function () { requestAnimationFrame(Je) }), Ge[t.i18n("btnCancel")] = function () { T.elfinderdialog("close") }, T.find("input,button").addClass("elfinder-tabstop"), x = l.fmDialog(T, { title: t.escape(i.name), width: 650, resizable: !1, buttons: Ge, open: function () { var e = function (e) { Ie = t.request({ data: { cmd: "dim", target: i.hash, substitute: a ? 400 : "" }, preventDefault: !0 }).done(function (e) { if (!e.url && n) T.elfinderdialog("close"), t.error(["errOpen", i.name]); else if (e.dim) { var a = e.dim.split("x"); return i.width = a[0], i.height = a[1], Ee(a), e.url && (De.attr("src", e.url), Pe.attr("src", e.url), Re.attr("src", e.url)), Fe() } }) }, n = !{ "image/jpeg": !0, "image/png": !0, "image/gif": !0 }[i.mime], a = !(!t.option("substituteImg", i.hash) || !(n || i.size > u.dimSubImgSize)), r = !(!i.width || !i.height); if (w = x.find(".ui-dialog-titlebar .elfinder-titlebar-minimize").hide(), t.bind("resize", it), De.attr("src", o).one("error.dimreq", function () { e() }), Pe.attr("src", o), Re.attr("src", o), p && (Re.on("mousedown touchstart", We.start).on("touchend", We.stop), x.on("mouseup", We.stop)), r && !a) return Fe(); if (i.size > (u.getDimThreshold || 0)) De.off("error.dimreq"), e(); else if (r) return Fe() }, close: function () { p && (Re.off("mousedown touchstart", We.start).off("touchend", We.stop), e(document).off("mouseup", We.stop)), t.unbind("resize", it), e(this).elfinderdialog("destroy") }, resize: function (e, t) { t && "off" === t.minimize && it() } }).attr("id", a).closest(".ui-dialog").addClass(v), t.UA.ltIE8 && e(".elfinder-dialog").css("filter", ""), qe.css({ opacity: .2, "background-color": "#fff", position: "absolute" }), q.css("cursor", "move"), q.find(".elfinder-resize-handle-point").css({ "background-color": "#fff", opacity: .5, "border-color": "#000" }), p || $.find(".api2").remove(), F.find("input,select").prop("disabled", !0), F.find("input.elfinder-resize-quality").next("span").addClass("elfinder-resize-jpgsize").attr("title", t.i18n("roughFileSize")) }; return c.length && -1 !== c[0].mime.indexOf("image/") ? (a = "resize-" + t.namespace + "-" + c[0].hash, (o = h.find("#" + a)).length ? (o.elfinderdialog("toTop"), d.resolve()) : (t.openUrl(c[0].hash, "sameorigin", function (e) { b(c[0], a, e) }), d)) : d.reject() } }, function (e) { var t = function (e, t) { var n = 0; for (n in t) if (void 0 !== e[t[n]]) return t[n]; return e[t[n]] = "", t[n] }; if (e.cssHooks.rotate = { get: function (t, n, i) { return e(t).rotate() }, set: function (t, n) { return e(t).rotate(n), n } }, e.cssHooks.transform = { get: function (e, n, i) { var a = t(e.style, ["WebkitTransform", "MozTransform", "OTransform", "msTransform", "transform"]); return e.style[a] }, set: function (e, n) { var i = t(e.style, ["WebkitTransform", "MozTransform", "OTransform", "msTransform", "transform"]); return e.style[i] = n, n } }, e.fn.rotate = function (e) { var t; return void 0 === e ? window.opera ? (t = this.css("transform").match(/rotate\((.*?)\)/)) && t[1] ? Math.round(180 * parseFloat(t[1]) / Math.PI) : 0 : (t = this.css("transform").match(/rotate\((.*?)\)/)) && t[1] ? parseInt(t[1]) : 0 : (this.css("transform", this.css("transform").replace(/none|rotate\(.*?\)/, "") + "rotate(" + parseInt(e) + "deg)"), this) }, e.fx.step.rotate = function (t) { 0 == t.state && (t.start = e(t.elem).rotate(), t.now = t.start), e(t.elem).rotate(t.now) }, void 0 === window.addEventListener && void 0 === document.getElementsByClassName) { var n = function (e) { if ("static" == e.currentStyle.position) { var t = function (e) { for (var t = e, n = t.offsetLeft, i = t.offsetTop; t.offsetParent && ((t = t.offsetParent) == document.body || "static" == t.currentStyle.position);)t != document.body && t != document.documentElement && (n -= t.scrollLeft, i -= t.scrollTop), n += t.offsetLeft, i += t.offsetTop; return { x: n, y: i } }(e); e.style.position = "absolute", e.style.left = t.x + "px", e.style.top = t.y + "px" } }, i = e.cssHooks.transform.set; e.cssHooks.transform.set = function (e, t) { return i.apply(this, [e, t]), function (e, t) { var i, a = 1, o = 1, r = 1, s = 1; if (void 0 !== e.style.msTransform) return !0; n(e); var l = (i = t.match(/rotate\((.*?)\)/)) && i[1] ? parseInt(i[1]) : 0; (l %= 360) < 0 && (l = 360 + l); var c = l * Math.PI / 180, d = Math.cos(c), p = Math.sin(c); a *= d, o *= -p, r *= p, s *= d, e.style.filter = (e.style.filter || "").replace(/progid:DXImageTransform\.Microsoft\.Matrix\([^)]*\)/, "") + "progid:DXImageTransform.Microsoft.Matrix(M11=" + a + ",M12=" + o + ",M21=" + r + ",M22=" + s + ",FilterType='bilinear',sizingMethod='auto expand')"; var u = parseInt(e.style.width || e.width || 0), h = parseInt(e.style.height || e.height || 0); c = l * Math.PI / 180; var f = Math.abs(Math.cos(c)), m = Math.abs(Math.sin(c)), g = (u - (u * f + h * m)) / 2, v = (h - (u * m + h * f)) / 2; e.style.marginLeft = Math.floor(g) + "px", e.style.marginTop = Math.floor(v) + "px" }(e, t), t } } }(jQuery), (h.prototype.commands.restore = function () { "use strict"; var t = this, n = this.fm, i = 0, a = function (t) { var o, r = e.Deferred(), s = [], l = [], c = [], d = []; return r._xhrReject = function () { e.each(c, function () { this && this.reject && this.reject() }), o && o._xhrReject() }, e.each(t, function (e, t) { "directory" === t.mime ? s.push(t) : l.push(t) }), s.length ? (e.each(s, function (e, t) { c.push(n.request({ data: { cmd: "open", target: t.hash }, preventDefault: !0, asNotOpen: !0 })), d[e] = t.hash }), e.when.apply(e, c).fail(function () { r.reject() }).done(function () { var t = []; e.each(arguments, function (e, n) { n.files && (n.files.length ? t = t.concat(n.files) : t.push({ hash: "fakefile_" + i++, phash: d[e], mime: "fakefile", name: "fakefile", ts: 0 })) }), n.cache(t), o = a(t).done(function (e) { l = l.concat(e), r.resolve(l) }) })) : r.resolve(l), r }; this.restore = function (t, o, r, s) { var l, c, d, p = {}, u = [], h = !1, f = s || {}, m = +new Date; n.lockfiles({ files: r }), l = e.map(o, function (e) { return "directory" === e.mime ? e.hash : null }), t.done(function () { l && n.exec("rm", l, { forceRm: !0, quiet: !0 }) }).always(function () { n.unlockfiles({ files: r }) }), c = setTimeout(function () { n.notify({ type: "search", id: m, cnt: 1, hideCnt: !0, cancel: function () { d && d._xhrReject(), t.reject() } }) }, n.notifyDelay), i = 0, d = a(o).always(function () { c && clearTimeout(c), n.notify({ type: "search", id: m, cnt: -1, hideCnt: !0 }) }).fail(function () { t.reject("errRestore", "errFileNotFound") }).done(function (i) { var a = ["errRestore", "errFolderNotFound"], o = ""; i.length ? (e.each(i, function (t, i) { for (var a, r, s, l = i.phash; l;) { if (r = n.trashes[l]) { if (!p[r]) { if (h) return u.push(i.hash), null; p[r] = {}, h = !0 } "" === (s = (s = n.path(i.hash).substr(n.path(l).length).replace(/\\/g, "/")).replace(/\/[^\/]+?$/, "")) && (s = "/"), p[r][s] || (p[r][s] = []), "fakefile" === i.mime ? n.updateCache({ removed: [i.hash] }) : p[r][s].push(i.hash), (!o || o.length > s.length) && (o = s); break } (a = n.file(l)) ? l = a.phash : (l = !1, e.each(n.trashes, function (e) { var t = n.file(e), a = n.path(e); if ((!t.volumeid || 0 === i.hash.indexOf(t.volumeid)) && 0 === n.path(i.hash).indexOf(a)) return l = e, !1 })) } }), h ? e.each(p, function (i, s) { var l = Object.keys(s), c = l.length; n.request({ data: { cmd: "mkdir", target: i, dirs: l }, notify: { type: "chkdir", cnt: c }, preventFail: !0 }).fail(function (e) { t.reject(e), n.unlockfiles({ files: r }) }).done(function (i) { var r; (r = i.hashes) ? n.getCommand("paste") ? n.one("mkdirdone", function () { var i = !1; e.each(s, function (e, s) { r[e] && (s.length ? n.file(r[e]) ? (n.clipboard(s, !0), n.exec("paste", [r[e]], { _cmd: "restore", noToast: f.noToast || e !== o }).done(function (e) { e && (e.error || e.warning) && (i = !0) }).fail(function () { i = !0 }).always(function () { --c < 1 && (t[i ? "reject" : "resolve"](), u.length && n.exec("restore", u)) })) : t.reject(a) : --c < 1 && (t.resolve(), u.length && n.exec("restore", u))) }) }) : t.reject(["errRestore", "errCmdNoSupport", "(paste)"]) : t.reject(a) }) }) : t.reject(a)) : (t.reject("errFileNotFound"), l && n.exec("rm", l, { forceRm: !0, quiet: !0 })) }) }, this.linkedCmds = ["copy", "paste", "mkdir", "rm"], this.updateOnSelect = !1, this.init = function () { t = this, n = this.fm }, this.getstate = function (t, i) { return (t = t || n.selected()).length && e.grep(t, function (e) { var t = n.file(e); return !(!t || t.locked || n.isRoot(t)) }).length == t.length ? 0 : -1 }, this.exec = function (i, a) { var o = e.Deferred().fail(function (e) { e && n.error(e) }), r = t.files(i); return r.length ? (e.each(r, function (e, t) { return n.isRoot(t) ? !o.reject(["errRestore", t.name]) : t.locked ? !o.reject(["errLocked", t.name]) : void 0 }), "pending" === o.state() && this.restore(o, r, i, a), o) : o.reject() } }).prototype = { forceLoad: !0 }, h.prototype.commands.rm = function () { "use strict"; var t = this, n = this.fm, i = '<div class="ui-helper-clearfix elfinder-rm-title"><span class="elfinder-cwd-icon {class} ui-corner-all"></span>{title}<div class="elfinder-rm-desc">{desc}</div></div>', a = function (e, t, i) { var a = i ? {} : { type: "rm", cnt: t.length }; n.request({ data: { cmd: "rm", targets: t }, notify: a, preventFail: !0 }).fail(function (t) { e.reject(t) }).done(function (t) { (t.error || t.warning) && (t.sync = !0), e.resolve(t) }).always(function () { n.unlockfiles({ files: t }) }) }, o = function (t) { var i, a = null; return t && t.length && (t.length > 1 && 2 === n.searchStatus.state ? (i = n.file(n.root(t[0])).volumeid, e.grep(t, function (e) { return 0 !== e.indexOf(i) }).length || (a = n.option("trashHash", t[0]))) : a = n.option("trashHash", t[0])), a }, r = !1; this.confirm = function (o, s, l, c, d) { var p, u, h, f, m, g, v = s.length, b = n.cwd().hash, y = [], w = n.i18n("calc") + '<span class="elfinder-spinner"></span>'; v > 1 ? (f = 0, e.each(l, function (e, t) { if (!t.size || "unknown" == t.size || "directory" === t.mime) return f = "unknown", !1; var n = parseInt(t.size); n >= 0 && f >= 0 && (f += n) }), r = "unknown" === f, y.push(n.i18n("size") + ": " + (r ? w : n.formatSize(f))), u = [e(i.replace("{class}", "elfinder-cwd-icon-group").replace("{title}", "<strong>" + n.i18n("items") + ": " + v + "</strong>").replace("{desc}", y.join("<br>")))]) : (m = l[0], h = n.tmb(m), r = "directory" === m.mime, y.push(n.i18n("size") + ": " + (r ? w : n.formatSize(m.size))), y.push(n.i18n("modify") + ": " + n.formatDate(m)), g = n.escape(m.i18 || m.name).replace(/([_.])/g, "&#8203;$1"), u = [e(i.replace("{class}", n.mime2class(m.mime)).replace("{title}", "<strong>" + g + "</strong>").replace("{desc}", y.join("<br>")))]), d && (u = u.concat(d)), u.push(c ? "confirmTrash" : "confirmRm"), p = n.confirm({ title: t.title, text: u, accept: { label: "btnRm", callback: function () { c ? t.toTrash(o, s, c) : a(o, s) } }, cancel: { label: "btnCancel", callback: function () { n.unlockfiles({ files: s }), 1 === s.length && n.file(s[0]).phash !== b ? n.select({ selected: s }) : n.selectfiles({ files: s }), o.reject() } } }), h && e("<img/>").on("load", function () { p.find(".elfinder-cwd-icon").addClass(h.className).css("background-image", "url('" + h.url + "')") }).attr("src", h.url), r && (r = n.getSize(e.map(l, function (e) { return "directory" === e.mime ? e.hash : null })).done(function (e) { p.find("span.elfinder-spinner").parent().html(n.i18n("size") + ": " + e.formated) }).fail(function () { p.find("span.elfinder-spinner").parent().html(n.i18n("size") + ": " + n.i18n("unknown")) }).always(function () { r = !1 })) }, this.toTrash = function (i, a, o) { var r, s, l, c = {}, d = a.length, p = t.options.toTrashMaxItems, u = [], h = e.Deferred(); d > p ? t.confirm(i, a, t.files(a), null, [n.i18n("tooManyToTrash")]) : (e.each(a, function (e, t) { var i = n.file(t), a = n.path(t).replace(/\\/g, "/").match(/^[^\/]+?(\/(?:[^\/]+?\/)*)[^\/]+?$/); i && (a && (a[1] = a[1].replace(/(^\/.*?)\/?$/, "$1"), c[a[1]] || (c[a[1]] = []), c[a[1]].push(t)), "directory" === i.mime && u.push(t)) }), u.length ? (r = n.request({ data: { cmd: "size", targets: u }, notify: { type: "readdir", cnt: 1, hideCnt: !0 }, preventDefault: !0 }).done(function (e) { var t = 0; e.fileCnt && (t += parseInt(e.fileCnt)), e.dirCnt && (t += parseInt(e.dirCnt)), h[t > p ? "reject" : "resolve"]() }).fail(function () { h.reject() }), setTimeout(function () { var e = r && r.xhr ? r.xhr : null; e && "pending" == e.state() && (r.syncOnFail(!1), r.reject(), h.reject()) }, 1e3 * t.options.infoCheckWait)) : h.resolve(), h.done(function () { s = Object.keys(c), (l = s.length) ? n.request({ data: { cmd: "mkdir", target: o, dirs: s }, notify: { type: "chkdir", cnt: l }, preventFail: !0 }).fail(function (e) { i.reject(e), n.unlockfiles({ files: a }) }).done(function (t) { var o, r, s, d, p = ["errTrash"], u = {}, h = function () { return n.ui.notify.children(".elfinder-notify-trash").length }; (o = t.hashes) ? (s = 1 / l * 100, d = 1 === l ? 100 : 5, r = setTimeout(function () { n.notify({ type: "trash", cnt: 1, hideCnt: !0, progress: d }) }, n.notifyDelay), e.each(c, function (t, c) { var f; n.file(c[0]).phash, o[t] && (f = { cmd: "paste", dst: o[t], targets: c, cut: 1 }, n.request({ data: f, preventDefault: !0 }).fail(function (e) { e && (p = p.concat(e)) }).done(function (t) { t = n.normalize(t), n.updateCache(t), function (t, i, o) { var r, s, l, c; e.each(t, function (e, t) { Array.isArray(t) && (u[e] ? u[e] = u[e].concat(t) : u[e] = t) }), t.sync && (u.sync = 1), t.added && t.added.length && (r = function () { var i = [], a = e.map(t.added, function (e) { return "directory" === e.mime ? e.hash : null }); return e.each(t.added, function (t, n) { -1 === e.inArray(n.phash, a) && i.push(n.hash) }), n.exec("restore", i, { noToast: !0 }) }, l = function () { return n.request({ data: o, notify: { type: "redo", cnt: a.length } }) }, u.undo ? (s = u.undo, u.undo = function () { r(), s() }) : u.undo = r, u.redo ? (c = u.redo, u.redo = function () { l(), c() }) : u.redo = l) }(t, 0, f), t.warning && (p = p.concat(t.warning), delete t.warning), t.removed && t.removed.length && n.remove(t), t.added && t.added.length && n.add(t), t.changed && t.changed.length && n.change(t), n.trigger("paste", t), n.trigger("pastedone"), t.sync && n.sync() }).always(function () { var t = [], o = 2; h() ? n.notify({ type: "trash", cnt: 0, hideCnt: !0, progress: s }) : d += s, --l < 1 && (r && clearTimeout(r), h() && n.notify({ type: "trash", cnt: -1 }), n.unlockfiles({ files: a }), Object.keys(u).length ? (p.length > 1 && ((u.removed || u.removed.length) && (t = e.grep(a, function (t) { return -1 === e.inArray(t, u.removed) })), t.length ? (p.length > o && (o = -1 === (n.messages[p[o - 1]] || "").indexOf("$") ? o : o + 1), i.reject(), n.exec("rm", t, { addTexts: p.slice(0, o), forceRm: !0 })) : n.error(p)), u._noSound = !0, u.undo && u.redo && (u.undo = { cmd: "trash", callback: u.undo }, u.redo = { cmd: "trash", callback: u.redo }), i.resolve(u)) : i.reject(p)) })) })) : (i.reject("errFolderNotFound"), n.unlockfiles({ files: a })) }) : (i.reject(["error", "The folder hierarchy to be deleting can not be determined."]), n.unlockfiles({ files: a })) }).fail(function () { t.confirm(i, a, t.files(a), null, [n.i18n("tooManyToTrash")]) })) }, this.remove = a, this.syncTitleOnChange = !0, this.updateOnSelect = !1, this.shortcuts = [{ pattern: "delete ctrl+backspace shift+delete" }], this.value = "rm", this.init = function () { t = this, n = this.fm, t.change(function () { var i; delete t.extra, t.title = n.i18n("cmd" + t.value), t.className = t.value, t.button && t.button.children("span.elfinder-button-icon")["trash" === t.value ? "addClass" : "removeClass"]("elfinder-button-icon-trash"), "trash" === t.value && (t.extra = { icon: "rm", node: e("<span></span>").attr({ title: n.i18n("cmdrm") }).on("ready", function (e, t) { i = t.targets }).on("click touchstart", function (e) { "touchstart" === e.type && e.originalEvent.touches.length > 1 || (e.stopPropagation(), e.preventDefault(), n.getUI().trigger("click"), n.exec("rm", i, { _userAction: !0, forceRm: !0 })) }) }) }) }, this.getstate = function (t) { var i = this.hashes(t); return i.length && e.grep(i, function (e) { var t = n.file(e); return !(!t || t.locked || n.isRoot(t)) }).length == i.length ? 0 : -1 }, this.exec = function (i, s) { var l, c = s || {}, d = e.Deferred().always(function () { r && r.state && "pending" === r.state() && r.reject() }).fail(function (e) { e && n.error(e) }).done(function (e) { !c.quiet && !e._noSound && e.removed && e.removed.length && n.trigger("playsound", { soundFile: "rm.wav" }) }), p = t.files(i), u = p.length, h = null, f = c.addTexts ? c.addTexts : null, m = c.forceRm, g = c.quiet; return u ? (e.each(p, function (e, t) { return n.isRoot(t) ? !d.reject(["errRm", t.name, "errPerm"]) : t.locked ? !d.reject(["errLocked", t.name]) : void 0 }), "pending" === d.state() && (l = t.hashes(i), u = p.length, (m || t.event && t.event.originalEvent && t.event.originalEvent.shiftKey) && (h = "", t.title = n.i18n("cmdrm")), null === h && (h = o(l)), n.lockfiles({ files: l }), h && t.options.quickTrash ? t.toTrash(d, l, h) : g ? a(d, l, g) : t.confirm(d, l, p, h, f)), d) : d.reject() }, n.bind("select contextmenucreate closecontextmenu", function (e) { var i = (e.data ? e.data.selected || e.data.targets : null) || n.selected(); i && i.length && t.update(void 0, (i ? o(i) : n.option("trashHash")) ? "trash" : "rm") }) }, h.prototype.commands.search = function () { "use strict"; this.title = "Find files", this.options = { ui: "searchbutton" }, this.alwaysEnabled = !0, this.updateOnSelect = !1, this.getstate = function () { return 0 }, this.exec = function (t, n, i, a) { var o, r, s = this.fm, l = [], c = a || "", d = s.options.onlyMimes, p = [], u = function (e) { return c && "SearchName" !== c && "SearchMime" !== c && (e.type = c), e }; return "string" == typeof t && t ? ("object" == typeof n && (i = n.mime || "", n = n.target || ""), n = n || "", i ? (i = e.trim(i).replace(",", " ").split(" "), d.length && (i = e.map(i, function (t) { return (t = e.trim(t)) && (-1 !== e.inArray(t, d) || e.grep(d, function (e) { return 0 === t.indexOf(e) }).length) ? t : null }))) : i = [].concat(d), s.trigger("searchstart", u({ query: t, target: n, mimes: i })), !d.length || i.length ? "" === n && s.api >= 2.1 ? (r = Object.keys(s.roots).length, e.each(s.roots, function (e, n) { l.push(s.request({ data: u({ cmd: "search", q: t, target: n, mimes: i }), notify: { type: "search", cnt: 1, hideCnt: !(r > 1) }, cancel: !0, preventDone: !0 })) })) : (l.push(s.request({ data: u({ cmd: "search", q: t, target: n, mimes: i }), notify: { type: "search", cnt: 1, hideCnt: !0 }, cancel: !0, preventDone: !0 })), "" !== n && s.api >= 2.1 && Object.keys(s.leafRoots).length && e.each(s.leafRoots, function (a, r) { for (o = a; o;)n === o && e.each(r, function () { var e = s.file(this); e && e.volumeid && p.push(e.volumeid), l.push(s.request({ data: u({ cmd: "search", q: t, target: this, mimes: i }), notify: { type: "search", cnt: 1, hideCnt: !1 }, cancel: !0, preventDone: !0 })) }), o = (s.file(o) || {}).phash })) : l = [e.Deferred().resolve({ files: [] })], s.searchStatus.mixed = l.length > 1 && p, e.when.apply(e, l).done(function (e) { var t, n = arguments.length; if (e.warning && s.error(e.warning), n > 1) for (e.files = e.files || [], t = 1; t < n; t++)arguments[t].warning && s.error(arguments[t].warning), arguments[t].files && e.files.push.apply(e.files, arguments[t].files); e.files && e.files.length && s.cache(e.files), s.lazy(function () { s.trigger("search", e) }).then(function () { return s.lazy(function () { s.trigger("searchdone") }) }).then(function () { e.sync && s.sync() }) })) : (s.getUI("toolbar").find("." + s.res("class", "searchbtn") + " :text").trigger("focus"), e.Deferred().reject()) } }, h.prototype.commands.selectall = function () { "use strict"; var t = 0; this.fm.bind("select", function (e) { t = e.data && e.data.selectall ? -1 : 0 }), this.state = 0, this.updateOnSelect = !1, this.getstate = function () { return t }, this.exec = function () { return e(document).trigger(e.Event("keydown", { keyCode: 65, ctrlKey: !0, shiftKey: !1, altKey: !1, metaKey: !1 })), e.Deferred().resolve() } }, h.prototype.commands.selectinvert = function () { "use strict"; this.updateOnSelect = !1, this.getstate = function () { return 0 }, this.exec = function () { return e(document).trigger(e.Event("keydown", { keyCode: 73, ctrlKey: !0, shiftKey: !0, altKey: !1, metaKey: !1 })), e.Deferred().resolve() } }, h.prototype.commands.selectnone = function () { "use strict"; var t = this.fm, n = -1; t.bind("select", function (e) { n = e.data && e.data.unselectall ? -1 : 0 }), this.state = -1, this.updateOnSelect = !1, this.getstate = function () { return n }, this.exec = function () { return t.getUI("cwd").trigger("unselectall"), e.Deferred().resolve() } }, h.prototype.commands.sort = function () { "use strict"; var t = this, n = t.fm, i = function () { t.variants = [], e.each(n.sortRules, function (e, i) { if (n.sorters[e]) { var a = e === n.sortType ? "asc" === n.sortOrder ? "n" : "s" : ""; t.variants.push([e, (a ? '<span class="ui-icon ui-icon-arrowthick-1-' + a + '"></span>' : "") + "&nbsp;" + n.i18n("sort" + e)]) } }), t.variants.push("|"), t.variants.push(["stick", (n.sortStickFolders ? '<span class="ui-icon ui-icon-check"></span>' : "") + "&nbsp;" + n.i18n("sortFoldersFirst")]), n.ui.tree && null !== n.options.sortAlsoTreeview && (t.variants.push("|"), t.variants.push(["tree", (n.sortAlsoTreeview ? '<span class="ui-icon ui-icon-check"></span>' : "") + "&nbsp;" + n.i18n("sortAlsoTreeview")])), a() }, a = function () { var t, i = n.getUI("contextmenu"); i.is(":visible") && ((t = i.find("span.elfinder-button-icon-sort").siblings("div.elfinder-contextmenu-sub")).find("span.ui-icon").remove(), t.children("div.elfinder-contextsubmenu-item").each(function () { var t, i = e(this).children("span"), a = i.text().trim(); a === (o.stick || (o.stick = n.i18n("sortFoldersFirst"))) ? n.sortStickFolders && i.prepend('<span class="ui-icon ui-icon-check"></span>') : a === (o.tree || (o.tree = n.i18n("sortAlsoTreeview"))) ? n.sortAlsoTreeview && i.prepend('<span class="ui-icon ui-icon-check"></span>') : a === (o[n.sortType] || (o[n.sortType] = n.i18n("sort" + n.sortType))) && (t = "asc" === n.sortOrder ? "n" : "s", i.prepend('<span class="ui-icon ui-icon-arrowthick-1-' + t + '"></span>')) })) }, o = {}; this.options = { ui: "sortbutton" }, this.keepContextmenu = !0, n.bind("sortchange", i).bind("sorterupdate", function () { i(), n.getUI().children(".elfinder-button-sort-menu").children(".elfinder-button-menu-item").each(function () { var t = e(this), i = t.attr("rel"); t.toggle(!(i && !n.sorters[i])) }) }).bind("cwdrender", function () { var t = e(n.cwd).find("div.elfinder-cwd-wrapper-list table"); t.length && e.each(n.sortRules, function (i, a) { var o = t.find("thead tr td.elfinder-cwd-view-th-" + i); if (o.length) { var r, s = i == n.sortType, l = { type: i, order: s ? "asc" == n.sortOrder ? "desc" : "asc" : n.sortOrder }; s && (o.addClass("ui-state-active"), r = "asc" == n.sortOrder ? "n" : "s", e('<span class="ui-icon ui-icon-triangle-1-' + r + '"></span>').appendTo(o)), e(o).on("click", function (t) { e(this).data("dragging") || (t.stopPropagation(), n.getUI("cwd").data("longtap") || n.exec("sort", [], l)) }).on("mouseenter mouseleave", function (t) { e(this).toggleClass("ui-state-hover", "mouseenter" === t.type) }) } }) }), this.getstate = function () { return 0 }, this.exec = function (t, n) { var i, a = this.fm, o = e.isPlainObject(n) ? n : (i = {}, "stick" == (n += "") ? i.stick = !a.sortStickFolders : "tree" === n ? i.tree = !a.sortAlsoTreeview : a.sorters[n] && (a.sortType === n ? i.order = "asc" === a.sortOrder ? "desc" : "asc" : i.type = n), i), r = Object.assign({ type: a.sortType, order: a.sortOrder, stick: a.sortStickFolders, tree: a.sortAlsoTreeview }, o); return a.lazy(function () { a.setSort(r.type, r.order, r.stick, r.tree), this.resolve() }) } }, h.prototype.commands.undo = function () { "use strict"; var t = this, n = this.fm, i = function (e) { e ? (t.title = n.i18n("cmdundo") + " " + n.i18n("cmd" + e.cmd), t.state = 0) : (t.title = n.i18n("cmdundo"), t.state = -1), t.change() }, a = []; this.alwaysEnabled = !0, this.updateOnSelect = !1, this.shortcuts = [{ pattern: "ctrl+z" }], this.syncTitleOnChange = !0, this.getstate = function () { return a.length ? 0 : -1 }, this.setUndo = function (t, o) { var r = {}; t && e.isPlainObject(t) && t.cmd && t.callback && (Object.assign(r, t), o ? (delete o.undo, r.redo = o) : n.getCommand("redo").setRedo(null), a.push(r), i(r)) }, this.exec = function () { var t, o, r = n.getCommand("redo"), s = e.Deferred(), l = {}; return a.length ? ((t = a.pop()).redo ? (Object.assign(l, t.redo), delete t.redo) : l = null, s.done(function () { l && r.setRedo(l, t) }), i(a.length ? a[a.length - 1] : void 0), (o = t.callback()) && o.done ? o.done(function () { s.resolve() }).fail(function () { s.reject() }) : s.resolve(), a.length ? this.update(0, a[a.length - 1].name) : this.update(-1, "")) : s.reject(), s }, n.bind("exec", function (e) { var n = e.data || {}; n.opts && n.opts._userAction && n.dfrd && n.dfrd.done && n.dfrd.done(function (e) { e && e.undo && e.redo && (e.undo.redo = e.redo, t.setUndo(e.undo)) }) }) }, h.prototype.commands.redo = function () { "use strict"; var t = this, n = this.fm, i = function (e) { e && e.callback ? (t.title = n.i18n("cmdredo") + " " + n.i18n("cmd" + e.cmd), t.state = 0) : (t.title = n.i18n("cmdredo"), t.state = -1), t.change() }, a = []; this.alwaysEnabled = !0, this.updateOnSelect = !1, this.shortcuts = [{ pattern: "shift+ctrl+z ctrl+y" }], this.syncTitleOnChange = !0, this.getstate = function () { return a.length ? 0 : -1 }, this.setRedo = function (e, t) { null === e ? (a = [], i()) : e && e.cmd && e.callback && (t && (e.undo = t), a.push(e), i(e)) }, this.exec = function () { var t, o, r = n.getCommand("undo"), s = e.Deferred(), l = {}, c = {}; return a.length ? ((t = a.pop()).undo && (Object.assign(l, t.undo), Object.assign(c, t), delete c.undo, s.done(function () { r.setUndo(l, c) })), i(a.length ? a[a.length - 1] : void 0), (o = t.callback()) && o.done ? o.done(function () { s.resolve() }).fail(function () { s.reject() }) : s.resolve(), s) : s.reject() } }, (h.prototype.commands.up = function () { "use strict"; this.alwaysEnabled = !0, this.updateOnSelect = !1, this.shortcuts = [{ pattern: "ctrl+up" }], this.getstate = function () { return this.fm.cwd().phash ? 0 : -1 }, this.exec = function () { var t = this.fm, n = t.cwd().hash; return this.fm.cwd().phash ? this.fm.exec("open", this.fm.cwd().phash).done(function () { t.one("opendone", function () { t.selectfiles({ files: [n] }) }) }) : e.Deferred().reject() } }).prototype = { forceLoad: !0 }, h.prototype.commands.upload = function () { "use strict"; var t = this.fm.res("class", "hover"); this.disableOnSearch = !0, this.updateOnSelect = !1, this.shortcuts = [{ pattern: "ctrl+u" }], this.getstate = function (e) { var t, n = this.fm, i = e || [n.cwd().hash]; return this._disabled || 1 != i.length || (t = n.file(i[0])), t && "directory" == t.mime && t.write ? 0 : -1 }, this.exec = function (n) { var i, a, o, r, s, l, c, d, p = this.fm, u = p.cwd().hash, h = (c = n && n instanceof Array ? n : null, (!n || n instanceof Array) && (c || 1 !== (l = p.selected()).length || "directory" !== p.file(l[0]).mime ? c && 1 === c.length && "directory" === p.file(c[0]).mime || (c = [u]) : c = l), c), f = h ? h[0] : n && n.target ? n.target : null, m = f ? p.file(f) : p.cwd(), g = function (t) { p.upload(t).fail(function (e) { w.reject(e) }).done(function (t) { var n; p.getUI("cwd"); if (w.resolve(t), t && t.added && t.added[0] && !p.ui.notify.children(".elfinder-notify-upload").length) { var i = p.findCwdNodes(t.added); i.length ? i.trigger("scrolltoview") : (m.hash !== u ? n = e("<div></div>").append(e('<button type="button" class="ui-button ui-widget ui-state-default ui-corner-all elfinder-tabstop"><span class="ui-button-text">' + p.i18n("cmdopendir") + "</span></button>").on("mouseenter mouseleave", function (t) { e(this).toggleClass("ui-state-hover", "mouseenter" == t.type) }).on("click", function () { p.exec("open", f).done(function () { p.one("opendone", function () { p.trigger("selectfiles", { files: e.map(t.added, function (e) { return e.hash }) }) }) }) })) : p.trigger("selectfiles", { files: e.map(t.added, function (e) { return e.hash }) }), p.toast({ msg: p.i18n(["complete", p.i18n("cmdupload")]), extNode: n })) } }).progress(function () { w.notifyWith(this, Array.from(arguments)) }) }, v = function (e) { i.elfinderdialog("close"), h && (e.target = h[0]), g(e) }, b = function () { var t = m.hash, n = e.map(p.files(t), function (e) { return "directory" === e.mime && e.write ? e : null }); return n.length ? e('<div class="elfinder-upload-dirselect elfinder-tabstop" title="' + p.i18n("folders") + '"></div>').on("click", function (t) { t.stopPropagation(), t.preventDefault(), n = p.sortFiles(n); var a = e(this), o = (p.cwd(), i.closest("div.ui-dialog")), r = function (e, t) { return { label: p.escape(e.i18 || e.name), icon: t, remain: !1, callback: function () { var t = o.children(".ui-dialog-titlebar:first").find("span.elfinder-upload-target"); h = [e.hash], t.html(" - " + p.escape(e.i18 || e.name)), a.trigger("focus") }, options: { className: h && h.length && e.hash === h[0] ? "ui-state-active" : "", iconClass: e.csscls || "", iconImg: e.icon || "" } } }, s = [r(m, "opendir"), "|"]; e.each(n, function (e, t) { s.push(r(t, "dir")) }), a.trigger("blur"), p.trigger("contextmenu", { raw: s, x: t.pageX || e(this).offset().left, y: t.pageY || e(this).offset().top, prevNode: o, fitHeight: !0 }) }).append('<span class="elfinder-button-icon elfinder-button-icon-dir" ></span>') : e() }, y = function (n, i) { var a = e('<input type="file" ' + n + "/>").on("click", function () { p.UA.IE && setTimeout(function () { o.css("display", "none").css("position", "relative"), requestAnimationFrame(function () { o.css("display", "").css("position", "") }) }, 100) }).on("change", function () { v({ input: a.get(0), type: "files" }) }).on("dragover", function (e) { e.originalEvent.dataTransfer.dropEffect = "copy" }), o = e("<form></form>").append(a).on("click", function (e) { e.stopPropagation() }); return e('<div class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only elfinder-tabstop elfinder-focus"><span class="ui-button-text">' + p.i18n(i) + "</span></div>").append(o).on("click", function (e) { e.stopPropagation(), e.preventDefault(), a.trigger("click") }).on("mouseenter mouseleave", function (n) { e(this).toggleClass(t, "mouseenter" === n.type) }) }, w = e.Deferred(); return a = function (t) { t.stopPropagation(), t.preventDefault(); var n, i = !1, a = "", o = null, r = "", s = null, l = t._target || null, c = t.dataTransfer || null, d = c.items && c.items.length && c.items[0].kind ? c.items[0].kind : ""; if (c) { try { if ((o = c.getData("elfinderfrom")) && (r = window.location.href + p.cwd().hash, !l && o === r || l === r)) return void w.reject() } catch (t) { } if ("file" === d && (c.items[0].getAsEntry || c.items[0].webkitGetAsEntry)) i = c, a = "data"; else if ("string" !== d && c.files && c.files.length && -1 === e.inArray("Text", c.types)) i = c.files, a = "files"; else { try { (s = c.getData("text/html")) && s.match(/<(?:img|a)/i) && (i = [s], a = "html") } catch (t) { } i || ((s = c.getData("text")) ? (i = [s], a = "text") : c && c.files && (d = "file")) } } i ? g({ files: i, type: a, target: l, dropEvt: t }) : (n = ["errUploadNoFiles"], "file" === d && n.push("errFolderUpload"), p.error(n), w.reject()) }, !h && n ? (n.input || n.files ? (n.type = "files", g(n)) : n.dropEvt && a(n.dropEvt), w) : (o = function (t) { var n, i = t.originalEvent || t, a = [], o = []; if (i.clipboardData) { if (i.clipboardData.items && i.clipboardData.items.length) { o = i.clipboardData.items; for (var r = 0; r < o.length; r++)"file" == i.clipboardData.items[r].kind && (n = i.clipboardData.items[r].getAsFile(), a.push(n)) } else i.clipboardData.files && i.clipboardData.files.length && (a = i.clipboardData.files); if (a.length) return void v({ files: a, type: "files", clipdata: !0 }) } var s = i.target || i.srcElement; requestAnimationFrame(function () { var t, n = "text"; s.innerHTML && (e(s).find("img").each(function (t, n) { n.src.match(/^webkit-fake-url:\/\//) && e(n).remove() }), e(s).find("a,img").length && (n = "html"), t = s.innerHTML, s.innerHTML = "", v({ files: [t], type: n })) }) }, i = e('<div class="elfinder-upload-dialog-wrapper"></div>').append(y("multiple", "selectForUpload")), p.UA.Mobile || void 0 === (d = document.createElement("input")).webkitdirectory && void 0 === d.directory || i.append(y("multiple webkitdirectory directory", "selectFolder")), m.dirs && (m.hash === u || p.navHash2Elm(m.hash).hasClass("elfinder-subtree-loaded") ? b().appendTo(i) : (r = e('<div class="elfinder-upload-dirselect" title="' + p.i18n("nowLoading") + '"></div>').append('<span class="elfinder-button-icon elfinder-button-icon-spinner" ></span>').appendTo(i), p.request({ cmd: "tree", target: m.hash }).done(function () { p.one("treedone", function () { r.replaceWith(b()), s.elfinderdialog("tabstopsInit") }) }).fail(function () { r.remove() }))), p.dragUpload ? e('<div class="ui-corner-all elfinder-upload-dropbox elfinder-tabstop" contenteditable="true" data-ph="' + p.i18n("dropPasteFiles") + '"></div>').on("paste", function (e) { o(e) }).on("mousedown click", function () { e(this).trigger("focus") }).on("focus", function () { this.innerHTML = "" }).on("mouseover", function () { e(this).addClass(t) }).on("mouseout", function () { e(this).removeClass(t) }).on("dragenter", function (n) { n.stopPropagation(), n.preventDefault(), e(this).addClass(t) }).on("dragleave", function (n) { n.stopPropagation(), n.preventDefault(), e(this).removeClass(t) }).on("dragover", function (n) { n.stopPropagation(), n.preventDefault(), n.originalEvent.dataTransfer.dropEffect = "copy", e(this).addClass(t) }).on("drop", function (e) { i.elfinderdialog("close"), h && (e.originalEvent._target = h[0]), a(e.originalEvent) }).prependTo(i).after('<div class="elfinder-upload-dialog-or">' + p.i18n("or") + "</div>")[0] : e('<div class="ui-corner-all elfinder-upload-dropbox" contenteditable="true">' + p.i18n("dropFilesBrowser") + "</div>").on("paste drop", function (e) { o(e) }).on("mousedown click", function () { e(this).trigger("focus") }).on("focus", function () { this.innerHTML = "" }).on("dragenter mouseover", function () { e(this).addClass(t) }).on("dragleave mouseout", function () { e(this).removeClass(t) }).prependTo(i).after('<div class="elfinder-upload-dialog-or">' + p.i18n("or") + "</div>")[0], s = this.fmDialog(i, { title: this.title + '<span class="elfinder-upload-target">' + (m ? " - " + p.escape(m.i18 || m.name) : "") + "</span>", modal: !0, resizable: !1, destroyOnClose: !0, propagationEvents: ["mousemove", "mouseup", "click"], close: function () { var e = p.getUI("contextmenu"); e.is(":visible") && e.click() } }), w) } }, h.prototype.commands.view = function () { "use strict"; var t, n = this, i = this.fm; this.value = i.viewType, this.alwaysEnabled = !0, this.updateOnSelect = !1, this.options = { ui: "viewbutton" }, this.getstate = function () { return 0 }, this.extra = { icon: "menu", node: e("<span></span>").attr({ title: i.i18n("viewtype") }).on("click touchstart", function (t) { if (!("touchstart" === t.type && t.originalEvent.touches.length > 1)) { var n = e(this); t.stopPropagation(), t.preventDefault(), i.trigger("contextmenu", { raw: getSubMenuRaw(), x: n.offset().left, y: n.offset().top }) } }) }, this.exec = function () { var e = this, t = "list" == this.value ? "icons" : "list"; return i.storage("view", t), i.lazy(function () { i.viewchange(), e.update(void 0, t), this.resolve() }) }, i.bind("init", function () { t = function () { var e, t = i.getUI("cwd"), a = [], o = i.options.uiOptions.cwd.iconsView.sizeNames, r = i.options.uiOptions.cwd.iconsView.sizeMax; for (e = 0; e <= r; e++)a.push({ label: i.i18n(o[e] || "Size-" + e + " icons"), icon: "view", callback: function (e) { return function () { t.trigger("iconpref", { size: e }), i.storage("iconsize", e), "list" === n.value && n.exec() } }(e) }); return a.push("|"), a.push({ label: i.i18n("viewlist"), icon: "view-list", callback: function () { "list" !== n.value && n.exec() } }), a }() }).bind("contextmenucreate", function () { n.extra = { icon: "menu", node: e("<span></span>").attr({ title: i.i18n("cmdview") }).on("click touchstart", function (a) { if (!("touchstart" === a.type && a.originalEvent.touches.length > 1)) { var o, r, s = e(this); t.concat(); for (o = "list" === n.value ? t.length - 1 : parseInt(i.storage("iconsize") || 0), r = 0; r < t.length; r++)"|" !== t[r] && (t[r].options = r === o ? { className: "ui-state-active" } : void 0); a.stopPropagation(), a.preventDefault(), i.trigger("contextmenu", { raw: t, x: s.offset().left, y: s.offset().top }) } }) } }) }, h });